Return-Path: <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>
X-Original-To: lists+qemu-devel@lfdr.de
Delivered-To: lists+qemu-devel@lfdr.de
Received: from lists.gnu.org (lists.gnu.org [209.51.188.17])
	by mail.lfdr.de (Postfix) with ESMTPS id AFEFF3F8D98
	for <lists+qemu-devel@lfdr.de>; Thu, 26 Aug 2021 20:08:51 +0200 (CEST)
Received: from localhost ([::1]:52590 helo=lists1p.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.90_1)
	(envelope-from <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>)
	id 1mJJo2-0003hx-OX
	for lists+qemu-devel@lfdr.de; Thu, 26 Aug 2021 14:08:50 -0400
Received: from eggs.gnu.org ([2001:470:142:3::10]:52516)
 by lists.gnu.org with esmtps (TLS1.2:ECDHE_RSA_AES_256_GCM_SHA384:256)
 (Exim 4.90_1) (envelope-from <tsimpson@qualcomm.com>)
 id 1mJJJU-0005tj-H9
 for qemu-devel@nongnu.org; Thu, 26 Aug 2021 13:37:16 -0400
Received: from alexa-out-sd-01.qualcomm.com ([199.106.114.38]:3083)
 by eggs.gnu.org with esmtps (TLS1.2:RSA_AES_256_CBC_SHA1:256)
 (Exim 4.90_1) (envelope-from <tsimpson@qualcomm.com>)
 id 1mJJJP-00058v-NT
 for qemu-devel@nongnu.org; Thu, 26 Aug 2021 13:37:16 -0400
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=quicinc.com; i=@quicinc.com; q=dns/txt; s=qcdkim;
 t=1629999431; x=1661535431;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=bwRqfg7owG23+ALxRoDNZ6zgdDT01vuXNSqe4kMjyNA=;
 b=e81EOYdUzZNK7tdoCHn8fioyMrsAV/EERFcLA02/E+jh5RyxNjP3eVbC
 M3m+MEtTVBuhGAVerxJ8Eoi5rX/PtYIsTzw1G8p7KLsbn2diUC4NQYZ5p
 izbKIHhhShC8qSWAQWVS76flvNaoF6AxL7xNLP7NU1OIbIiyZSf1J/SCk w=;
Received: from unknown (HELO ironmsg-SD-alpha.qualcomm.com) ([10.53.140.30])
 by alexa-out-sd-01.qualcomm.com with ESMTP; 26 Aug 2021 10:36:16 -0700
X-QCInternal: smtphost
Received: from vu-tsimpson-aus.qualcomm.com (HELO
 vu-tsimpson1-aus.qualcomm.com) ([10.222.150.1])
 by ironmsg-SD-alpha.qualcomm.com with ESMTP; 26 Aug 2021 10:36:15 -0700
Received: by vu-tsimpson1-aus.qualcomm.com (Postfix, from userid 47164)
 id 9679B16ED; Thu, 26 Aug 2021 12:36:13 -0500 (CDT)
From: Taylor Simpson <tsimpson@quicinc.com>
To: qemu-devel@nongnu.org
Subject: [PATCH v2 25/30] Hexagon HVX (target/hexagon) instruction decoding
Date: Thu, 26 Aug 2021 12:35:53 -0500
Message-Id: <1629999358-25304-26-git-send-email-tsimpson@quicinc.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1629999358-25304-1-git-send-email-tsimpson@quicinc.com>
References: <1629999358-25304-1-git-send-email-tsimpson@quicinc.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Received-SPF: pass client-ip=199.106.114.38;
 envelope-from=tsimpson@qualcomm.com; helo=alexa-out-sd-01.qualcomm.com
X-Spam_score_int: -40
X-Spam_score: -4.1
X-Spam_bar: ----
X-Spam_report: (-4.1 / 5.0 requ) BAYES_00=-1.9, DKIM_SIGNED=0.1,
 DKIM_VALID=-0.1, DKIM_VALID_AU=-0.1, HEADER_FROM_DIFFERENT_DOMAINS=0.249,
 RCVD_IN_DNSWL_MED=-2.3, SPF_HELO_NONE=0.001,
 SPF_PASS=-0.001 autolearn=ham autolearn_force=no
X-Spam_action: no action
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <https://lists.nongnu.org/archive/html/qemu-devel>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Cc: ale@rev.ng, bcain@quicinc.com, tsimpson@quicinc.com,
 richard.henderson@linaro.org, f4bug@amsat.org
Errors-To: qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org
Sender: "Qemu-devel" <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>

QWRkIG5ldyBmaWxlIHRvIHRhcmdldC9oZXhhZ29uL21lc29uLmJ1aWxkCgpTaWduZWQtb2ZmLWJ5
OiBUYXlsb3IgU2ltcHNvbiA8dHNpbXBzb25AcXVpY2luYy5jb20+Ci0tLQogdGFyZ2V0L2hleGFn
b24vbW12ZWMvZGVjb2RlX2V4dF9tbXZlYy5oIHwgIDI0ICsrKysKIHRhcmdldC9oZXhhZ29uL2Rl
Y29kZS5jICAgICAgICAgICAgICAgICB8ICAyNCArKystCiB0YXJnZXQvaGV4YWdvbi9tbXZlYy9k
ZWNvZGVfZXh0X21tdmVjLmMgfCAyMzYgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysK
IHRhcmdldC9oZXhhZ29uL21lc29uLmJ1aWxkICAgICAgICAgICAgICB8ICAgMSArCiA0IGZpbGVz
IGNoYW5nZWQsIDI4MyBpbnNlcnRpb25zKCspLCAyIGRlbGV0aW9ucygtKQogY3JlYXRlIG1vZGUg
MTAwNjQ0IHRhcmdldC9oZXhhZ29uL21tdmVjL2RlY29kZV9leHRfbW12ZWMuaAogY3JlYXRlIG1v
ZGUgMTAwNjQ0IHRhcmdldC9oZXhhZ29uL21tdmVjL2RlY29kZV9leHRfbW12ZWMuYwoKZGlmZiAt
LWdpdCBhL3RhcmdldC9oZXhhZ29uL21tdmVjL2RlY29kZV9leHRfbW12ZWMuaCBiL3RhcmdldC9o
ZXhhZ29uL21tdmVjL2RlY29kZV9leHRfbW12ZWMuaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRl
eCAwMDAwMDAwLi4zNjY0YjY4Ci0tLSAvZGV2L251bGwKKysrIGIvdGFyZ2V0L2hleGFnb24vbW12
ZWMvZGVjb2RlX2V4dF9tbXZlYy5oCkBAIC0wLDAgKzEsMjQgQEAKKy8qCisgKiAgQ29weXJpZ2h0
KGMpIDIwMTktMjAyMSBRdWFsY29tbSBJbm5vdmF0aW9uIENlbnRlciwgSW5jLiBBbGwgUmlnaHRz
IFJlc2VydmVkLgorICoKKyAqICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNh
biByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQorICogIGl0IHVuZGVyIHRoZSB0ZXJtcyBv
ZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5CisgKiAgdGhl
IEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMiBvZiB0aGUgTGljZW5z
ZSwgb3IKKyAqICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgorICoKKyAqICBU
aGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVz
ZWZ1bCwKKyAqICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1w
bGllZCB3YXJyYW50eSBvZgorICogIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBB
UlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKKyAqICBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5z
ZSBmb3IgbW9yZSBkZXRhaWxzLgorICoKKyAqICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBj
b3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQorICogIGFsb25nIHdpdGggdGhp
cyBwcm9ncmFtOyBpZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCisg
Ki8KKworI2lmbmRlZiBIRVhBR09OX0RFQ09ERV9FWFRfTU1WRUNfSAorI2RlZmluZSBIRVhBR09O
X0RFQ09ERV9FWFRfTU1WRUNfSAorCit2b2lkIG1tdmVjX2V4dF9kZWNvZGVfY2hlY2tzKFBhY2tl
dCAqcGt0LCBib29sIGRpc2FzX29ubHkpOworU2xvdE1hc2sgbW12ZWNfZXh0X2RlY29kZV9maW5k
X2ljbGFzc19zbG90cyhpbnQgb3Bjb2RlKTsKKworI2VuZGlmCmRpZmYgLS1naXQgYS90YXJnZXQv
aGV4YWdvbi9kZWNvZGUuYyBiL3RhcmdldC9oZXhhZ29uL2RlY29kZS5jCmluZGV4IGQ0MjQyNDUu
LjY1M2JmZDcgMTAwNjQ0Ci0tLSBhL3RhcmdldC9oZXhhZ29uL2RlY29kZS5jCisrKyBiL3Rhcmdl
dC9oZXhhZ29uL2RlY29kZS5jCkBAIC0yMiw2ICsyMiw3IEBACiAjaW5jbHVkZSAiZGVjb2RlLmgi
CiAjaW5jbHVkZSAiaW5zbi5oIgogI2luY2x1ZGUgInByaW50aW5zbi5oIgorI2luY2x1ZGUgIm1t
dmVjL2RlY29kZV9leHRfbW12ZWMuaCIKIAogI2RlZmluZSBmWlhUTihOLCBNLCBWQUwpICgoVkFM
KSAmICgoMUxMIDw8IChOKSkgLSAxKSkKIApAQCAtNTY2LDggKzU2NywxMiBAQCBzdGF0aWMgdm9p
ZCBkZWNvZGVfcmVtb3ZlX2V4dGVuZGVycyhQYWNrZXQgKnBhY2tldCkKIAogc3RhdGljIFNsb3RN
YXNrIGdldF92YWxpZF9zbG90cyhjb25zdCBQYWNrZXQgKnBrdCwgdW5zaWduZWQgaW50IHNsb3Qp
CiB7Ci0gICAgcmV0dXJuIGZpbmRfaWNsYXNzX3Nsb3RzKHBrdC0+aW5zbltzbG90XS5vcGNvZGUs
Ci0gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBrdC0+aW5zbltzbG90XS5pY2xhc3MpOwor
ICAgIGlmIChHRVRfQVRUUklCKHBrdC0+aW5zbltzbG90XS5vcGNvZGUsIEFfRVhURU5TSU9OKSkg
eworICAgICAgICByZXR1cm4gbW12ZWNfZXh0X2RlY29kZV9maW5kX2ljbGFzc19zbG90cyhwa3Qt
Pmluc25bc2xvdF0ub3Bjb2RlKTsKKyAgICB9IGVsc2UgeworICAgICAgICByZXR1cm4gZmluZF9p
Y2xhc3Nfc2xvdHMocGt0LT5pbnNuW3Nsb3RdLm9wY29kZSwKKyAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIHBrdC0+aW5zbltzbG90XS5pY2xhc3MpOworICAgIH0KIH0KIAogI2RlZmlu
ZSBERUNPREVfTkVXX1RBQkxFKFRBRywgU0laRSwgV0hBVE5PVCkgICAgIC8qIE5PVEhJTkcgKi8K
QEAgLTcyOCw2ICs3MzMsMTEgQEAgZGVjb2RlX2luc25zX3RhYmxld2FsayhJbnNuICppbnNuLCBj
b25zdCBEZWN0cmVlVGFibGUgKnRhYmxlLAogICAgICAgICB9CiAgICAgICAgIGRlY29kZV9vcChp
bnNuLCBvcGMsIGVuY29kaW5nKTsKICAgICAgICAgcmV0dXJuIDE7CisgICAgfSBlbHNlIGlmICh0
YWJsZS0+dGFibGVbaV0udHlwZSA9PSBERUNUUkVFX0VYVFNQQUNFKSB7CisgICAgICAgIC8qCisg
ICAgICAgICAqIEZvciBub3csIEhWWCB3aWxsIGJlIHRoZSBvbmx5IGNvcHJvYworICAgICAgICAg
Ki8KKyAgICAgICAgcmV0dXJuIGRlY29kZV9pbnNuc190YWJsZXdhbGsoaW5zbiwgZXh0X3RyZWVz
W0VYVF9JRFhfbW12ZWNdLCBlbmNvZGluZyk7CiAgICAgfSBlbHNlIHsKICAgICAgICAgcmV0dXJu
IDA7CiAgICAgfQpAQCAtODc0LDYgKzg4NCw3IEBAIGludCBkZWNvZGVfcGFja2V0KGludCBtYXhf
d29yZHMsIGNvbnN0IHVpbnQzMl90ICp3b3JkcywgUGFja2V0ICpwa3QsCiAgICAgaW50IHdvcmRz
X3JlYWQgPSAwOwogICAgIGJvb2wgZW5kX29mX3BhY2tldCA9IGZhbHNlOwogICAgIGludCBuZXdf
aW5zbnMgPSAwOworICAgIGludCBpOwogICAgIHVpbnQzMl90IGVuY29kaW5nMzI7CiAKICAgICAv
KiBJbml0aWFsaXplICovCkBAIC05MDEsNiArOTEyLDExIEBAIGludCBkZWNvZGVfcGFja2V0KGlu
dCBtYXhfd29yZHMsIGNvbnN0IHVpbnQzMl90ICp3b3JkcywgUGFja2V0ICpwa3QsCiAgICAgICAg
IHJldHVybiAwOwogICAgIH0KICAgICBwa3QtPmVuY29kX3BrdF9zaXplX2luX2J5dGVzID0gd29y
ZHNfcmVhZCAqIDQ7CisgICAgcGt0LT5wa3RfaGFzX2h2eCA9IGZhbHNlOworICAgIGZvciAoaSA9
IDA7IGkgPCBudW1faW5zbnM7IGkrKykgeworICAgICAgICBwa3QtPnBrdF9oYXNfaHZ4IHw9Cisg
ICAgICAgICAgICBHRVRfQVRUUklCKHBrdC0+aW5zbltpXS5vcGNvZGUsIEFfQ1ZJKTsKKyAgICB9
CiAKICAgICAvKgogICAgICAqIENoZWNrIGZvciA6ZW5kbG9vcCBpbiB0aGUgcGFyc2UgYml0cwpA
QCAtOTMxLDYgKzk0NywxMCBAQCBpbnQgZGVjb2RlX3BhY2tldChpbnQgbWF4X3dvcmRzLCBjb25z
dCB1aW50MzJfdCAqd29yZHMsIFBhY2tldCAqcGt0LAogICAgIGRlY29kZV9zZXRfc2xvdF9udW1i
ZXIocGt0KTsKICAgICBkZWNvZGVfZmlsbF9uZXd2YWx1ZV9yZWdubyhwa3QpOwogCisgICAgaWYg
KHBrdC0+cGt0X2hhc19odngpIHsKKyAgICAgICAgbW12ZWNfZXh0X2RlY29kZV9jaGVja3MocGt0
LCBkaXNhc19vbmx5KTsKKyAgICB9CisKICAgICBpZiAoIWRpc2FzX29ubHkpIHsKICAgICAgICAg
ZGVjb2RlX3NodWZmbGVfZm9yX2V4ZWN1dGlvbihwa3QpOwogICAgICAgICBkZWNvZGVfc3BsaXRf
Y21wanVtcChwa3QpOwpkaWZmIC0tZ2l0IGEvdGFyZ2V0L2hleGFnb24vbW12ZWMvZGVjb2RlX2V4
dF9tbXZlYy5jIGIvdGFyZ2V0L2hleGFnb24vbW12ZWMvZGVjb2RlX2V4dF9tbXZlYy5jCm5ldyBm
aWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAuLjA2MWE2NWEKLS0tIC9kZXYvbnVsbAorKysg
Yi90YXJnZXQvaGV4YWdvbi9tbXZlYy9kZWNvZGVfZXh0X21tdmVjLmMKQEAgLTAsMCArMSwyMzYg
QEAKKy8qCisgKiAgQ29weXJpZ2h0KGMpIDIwMTktMjAyMSBRdWFsY29tbSBJbm5vdmF0aW9uIENl
bnRlciwgSW5jLiBBbGwgUmlnaHRzIFJlc2VydmVkLgorICoKKyAqICBUaGlzIHByb2dyYW0gaXMg
ZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQorICog
IGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMg
cHVibGlzaGVkIGJ5CisgKiAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZl
cnNpb24gMiBvZiB0aGUgTGljZW5zZSwgb3IKKyAqICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRl
ciB2ZXJzaW9uLgorICoKKyAqICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhv
cGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKKyAqICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7
IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgorICogIE1FUkNIQU5UQUJJTElU
WSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKKyAqICBHTlUg
R2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgorICoKKyAqICBZb3Ugc2hv
dWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5z
ZQorICogIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtOyBpZiBub3QsIHNlZSA8aHR0cDovL3d3dy5n
bnUub3JnL2xpY2Vuc2VzLz4uCisgKi8KKworI2luY2x1ZGUgInFlbXUvb3NkZXAuaCIKKyNpbmNs
dWRlICJkZWNvZGUuaCIKKyNpbmNsdWRlICJvcGNvZGVzLmgiCisjaW5jbHVkZSAiaW5zbi5oIgor
I2luY2x1ZGUgImljbGFzcy5oIgorI2luY2x1ZGUgIm1tdmVjL21tdmVjLmgiCisjaW5jbHVkZSAi
bW12ZWMvZGVjb2RlX2V4dF9tbXZlYy5oIgorCitzdGF0aWMgdm9pZAorY2hlY2tfbmV3X3ZhbHVl
KFBhY2tldCAqcGt0KQoreworICAgIC8qIC5uZXcgdmFsdWUgZm9yIGEgTU1WZWN0b3Igc3RvcmUg
Ki8KKyAgICBpbnQgaSwgajsKKyAgICBjb25zdCBjaGFyICpyZWdpbmZvOworICAgIGNvbnN0IGNo
YXIgKmRlc3RsZXR0ZXJzOworICAgIGNvbnN0IGNoYXIgKmRzdHN0ciA9IE5VTEw7CisgICAgdWlu
dDE2X3QgZGVmX29wY29kZTsKKyAgICBjaGFyIGxldHRlcjsKKyAgICBpbnQgZGVmX3JlZ251bTsK
KworICAgIGZvciAoaSA9IDE7IGkgPCBwa3QtPm51bV9pbnNuczsgaSsrKSB7CisgICAgICAgIHVp
bnQxNl90IHVzZV9vcGNvZGUgPSBwa3QtPmluc25baV0ub3Bjb2RlOworICAgICAgICBpZiAoR0VU
X0FUVFJJQih1c2Vfb3Bjb2RlLCBBX0RPVE5FV1ZBTFVFKSAmJgorICAgICAgICAgICAgR0VUX0FU
VFJJQih1c2Vfb3Bjb2RlLCBBX0NWSSkgJiYKKyAgICAgICAgICAgIEdFVF9BVFRSSUIodXNlX29w
Y29kZSwgQV9TVE9SRSkpIHsKKyAgICAgICAgICAgIGludCB1c2VfcmVnaWR4ID0gc3RyY2hyKG9w
Y29kZV9yZWdpbmZvW3VzZV9vcGNvZGVdLCAncycpIC0KKyAgICAgICAgICAgICAgICBvcGNvZGVf
cmVnaW5mb1t1c2Vfb3Bjb2RlXTsKKyAgICAgICAgICAgIC8qCisgICAgICAgICAgICAgKiBXaGF0
J3MgZW5jb2RlZCBhdCB0aGUgTi1maWVsZCBpcyB0aGUgb2Zmc2V0IHRvIHdobydzIHByb2R1Y2lu
ZworICAgICAgICAgICAgICogdGhlIHZhbHVlLgorICAgICAgICAgICAgICogU2hpZnQgb2ZmIHRo
ZSBMU0Igd2hpY2ggaW5kaWNhdGVzIG9kZC9ldmVuIHJlZ2lzdGVyLgorICAgICAgICAgICAgICov
CisgICAgICAgICAgICBpbnQgZGVmX29mZiA9ICgocGt0LT5pbnNuW2ldLnJlZ25vW3VzZV9yZWdp
ZHhdKSA+PiAxKTsKKyAgICAgICAgICAgIGludCBkZWZfb3JlZyA9IHBrdC0+aW5zbltpXS5yZWdu
b1t1c2VfcmVnaWR4XSAmIDE7CisgICAgICAgICAgICBpbnQgZGVmX2lkeCA9IC0xOworICAgICAg
ICAgICAgZm9yIChqID0gaSAtIDE7IChqID49IDApICYmIChkZWZfb2ZmID49IDApOyBqLS0pIHsK
KyAgICAgICAgICAgICAgICBpZiAoIUdFVF9BVFRSSUIocGt0LT5pbnNuW2pdLm9wY29kZSwgQV9D
VkkpKSB7CisgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOworICAgICAgICAgICAgICAgIH0K
KyAgICAgICAgICAgICAgICBkZWZfb2ZmLS07CisgICAgICAgICAgICAgICAgaWYgKGRlZl9vZmYg
PT0gMCkgeworICAgICAgICAgICAgICAgICAgICBkZWZfaWR4ID0gajsKKyAgICAgICAgICAgICAg
ICAgICAgYnJlYWs7CisgICAgICAgICAgICAgICAgfQorICAgICAgICAgICAgfQorICAgICAgICAg
ICAgLyoKKyAgICAgICAgICAgICAqIENoZWNrIGZvciBhIGJhZGx5IGVuY29kZWQgTi1maWVsZCB3
aGljaCBwb2ludHMgdG8gYW4gaW5zdHJ1Y3Rpb24KKyAgICAgICAgICAgICAqIG91dC1vZi1yYW5n
ZQorICAgICAgICAgICAgICovCisgICAgICAgICAgICBnX2Fzc2VydCghKChkZWZfb2ZmICE9IDAp
IHx8IChkZWZfaWR4IDwgMCkgfHwKKyAgICAgICAgICAgICAgICAgICAgICAgKGRlZl9pZHggPiAo
cGt0LT5udW1faW5zbnMgLSAxKSkpKTsKKworICAgICAgICAgICAgLyogZGVmX2lkeCBpcyB0aGUg
aW5kZXggb2YgdGhlIHByb2R1Y2VyICovCisgICAgICAgICAgICBkZWZfb3Bjb2RlID0gcGt0LT5p
bnNuW2RlZl9pZHhdLm9wY29kZTsKKyAgICAgICAgICAgIHJlZ2luZm8gPSBvcGNvZGVfcmVnaW5m
b1tkZWZfb3Bjb2RlXTsKKyAgICAgICAgICAgIGRlc3RsZXR0ZXJzID0gImRleHkiOworICAgICAg
ICAgICAgZm9yIChqID0gMDsgKGxldHRlciA9IGRlc3RsZXR0ZXJzW2pdKSAhPSAwOyBqKyspIHsK
KyAgICAgICAgICAgICAgICBkc3RzdHIgPSBzdHJjaHIocmVnaW5mbywgbGV0dGVyKTsKKyAgICAg
ICAgICAgICAgICBpZiAoZHN0c3RyICE9IE5VTEwpIHsKKyAgICAgICAgICAgICAgICAgICAgYnJl
YWs7CisgICAgICAgICAgICAgICAgfQorICAgICAgICAgICAgfQorICAgICAgICAgICAgaWYgKChk
c3RzdHIgPT0gTlVMTCkgICYmIEdFVF9BVFRSSUIoZGVmX29wY29kZSwgQV9DVklfR0FUSEVSKSkg
eworICAgICAgICAgICAgICAgIGRlZl9yZWdudW0gPSAwOworICAgICAgICAgICAgICAgIHBrdC0+
aW5zbltpXS5yZWdub1t1c2VfcmVnaWR4XSA9IGRlZl9vcmVnOworICAgICAgICAgICAgICAgIHBr
dC0+aW5zbltpXS5uZXdfdmFsdWVfcHJvZHVjZXJfc2xvdCA9IHBrdC0+aW5zbltkZWZfaWR4XS5z
bG90OworICAgICAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgICAgICBpZiAoZHN0c3RyID09
IE5VTEwpIHsKKyAgICAgICAgICAgICAgICAgICAgLyogc3RpbGwgbm90IHRoZXJlLCB3ZSBoYXZl
IGEgYmFkIHBhY2tldCAqLworICAgICAgICAgICAgICAgICAgICBnX2Fzc2VydF9ub3RfcmVhY2hl
ZCgpOworICAgICAgICAgICAgICAgIH0KKyAgICAgICAgICAgICAgICBkZWZfcmVnbnVtID0gcGt0
LT5pbnNuW2RlZl9pZHhdLnJlZ25vW2RzdHN0ciAtIHJlZ2luZm9dOworICAgICAgICAgICAgICAg
IC8qIE5vdyBwYXRjaCB1cCB0aGUgY29uc3VtZXIgd2l0aCB0aGUgcmVnaXN0ZXIgbnVtYmVyICov
CisgICAgICAgICAgICAgICAgcGt0LT5pbnNuW2ldLnJlZ25vW3VzZV9yZWdpZHhdID0gZGVmX3Jl
Z251bSBeIGRlZl9vcmVnOworICAgICAgICAgICAgICAgIC8qIHNwZWNpYWwgY2FzZSBmb3IgKFZ4
LFZ5KSAqLworICAgICAgICAgICAgICAgIGRzdHN0ciA9IHN0cmNocihyZWdpbmZvLCAneScpOwor
ICAgICAgICAgICAgICAgIGlmIChkZWZfb3JlZyAmJiBzdHJjaHIocmVnaW5mbywgJ3gnKSAmJiBk
c3RzdHIpIHsKKyAgICAgICAgICAgICAgICAgICAgZGVmX3JlZ251bSA9IHBrdC0+aW5zbltkZWZf
aWR4XS5yZWdub1tkc3RzdHIgLSByZWdpbmZvXTsKKyAgICAgICAgICAgICAgICAgICAgcGt0LT5p
bnNuW2ldLnJlZ25vW3VzZV9yZWdpZHhdID0gZGVmX3JlZ251bTsKKyAgICAgICAgICAgICAgICB9
CisgICAgICAgICAgICAgICAgLyoKKyAgICAgICAgICAgICAgICAgKiBXZSBuZWVkIHRvIHJlbWVt
YmVyIHdobyBwcm9kdWNlcyB0aGlzIHZhbHVlIHRvIGxhdGVyCisgICAgICAgICAgICAgICAgICog
Y2hlY2sgaWYgaXQgd2FzIGR5bmFtaWNhbGx5IGNhbmNlbGxlZAorICAgICAgICAgICAgICAgICAq
LworICAgICAgICAgICAgICAgIHBrdC0+aW5zbltpXS5uZXdfdmFsdWVfcHJvZHVjZXJfc2xvdCA9
IHBrdC0+aW5zbltkZWZfaWR4XS5zbG90OworICAgICAgICAgICAgfQorICAgICAgICB9CisgICAg
fQorfQorCisvKgorICogV2UgZG9uJ3Qgd2FudCB0byByZW9yZGVyIHNsb3QxL3Nsb3QwIHdpdGgg
cmVzcGVjdCB0byBlYWNoIG90aGVyLgorICogU28gaW4gb3VyIHNodWZmbGluZywgd2UgZG9uJ3Qg
d2FudCB0byBtb3ZlIHRoZSAuY3VyIC8gLnRtcCB2bWVtIGVhcmxpZXIKKyAqIEluc3RlYWQsIHdl
IHNob3VsZCBtb3ZlIHRoZSBwcm9kdWNpbmcgaW5zdHJ1Y3Rpb24gbGF0ZXIKKyAqIEJ1dCB0aGUg
cHJvZHVjaW5nIGluc3RydWN0aW9uIG1pZ2h0IGZlZWQgYSAubmV3IHN0b3JlIQorICogU28gd2Ug
bWF5IG5lZWQgdG8gbW92ZSB0aGF0IGV2ZW4gbGF0ZXIuCisgKi8KKworc3RhdGljIHZvaWQKK2Rl
Y29kZV9tbXZlY19tb3ZlX2N2aV90b19lbmQoUGFja2V0ICpwa3QsIGludCBtYXgpCit7CisgICAg
aW50IGk7CisgICAgZm9yIChpID0gMDsgaSA8IG1heDsgaSsrKSB7CisgICAgICAgIGlmIChHRVRf
QVRUUklCKHBrdC0+aW5zbltpXS5vcGNvZGUsIEFfQ1ZJKSkgeworICAgICAgICAgICAgaW50IGxh
c3RfaW5zdCA9IHBrdC0+bnVtX2luc25zIC0gMTsKKyAgICAgICAgICAgIHVpbnQxNl90IGxhc3Rf
b3Bjb2RlID0gcGt0LT5pbnNuW2xhc3RfaW5zdF0ub3Bjb2RlOworCisgICAgICAgICAgICAvKgor
ICAgICAgICAgICAgICogSWYgdGhlIGxhc3QgaW5zdHJ1Y3Rpb24gaXMgYW4gZW5kbG9vcCwgbW92
ZSB0byB0aGUgb25lIGJlZm9yZSBpdAorICAgICAgICAgICAgICogS2VlcCBlbmRsb29wIGFzIHRo
ZSBsYXN0IHRoaW5nIGFsd2F5cworICAgICAgICAgICAgICovCisgICAgICAgICAgICBpZiAoKGxh
c3Rfb3Bjb2RlID09IEoyX2VuZGxvb3AwKSB8fAorICAgICAgICAgICAgICAgIChsYXN0X29wY29k
ZSA9PSBKMl9lbmRsb29wMSkgfHwKKyAgICAgICAgICAgICAgICAobGFzdF9vcGNvZGUgPT0gSjJf
ZW5kbG9vcDAxKSkgeworICAgICAgICAgICAgICAgIGxhc3RfaW5zdC0tOworICAgICAgICAgICAg
fQorCisgICAgICAgICAgICBkZWNvZGVfc2VuZF9pbnNuX3RvKHBrdCwgaSwgbGFzdF9pbnN0KTsK
KyAgICAgICAgICAgIG1heC0tOworICAgICAgICAgICAgaS0tOyAgICAvKiBSZXRyeSB0aGlzIGlu
ZGV4IG5vdyB0aGF0IHBhY2tldCBoYXMgcm90YXRlZCAqLworICAgICAgICB9CisgICAgfQorfQor
CitzdGF0aWMgdm9pZAorZGVjb2RlX3NodWZmbGVfZm9yX2V4ZWN1dGlvbl92b3BzKFBhY2tldCAq
cGt0KQoreworICAgIC8qCisgICAgICogU29ydCBmb3IgLm5ldworICAgICAqLworICAgIGludCBp
OworICAgIGZvciAoaSA9IDA7IGkgPCBwa3QtPm51bV9pbnNuczsgaSsrKSB7CisgICAgICAgIHVp
bnQxNl90IG9wY29kZSA9IHBrdC0+aW5zbltpXS5vcGNvZGU7CisgICAgICAgIGlmIChHRVRfQVRU
UklCKG9wY29kZSwgQV9MT0FEKSAmJgorICAgICAgICAgICAgKEdFVF9BVFRSSUIob3Bjb2RlLCBB
X0NWSV9ORVcpIHx8CisgICAgICAgICAgICAgR0VUX0FUVFJJQihvcGNvZGUsIEFfQ1ZJX1RNUCkp
KSB7CisgICAgICAgICAgICAvKgorICAgICAgICAgICAgICogRmluZCBwcmlvciBjb25zdW1pbmcg
dmVjdG9yIGluc3RydWN0aW9ucworICAgICAgICAgICAgICogTW92ZSB0byBlbmQgb2YgcGFja2V0
CisgICAgICAgICAgICAgKi8KKyAgICAgICAgICAgIGRlY29kZV9tbXZlY19tb3ZlX2N2aV90b19l
bmQocGt0LCBpKTsKKyAgICAgICAgICAgIGJyZWFrOworICAgICAgICB9CisgICAgfQorCisgICAg
LyogTW92ZSBIVlggbmV3IHZhbHVlIHN0b3JlcyB0byB0aGUgZW5kIG9mIHRoZSBwYWNrZXQgKi8K
KyAgICBmb3IgKGkgPSAwOyBpIDwgcGt0LT5udW1faW5zbnMgLSAxOyBpKyspIHsKKyAgICAgICAg
dWludDE2X3Qgb3Bjb2RlID0gcGt0LT5pbnNuW2ldLm9wY29kZTsKKyAgICAgICAgaWYgKEdFVF9B
VFRSSUIob3Bjb2RlLCBBX1NUT1JFKSAmJgorICAgICAgICAgICAgR0VUX0FUVFJJQihvcGNvZGUs
IEFfQ1ZJX05FVykgJiYKKyAgICAgICAgICAgICFHRVRfQVRUUklCKG9wY29kZSwgQV9DVklfU0NB
VFRFUl9SRUxFQVNFKSkgeworICAgICAgICAgICAgaW50IGxhc3RfaW5zdCA9IHBrdC0+bnVtX2lu
c25zIC0gMTsKKyAgICAgICAgICAgIHVpbnQxNl90IGxhc3Rfb3Bjb2RlID0gcGt0LT5pbnNuW2xh
c3RfaW5zdF0ub3Bjb2RlOworCisgICAgICAgICAgICAvKgorICAgICAgICAgICAgICogSWYgdGhl
IGxhc3QgaW5zdHJ1Y3Rpb24gaXMgYW4gZW5kbG9vcCwgbW92ZSB0byB0aGUgb25lIGJlZm9yZSBp
dAorICAgICAgICAgICAgICogS2VlcCBlbmRsb29wIGFzIHRoZSBsYXN0IHRoaW5nIGFsd2F5cwor
ICAgICAgICAgICAgICovCisgICAgICAgICAgICBpZiAoKGxhc3Rfb3Bjb2RlID09IEoyX2VuZGxv
b3AwKSB8fAorICAgICAgICAgICAgICAgIChsYXN0X29wY29kZSA9PSBKMl9lbmRsb29wMSkgfHwK
KyAgICAgICAgICAgICAgICAobGFzdF9vcGNvZGUgPT0gSjJfZW5kbG9vcDAxKSkgeworICAgICAg
ICAgICAgICAgIGxhc3RfaW5zdC0tOworICAgICAgICAgICAgfQorCisgICAgICAgICAgICBkZWNv
ZGVfc2VuZF9pbnNuX3RvKHBrdCwgaSwgbGFzdF9pbnN0KTsKKyAgICAgICAgICAgIGJyZWFrOwor
ICAgICAgICB9CisgICAgfQorfQorCitzdGF0aWMgdm9pZAorY2hlY2tfZm9yX3ZoaXN0KFBhY2tl
dCAqcGt0KQoreworICAgIHBrdC0+dmhpc3RfaW5zbiA9IE5VTEw7CisgICAgZm9yIChpbnQgaSA9
IDA7IGkgPCBwa3QtPm51bV9pbnNuczsgaSsrKSB7CisgICAgICAgIEluc24gKmluc24gPSAmcGt0
LT5pbnNuW2ldOworICAgICAgICBpbnQgb3Bjb2RlID0gaW5zbi0+b3Bjb2RlOworICAgICAgICBp
ZiAoR0VUX0FUVFJJQihvcGNvZGUsIEFfQ1ZJKSAmJiBHRVRfQVRUUklCKG9wY29kZSwgQV9DVklf
NFNMT1QpKSB7CisgICAgICAgICAgICAgICAgcGt0LT52aGlzdF9pbnNuID0gaW5zbjsKKyAgICAg
ICAgICAgICAgICByZXR1cm47CisgICAgICAgIH0KKyAgICB9Cit9CisKKy8qCisgKiBQdWJsaWMg
RnVuY3Rpb25zCisgKi8KKworU2xvdE1hc2sgbW12ZWNfZXh0X2RlY29kZV9maW5kX2ljbGFzc19z
bG90cyhpbnQgb3Bjb2RlKQoreworICAgIGlmIChHRVRfQVRUUklCKG9wY29kZSwgQV9DVklfVk0p
KSB7CisgICAgICAgIC8qIEhWWCBtZW1vcnkgaW5zdHJ1Y3Rpb24gKi8KKyAgICAgICAgaWYgKEdF
VF9BVFRSSUIob3Bjb2RlLCBBX1JFU1RSSUNUX1NMT1QwT05MWSkpIHsKKyAgICAgICAgICAgIHJl
dHVybiBTTE9UU18wOworICAgICAgICB9IGVsc2UgaWYgKEdFVF9BVFRSSUIob3Bjb2RlLCBBX1JF
U1RSSUNUX1NMT1QxT05MWSkpIHsKKyAgICAgICAgICAgIHJldHVybiBTTE9UU18xOworICAgICAg
ICB9CisgICAgICAgIHJldHVybiBTTE9UU18wMTsKKyAgICB9IGVsc2UgaWYgKEdFVF9BVFRSSUIo
b3Bjb2RlLCBBX1JFU1RSSUNUX1NMT1QyT05MWSkpIHsKKyAgICAgICAgcmV0dXJuIFNMT1RTXzI7
CisgICAgfSBlbHNlIGlmIChHRVRfQVRUUklCKG9wY29kZSwgQV9DVklfVlgpKSB7CisgICAgICAg
IC8qIEhWWCBtdWx0aXBseSBpbnN0cnVjdGlvbiAqLworICAgICAgICByZXR1cm4gU0xPVFNfMjM7
CisgICAgfSBlbHNlIGlmIChHRVRfQVRUUklCKG9wY29kZSwgQV9DVklfVlNfVlgpKSB7CisgICAg
ICAgIC8qIEhWWCBwZXJtdXRlL3NoaWZ0IGluc3RydWN0aW9uICovCisgICAgICAgIHJldHVybiBT
TE9UU18yMzsKKyAgICB9IGVsc2UgeworICAgICAgICByZXR1cm4gU0xPVFNfMDEyMzsKKyAgICB9
Cit9CisKK3ZvaWQgbW12ZWNfZXh0X2RlY29kZV9jaGVja3MoUGFja2V0ICpwa3QsIGJvb2wgZGlz
YXNfb25seSkKK3sKKyAgICBjaGVja19uZXdfdmFsdWUocGt0KTsKKyAgICBpZiAoIWRpc2FzX29u
bHkpIHsKKyAgICAgICAgZGVjb2RlX3NodWZmbGVfZm9yX2V4ZWN1dGlvbl92b3BzKHBrdCk7Cisg
ICAgfQorICAgIGNoZWNrX2Zvcl92aGlzdChwa3QpOworfQpkaWZmIC0tZ2l0IGEvdGFyZ2V0L2hl
eGFnb24vbWVzb24uYnVpbGQgYi90YXJnZXQvaGV4YWdvbi9tZXNvbi5idWlsZAppbmRleCBjYWUz
NjZjLi42NGIxNDRiIDEwMDY0NAotLS0gYS90YXJnZXQvaGV4YWdvbi9tZXNvbi5idWlsZAorKysg
Yi90YXJnZXQvaGV4YWdvbi9tZXNvbi5idWlsZApAQCAtMTc0LDYgKzE3NCw3IEBAIGhleGFnb25f
c3MuYWRkKGZpbGVzKAogICAgICdwcmludGluc24uYycsCiAgICAgJ2FyY2guYycsCiAgICAgJ2Zt
YV9lbXUuYycsCisgICAgJ21tdmVjL2RlY29kZV9leHRfbW12ZWMuYycsCiAgICAgJ21tdmVjL3N5
c3RlbV9leHRfbW12ZWMuYycsCiApKQogCi0tIAoyLjcuNAoK

