Return-Path: <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>
X-Original-To: lists+qemu-devel@lfdr.de
Delivered-To: lists+qemu-devel@lfdr.de
Received: from lists.gnu.org (lists.gnu.org [209.51.188.17])
	by mail.lfdr.de (Postfix) with ESMTPS id 6707D17AB3C
	for <lists+qemu-devel@lfdr.de>; Thu,  5 Mar 2020 18:10:34 +0100 (CET)
Received: from localhost ([::1]:53578 helo=lists1p.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.90_1)
	(envelope-from <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>)
	id 1j9u13-0002Wu-CX
	for lists+qemu-devel@lfdr.de; Thu, 05 Mar 2020 12:10:33 -0500
Received: from eggs.gnu.org ([2001:470:142:3::10]:38031)
 by lists.gnu.org with esmtp (Exim 4.90_1)
 (envelope-from <stefanha@redhat.com>) id 1j9tz6-0000LR-KM
 for qemu-devel@nongnu.org; Thu, 05 Mar 2020 12:08:35 -0500
Received: from Debian-exim by eggs.gnu.org with spam-scanned (Exim 4.71)
 (envelope-from <stefanha@redhat.com>) id 1j9tz3-0003Je-DF
 for qemu-devel@nongnu.org; Thu, 05 Mar 2020 12:08:32 -0500
Received: from us-smtp-delivery-1.mimecast.com ([207.211.31.120]:20777
 helo=us-smtp-1.mimecast.com)
 by eggs.gnu.org with esmtps (TLS1.0:DHE_RSA_AES_256_CBC_SHA1:32)
 (Exim 4.71) (envelope-from <stefanha@redhat.com>) id 1j9tz3-0003JO-7x
 for qemu-devel@nongnu.org; Thu, 05 Mar 2020 12:08:29 -0500
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1583428108;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=2FgGnk4xMp1dypbXhXumAD2XyGGYFYtkPxCu7Yv1eus=;
 b=TWizP0bmgKHleb20bAF9ZeJAawzjkl2ohBTB2UxBpajHIaTifLqxdt8dgwT4SUPfnvCoXr
 TcbxG14aoAUCrJoqgyjFpgKSYGqaF9iFyDdKficlSGmkQjHi1Y6XjS2iKYT9ub480m3Bl2
 tFzRJBDvaTfYrZPRxQXPPxHKVmuMLTE=
Received: from mimecast-mx01.redhat.com (mimecast-mx01.redhat.com
 [209.132.183.4]) (Using TLS) by relay.mimecast.com with ESMTP id
 us-mta-297-8OazA4EEMyeUHZT3Nyfbug-1; Thu, 05 Mar 2020 12:08:25 -0500
X-MC-Unique: 8OazA4EEMyeUHZT3Nyfbug-1
Received: from smtp.corp.redhat.com (int-mx05.intmail.prod.int.phx2.redhat.com
 [10.5.11.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mimecast-mx01.redhat.com (Postfix) with ESMTPS id 98581107ACC9;
 Thu,  5 Mar 2020 17:08:24 +0000 (UTC)
Received: from localhost (ovpn-117-104.ams2.redhat.com [10.36.117.104])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 4D28173880;
 Thu,  5 Mar 2020 17:08:21 +0000 (UTC)
From: Stefan Hajnoczi <stefanha@redhat.com>
To: qemu-devel@nongnu.org
Subject: [PATCH 3/7] aio-posix: extract ppoll(2) and epoll(7) fd monitoring
Date: Thu,  5 Mar 2020 17:08:02 +0000
Message-Id: <20200305170806.1313245-4-stefanha@redhat.com>
In-Reply-To: <20200305170806.1313245-1-stefanha@redhat.com>
References: <20200305170806.1313245-1-stefanha@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.15
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: redhat.com
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: base64
X-detected-operating-system: by eggs.gnu.org: GNU/Linux 2.2.x-3.x [generic]
 [fuzzy]
X-Received-From: 207.211.31.120
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <https://lists.nongnu.org/archive/html/qemu-devel>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Cc: Fam Zheng <fam@euphon.net>, Kevin Wolf <kwolf@redhat.com>,
 qemu-block@nongnu.org, Max Reitz <mreitz@redhat.com>,
 Stefan Hajnoczi <stefanha@redhat.com>, Paolo Bonzini <pbonzini@redhat.com>
Errors-To: qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org
Sender: "Qemu-devel" <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>

VGhlIHBwb2xsKDIpIGFuZCBlcG9sbCg3KSBmaWxlIGRlc2NyaXB0b3IgbW9uaXRvcmluZyBpbXBs
ZW1lbnRhdGlvbnMgYXJlCm1peGVkIHdpdGggdGhlIGNvcmUgdXRpbC9haW8tcG9zaXguYyBjb2Rl
LiAgQmVmb3JlIGFkZGluZyBhbm90aGVyCmltcGxlbWVudGF0aW9uIGZvciBMaW51eCBpb191cmlu
ZywgZXh0cmFjdCBvdXQgdGhlIGV4aXN0aW5nCm9uZXMgc28gdGhlcmUgaXMgYSBjbGVhciBpbnRl
cmZhY2UgYW5kIHRoZSBjb3JlIGNvZGUgaXMgc2ltcGxlci4KClRoZSBuZXcgaW50ZXJmYWNlIGlz
IEFpb0NvbnRleHQtPmZkbW9uX29wcywgYSBwb2ludGVyIHRvIGEgRkRNb25PcHMKc3RydWN0LiAg
U2VlIHRoZSBwYXRjaCBmb3IgZGV0YWlscy4KClNlbWFudGljIGNoYW5nZXM6CjEuIHBwb2xsKDIp
IG5vdyByZWZsZWN0cyBldmVudHMgZnJvbSBwb2xsZmRzW10gYmFjayBpbnRvIEFpb0hhbmRsZXJz
CiAgIHdoaWxlIHdlJ3JlIHN0aWxsIG9uIHRoZSBjbG9jayBmb3IgYWRhcHRpdmUgcG9sbGluZy4g
IFRoaXMgd2FzCiAgIGFscmVhZHkgaGFwcGVuaW5nIGZvciBlcG9sbCg3KSwgc28gaWYgaXQncyBy
ZWFsbHkgYW4gaXNzdWUgdGhlbiB3ZSdsbAogICBuZWVkIHRvIGZpeCBib3RoIGluIHRoZSBmdXR1
cmUuCjIuIGVwb2xsKDcpJ3MgZmFsbGJhY2sgdG8gcHBvbGwoMikgd2hpbGUgZXh0ZXJuYWwgZXZl
bnRzIGFyZSBkaXNhYmxlZAogICB3YXMgYnJva2VuIHdoZW4gdGhlIG51bWJlciBvZiBmZHMgZXhj
ZWVkZWQgdGhlIGVwb2xsKDcpIHVwZ3JhZGUKICAgdGhyZXNob2xkLiAgSSBndWVzcyB0aGlzIGNv
ZGUgcGF0aCBzaW1wbHkgd2Fzbid0IHRlc3RlZCBhbmQgbm8gb25lCiAgIG5vdGljZWQgdGhlIGJ1
Zy4gIEkgZGlkbid0IGdvIG91dCBvZiBteSB3YXkgdG8gZml4IGl0IGJ1dCB0aGUgY29ycmVjdAog
ICBjb2RlIGlzIHNpbXBsZXIgdGhhbiBwcmVzZXJ2aW5nIHRoZSBidWcuCgpJIGFsc28gdG9vayBz
b21lIGxpYmVydGllcyBpbiByZW1vdmluZyB0aGUgdW5uZWNlc3NhcnkKQWlvQ29udGV4dC0+ZXBv
bGxfYXZhaWxhYmxlIChqdXN0IGNoZWNrIEFpb0NvbnRleHQtPmVwb2xsZmQgIT0gLTEKaW5zdGVh
ZCkgYW5kIEFpb0NvbnRleHQtPmVwb2xsX2VuYWJsZWQgKGl0J3MgaW1wbGljaXQgaWYgb3VyCkFp
b0NvbnRleHQtPmZkbW9uX29wcyBjYWxsYmFja3MgYXJlIGJlaW5nIGludm9rZWQpIGZpZWxkcy4K
ClNpZ25lZC1vZmYtYnk6IFN0ZWZhbiBIYWpub2N6aSA8c3RlZmFuaGFAcmVkaGF0LmNvbT4KLS0t
CiBNQUlOVEFJTkVSUyAgICAgICAgIHwgICAyICsKIGluY2x1ZGUvYmxvY2svYWlvLmggfCAgMzYg
KysrKystCiB1dGlsL01ha2VmaWxlLm9ianMgIHwgICAyICsKIHV0aWwvYWlvLXBvc2l4LmMgICAg
fCAyODYgKystLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIHV0aWwv
YWlvLXBvc2l4LmggICAgfCAgNjEgKysrKysrKysrKwogdXRpbC9mZG1vbi1lcG9sbC5jICB8IDE1
MSArKysrKysrKysrKysrKysrKysrKysrKwogdXRpbC9mZG1vbi1wb2xsLmMgICB8IDEwNCArKysr
KysrKysrKysrKysrCiA3IGZpbGVzIGNoYW5nZWQsIDM2NiBpbnNlcnRpb25zKCspLCAyNzYgZGVs
ZXRpb25zKC0pCiBjcmVhdGUgbW9kZSAxMDA2NDQgdXRpbC9haW8tcG9zaXguaAogY3JlYXRlIG1v
ZGUgMTAwNjQ0IHV0aWwvZmRtb24tZXBvbGwuYwogY3JlYXRlIG1vZGUgMTAwNjQ0IHV0aWwvZmRt
b24tcG9sbC5jCgpkaWZmIC0tZ2l0IGEvTUFJTlRBSU5FUlMgYi9NQUlOVEFJTkVSUwppbmRleCBj
MjU4MzkxY2FkLi44MDg1M2IxZjM3IDEwMDY0NAotLS0gYS9NQUlOVEFJTkVSUworKysgYi9NQUlO
VEFJTkVSUwpAQCAtMTg4NCw2ICsxODg0LDggQEAgTDogcWVtdS1ibG9ja0Bub25nbnUub3JnCiBT
OiBTdXBwb3J0ZWQKIEY6IHV0aWwvYXN5bmMuYwogRjogdXRpbC9haW8tKi5jCitGOiB1dGlsL2Fp
by0qLmgKK0Y6IHV0aWwvZmRtb24tKi5jCiBGOiBibG9jay9pby5jCiBGOiBtaWdyYXRpb24vYmxv
Y2sqCiBGOiBpbmNsdWRlL2Jsb2NrL2Fpby5oCmRpZmYgLS1naXQgYS9pbmNsdWRlL2Jsb2NrL2Fp
by5oIGIvaW5jbHVkZS9ibG9jay9haW8uaAppbmRleCA5ZGQ2MWNlZTdlLi45MGUwN2Q3NTA3IDEw
MDY0NAotLS0gYS9pbmNsdWRlL2Jsb2NrL2Fpby5oCisrKyBiL2luY2x1ZGUvYmxvY2svYWlvLmgK
QEAgLTUyLDYgKzUyLDM4IEBAIHN0cnVjdCBUaHJlYWRQb29sOwogc3RydWN0IExpbnV4QWlvU3Rh
dGU7CiBzdHJ1Y3QgTHVyaW5nU3RhdGU7CiAKKy8qIENhbGxiYWNrcyBmb3IgZmlsZSBkZXNjcmlw
dG9yIG1vbml0b3JpbmcgaW1wbGVtZW50YXRpb25zICovCit0eXBlZGVmIHN0cnVjdCB7CisgICAg
LyoKKyAgICAgKiB1cGRhdGU6CisgICAgICogQGN0eDogdGhlIEFpb0NvbnRleHQKKyAgICAgKiBA
bm9kZTogdGhlIGhhbmRsZXIKKyAgICAgKiBAaXNfbmV3OiBpcyB0aGUgZmlsZSBkZXNjcmlwdG9y
IGFscmVhZHkgYmVpbmcgbW9uaXRvcmVkPworICAgICAqCisgICAgICogQWRkL3JlbW92ZS9tb2Rp
ZnkgYSBtb25pdG9yZWQgZmlsZSBkZXNjcmlwdG9yLiAgVGhlcmUgYXJlIHRocmVlIGNhc2VzOgor
ICAgICAqIDEuIG5vZGUtPnBmZC5ldmVudHMgPT0gMCBtZWFucyByZW1vdmUgdGhlIGZpbGUgZGVz
Y3JpcHRvci4KKyAgICAgKiAyLiAhaXNfbmV3IG1lYW5zIG1vZGlmeSBhbiBhbHJlYWR5IG1vbml0
b3JlZCBmaWxlIGRlc2NyaXB0b3IuCisgICAgICogMy4gaXNfbmV3IG1lYW5zIGFkZCBhIG5ldyBm
aWxlIGRlc2NyaXB0b3IuCisgICAgICoKKyAgICAgKiBDYWxsZWQgd2l0aCBjdHgtPmxpc3RfbG9j
ayBhY3F1aXJlZC4KKyAgICAgKi8KKyAgICB2b2lkICgqdXBkYXRlKShBaW9Db250ZXh0ICpjdHgs
IEFpb0hhbmRsZXIgKm5vZGUsIGJvb2wgaXNfbmV3KTsKKworICAgIC8qCisgICAgICogd2FpdDoK
KyAgICAgKiBAY3R4OiB0aGUgQWlvQ29udGV4dAorICAgICAqIEByZWFkeV9saXN0OiBsaXN0IGZv
ciBoYW5kbGVycyB0aGF0IGJlY29tZSByZWFkeQorICAgICAqIEB0aW1lb3V0OiBtYXhpbXVtIGR1
cmF0aW9uIHRvIHdhaXQsIGluIG5hbm9zZWNvbmRzCisgICAgICoKKyAgICAgKiBXYWl0IGZvciBm
aWxlIGRlc2NyaXB0b3JzIHRvIGJlY29tZSByZWFkeSBhbmQgcGxhY2UgdGhlbSBvbiByZWFkeV9s
aXN0LgorICAgICAqCisgICAgICogQ2FsbGVkIHdpdGggY3R4LT5saXN0X2xvY2sgaW5jcmVtZW50
ZWQgYnV0IG5vdCBsb2NrZWQuCisgICAgICoKKyAgICAgKiBSZXR1cm5zOiBudW1iZXIgb2YgcmVh
ZHkgZmlsZSBkZXNjcmlwdG9ycy4KKyAgICAgKi8KKyAgICBpbnQgKCp3YWl0KShBaW9Db250ZXh0
ICpjdHgsIEFpb0hhbmRsZXJMaXN0ICpyZWFkeV9saXN0LCBpbnQ2NF90IHRpbWVvdXQpOworfSBG
RE1vbk9wczsKKwogLyoKICAqIEVhY2ggYWlvX2JoX3BvbGwoKSBjYWxsIGNhcnZlcyBvZmYgYSBz
bGljZSBvZiB0aGUgQkggbGlzdCwgc28gdGhhdCBuZXdseQogICogc2NoZWR1bGVkIEJIcyBhcmUg
bm90IHByb2Nlc3NlZCB1bnRpbCB0aGUgbmV4dCBhaW9fYmhfcG9sbCgpIGNhbGwuICBBbGwKQEAg
LTE3Myw4ICsyMDUsOCBAQCBzdHJ1Y3QgQWlvQ29udGV4dCB7CiAKICAgICAvKiBlcG9sbCg3KSBz
dGF0ZSB1c2VkIHdoZW4gYnVpbHQgd2l0aCBDT05GSUdfRVBPTEwgKi8KICAgICBpbnQgZXBvbGxm
ZDsKLSAgICBib29sIGVwb2xsX2VuYWJsZWQ7Ci0gICAgYm9vbCBlcG9sbF9hdmFpbGFibGU7CisK
KyAgICBjb25zdCBGRE1vbk9wcyAqZmRtb25fb3BzOwogfTsKIAogLyoqCmRpZmYgLS1naXQgYS91
dGlsL01ha2VmaWxlLm9ianMgYi91dGlsL01ha2VmaWxlLm9ianMKaW5kZXggNmIzOGI2N2NmMS4u
NjQzOTA3N2E2OCAxMDA2NDQKLS0tIGEvdXRpbC9NYWtlZmlsZS5vYmpzCisrKyBiL3V0aWwvTWFr
ZWZpbGUub2JqcwpAQCAtNSw2ICs1LDggQEAgdXRpbC1vYmoteSArPSBhaW9jYi5vIGFzeW5jLm8g
YWlvLXdhaXQubyB0aHJlYWQtcG9vbC5vIHFlbXUtdGltZXIubwogdXRpbC1vYmoteSArPSBtYWlu
LWxvb3AubwogdXRpbC1vYmotJChjYWxsIGxub3QsJChDT05GSUdfQVRPTUlDNjQpKSArPSBhdG9t
aWM2NC5vCiB1dGlsLW9iai0kKENPTkZJR19QT1NJWCkgKz0gYWlvLXBvc2l4Lm8KK3V0aWwtb2Jq
LSQoQ09ORklHX1BPU0lYKSArPSBmZG1vbi1wb2xsLm8KK3V0aWwtb2JqLSQoQ09ORklHX0VQT0xM
X0NSRUFURTEpICs9IGZkbW9uLWVwb2xsLm8KIHV0aWwtb2JqLSQoQ09ORklHX1BPU0lYKSArPSBj
b21wYXRmZC5vCiB1dGlsLW9iai0kKENPTkZJR19QT1NJWCkgKz0gZXZlbnRfbm90aWZpZXItcG9z
aXgubwogdXRpbC1vYmotJChDT05GSUdfUE9TSVgpICs9IG1tYXAtYWxsb2MubwpkaWZmIC0tZ2l0
IGEvdXRpbC9haW8tcG9zaXguYyBiL3V0aWwvYWlvLXBvc2l4LmMKaW5kZXggMzhjNTFmNWQ4Zi4u
NGQ5N2I0YzdkZSAxMDA2NDQKLS0tIGEvdXRpbC9haW8tcG9zaXguYworKysgYi91dGlsL2Fpby1w
b3NpeC5jCkBAIC0yMCwxOTEgKzIwLDE3IEBACiAjaW5jbHVkZSAicWVtdS9zb2NrZXRzLmgiCiAj
aW5jbHVkZSAicWVtdS9jdXRpbHMuaCIKICNpbmNsdWRlICJ0cmFjZS5oIgotI2lmZGVmIENPTkZJ
R19FUE9MTF9DUkVBVEUxCi0jaW5jbHVkZSA8c3lzL2Vwb2xsLmg+Ci0jZW5kaWYKKyNpbmNsdWRl
ICJhaW8tcG9zaXguaCIKIAotc3RydWN0IEFpb0hhbmRsZXIKLXsKLSAgICBHUG9sbEZEIHBmZDsK
LSAgICBJT0hhbmRsZXIgKmlvX3JlYWQ7Ci0gICAgSU9IYW5kbGVyICppb193cml0ZTsKLSAgICBB
aW9Qb2xsRm4gKmlvX3BvbGw7Ci0gICAgSU9IYW5kbGVyICppb19wb2xsX2JlZ2luOwotICAgIElP
SGFuZGxlciAqaW9fcG9sbF9lbmQ7Ci0gICAgdm9pZCAqb3BhcXVlOwotICAgIGJvb2wgaXNfZXh0
ZXJuYWw7Ci0gICAgUUxJU1RfRU5UUlkoQWlvSGFuZGxlcikgbm9kZTsKLSAgICBRTElTVF9FTlRS
WShBaW9IYW5kbGVyKSBub2RlX3JlYWR5OyAvKiBvbmx5IHVzZWQgZHVyaW5nIGFpb19wb2xsKCkg
Ki8KLSAgICBRTElTVF9FTlRSWShBaW9IYW5kbGVyKSBub2RlX2RlbGV0ZWQ7Ci19OwotCi0vKiBB
ZGQgYSBoYW5kbGVyIHRvIGEgcmVhZHkgbGlzdCAqLwotc3RhdGljIHZvaWQgYWRkX3JlYWR5X2hh
bmRsZXIoQWlvSGFuZGxlckxpc3QgKnJlYWR5X2xpc3QsCi0gICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBBaW9IYW5kbGVyICpub2RlLAotICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
aW50IHJldmVudHMpCit2b2lkIGFpb19hZGRfcmVhZHlfaGFuZGxlcihBaW9IYW5kbGVyTGlzdCAq
cmVhZHlfbGlzdCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIEFpb0hhbmRsZXIgKm5vZGUs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgcmV2ZW50cykKIHsKICAgICBRTElTVF9T
QUZFX1JFTU9WRShub2RlLCBub2RlX3JlYWR5KTsgLyogcmVtb3ZlIGZyb20gbmVzdGVkIHBhcmVu
dCdzIGxpc3QgKi8KICAgICBub2RlLT5wZmQucmV2ZW50cyA9IHJldmVudHM7CiAgICAgUUxJU1Rf
SU5TRVJUX0hFQUQocmVhZHlfbGlzdCwgbm9kZSwgbm9kZV9yZWFkeSk7CiB9CiAKLSNpZmRlZiBD
T05GSUdfRVBPTExfQ1JFQVRFMQotCi0vKiBUaGUgZmQgbnVtYmVyIHRocmVzaG9sZCB0byBzd2l0
Y2ggdG8gZXBvbGwgKi8KLSNkZWZpbmUgRVBPTExfRU5BQkxFX1RIUkVTSE9MRCA2NAotCi1zdGF0
aWMgdm9pZCBhaW9fZXBvbGxfZGlzYWJsZShBaW9Db250ZXh0ICpjdHgpCi17Ci0gICAgY3R4LT5l
cG9sbF9lbmFibGVkID0gZmFsc2U7Ci0gICAgaWYgKCFjdHgtPmVwb2xsX2F2YWlsYWJsZSkgewot
ICAgICAgICByZXR1cm47Ci0gICAgfQotICAgIGN0eC0+ZXBvbGxfYXZhaWxhYmxlID0gZmFsc2U7
Ci0gICAgY2xvc2UoY3R4LT5lcG9sbGZkKTsKLX0KLQotc3RhdGljIGlubGluZSBpbnQgZXBvbGxf
ZXZlbnRzX2Zyb21fcGZkKGludCBwZmRfZXZlbnRzKQotewotICAgIHJldHVybiAocGZkX2V2ZW50
cyAmIEdfSU9fSU4gPyBFUE9MTElOIDogMCkgfAotICAgICAgICAgICAocGZkX2V2ZW50cyAmIEdf
SU9fT1VUID8gRVBPTExPVVQgOiAwKSB8Ci0gICAgICAgICAgIChwZmRfZXZlbnRzICYgR19JT19I
VVAgPyBFUE9MTEhVUCA6IDApIHwKLSAgICAgICAgICAgKHBmZF9ldmVudHMgJiBHX0lPX0VSUiA/
IEVQT0xMRVJSIDogMCk7Ci19Ci0KLXN0YXRpYyBib29sIGFpb19lcG9sbF90cnlfZW5hYmxlKEFp
b0NvbnRleHQgKmN0eCkKLXsKLSAgICBBaW9IYW5kbGVyICpub2RlOwotICAgIHN0cnVjdCBlcG9s
bF9ldmVudCBldmVudDsKLQotICAgIFFMSVNUX0ZPUkVBQ0hfUkNVKG5vZGUsICZjdHgtPmFpb19o
YW5kbGVycywgbm9kZSkgewotICAgICAgICBpbnQgcjsKLSAgICAgICAgaWYgKFFMSVNUX0lTX0lO
U0VSVEVEKG5vZGUsIG5vZGVfZGVsZXRlZCkgfHwgIW5vZGUtPnBmZC5ldmVudHMpIHsKLSAgICAg
ICAgICAgIGNvbnRpbnVlOwotICAgICAgICB9Ci0gICAgICAgIGV2ZW50LmV2ZW50cyA9IGVwb2xs
X2V2ZW50c19mcm9tX3BmZChub2RlLT5wZmQuZXZlbnRzKTsKLSAgICAgICAgZXZlbnQuZGF0YS5w
dHIgPSBub2RlOwotICAgICAgICByID0gZXBvbGxfY3RsKGN0eC0+ZXBvbGxmZCwgRVBPTExfQ1RM
X0FERCwgbm9kZS0+cGZkLmZkLCAmZXZlbnQpOwotICAgICAgICBpZiAocikgewotICAgICAgICAg
ICAgcmV0dXJuIGZhbHNlOwotICAgICAgICB9Ci0gICAgfQotICAgIGN0eC0+ZXBvbGxfZW5hYmxl
ZCA9IHRydWU7Ci0gICAgcmV0dXJuIHRydWU7Ci19Ci0KLXN0YXRpYyB2b2lkIGFpb19lcG9sbF91
cGRhdGUoQWlvQ29udGV4dCAqY3R4LCBBaW9IYW5kbGVyICpub2RlLCBib29sIGlzX25ldykKLXsK
LSAgICBzdHJ1Y3QgZXBvbGxfZXZlbnQgZXZlbnQ7Ci0gICAgaW50IHI7Ci0gICAgaW50IGN0bDsK
LQotICAgIGlmICghY3R4LT5lcG9sbF9lbmFibGVkKSB7Ci0gICAgICAgIHJldHVybjsKLSAgICB9
Ci0gICAgaWYgKCFub2RlLT5wZmQuZXZlbnRzKSB7Ci0gICAgICAgIGN0bCA9IEVQT0xMX0NUTF9E
RUw7Ci0gICAgfSBlbHNlIHsKLSAgICAgICAgZXZlbnQuZGF0YS5wdHIgPSBub2RlOwotICAgICAg
ICBldmVudC5ldmVudHMgPSBlcG9sbF9ldmVudHNfZnJvbV9wZmQobm9kZS0+cGZkLmV2ZW50cyk7
Ci0gICAgICAgIGN0bCA9IGlzX25ldyA/IEVQT0xMX0NUTF9BREQgOiBFUE9MTF9DVExfTU9EOwot
ICAgIH0KLQotICAgIHIgPSBlcG9sbF9jdGwoY3R4LT5lcG9sbGZkLCBjdGwsIG5vZGUtPnBmZC5m
ZCwgJmV2ZW50KTsKLSAgICBpZiAocikgewotICAgICAgICBhaW9fZXBvbGxfZGlzYWJsZShjdHgp
OwotICAgIH0KLX0KLQotc3RhdGljIGludCBhaW9fZXBvbGwoQWlvQ29udGV4dCAqY3R4LCBBaW9I
YW5kbGVyTGlzdCAqcmVhZHlfbGlzdCwKLSAgICAgICAgICAgICAgICAgICAgIGludDY0X3QgdGlt
ZW91dCkKLXsKLSAgICBHUG9sbEZEIHBmZCA9IHsKLSAgICAgICAgLmZkID0gY3R4LT5lcG9sbGZk
LAotICAgICAgICAuZXZlbnRzID0gR19JT19JTiB8IEdfSU9fT1VUIHwgR19JT19IVVAgfCBHX0lP
X0VSUiwKLSAgICB9OwotICAgIEFpb0hhbmRsZXIgKm5vZGU7Ci0gICAgaW50IGksIHJldCA9IDA7
Ci0gICAgc3RydWN0IGVwb2xsX2V2ZW50IGV2ZW50c1sxMjhdOwotCi0gICAgaWYgKHRpbWVvdXQg
PiAwKSB7Ci0gICAgICAgIHJldCA9IHFlbXVfcG9sbF9ucygmcGZkLCAxLCB0aW1lb3V0KTsKLSAg
ICAgICAgaWYgKHJldCA+IDApIHsKLSAgICAgICAgICAgIHRpbWVvdXQgPSAwOwotICAgICAgICB9
Ci0gICAgfQotICAgIGlmICh0aW1lb3V0IDw9IDAgfHwgcmV0ID4gMCkgewotICAgICAgICByZXQg
PSBlcG9sbF93YWl0KGN0eC0+ZXBvbGxmZCwgZXZlbnRzLAotICAgICAgICAgICAgICAgICAgICAg
ICAgIEFSUkFZX1NJWkUoZXZlbnRzKSwKLSAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0
KTsKLSAgICAgICAgaWYgKHJldCA8PSAwKSB7Ci0gICAgICAgICAgICBnb3RvIG91dDsKLSAgICAg
ICAgfQotICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcmV0OyBpKyspIHsKLSAgICAgICAgICAgIGlu
dCBldiA9IGV2ZW50c1tpXS5ldmVudHM7Ci0gICAgICAgICAgICBpbnQgcmV2ZW50cyA9IChldiAm
IEVQT0xMSU4gPyBHX0lPX0lOIDogMCkgfAotICAgICAgICAgICAgICAgICAgICAgICAgICAoZXYg
JiBFUE9MTE9VVCA/IEdfSU9fT1VUIDogMCkgfAotICAgICAgICAgICAgICAgICAgICAgICAgICAo
ZXYgJiBFUE9MTEhVUCA/IEdfSU9fSFVQIDogMCkgfAotICAgICAgICAgICAgICAgICAgICAgICAg
ICAoZXYgJiBFUE9MTEVSUiA/IEdfSU9fRVJSIDogMCk7Ci0KLSAgICAgICAgICAgIG5vZGUgPSBl
dmVudHNbaV0uZGF0YS5wdHI7Ci0gICAgICAgICAgICBhZGRfcmVhZHlfaGFuZGxlcihyZWFkeV9s
aXN0LCBub2RlLCByZXZlbnRzKTsKLSAgICAgICAgfQotICAgIH0KLW91dDoKLSAgICByZXR1cm4g
cmV0OwotfQotCi1zdGF0aWMgYm9vbCBhaW9fZXBvbGxfZW5hYmxlZChBaW9Db250ZXh0ICpjdHgp
Ci17Ci0gICAgLyogRmFsbCBiYWNrIHRvIHBwb2xsIHdoZW4gZXh0ZXJuYWwgY2xpZW50cyBhcmUg
ZGlzYWJsZWQuICovCi0gICAgcmV0dXJuICFhaW9fZXh0ZXJuYWxfZGlzYWJsZWQoY3R4KSAmJiBj
dHgtPmVwb2xsX2VuYWJsZWQ7Ci19Ci0KLXN0YXRpYyBib29sIGFpb19lcG9sbF9jaGVja19wb2xs
KEFpb0NvbnRleHQgKmN0eCwgR1BvbGxGRCAqcGZkcywKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHVuc2lnbmVkIG5wZmQsIGludDY0X3QgdGltZW91dCkKLXsKLSAgICBpZiAoIWN0
eC0+ZXBvbGxfYXZhaWxhYmxlKSB7Ci0gICAgICAgIHJldHVybiBmYWxzZTsKLSAgICB9Ci0gICAg
aWYgKGFpb19lcG9sbF9lbmFibGVkKGN0eCkpIHsKLSAgICAgICAgcmV0dXJuIHRydWU7Ci0gICAg
fQotICAgIGlmIChucGZkID49IEVQT0xMX0VOQUJMRV9USFJFU0hPTEQpIHsKLSAgICAgICAgaWYg
KGFpb19lcG9sbF90cnlfZW5hYmxlKGN0eCkpIHsKLSAgICAgICAgICAgIHJldHVybiB0cnVlOwot
ICAgICAgICB9IGVsc2UgewotICAgICAgICAgICAgYWlvX2Vwb2xsX2Rpc2FibGUoY3R4KTsKLSAg
ICAgICAgfQotICAgIH0KLSAgICByZXR1cm4gZmFsc2U7Ci19Ci0KLSNlbHNlCi0KLXN0YXRpYyB2
b2lkIGFpb19lcG9sbF91cGRhdGUoQWlvQ29udGV4dCAqY3R4LCBBaW9IYW5kbGVyICpub2RlLCBi
b29sIGlzX25ldykKLXsKLX0KLQotc3RhdGljIGludCBhaW9fZXBvbGwoQWlvQ29udGV4dCAqY3R4
LCBBaW9IYW5kbGVyTGlzdCAqcmVhZHlfbGlzdCwKLSAgICAgICAgICAgICAgICAgICAgIGludDY0
X3QgdGltZW91dCkKLXsKLSAgICBhc3NlcnQoZmFsc2UpOwotfQotCi1zdGF0aWMgYm9vbCBhaW9f
ZXBvbGxfZW5hYmxlZChBaW9Db250ZXh0ICpjdHgpCi17Ci0gICAgcmV0dXJuIGZhbHNlOwotfQot
Ci1zdGF0aWMgYm9vbCBhaW9fZXBvbGxfY2hlY2tfcG9sbChBaW9Db250ZXh0ICpjdHgsIEdQb2xs
RkQgKnBmZHMsCi0gICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIG5wZmQsIGludDY0
X3QgdGltZW91dCkKLXsKLSAgICByZXR1cm4gZmFsc2U7Ci19Ci0KLSNlbmRpZgotCiBzdGF0aWMg
QWlvSGFuZGxlciAqZmluZF9haW9faGFuZGxlcihBaW9Db250ZXh0ICpjdHgsIGludCBmZCkKIHsK
ICAgICBBaW9IYW5kbGVyICpub2RlOwpAQCAtMzE0LDEwICsxNDAsMTAgQEAgdm9pZCBhaW9fc2V0
X2ZkX2hhbmRsZXIoQWlvQ29udGV4dCAqY3R4LAogICAgICAgICAgICAgICAgYXRvbWljX3JlYWQo
JmN0eC0+cG9sbF9kaXNhYmxlX2NudCkgKyBwb2xsX2Rpc2FibGVfY2hhbmdlKTsKIAogICAgIGlm
IChuZXdfbm9kZSkgewotICAgICAgICBhaW9fZXBvbGxfdXBkYXRlKGN0eCwgbmV3X25vZGUsIGlz
X25ldyk7CisgICAgICAgIGN0eC0+ZmRtb25fb3BzLT51cGRhdGUoY3R4LCBuZXdfbm9kZSwgaXNf
bmV3KTsKICAgICB9IGVsc2UgaWYgKG5vZGUpIHsKICAgICAgICAgLyogVW5yZWdpc3RlciBkZWxl
dGVkIGZkX2hhbmRsZXIgKi8KLSAgICAgICAgYWlvX2Vwb2xsX3VwZGF0ZShjdHgsIG5vZGUsIGZh
bHNlKTsKKyAgICAgICAgY3R4LT5mZG1vbl9vcHMtPnVwZGF0ZShjdHgsIG5vZGUsIGZhbHNlKTsK
ICAgICB9CiAgICAgcWVtdV9sb2NrY250X3VubG9jaygmY3R4LT5saXN0X2xvY2spOwogICAgIGFp
b19ub3RpZnkoY3R4KTsKQEAgLTUzMiw1MiArMzU4LDYgQEAgdm9pZCBhaW9fZGlzcGF0Y2goQWlv
Q29udGV4dCAqY3R4KQogICAgIHRpbWVybGlzdGdyb3VwX3J1bl90aW1lcnMoJmN0eC0+dGxnKTsK
IH0KIAotLyogVGhlc2UgdGhyZWFkLWxvY2FsIHZhcmlhYmxlcyBhcmUgdXNlZCBvbmx5IGluIGEg
c21hbGwgcGFydCBvZiBhaW9fcG9sbAotICogYXJvdW5kIHRoZSBjYWxsIHRvIHRoZSBwb2xsKCkg
c3lzdGVtIGNhbGwuICBJbiBwYXJ0aWN1bGFyIHRoZXkgYXJlIG5vdAotICogdXNlZCB3aGlsZSBh
aW9fcG9sbCBpcyBwZXJmb3JtaW5nIGNhbGxiYWNrcywgd2hpY2ggbWFrZXMgaXQgbXVjaCBlYXNp
ZXIKLSAqIHRvIHRoaW5rIGFib3V0IHJlZW50cmFuY3khCi0gKgotICogU3RhY2stYWxsb2NhdGVk
IGFycmF5cyB3b3VsZCBiZSBwZXJmZWN0IGJ1dCB0aGV5IGhhdmUgc2l6ZSBsaW1pdGF0aW9uczsK
LSAqIGhlYXAgYWxsb2NhdGlvbiBpcyBleHBlbnNpdmUgZW5vdWdoIHRoYXQgd2Ugd2FudCB0byBy
ZXVzZSBhcnJheXMgYWNyb3NzCi0gKiBjYWxscyB0byBhaW9fcG9sbCgpLiAgQW5kIGJlY2F1c2Ug
cG9sbCgpIGhhcyB0byBiZSBjYWxsZWQgd2l0aG91dCBob2xkaW5nCi0gKiBhbnkgbG9jaywgdGhl
IGFycmF5cyBjYW5ub3QgYmUgc3RvcmVkIGluIEFpb0NvbnRleHQuICBUaHJlYWQtbG9jYWwgZGF0
YQotICogaGFzIG5vbmUgb2YgdGhlIGRpc2FkdmFudGFnZXMgb2YgdGhlc2UgdGhyZWUgb3B0aW9u
cy4KLSAqLwotc3RhdGljIF9fdGhyZWFkIEdQb2xsRkQgKnBvbGxmZHM7Ci1zdGF0aWMgX190aHJl
YWQgQWlvSGFuZGxlciAqKm5vZGVzOwotc3RhdGljIF9fdGhyZWFkIHVuc2lnbmVkIG5wZmQsIG5h
bGxvYzsKLXN0YXRpYyBfX3RocmVhZCBOb3RpZmllciBwb2xsZmRzX2NsZWFudXBfbm90aWZpZXI7
Ci0KLXN0YXRpYyB2b2lkIHBvbGxmZHNfY2xlYW51cChOb3RpZmllciAqbiwgdm9pZCAqdW51c2Vk
KQotewotICAgIGdfYXNzZXJ0KG5wZmQgPT0gMCk7Ci0gICAgZ19mcmVlKHBvbGxmZHMpOwotICAg
IGdfZnJlZShub2Rlcyk7Ci0gICAgbmFsbG9jID0gMDsKLX0KLQotc3RhdGljIHZvaWQgYWRkX3Bv
bGxmZChBaW9IYW5kbGVyICpub2RlKQotewotICAgIGlmIChucGZkID09IG5hbGxvYykgewotICAg
ICAgICBpZiAobmFsbG9jID09IDApIHsKLSAgICAgICAgICAgIHBvbGxmZHNfY2xlYW51cF9ub3Rp
Zmllci5ub3RpZnkgPSBwb2xsZmRzX2NsZWFudXA7Ci0gICAgICAgICAgICBxZW11X3RocmVhZF9h
dGV4aXRfYWRkKCZwb2xsZmRzX2NsZWFudXBfbm90aWZpZXIpOwotICAgICAgICAgICAgbmFsbG9j
ID0gODsKLSAgICAgICAgfSBlbHNlIHsKLSAgICAgICAgICAgIGdfYXNzZXJ0KG5hbGxvYyA8PSBJ
TlRfTUFYKTsKLSAgICAgICAgICAgIG5hbGxvYyAqPSAyOwotICAgICAgICB9Ci0gICAgICAgIHBv
bGxmZHMgPSBnX3JlbmV3KEdQb2xsRkQsIHBvbGxmZHMsIG5hbGxvYyk7Ci0gICAgICAgIG5vZGVz
ID0gZ19yZW5ldyhBaW9IYW5kbGVyICosIG5vZGVzLCBuYWxsb2MpOwotICAgIH0KLSAgICBub2Rl
c1tucGZkXSA9IG5vZGU7Ci0gICAgcG9sbGZkc1tucGZkXSA9IChHUG9sbEZEKSB7Ci0gICAgICAg
IC5mZCA9IG5vZGUtPnBmZC5mZCwKLSAgICAgICAgLmV2ZW50cyA9IG5vZGUtPnBmZC5ldmVudHMs
Ci0gICAgfTsKLSAgICBucGZkKys7Ci19Ci0KIHN0YXRpYyBib29sIHJ1bl9wb2xsX2hhbmRsZXJz
X29uY2UoQWlvQ29udGV4dCAqY3R4LCBpbnQ2NF90ICp0aW1lb3V0KQogewogICAgIGJvb2wgcHJv
Z3Jlc3MgPSBmYWxzZTsKQEAgLTY4OSw4ICs0NjksNiBAQCBzdGF0aWMgYm9vbCB0cnlfcG9sbF9t
b2RlKEFpb0NvbnRleHQgKmN0eCwgaW50NjRfdCAqdGltZW91dCkKIGJvb2wgYWlvX3BvbGwoQWlv
Q29udGV4dCAqY3R4LCBib29sIGJsb2NraW5nKQogewogICAgIEFpb0hhbmRsZXJMaXN0IHJlYWR5
X2xpc3QgPSBRTElTVF9IRUFEX0lOSVRJQUxJWkVSKHJlYWR5X2xpc3QpOwotICAgIEFpb0hhbmRs
ZXIgKm5vZGU7Ci0gICAgaW50IGk7CiAgICAgaW50IHJldCA9IDA7CiAgICAgYm9vbCBwcm9ncmVz
czsKICAgICBpbnQ2NF90IHRpbWVvdXQ7CkBAIC03MjMsMjYgKzUwMSw3IEBAIGJvb2wgYWlvX3Bv
bGwoQWlvQ29udGV4dCAqY3R4LCBib29sIGJsb2NraW5nKQogICAgICAqIHN5c3RlbSBjYWxsLS0t
YSBzaW5nbGUgcm91bmQgb2YgcnVuX3BvbGxfaGFuZGxlcnNfb25jZSBzdWZmaWNlcy4KICAgICAg
Ki8KICAgICBpZiAodGltZW91dCB8fCBhdG9taWNfcmVhZCgmY3R4LT5wb2xsX2Rpc2FibGVfY250
KSkgewotICAgICAgICBhc3NlcnQobnBmZCA9PSAwKTsKLQotICAgICAgICAvKiBmaWxsIHBvbGxm
ZHMgKi8KLQotICAgICAgICBpZiAoIWFpb19lcG9sbF9lbmFibGVkKGN0eCkpIHsKLSAgICAgICAg
ICAgIFFMSVNUX0ZPUkVBQ0hfUkNVKG5vZGUsICZjdHgtPmFpb19oYW5kbGVycywgbm9kZSkgewot
ICAgICAgICAgICAgICAgIGlmICghUUxJU1RfSVNfSU5TRVJURUQobm9kZSwgbm9kZV9kZWxldGVk
KSAmJiBub2RlLT5wZmQuZXZlbnRzCi0gICAgICAgICAgICAgICAgICAgICYmIGFpb19ub2RlX2No
ZWNrKGN0eCwgbm9kZS0+aXNfZXh0ZXJuYWwpKSB7Ci0gICAgICAgICAgICAgICAgICAgIGFkZF9w
b2xsZmQobm9kZSk7Ci0gICAgICAgICAgICAgICAgfQotICAgICAgICAgICAgfQotICAgICAgICB9
Ci0KLSAgICAgICAgLyogd2FpdCB1bnRpbCBuZXh0IGV2ZW50ICovCi0gICAgICAgIGlmIChhaW9f
ZXBvbGxfY2hlY2tfcG9sbChjdHgsIHBvbGxmZHMsIG5wZmQsIHRpbWVvdXQpKSB7Ci0gICAgICAg
ICAgICBucGZkID0gMDsgLyogcG9sbGZkc1tdIGlzIG5vdCBiZWluZyB1c2VkICovCi0gICAgICAg
ICAgICByZXQgPSBhaW9fZXBvbGwoY3R4LCAmcmVhZHlfbGlzdCwgdGltZW91dCk7Ci0gICAgICAg
IH0gZWxzZSAgewotICAgICAgICAgICAgcmV0ID0gcWVtdV9wb2xsX25zKHBvbGxmZHMsIG5wZmQs
IHRpbWVvdXQpOwotICAgICAgICB9CisgICAgICAgIHJldCA9IGN0eC0+ZmRtb25fb3BzLT53YWl0
KGN0eCwgJnJlYWR5X2xpc3QsIHRpbWVvdXQpOwogICAgIH0KIAogICAgIGlmIChibG9ja2luZykg
ewpAQCAtNzkxLDE5ICs1NTAsNiBAQCBib29sIGFpb19wb2xsKEFpb0NvbnRleHQgKmN0eCwgYm9v
bCBibG9ja2luZykKICAgICAgICAgfQogICAgIH0KIAotICAgIC8qIGlmIHdlIGhhdmUgYW55IHJl
YWRhYmxlIGZkcywgZGlzcGF0Y2ggZXZlbnQgKi8KLSAgICBpZiAocmV0ID4gMCkgewotICAgICAg
ICBmb3IgKGkgPSAwOyBpIDwgbnBmZDsgaSsrKSB7Ci0gICAgICAgICAgICBpbnQgcmV2ZW50cyA9
IHBvbGxmZHNbaV0ucmV2ZW50czsKLQotICAgICAgICAgICAgaWYgKHJldmVudHMpIHsKLSAgICAg
ICAgICAgICAgICBhZGRfcmVhZHlfaGFuZGxlcigmcmVhZHlfbGlzdCwgbm9kZXNbaV0sIHJldmVu
dHMpOwotICAgICAgICAgICAgfQotICAgICAgICB9Ci0gICAgfQotCi0gICAgbnBmZCA9IDA7Ci0K
ICAgICBwcm9ncmVzcyB8PSBhaW9fYmhfcG9sbChjdHgpOwogCiAgICAgaWYgKHJldCA+IDApIHsK
QEAgLTgyMSwyMyArNTY3LDE1IEBAIGJvb2wgYWlvX3BvbGwoQWlvQ29udGV4dCAqY3R4LCBib29s
IGJsb2NraW5nKQogCiB2b2lkIGFpb19jb250ZXh0X3NldHVwKEFpb0NvbnRleHQgKmN0eCkKIHsK
LSNpZmRlZiBDT05GSUdfRVBPTExfQ1JFQVRFMQotICAgIGFzc2VydCghY3R4LT5lcG9sbGZkKTsK
LSAgICBjdHgtPmVwb2xsZmQgPSBlcG9sbF9jcmVhdGUxKEVQT0xMX0NMT0VYRUMpOwotICAgIGlm
IChjdHgtPmVwb2xsZmQgPT0gLTEpIHsKLSAgICAgICAgZnByaW50ZihzdGRlcnIsICJGYWlsZWQg
dG8gY3JlYXRlIGVwb2xsIGluc3RhbmNlOiAlcyIsIHN0cmVycm9yKGVycm5vKSk7Ci0gICAgICAg
IGN0eC0+ZXBvbGxfYXZhaWxhYmxlID0gZmFsc2U7Ci0gICAgfSBlbHNlIHsKLSAgICAgICAgY3R4
LT5lcG9sbF9hdmFpbGFibGUgPSB0cnVlOwotICAgIH0KLSNlbmRpZgorICAgIGN0eC0+ZmRtb25f
b3BzID0gJmZkbW9uX3BvbGxfb3BzOworICAgIGN0eC0+ZXBvbGxmZCA9IC0xOworCisgICAgZmRt
b25fZXBvbGxfc2V0dXAoY3R4KTsKIH0KIAogdm9pZCBhaW9fY29udGV4dF9kZXN0cm95KEFpb0Nv
bnRleHQgKmN0eCkKIHsKLSNpZmRlZiBDT05GSUdfRVBPTExfQ1JFQVRFMQotICAgIGFpb19lcG9s
bF9kaXNhYmxlKGN0eCk7Ci0jZW5kaWYKKyAgICBmZG1vbl9lcG9sbF9kaXNhYmxlKGN0eCk7CiB9
CiAKIHZvaWQgYWlvX2NvbnRleHRfc2V0X3BvbGxfcGFyYW1zKEFpb0NvbnRleHQgKmN0eCwgaW50
NjRfdCBtYXhfbnMsCmRpZmYgLS1naXQgYS91dGlsL2Fpby1wb3NpeC5oIGIvdXRpbC9haW8tcG9z
aXguaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwLi45Nzg5OWQwZmJjCi0t
LSAvZGV2L251bGwKKysrIGIvdXRpbC9haW8tcG9zaXguaApAQCAtMCwwICsxLDYxIEBACisvKgor
ICogQWlvQ29udGV4dCBQT1NJWCBldmVudCBsb29wIGltcGxlbWVudGF0aW9uIGludGVybmFsIEFQ
SXMKKyAqCisgKiBDb3B5cmlnaHQgSUJNLCBDb3JwLiAyMDA4CisgKiBDb3B5cmlnaHQgUmVkIEhh
dCwgSW5jLiAyMDIwCisgKgorICogQXV0aG9yczoKKyAqICBBbnRob255IExpZ3VvcmkgICA8YWxp
Z3VvcmlAdXMuaWJtLmNvbT4KKyAqCisgKiBUaGlzIHdvcmsgaXMgbGljZW5zZWQgdW5kZXIgdGhl
IHRlcm1zIG9mIHRoZSBHTlUgR1BMLCB2ZXJzaW9uIDIuICBTZWUKKyAqIHRoZSBDT1BZSU5HIGZp
bGUgaW4gdGhlIHRvcC1sZXZlbCBkaXJlY3RvcnkuCisgKgorICogQ29udHJpYnV0aW9ucyBhZnRl
ciAyMDEyLTAxLTEzIGFyZSBsaWNlbnNlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlCisgKiBHTlUg
R1BMLCB2ZXJzaW9uIDIgb3IgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KKyAq
LworCisjaWZuZGVmIEFJT19QT1NJWF9ICisjZGVmaW5lIEFJT19QT1NJWF9ICisKKyNpbmNsdWRl
ICJibG9jay9haW8uaCIKKworc3RydWN0IEFpb0hhbmRsZXIgeworICAgIEdQb2xsRkQgcGZkOwor
ICAgIElPSGFuZGxlciAqaW9fcmVhZDsKKyAgICBJT0hhbmRsZXIgKmlvX3dyaXRlOworICAgIEFp
b1BvbGxGbiAqaW9fcG9sbDsKKyAgICBJT0hhbmRsZXIgKmlvX3BvbGxfYmVnaW47CisgICAgSU9I
YW5kbGVyICppb19wb2xsX2VuZDsKKyAgICB2b2lkICpvcGFxdWU7CisgICAgYm9vbCBpc19leHRl
cm5hbDsKKyAgICBRTElTVF9FTlRSWShBaW9IYW5kbGVyKSBub2RlOworICAgIFFMSVNUX0VOVFJZ
KEFpb0hhbmRsZXIpIG5vZGVfcmVhZHk7IC8qIG9ubHkgdXNlZCBkdXJpbmcgYWlvX3BvbGwoKSAq
LworICAgIFFMSVNUX0VOVFJZKEFpb0hhbmRsZXIpIG5vZGVfZGVsZXRlZDsKK307CisKKy8qIEFk
ZCBhIGhhbmRsZXIgdG8gYSByZWFkeSBsaXN0ICovCit2b2lkIGFpb19hZGRfcmVhZHlfaGFuZGxl
cihBaW9IYW5kbGVyTGlzdCAqcmVhZHlfbGlzdCwgQWlvSGFuZGxlciAqbm9kZSwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGludCByZXZlbnRzKTsKKworZXh0ZXJuIGNvbnN0IEZETW9uT3Bz
IGZkbW9uX3BvbGxfb3BzOworCisjaWZkZWYgQ09ORklHX0VQT0xMX0NSRUFURTEKK2Jvb2wgZmRt
b25fZXBvbGxfdHJ5X3VwZ3JhZGUoQWlvQ29udGV4dCAqY3R4LCB1bnNpZ25lZCBucGZkKTsKK3Zv
aWQgZmRtb25fZXBvbGxfc2V0dXAoQWlvQ29udGV4dCAqY3R4KTsKK3ZvaWQgZmRtb25fZXBvbGxf
ZGlzYWJsZShBaW9Db250ZXh0ICpjdHgpOworI2Vsc2UKK3N0YXRpYyBpbmxpbmUgYm9vbCBmZG1v
bl9lcG9sbF90cnlfdXBncmFkZShBaW9Db250ZXh0ICpjdHgsIHVuc2lnbmVkIG5wZmQpCit7Cisg
ICAgcmV0dXJuIGZhbHNlOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQgZmRtb25fZXBvbGxfc2V0
dXAoQWlvQ29udGV4dCAqY3R4KQoreworfQorCitzdGF0aWMgaW5saW5lIHZvaWQgZmRtb25fZXBv
bGxfZGlzYWJsZShBaW9Db250ZXh0ICpjdHgpCit7Cit9CisjZW5kaWYgLyogIUNPTkZJR19FUE9M
TF9DUkVBVEUxICovCisKKyNlbmRpZiAvKiBBSU9fUE9TSVhfSCAqLwpkaWZmIC0tZ2l0IGEvdXRp
bC9mZG1vbi1lcG9sbC5jIGIvdXRpbC9mZG1vbi1lcG9sbC5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0
CmluZGV4IDAwMDAwMDAwMDAuLjI5YzE0NTQ0NjkKLS0tIC9kZXYvbnVsbAorKysgYi91dGlsL2Zk
bW9uLWVwb2xsLmMKQEAgLTAsMCArMSwxNTEgQEAKKy8qIFNQRFgtTGljZW5zZS1JZGVudGlmaWVy
OiBHUEwtMi4wLW9yLWxhdGVyICovCisvKgorICogZXBvbGwoNykgZmlsZSBkZXNjcmlwdG9yIG1v
bml0b3JpbmcKKyAqLworCisjaW5jbHVkZSAicWVtdS9vc2RlcC5oIgorI2luY2x1ZGUgPHN5cy9l
cG9sbC5oPgorI2luY2x1ZGUgInFlbXUvcmN1X3F1ZXVlLmgiCisjaW5jbHVkZSAiYWlvLXBvc2l4
LmgiCisKKy8qIFRoZSBmZCBudW1iZXIgdGhyZXNob2xkIHRvIHN3aXRjaCB0byBlcG9sbCAqLwor
I2RlZmluZSBFUE9MTF9FTkFCTEVfVEhSRVNIT0xEIDY0CisKK3ZvaWQgZmRtb25fZXBvbGxfZGlz
YWJsZShBaW9Db250ZXh0ICpjdHgpCit7CisgICAgaWYgKGN0eC0+ZXBvbGxmZCA+PSAwKSB7Cisg
ICAgICAgIGNsb3NlKGN0eC0+ZXBvbGxmZCk7CisgICAgICAgIGN0eC0+ZXBvbGxmZCA9IC0xOwor
ICAgIH0KKworICAgIC8qIFN3aXRjaCBiYWNrICovCisgICAgY3R4LT5mZG1vbl9vcHMgPSAmZmRt
b25fcG9sbF9vcHM7Cit9CisKK3N0YXRpYyBpbmxpbmUgaW50IGVwb2xsX2V2ZW50c19mcm9tX3Bm
ZChpbnQgcGZkX2V2ZW50cykKK3sKKyAgICByZXR1cm4gKHBmZF9ldmVudHMgJiBHX0lPX0lOID8g
RVBPTExJTiA6IDApIHwKKyAgICAgICAgICAgKHBmZF9ldmVudHMgJiBHX0lPX09VVCA/IEVQT0xM
T1VUIDogMCkgfAorICAgICAgICAgICAocGZkX2V2ZW50cyAmIEdfSU9fSFVQID8gRVBPTExIVVAg
OiAwKSB8CisgICAgICAgICAgIChwZmRfZXZlbnRzICYgR19JT19FUlIgPyBFUE9MTEVSUiA6IDAp
OworfQorCitzdGF0aWMgdm9pZCBmZG1vbl9lcG9sbF91cGRhdGUoQWlvQ29udGV4dCAqY3R4LCBB
aW9IYW5kbGVyICpub2RlLCBib29sIGlzX25ldykKK3sKKyAgICBzdHJ1Y3QgZXBvbGxfZXZlbnQg
ZXZlbnQ7CisgICAgaW50IHI7CisgICAgaW50IGN0bDsKKworICAgIGlmICghbm9kZS0+cGZkLmV2
ZW50cykgeworICAgICAgICBjdGwgPSBFUE9MTF9DVExfREVMOworICAgIH0gZWxzZSB7CisgICAg
ICAgIGV2ZW50LmRhdGEucHRyID0gbm9kZTsKKyAgICAgICAgZXZlbnQuZXZlbnRzID0gZXBvbGxf
ZXZlbnRzX2Zyb21fcGZkKG5vZGUtPnBmZC5ldmVudHMpOworICAgICAgICBjdGwgPSBpc19uZXcg
PyBFUE9MTF9DVExfQUREIDogRVBPTExfQ1RMX01PRDsKKyAgICB9CisKKyAgICByID0gZXBvbGxf
Y3RsKGN0eC0+ZXBvbGxmZCwgY3RsLCBub2RlLT5wZmQuZmQsICZldmVudCk7CisgICAgaWYgKHIp
IHsKKyAgICAgICAgZmRtb25fZXBvbGxfZGlzYWJsZShjdHgpOworICAgIH0KK30KKworc3RhdGlj
IGludCBmZG1vbl9lcG9sbF93YWl0KEFpb0NvbnRleHQgKmN0eCwgQWlvSGFuZGxlckxpc3QgKnJl
YWR5X2xpc3QsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50NjRfdCB0aW1lb3V0KQor
eworICAgIEdQb2xsRkQgcGZkID0geworICAgICAgICAuZmQgPSBjdHgtPmVwb2xsZmQsCisgICAg
ICAgIC5ldmVudHMgPSBHX0lPX0lOIHwgR19JT19PVVQgfCBHX0lPX0hVUCB8IEdfSU9fRVJSLAor
ICAgIH07CisgICAgQWlvSGFuZGxlciAqbm9kZTsKKyAgICBpbnQgaSwgcmV0ID0gMDsKKyAgICBz
dHJ1Y3QgZXBvbGxfZXZlbnQgZXZlbnRzWzEyOF07CisKKyAgICAvKiBGYWxsIGJhY2sgd2hpbGUg
ZXh0ZXJuYWwgY2xpZW50cyBhcmUgZGlzYWJsZWQgKi8KKyAgICBpZiAoYXRvbWljX3JlYWQoJmN0
eC0+ZXh0ZXJuYWxfZGlzYWJsZV9jbnQpKSB7CisgICAgICAgIHJldHVybiBmZG1vbl9wb2xsX29w
cy53YWl0KGN0eCwgcmVhZHlfbGlzdCwgdGltZW91dCk7CisgICAgfQorCisgICAgaWYgKHRpbWVv
dXQgPiAwKSB7CisgICAgICAgIHJldCA9IHFlbXVfcG9sbF9ucygmcGZkLCAxLCB0aW1lb3V0KTsK
KyAgICAgICAgaWYgKHJldCA+IDApIHsKKyAgICAgICAgICAgIHRpbWVvdXQgPSAwOworICAgICAg
ICB9CisgICAgfQorICAgIGlmICh0aW1lb3V0IDw9IDAgfHwgcmV0ID4gMCkgeworICAgICAgICBy
ZXQgPSBlcG9sbF93YWl0KGN0eC0+ZXBvbGxmZCwgZXZlbnRzLAorICAgICAgICAgICAgICAgICAg
ICAgICAgIEFSUkFZX1NJWkUoZXZlbnRzKSwKKyAgICAgICAgICAgICAgICAgICAgICAgICB0aW1l
b3V0KTsKKyAgICAgICAgaWYgKHJldCA8PSAwKSB7CisgICAgICAgICAgICBnb3RvIG91dDsKKyAg
ICAgICAgfQorICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcmV0OyBpKyspIHsKKyAgICAgICAgICAg
IGludCBldiA9IGV2ZW50c1tpXS5ldmVudHM7CisgICAgICAgICAgICBpbnQgcmV2ZW50cyA9IChl
diAmIEVQT0xMSU4gPyBHX0lPX0lOIDogMCkgfAorICAgICAgICAgICAgICAgICAgICAgICAgICAo
ZXYgJiBFUE9MTE9VVCA/IEdfSU9fT1VUIDogMCkgfAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAoZXYgJiBFUE9MTEhVUCA/IEdfSU9fSFVQIDogMCkgfAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAoZXYgJiBFUE9MTEVSUiA/IEdfSU9fRVJSIDogMCk7CisKKyAgICAgICAgICAgIG5vZGUg
PSBldmVudHNbaV0uZGF0YS5wdHI7CisgICAgICAgICAgICBhaW9fYWRkX3JlYWR5X2hhbmRsZXIo
cmVhZHlfbGlzdCwgbm9kZSwgcmV2ZW50cyk7CisgICAgICAgIH0KKyAgICB9CitvdXQ6CisgICAg
cmV0dXJuIHJldDsKK30KKworc3RhdGljIGNvbnN0IEZETW9uT3BzIGZkbW9uX2Vwb2xsX29wcyA9
IHsKKyAgICAudXBkYXRlID0gZmRtb25fZXBvbGxfdXBkYXRlLAorICAgIC53YWl0ID0gZmRtb25f
ZXBvbGxfd2FpdCwKK307CisKK3N0YXRpYyBib29sIGZkbW9uX2Vwb2xsX3RyeV9lbmFibGUoQWlv
Q29udGV4dCAqY3R4KQoreworICAgIEFpb0hhbmRsZXIgKm5vZGU7CisgICAgc3RydWN0IGVwb2xs
X2V2ZW50IGV2ZW50OworCisgICAgUUxJU1RfRk9SRUFDSF9SQ1Uobm9kZSwgJmN0eC0+YWlvX2hh
bmRsZXJzLCBub2RlKSB7CisgICAgICAgIGludCByOworICAgICAgICBpZiAoUUxJU1RfSVNfSU5T
RVJURUQobm9kZSwgbm9kZV9kZWxldGVkKSB8fCAhbm9kZS0+cGZkLmV2ZW50cykgeworICAgICAg
ICAgICAgY29udGludWU7CisgICAgICAgIH0KKyAgICAgICAgZXZlbnQuZXZlbnRzID0gZXBvbGxf
ZXZlbnRzX2Zyb21fcGZkKG5vZGUtPnBmZC5ldmVudHMpOworICAgICAgICBldmVudC5kYXRhLnB0
ciA9IG5vZGU7CisgICAgICAgIHIgPSBlcG9sbF9jdGwoY3R4LT5lcG9sbGZkLCBFUE9MTF9DVExf
QURELCBub2RlLT5wZmQuZmQsICZldmVudCk7CisgICAgICAgIGlmIChyKSB7CisgICAgICAgICAg
ICByZXR1cm4gZmFsc2U7CisgICAgICAgIH0KKyAgICB9CisKKyAgICBjdHgtPmZkbW9uX29wcyA9
ICZmZG1vbl9lcG9sbF9vcHM7CisgICAgcmV0dXJuIHRydWU7Cit9CisKK2Jvb2wgZmRtb25fZXBv
bGxfdHJ5X3VwZ3JhZGUoQWlvQ29udGV4dCAqY3R4LCB1bnNpZ25lZCBucGZkKQoreworICAgIGlm
IChjdHgtPmVwb2xsZmQgPCAwKSB7CisgICAgICAgIHJldHVybiBmYWxzZTsKKyAgICB9CisKKyAg
ICAvKiBEbyBub3QgdXBncmFkZSB3aGlsZSBleHRlcm5hbCBjbGllbnRzIGFyZSBkaXNhYmxlZCAq
LworICAgIGlmIChhdG9taWNfcmVhZCgmY3R4LT5leHRlcm5hbF9kaXNhYmxlX2NudCkpIHsKKyAg
ICAgICAgcmV0dXJuIGZhbHNlOworICAgIH0KKworICAgIGlmIChucGZkID49IEVQT0xMX0VOQUJM
RV9USFJFU0hPTEQpIHsKKyAgICAgICAgaWYgKGZkbW9uX2Vwb2xsX3RyeV9lbmFibGUoY3R4KSkg
eworICAgICAgICAgICAgcmV0dXJuIHRydWU7CisgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAg
ICBmZG1vbl9lcG9sbF9kaXNhYmxlKGN0eCk7CisgICAgICAgIH0KKyAgICB9CisgICAgcmV0dXJu
IGZhbHNlOworfQorCit2b2lkIGZkbW9uX2Vwb2xsX3NldHVwKEFpb0NvbnRleHQgKmN0eCkKK3sK
KyAgICBjdHgtPmVwb2xsZmQgPSBlcG9sbF9jcmVhdGUxKEVQT0xMX0NMT0VYRUMpOworICAgIGlm
IChjdHgtPmVwb2xsZmQgPT0gLTEpIHsKKyAgICAgICAgZnByaW50ZihzdGRlcnIsICJGYWlsZWQg
dG8gY3JlYXRlIGVwb2xsIGluc3RhbmNlOiAlcyIsIHN0cmVycm9yKGVycm5vKSk7CisgICAgfQor
fQpkaWZmIC0tZ2l0IGEvdXRpbC9mZG1vbi1wb2xsLmMgYi91dGlsL2ZkbW9uLXBvbGwuYwpuZXcg
ZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwLi42Nzk5MjExNmI4Ci0tLSAvZGV2L251
bGwKKysrIGIvdXRpbC9mZG1vbi1wb2xsLmMKQEAgLTAsMCArMSwxMDQgQEAKKy8qIFNQRFgtTGlj
ZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wLW9yLWxhdGVyICovCisvKgorICogcG9sbCgyKSBmaWxl
IGRlc2NyaXB0b3IgbW9uaXRvcmluZworICoKKyAqIFVzZXMgcHBvbGwoMikgd2hlbiBhdmFpbGFi
bGUsIGdfcG9sbCgpIG90aGVyd2lzZS4KKyAqLworCisjaW5jbHVkZSAicWVtdS9vc2RlcC5oIgor
I2luY2x1ZGUgImFpby1wb3NpeC5oIgorI2luY2x1ZGUgInFlbXUvcmN1X3F1ZXVlLmgiCisKKy8q
CisgKiBUaGVzZSB0aHJlYWQtbG9jYWwgdmFyaWFibGVzIGFyZSB1c2VkIG9ubHkgaW4gZmRtb25f
cG9sbF93YWl0KCkgYXJvdW5kIHRoZQorICogY2FsbCB0byB0aGUgcG9sbCgpIHN5c3RlbSBjYWxs
LiAgSW4gcGFydGljdWxhciB0aGV5IGFyZSBub3QgdXNlZCB3aGlsZQorICogYWlvX3BvbGwgaXMg
cGVyZm9ybWluZyBjYWxsYmFja3MsIHdoaWNoIG1ha2VzIGl0IG11Y2ggZWFzaWVyIHRvIHRoaW5r
IGFib3V0CisgKiByZWVudHJhbmN5IQorICoKKyAqIFN0YWNrLWFsbG9jYXRlZCBhcnJheXMgd291
bGQgYmUgcGVyZmVjdCBidXQgdGhleSBoYXZlIHNpemUgbGltaXRhdGlvbnM7CisgKiBoZWFwIGFs
bG9jYXRpb24gaXMgZXhwZW5zaXZlIGVub3VnaCB0aGF0IHdlIHdhbnQgdG8gcmV1c2UgYXJyYXlz
IGFjcm9zcworICogY2FsbHMgdG8gYWlvX3BvbGwoKS4gIEFuZCBiZWNhdXNlIHBvbGwoKSBoYXMg
dG8gYmUgY2FsbGVkIHdpdGhvdXQgaG9sZGluZworICogYW55IGxvY2ssIHRoZSBhcnJheXMgY2Fu
bm90IGJlIHN0b3JlZCBpbiBBaW9Db250ZXh0LiAgVGhyZWFkLWxvY2FsIGRhdGEKKyAqIGhhcyBu
b25lIG9mIHRoZSBkaXNhZHZhbnRhZ2VzIG9mIHRoZXNlIHRocmVlIG9wdGlvbnMuCisgKi8KK3N0
YXRpYyBfX3RocmVhZCBHUG9sbEZEICpwb2xsZmRzOworc3RhdGljIF9fdGhyZWFkIEFpb0hhbmRs
ZXIgKipub2RlczsKK3N0YXRpYyBfX3RocmVhZCB1bnNpZ25lZCBucGZkLCBuYWxsb2M7CitzdGF0
aWMgX190aHJlYWQgTm90aWZpZXIgcG9sbGZkc19jbGVhbnVwX25vdGlmaWVyOworCitzdGF0aWMg
dm9pZCBwb2xsZmRzX2NsZWFudXAoTm90aWZpZXIgKm4sIHZvaWQgKnVudXNlZCkKK3sKKyAgICBn
X2Fzc2VydChucGZkID09IDApOworICAgIGdfZnJlZShwb2xsZmRzKTsKKyAgICBnX2ZyZWUobm9k
ZXMpOworICAgIG5hbGxvYyA9IDA7Cit9CisKK3N0YXRpYyB2b2lkIGFkZF9wb2xsZmQoQWlvSGFu
ZGxlciAqbm9kZSkKK3sKKyAgICBpZiAobnBmZCA9PSBuYWxsb2MpIHsKKyAgICAgICAgaWYgKG5h
bGxvYyA9PSAwKSB7CisgICAgICAgICAgICBwb2xsZmRzX2NsZWFudXBfbm90aWZpZXIubm90aWZ5
ID0gcG9sbGZkc19jbGVhbnVwOworICAgICAgICAgICAgcWVtdV90aHJlYWRfYXRleGl0X2FkZCgm
cG9sbGZkc19jbGVhbnVwX25vdGlmaWVyKTsKKyAgICAgICAgICAgIG5hbGxvYyA9IDg7CisgICAg
ICAgIH0gZWxzZSB7CisgICAgICAgICAgICBnX2Fzc2VydChuYWxsb2MgPD0gSU5UX01BWCk7Cisg
ICAgICAgICAgICBuYWxsb2MgKj0gMjsKKyAgICAgICAgfQorICAgICAgICBwb2xsZmRzID0gZ19y
ZW5ldyhHUG9sbEZELCBwb2xsZmRzLCBuYWxsb2MpOworICAgICAgICBub2RlcyA9IGdfcmVuZXco
QWlvSGFuZGxlciAqLCBub2RlcywgbmFsbG9jKTsKKyAgICB9CisgICAgbm9kZXNbbnBmZF0gPSBu
b2RlOworICAgIHBvbGxmZHNbbnBmZF0gPSAoR1BvbGxGRCkgeworICAgICAgICAuZmQgPSBub2Rl
LT5wZmQuZmQsCisgICAgICAgIC5ldmVudHMgPSBub2RlLT5wZmQuZXZlbnRzLAorICAgIH07Cisg
ICAgbnBmZCsrOworfQorCitzdGF0aWMgaW50IGZkbW9uX3BvbGxfd2FpdChBaW9Db250ZXh0ICpj
dHgsIEFpb0hhbmRsZXJMaXN0ICpyZWFkeV9saXN0LAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgIGludDY0X3QgdGltZW91dCkKK3sKKyAgICBBaW9IYW5kbGVyICpub2RlOworICAgIGludCBy
ZXQ7CisKKyAgICBhc3NlcnQobnBmZCA9PSAwKTsKKworICAgIFFMSVNUX0ZPUkVBQ0hfUkNVKG5v
ZGUsICZjdHgtPmFpb19oYW5kbGVycywgbm9kZSkgeworICAgICAgICBpZiAoIVFMSVNUX0lTX0lO
U0VSVEVEKG5vZGUsIG5vZGVfZGVsZXRlZCkgJiYgbm9kZS0+cGZkLmV2ZW50cworICAgICAgICAg
ICAgICAgICYmIGFpb19ub2RlX2NoZWNrKGN0eCwgbm9kZS0+aXNfZXh0ZXJuYWwpKSB7CisgICAg
ICAgICAgICBhZGRfcG9sbGZkKG5vZGUpOworICAgICAgICB9CisgICAgfQorCisgICAgLyogZXBv
bGwoNykgaXMgZmFzdGVyIGFib3ZlIGEgY2VydGFpbiBudW1iZXIgb2YgZmRzICovCisgICAgaWYg
KGZkbW9uX2Vwb2xsX3RyeV91cGdyYWRlKGN0eCwgbnBmZCkpIHsKKyAgICAgICAgcmV0dXJuIGN0
eC0+ZmRtb25fb3BzLT53YWl0KGN0eCwgcmVhZHlfbGlzdCwgdGltZW91dCk7CisgICAgfQorCisg
ICAgcmV0ID0gcWVtdV9wb2xsX25zKHBvbGxmZHMsIG5wZmQsIHRpbWVvdXQpOworICAgIGlmIChy
ZXQgPiAwKSB7CisgICAgICAgIGludCBpOworCisgICAgICAgIGZvciAoaSA9IDA7IGkgPCBucGZk
OyBpKyspIHsKKyAgICAgICAgICAgIGludCByZXZlbnRzID0gcG9sbGZkc1tpXS5yZXZlbnRzOwor
CisgICAgICAgICAgICBpZiAocmV2ZW50cykgeworICAgICAgICAgICAgICAgIGFpb19hZGRfcmVh
ZHlfaGFuZGxlcihyZWFkeV9saXN0LCBub2Rlc1tpXSwgcmV2ZW50cyk7CisgICAgICAgICAgICB9
CisgICAgICAgIH0KKyAgICB9CisKKyAgICBucGZkID0gMDsKKyAgICByZXR1cm4gcmV0OworfQor
CitzdGF0aWMgdm9pZCBmZG1vbl9wb2xsX3VwZGF0ZShBaW9Db250ZXh0ICpjdHgsIEFpb0hhbmRs
ZXIgKm5vZGUsIGJvb2wgaXNfbmV3KQoreworICAgIC8qIERvIG5vdGhpbmcsIEFpb0hhbmRsZXIg
YWxyZWFkeSBjb250YWlucyB0aGUgc3RhdGUgd2UnbGwgbmVlZCAqLworfQorCitjb25zdCBGRE1v
bk9wcyBmZG1vbl9wb2xsX29wcyA9IHsKKyAgICAudXBkYXRlID0gZmRtb25fcG9sbF91cGRhdGUs
CisgICAgLndhaXQgPSBmZG1vbl9wb2xsX3dhaXQsCit9OwotLSAKMi4yNC4xCgo=


