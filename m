Return-Path: <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>
X-Original-To: lists+qemu-devel@lfdr.de
Delivered-To: lists+qemu-devel@lfdr.de
Received: from lists.gnu.org (lists.gnu.org [209.51.188.17])
	by mail.lfdr.de (Postfix) with ESMTPS id 0674A275D40
	for <lists+qemu-devel@lfdr.de>; Wed, 23 Sep 2020 18:21:31 +0200 (CEST)
Received: from localhost ([::1]:41610 helo=lists1p.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.90_1)
	(envelope-from <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>)
	id 1kL7WL-00063k-Uv
	for lists+qemu-devel@lfdr.de; Wed, 23 Sep 2020 12:21:29 -0400
Received: from eggs.gnu.org ([2001:470:142:3::10]:47100)
 by lists.gnu.org with esmtps (TLS1.2:ECDHE_RSA_AES_256_GCM_SHA384:256)
 (Exim 4.90_1) (envelope-from <stefanha@redhat.com>)
 id 1kL7MJ-0003Vy-J4
 for qemu-devel@nongnu.org; Wed, 23 Sep 2020 12:11:07 -0400
Received: from us-smtp-delivery-124.mimecast.com ([216.205.24.124]:38450)
 by eggs.gnu.org with esmtps (TLS1.2:ECDHE_RSA_AES_256_CBC_SHA1:256)
 (Exim 4.90_1) (envelope-from <stefanha@redhat.com>)
 id 1kL7MF-0006DR-BV
 for qemu-devel@nongnu.org; Wed, 23 Sep 2020 12:11:07 -0400
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1600877462;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=JjkHASSICsm9zahK0zNlLdjGvgbJbTeRrxHq1lM/FXo=;
 b=SbQt+BdbudKVwlVAom1qVV2WYPCe+0FYYP7xHesuGgSc6qthZBtDZnQiEGPv4aaEz11+Y0
 A8M4Bw8mjxeRcO7Y4Jyn+leR0zOsnBf6E/849/qxNQBD6GcFjcTgvjCtlR50coGu0fSx3e
 qBr0G/fZDDagKjaVy1mbobrrgpKwaa8=
Received: from mimecast-mx01.redhat.com (mimecast-mx01.redhat.com
 [209.132.183.4]) (Using TLS) by relay.mimecast.com with ESMTP id
 us-mta-225-ypHld5EzNi6AOrPveONRbA-1; Wed, 23 Sep 2020 12:11:00 -0400
X-MC-Unique: ypHld5EzNi6AOrPveONRbA-1
Received: from smtp.corp.redhat.com (int-mx05.intmail.prod.int.phx2.redhat.com
 [10.5.11.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mimecast-mx01.redhat.com (Postfix) with ESMTPS id 6AF151084C8F;
 Wed, 23 Sep 2020 16:10:58 +0000 (UTC)
Received: from localhost (ovpn-113-77.ams2.redhat.com [10.36.113.77])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 8B47755783;
 Wed, 23 Sep 2020 16:10:54 +0000 (UTC)
From: Stefan Hajnoczi <stefanha@redhat.com>
To: qemu-devel@nongnu.org,
	Peter Maydell <peter.maydell@linaro.org>
Subject: [PULL 04/13] util/iov: add iov_discard_undo()
Date: Wed, 23 Sep 2020 17:10:22 +0100
Message-Id: <20200923161031.69474-5-stefanha@redhat.com>
In-Reply-To: <20200923161031.69474-1-stefanha@redhat.com>
References: <20200923161031.69474-1-stefanha@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.15
Authentication-Results: relay.mimecast.com;
 auth=pass smtp.auth=CUSA124A263 smtp.mailfrom=stefanha@redhat.com
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: redhat.com
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: base64
Received-SPF: pass client-ip=216.205.24.124; envelope-from=stefanha@redhat.com;
 helo=us-smtp-delivery-124.mimecast.com
X-detected-operating-system: by eggs.gnu.org: First seen = 2020/09/22 23:02:20
X-ACL-Warn: Detected OS   = Linux 2.2.x-3.x [generic] [fuzzy]
X-Spam_score_int: -15
X-Spam_score: -1.6
X-Spam_bar: -
X-Spam_report: (-1.6 / 5.0 requ) BAYES_00=-1.9, DKIMWL_WL_HIGH=-1.228,
 DKIM_SIGNED=0.1, DKIM_VALID=-0.1, DKIM_VALID_AU=-0.1, DKIM_VALID_EF=-0.1,
 MIME_BASE64_TEXT=1.741, RCVD_IN_DNSWL_NONE=-0.0001, RCVD_IN_MSPIKE_H5=0.001,
 RCVD_IN_MSPIKE_WL=0.001, SPF_HELO_NONE=0.001,
 SPF_PASS=-0.001 autolearn=unavailable autolearn_force=no
X-Spam_action: no action
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <https://lists.nongnu.org/archive/html/qemu-devel>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Cc: Li Qiang <liq3ea@gmail.com>, Stefan Hajnoczi <stefanha@redhat.com>,
 "Dr. David Alan Gilbert" <dgilbert@redhat.com>, qemu-block@nongnu.org
Errors-To: qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org
Sender: "Qemu-devel" <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>

VGhlIGlvdl9kaXNjYXJkX2Zyb250L2JhY2soKSBvcGVyYXRpb25zIGFyZSB1c2VmdWwgZm9yIHBh
cnNpbmcgaW92ZWNzCmJ1dCB0aGV5IG1vZGlmeSB0aGUgYXJyYXkgZWxlbWVudHMuIElmIHRoZSBv
cmlnaW5hbCBhcnJheSBpcyBuZWVkZWQKYWZ0ZXIgcGFyc2luZyBmaW5pc2hlcyB0aGVyZSBpcyBj
dXJyZW50bHkgbm8gd2F5IHRvIHJlc3RvcmUgaXQuCgpBbHRob3VnaCBnX21lbWR1cCgpIGNhbiBi
ZSB1c2VkIGJlZm9yZSBwZXJmb3JtaW5nIGRlc3RydWN0aXZlCmlvdl9kaXNjYXJkX2Zyb250L2Jh
Y2soKSBvcGVyYXRpb25zLCB0aGlzIGlzIGluZWZmaWNpZW50LgoKSW50cm9kdWNlIGlvdl9kaXNj
YXJkX3VuZG8oKSB0byByZXN0b3JlIHRoZSBhcnJheSB0byB0aGUgc3RhdGUgcHJpb3IgdG8KYW4g
aW92X2Rpc2NhcmRfZnJvbnQvYmFjaygpIG9wZXJhdGlvbi4KClNpZ25lZC1vZmYtYnk6IFN0ZWZh
biBIYWpub2N6aSA8c3RlZmFuaGFAcmVkaGF0LmNvbT4KUmV2aWV3ZWQtYnk6IExpIFFpYW5nIDxs
aXEzZWFAZ21haWwuY29tPgpNZXNzYWdlLUlkOiA8MjAyMDA5MTcwOTQ0NTUuODIyMzc5LTItc3Rl
ZmFuaGFAcmVkaGF0LmNvbT4KLS0tCiBpbmNsdWRlL3FlbXUvaW92LmggfCAgMjMgKysrKysrKwog
dGVzdHMvdGVzdC1pb3YuYyAgIHwgMTY1ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKwogdXRpbC9pb3YuYyAgICAgICAgIHwgIDUwICsrKysrKysrKysrKy0tCiAz
IGZpbGVzIGNoYW5nZWQsIDIzNCBpbnNlcnRpb25zKCspLCA0IGRlbGV0aW9ucygtKQoKZGlmZiAt
LWdpdCBhL2luY2x1ZGUvcWVtdS9pb3YuaCBiL2luY2x1ZGUvcWVtdS9pb3YuaAppbmRleCBiZmZj
MTUxMjgyLi5iNmIyODNhNWU1IDEwMDY0NAotLS0gYS9pbmNsdWRlL3FlbXUvaW92LmgKKysrIGIv
aW5jbHVkZS9xZW11L2lvdi5oCkBAIC0xMzAsNiArMTMwLDI5IEBAIHNpemVfdCBpb3ZfZGlzY2Fy
ZF9mcm9udChzdHJ1Y3QgaW92ZWMgKippb3YsIHVuc2lnbmVkIGludCAqaW92X2NudCwKIHNpemVf
dCBpb3ZfZGlzY2FyZF9iYWNrKHN0cnVjdCBpb3ZlYyAqaW92LCB1bnNpZ25lZCBpbnQgKmlvdl9j
bnQsCiAgICAgICAgICAgICAgICAgICAgICAgICBzaXplX3QgYnl0ZXMpOwogCisvKiBJbmZvcm1h
dGlvbiBuZWVkZWQgdG8gdW5kbyBhbiBpb3ZfZGlzY2FyZF8qKCkgb3BlcmF0aW9uICovCit0eXBl
ZGVmIHN0cnVjdCB7CisgICAgc3RydWN0IGlvdmVjICptb2RpZmllZF9pb3Y7CisgICAgc3RydWN0
IGlvdmVjIG9yaWc7Cit9IElPVkRpc2NhcmRVbmRvOworCisvKgorICogVW5kbyBhbiBpb3ZfZGlz
Y2FyZF9mcm9udF91bmRvYWJsZSgpIG9yIGlvdl9kaXNjYXJkX2JhY2tfdW5kb2FibGUoKQorICog
b3BlcmF0aW9uLiBJZiBtdWx0aXBsZSBvcGVyYXRpb25zIGFyZSBtYWRlIHRoZW4gZWFjaCBvbmUg
bmVlZHMgYSBzZXBhcmF0ZQorICogSU9WRGlzY2FyZFVuZG8gYW5kIGlvdl9kaXNjYXJkX3VuZG8o
KSBtdXN0IGJlIGNhbGxlZCBpbiB0aGUgcmV2ZXJzZSBvcmRlcgorICogdGhhdCB0aGUgb3BlcmF0
aW9ucyB3ZXJlIG1hZGUuCisgKi8KK3ZvaWQgaW92X2Rpc2NhcmRfdW5kbyhJT1ZEaXNjYXJkVW5k
byAqdW5kbyk7CisKKy8qCisgKiBVbmRvYWJsZSB2ZXJzaW9ucyBvZiBpb3ZfZGlzY2FyZF9mcm9u
dCgpIGFuZCBpb3ZfZGlzY2FyZF9iYWNrKCkuIFVzZQorICogaW92X2Rpc2NhcmRfdW5kbygpIHRv
IHJlc2V0IHRvIHRoZSBzdGF0ZSBiZWZvcmUgdGhlIGRpc2NhcmQgb3BlcmF0aW9ucy4KKyAqLwor
c2l6ZV90IGlvdl9kaXNjYXJkX2Zyb250X3VuZG9hYmxlKHN0cnVjdCBpb3ZlYyAqKmlvdiwgdW5z
aWduZWQgaW50ICppb3ZfY250LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNp
emVfdCBieXRlcywgSU9WRGlzY2FyZFVuZG8gKnVuZG8pOworc2l6ZV90IGlvdl9kaXNjYXJkX2Jh
Y2tfdW5kb2FibGUoc3RydWN0IGlvdmVjICppb3YsIHVuc2lnbmVkIGludCAqaW92X2NudCwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemVfdCBieXRlcywgSU9WRGlzY2FyZFVu
ZG8gKnVuZG8pOworCiB0eXBlZGVmIHN0cnVjdCBRRU1VSU9WZWN0b3IgewogICAgIHN0cnVjdCBp
b3ZlYyAqaW92OwogICAgIGludCBuaW92OwpkaWZmIC0tZ2l0IGEvdGVzdHMvdGVzdC1pb3YuYyBi
L3Rlc3RzL3Rlc3QtaW92LmMKaW5kZXggNDU4Y2EyNTA5OS4uOWM0MTVlMmYxZiAxMDA2NDQKLS0t
IGEvdGVzdHMvdGVzdC1pb3YuYworKysgYi90ZXN0cy90ZXN0LWlvdi5jCkBAIC0yNiw2ICsyNiwx
MiBAQCBzdGF0aWMgdm9pZCBpb3ZfZnJlZShzdHJ1Y3QgaW92ZWMgKmlvdiwgdW5zaWduZWQgbmlv
dikKICAgICBnX2ZyZWUoaW92KTsKIH0KIAorc3RhdGljIGJvb2wgaW92X2VxdWFscyhjb25zdCBz
dHJ1Y3QgaW92ZWMgKmEsIGNvbnN0IHN0cnVjdCBpb3ZlYyAqYiwKKyAgICAgICAgICAgICAgICAg
ICAgICAgdW5zaWduZWQgbmlvdikKK3sKKyAgICByZXR1cm4gbWVtY21wKGEsIGIsIHNpemVvZihh
WzBdKSAqIG5pb3YpID09IDA7Cit9CisKIHN0YXRpYyB2b2lkIHRlc3RfaW92X2J5dGVzKHN0cnVj
dCBpb3ZlYyAqaW92LCB1bnNpZ25lZCBuaW92LAogICAgICAgICAgICAgICAgICAgICAgICAgICAg
c2l6ZV90IG9mZnNldCwgc2l6ZV90IGJ5dGVzKQogewpAQCAtMzM1LDYgKzM0MSw4NyBAQCBzdGF0
aWMgdm9pZCB0ZXN0X2Rpc2NhcmRfZnJvbnQodm9pZCkKICAgICBpb3ZfZnJlZShpb3YsIGlvdl9j
bnQpOwogfQogCitzdGF0aWMgdm9pZCB0ZXN0X2Rpc2NhcmRfZnJvbnRfdW5kbyh2b2lkKQorewor
ICAgIElPVkRpc2NhcmRVbmRvIHVuZG87CisgICAgc3RydWN0IGlvdmVjICppb3Y7CisgICAgc3Ry
dWN0IGlvdmVjICppb3ZfdG1wOworICAgIHN0cnVjdCBpb3ZlYyAqaW92X29yaWc7CisgICAgdW5z
aWduZWQgaW50IGlvdl9jbnQ7CisgICAgdW5zaWduZWQgaW50IGlvdl9jbnRfdG1wOworICAgIHNp
emVfdCBzaXplOworCisgICAgLyogRGlzY2FyZCB6ZXJvIGJ5dGVzICovCisgICAgaW92X3JhbmRv
bSgmaW92LCAmaW92X2NudCk7CisgICAgaW92X29yaWcgPSBnX21lbWR1cChpb3YsIHNpemVvZihp
b3ZbMF0pICogaW92X2NudCk7CisgICAgaW92X3RtcCA9IGlvdjsKKyAgICBpb3ZfY250X3RtcCA9
IGlvdl9jbnQ7CisgICAgaW92X2Rpc2NhcmRfZnJvbnRfdW5kb2FibGUoJmlvdl90bXAsICZpb3Zf
Y250X3RtcCwgMCwgJnVuZG8pOworICAgIGlvdl9kaXNjYXJkX3VuZG8oJnVuZG8pOworICAgIGFz
c2VydChpb3ZfZXF1YWxzKGlvdiwgaW92X29yaWcsIGlvdl9jbnQpKTsKKyAgICBnX2ZyZWUoaW92
X29yaWcpOworICAgIGlvdl9mcmVlKGlvdiwgaW92X2NudCk7CisKKyAgICAvKiBEaXNjYXJkIG1v
cmUgYnl0ZXMgdGhhbiB2ZWN0b3Igc2l6ZSAqLworICAgIGlvdl9yYW5kb20oJmlvdiwgJmlvdl9j
bnQpOworICAgIGlvdl9vcmlnID0gZ19tZW1kdXAoaW92LCBzaXplb2YoaW92WzBdKSAqIGlvdl9j
bnQpOworICAgIGlvdl90bXAgPSBpb3Y7CisgICAgaW92X2NudF90bXAgPSBpb3ZfY250OworICAg
IHNpemUgPSBpb3Zfc2l6ZShpb3YsIGlvdl9jbnQpOworICAgIGlvdl9kaXNjYXJkX2Zyb250X3Vu
ZG9hYmxlKCZpb3ZfdG1wLCAmaW92X2NudF90bXAsIHNpemUgKyAxLCAmdW5kbyk7CisgICAgaW92
X2Rpc2NhcmRfdW5kbygmdW5kbyk7CisgICAgYXNzZXJ0KGlvdl9lcXVhbHMoaW92LCBpb3Zfb3Jp
ZywgaW92X2NudCkpOworICAgIGdfZnJlZShpb3Zfb3JpZyk7CisgICAgaW92X2ZyZWUoaW92LCBp
b3ZfY250KTsKKworICAgIC8qIERpc2NhcmQgZW50aXJlIHZlY3RvciAqLworICAgIGlvdl9yYW5k
b20oJmlvdiwgJmlvdl9jbnQpOworICAgIGlvdl9vcmlnID0gZ19tZW1kdXAoaW92LCBzaXplb2Yo
aW92WzBdKSAqIGlvdl9jbnQpOworICAgIGlvdl90bXAgPSBpb3Y7CisgICAgaW92X2NudF90bXAg
PSBpb3ZfY250OworICAgIHNpemUgPSBpb3Zfc2l6ZShpb3YsIGlvdl9jbnQpOworICAgIGlvdl9k
aXNjYXJkX2Zyb250X3VuZG9hYmxlKCZpb3ZfdG1wLCAmaW92X2NudF90bXAsIHNpemUsICZ1bmRv
KTsKKyAgICBpb3ZfZGlzY2FyZF91bmRvKCZ1bmRvKTsKKyAgICBhc3NlcnQoaW92X2VxdWFscyhp
b3YsIGlvdl9vcmlnLCBpb3ZfY250KSk7CisgICAgZ19mcmVlKGlvdl9vcmlnKTsKKyAgICBpb3Zf
ZnJlZShpb3YsIGlvdl9jbnQpOworCisgICAgLyogRGlzY2FyZCB3aXRoaW4gZmlyc3QgZWxlbWVu
dCAqLworICAgIGlvdl9yYW5kb20oJmlvdiwgJmlvdl9jbnQpOworICAgIGlvdl9vcmlnID0gZ19t
ZW1kdXAoaW92LCBzaXplb2YoaW92WzBdKSAqIGlvdl9jbnQpOworICAgIGlvdl90bXAgPSBpb3Y7
CisgICAgaW92X2NudF90bXAgPSBpb3ZfY250OworICAgIHNpemUgPSBnX3Rlc3RfcmFuZF9pbnRf
cmFuZ2UoMSwgaW92LT5pb3ZfbGVuKTsKKyAgICBpb3ZfZGlzY2FyZF9mcm9udF91bmRvYWJsZSgm
aW92X3RtcCwgJmlvdl9jbnRfdG1wLCBzaXplLCAmdW5kbyk7CisgICAgaW92X2Rpc2NhcmRfdW5k
bygmdW5kbyk7CisgICAgYXNzZXJ0KGlvdl9lcXVhbHMoaW92LCBpb3Zfb3JpZywgaW92X2NudCkp
OworICAgIGdfZnJlZShpb3Zfb3JpZyk7CisgICAgaW92X2ZyZWUoaW92LCBpb3ZfY250KTsKKwor
ICAgIC8qIERpc2NhcmQgZW50aXJlIGZpcnN0IGVsZW1lbnQgKi8KKyAgICBpb3ZfcmFuZG9tKCZp
b3YsICZpb3ZfY250KTsKKyAgICBpb3Zfb3JpZyA9IGdfbWVtZHVwKGlvdiwgc2l6ZW9mKGlvdlsw
XSkgKiBpb3ZfY250KTsKKyAgICBpb3ZfdG1wID0gaW92OworICAgIGlvdl9jbnRfdG1wID0gaW92
X2NudDsKKyAgICBpb3ZfZGlzY2FyZF9mcm9udF91bmRvYWJsZSgmaW92X3RtcCwgJmlvdl9jbnRf
dG1wLCBpb3YtPmlvdl9sZW4sICZ1bmRvKTsKKyAgICBpb3ZfZGlzY2FyZF91bmRvKCZ1bmRvKTsK
KyAgICBhc3NlcnQoaW92X2VxdWFscyhpb3YsIGlvdl9vcmlnLCBpb3ZfY250KSk7CisgICAgZ19m
cmVlKGlvdl9vcmlnKTsKKyAgICBpb3ZfZnJlZShpb3YsIGlvdl9jbnQpOworCisgICAgLyogRGlz
Y2FyZCB3aXRoaW4gc2Vjb25kIGVsZW1lbnQgKi8KKyAgICBpb3ZfcmFuZG9tKCZpb3YsICZpb3Zf
Y250KTsKKyAgICBpb3Zfb3JpZyA9IGdfbWVtZHVwKGlvdiwgc2l6ZW9mKGlvdlswXSkgKiBpb3Zf
Y250KTsKKyAgICBpb3ZfdG1wID0gaW92OworICAgIGlvdl9jbnRfdG1wID0gaW92X2NudDsKKyAg
ICBzaXplID0gaW92LT5pb3ZfbGVuICsgZ190ZXN0X3JhbmRfaW50X3JhbmdlKDEsIGlvdlsxXS5p
b3ZfbGVuKTsKKyAgICBpb3ZfZGlzY2FyZF9mcm9udF91bmRvYWJsZSgmaW92X3RtcCwgJmlvdl9j
bnRfdG1wLCBzaXplLCAmdW5kbyk7CisgICAgaW92X2Rpc2NhcmRfdW5kbygmdW5kbyk7CisgICAg
YXNzZXJ0KGlvdl9lcXVhbHMoaW92LCBpb3Zfb3JpZywgaW92X2NudCkpOworICAgIGdfZnJlZShp
b3Zfb3JpZyk7CisgICAgaW92X2ZyZWUoaW92LCBpb3ZfY250KTsKK30KKwogc3RhdGljIHZvaWQg
dGVzdF9kaXNjYXJkX2JhY2sodm9pZCkKIHsKICAgICBzdHJ1Y3QgaW92ZWMgKmlvdjsKQEAgLTQw
NCw2ICs0OTEsODIgQEAgc3RhdGljIHZvaWQgdGVzdF9kaXNjYXJkX2JhY2sodm9pZCkKICAgICBp
b3ZfZnJlZShpb3YsIGlvdl9jbnQpOwogfQogCitzdGF0aWMgdm9pZCB0ZXN0X2Rpc2NhcmRfYmFj
a191bmRvKHZvaWQpCit7CisgICAgSU9WRGlzY2FyZFVuZG8gdW5kbzsKKyAgICBzdHJ1Y3QgaW92
ZWMgKmlvdjsKKyAgICBzdHJ1Y3QgaW92ZWMgKmlvdl9vcmlnOworICAgIHVuc2lnbmVkIGludCBp
b3ZfY250OworICAgIHVuc2lnbmVkIGludCBpb3ZfY250X3RtcDsKKyAgICBzaXplX3Qgc2l6ZTsK
KworICAgIC8qIERpc2NhcmQgemVybyBieXRlcyAqLworICAgIGlvdl9yYW5kb20oJmlvdiwgJmlv
dl9jbnQpOworICAgIGlvdl9vcmlnID0gZ19tZW1kdXAoaW92LCBzaXplb2YoaW92WzBdKSAqIGlv
dl9jbnQpOworICAgIGlvdl9jbnRfdG1wID0gaW92X2NudDsKKyAgICBpb3ZfZGlzY2FyZF9iYWNr
X3VuZG9hYmxlKGlvdiwgJmlvdl9jbnRfdG1wLCAwLCAmdW5kbyk7CisgICAgaW92X2Rpc2NhcmRf
dW5kbygmdW5kbyk7CisgICAgYXNzZXJ0KGlvdl9lcXVhbHMoaW92LCBpb3Zfb3JpZywgaW92X2Nu
dCkpOworICAgIGdfZnJlZShpb3Zfb3JpZyk7CisgICAgaW92X2ZyZWUoaW92LCBpb3ZfY250KTsK
KworICAgIC8qIERpc2NhcmQgbW9yZSBieXRlcyB0aGFuIHZlY3RvciBzaXplICovCisgICAgaW92
X3JhbmRvbSgmaW92LCAmaW92X2NudCk7CisgICAgaW92X29yaWcgPSBnX21lbWR1cChpb3YsIHNp
emVvZihpb3ZbMF0pICogaW92X2NudCk7CisgICAgaW92X2NudF90bXAgPSBpb3ZfY250OworICAg
IHNpemUgPSBpb3Zfc2l6ZShpb3YsIGlvdl9jbnQpOworICAgIGlvdl9kaXNjYXJkX2JhY2tfdW5k
b2FibGUoaW92LCAmaW92X2NudF90bXAsIHNpemUgKyAxLCAmdW5kbyk7CisgICAgaW92X2Rpc2Nh
cmRfdW5kbygmdW5kbyk7CisgICAgYXNzZXJ0KGlvdl9lcXVhbHMoaW92LCBpb3Zfb3JpZywgaW92
X2NudCkpOworICAgIGdfZnJlZShpb3Zfb3JpZyk7CisgICAgaW92X2ZyZWUoaW92LCBpb3ZfY250
KTsKKworICAgIC8qIERpc2NhcmQgZW50aXJlIHZlY3RvciAqLworICAgIGlvdl9yYW5kb20oJmlv
diwgJmlvdl9jbnQpOworICAgIGlvdl9vcmlnID0gZ19tZW1kdXAoaW92LCBzaXplb2YoaW92WzBd
KSAqIGlvdl9jbnQpOworICAgIGlvdl9jbnRfdG1wID0gaW92X2NudDsKKyAgICBzaXplID0gaW92
X3NpemUoaW92LCBpb3ZfY250KTsKKyAgICBpb3ZfZGlzY2FyZF9iYWNrX3VuZG9hYmxlKGlvdiwg
Jmlvdl9jbnRfdG1wLCBzaXplLCAmdW5kbyk7CisgICAgaW92X2Rpc2NhcmRfdW5kbygmdW5kbyk7
CisgICAgYXNzZXJ0KGlvdl9lcXVhbHMoaW92LCBpb3Zfb3JpZywgaW92X2NudCkpOworICAgIGdf
ZnJlZShpb3Zfb3JpZyk7CisgICAgaW92X2ZyZWUoaW92LCBpb3ZfY250KTsKKworICAgIC8qIERp
c2NhcmQgd2l0aGluIGxhc3QgZWxlbWVudCAqLworICAgIGlvdl9yYW5kb20oJmlvdiwgJmlvdl9j
bnQpOworICAgIGlvdl9vcmlnID0gZ19tZW1kdXAoaW92LCBzaXplb2YoaW92WzBdKSAqIGlvdl9j
bnQpOworICAgIGlvdl9jbnRfdG1wID0gaW92X2NudDsKKyAgICBzaXplID0gZ190ZXN0X3JhbmRf
aW50X3JhbmdlKDEsIGlvdltpb3ZfY250IC0gMV0uaW92X2xlbik7CisgICAgaW92X2Rpc2NhcmRf
YmFja191bmRvYWJsZShpb3YsICZpb3ZfY250X3RtcCwgc2l6ZSwgJnVuZG8pOworICAgIGlvdl9k
aXNjYXJkX3VuZG8oJnVuZG8pOworICAgIGFzc2VydChpb3ZfZXF1YWxzKGlvdiwgaW92X29yaWcs
IGlvdl9jbnQpKTsKKyAgICBnX2ZyZWUoaW92X29yaWcpOworICAgIGlvdl9mcmVlKGlvdiwgaW92
X2NudCk7CisKKyAgICAvKiBEaXNjYXJkIGVudGlyZSBsYXN0IGVsZW1lbnQgKi8KKyAgICBpb3Zf
cmFuZG9tKCZpb3YsICZpb3ZfY250KTsKKyAgICBpb3Zfb3JpZyA9IGdfbWVtZHVwKGlvdiwgc2l6
ZW9mKGlvdlswXSkgKiBpb3ZfY250KTsKKyAgICBpb3ZfY250X3RtcCA9IGlvdl9jbnQ7CisgICAg
c2l6ZSA9IGlvdltpb3ZfY250IC0gMV0uaW92X2xlbjsKKyAgICBpb3ZfZGlzY2FyZF9iYWNrX3Vu
ZG9hYmxlKGlvdiwgJmlvdl9jbnRfdG1wLCBzaXplLCAmdW5kbyk7CisgICAgaW92X2Rpc2NhcmRf
dW5kbygmdW5kbyk7CisgICAgYXNzZXJ0KGlvdl9lcXVhbHMoaW92LCBpb3Zfb3JpZywgaW92X2Nu
dCkpOworICAgIGdfZnJlZShpb3Zfb3JpZyk7CisgICAgaW92X2ZyZWUoaW92LCBpb3ZfY250KTsK
KworICAgIC8qIERpc2NhcmQgd2l0aGluIHNlY29uZC10by1sYXN0IGVsZW1lbnQgKi8KKyAgICBp
b3ZfcmFuZG9tKCZpb3YsICZpb3ZfY250KTsKKyAgICBpb3Zfb3JpZyA9IGdfbWVtZHVwKGlvdiwg
c2l6ZW9mKGlvdlswXSkgKiBpb3ZfY250KTsKKyAgICBpb3ZfY250X3RtcCA9IGlvdl9jbnQ7Cisg
ICAgc2l6ZSA9IGlvdltpb3ZfY250IC0gMV0uaW92X2xlbiArCisgICAgICAgICAgIGdfdGVzdF9y
YW5kX2ludF9yYW5nZSgxLCBpb3ZbaW92X2NudCAtIDJdLmlvdl9sZW4pOworICAgIGlvdl9kaXNj
YXJkX2JhY2tfdW5kb2FibGUoaW92LCAmaW92X2NudF90bXAsIHNpemUsICZ1bmRvKTsKKyAgICBp
b3ZfZGlzY2FyZF91bmRvKCZ1bmRvKTsKKyAgICBhc3NlcnQoaW92X2VxdWFscyhpb3YsIGlvdl9v
cmlnLCBpb3ZfY250KSk7CisgICAgZ19mcmVlKGlvdl9vcmlnKTsKKyAgICBpb3ZfZnJlZShpb3Ys
IGlvdl9jbnQpOworfQorCiBpbnQgbWFpbihpbnQgYXJnYywgY2hhciAqKmFyZ3YpCiB7CiAgICAg
Z190ZXN0X2luaXQoJmFyZ2MsICZhcmd2LCBOVUxMKTsKQEAgLTQxMiw1ICs1NzUsNyBAQCBpbnQg
bWFpbihpbnQgYXJnYywgY2hhciAqKmFyZ3YpCiAgICAgZ190ZXN0X2FkZF9mdW5jKCIvYmFzaWMv
aW92L2lvIiwgdGVzdF9pbyk7CiAgICAgZ190ZXN0X2FkZF9mdW5jKCIvYmFzaWMvaW92L2Rpc2Nh
cmQtZnJvbnQiLCB0ZXN0X2Rpc2NhcmRfZnJvbnQpOwogICAgIGdfdGVzdF9hZGRfZnVuYygiL2Jh
c2ljL2lvdi9kaXNjYXJkLWJhY2siLCB0ZXN0X2Rpc2NhcmRfYmFjayk7CisgICAgZ190ZXN0X2Fk
ZF9mdW5jKCIvYmFzaWMvaW92L2Rpc2NhcmQtZnJvbnQtdW5kbyIsIHRlc3RfZGlzY2FyZF9mcm9u
dF91bmRvKTsKKyAgICBnX3Rlc3RfYWRkX2Z1bmMoIi9iYXNpYy9pb3YvZGlzY2FyZC1iYWNrLXVu
ZG8iLCB0ZXN0X2Rpc2NhcmRfYmFja191bmRvKTsKICAgICByZXR1cm4gZ190ZXN0X3J1bigpOwog
fQpkaWZmIC0tZ2l0IGEvdXRpbC9pb3YuYyBiL3V0aWwvaW92LmMKaW5kZXggYWU2MWQ2OTZhYS4u
ZjNhOWU5MmEzNyAxMDA2NDQKLS0tIGEvdXRpbC9pb3YuYworKysgYi91dGlsL2lvdi5jCkBAIC02
MzYsMTQgKzYzNiwzMyBAQCB2b2lkIHFlbXVfaW92ZWNfY2xvbmUoUUVNVUlPVmVjdG9yICpkZXN0
LCBjb25zdCBRRU1VSU9WZWN0b3IgKnNyYywgdm9pZCAqYnVmKQogICAgIH0KIH0KIAotc2l6ZV90
IGlvdl9kaXNjYXJkX2Zyb250KHN0cnVjdCBpb3ZlYyAqKmlvdiwgdW5zaWduZWQgaW50ICppb3Zf
Y250LAotICAgICAgICAgICAgICAgICAgICAgICAgIHNpemVfdCBieXRlcykKK3ZvaWQgaW92X2Rp
c2NhcmRfdW5kbyhJT1ZEaXNjYXJkVW5kbyAqdW5kbykKK3sKKyAgICAvKiBSZXN0b3JlIG9yaWdp
bmFsIGlvdmVjIGlmIGl0IHdhcyBtb2RpZmllZCAqLworICAgIGlmICh1bmRvLT5tb2RpZmllZF9p
b3YpIHsKKyAgICAgICAgKnVuZG8tPm1vZGlmaWVkX2lvdiA9IHVuZG8tPm9yaWc7CisgICAgfQor
fQorCitzaXplX3QgaW92X2Rpc2NhcmRfZnJvbnRfdW5kb2FibGUoc3RydWN0IGlvdmVjICoqaW92
LAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuc2lnbmVkIGludCAqaW92X2Nu
dCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplX3QgYnl0ZXMsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSU9WRGlzY2FyZFVuZG8gKnVuZG8pCiB7CiAg
ICAgc2l6ZV90IHRvdGFsID0gMDsKICAgICBzdHJ1Y3QgaW92ZWMgKmN1cjsKIAorICAgIGlmICh1
bmRvKSB7CisgICAgICAgIHVuZG8tPm1vZGlmaWVkX2lvdiA9IE5VTEw7CisgICAgfQorCiAgICAg
Zm9yIChjdXIgPSAqaW92OyAqaW92X2NudCA+IDA7IGN1cisrKSB7CiAgICAgICAgIGlmIChjdXIt
Pmlvdl9sZW4gPiBieXRlcykgeworICAgICAgICAgICAgaWYgKHVuZG8pIHsKKyAgICAgICAgICAg
ICAgICB1bmRvLT5tb2RpZmllZF9pb3YgPSBjdXI7CisgICAgICAgICAgICAgICAgdW5kby0+b3Jp
ZyA9ICpjdXI7CisgICAgICAgICAgICB9CisKICAgICAgICAgICAgIGN1ci0+aW92X2Jhc2UgKz0g
Ynl0ZXM7CiAgICAgICAgICAgICBjdXItPmlvdl9sZW4gLT0gYnl0ZXM7CiAgICAgICAgICAgICB0
b3RhbCArPSBieXRlczsKQEAgLTY1OSwxMiArNjc4LDI0IEBAIHNpemVfdCBpb3ZfZGlzY2FyZF9m
cm9udChzdHJ1Y3QgaW92ZWMgKippb3YsIHVuc2lnbmVkIGludCAqaW92X2NudCwKICAgICByZXR1
cm4gdG90YWw7CiB9CiAKLXNpemVfdCBpb3ZfZGlzY2FyZF9iYWNrKHN0cnVjdCBpb3ZlYyAqaW92
LCB1bnNpZ25lZCBpbnQgKmlvdl9jbnQsCi0gICAgICAgICAgICAgICAgICAgICAgICBzaXplX3Qg
Ynl0ZXMpCitzaXplX3QgaW92X2Rpc2NhcmRfZnJvbnQoc3RydWN0IGlvdmVjICoqaW92LCB1bnNp
Z25lZCBpbnQgKmlvdl9jbnQsCisgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZV90IGJ5dGVz
KQoreworICAgIHJldHVybiBpb3ZfZGlzY2FyZF9mcm9udF91bmRvYWJsZShpb3YsIGlvdl9jbnQs
IGJ5dGVzLCBOVUxMKTsKK30KKworc2l6ZV90IGlvdl9kaXNjYXJkX2JhY2tfdW5kb2FibGUoc3Ry
dWN0IGlvdmVjICppb3YsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25l
ZCBpbnQgKmlvdl9jbnQsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplX3Qg
Ynl0ZXMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJT1ZEaXNjYXJkVW5kbyAq
dW5kbykKIHsKICAgICBzaXplX3QgdG90YWwgPSAwOwogICAgIHN0cnVjdCBpb3ZlYyAqY3VyOwog
CisgICAgaWYgKHVuZG8pIHsKKyAgICAgICAgdW5kby0+bW9kaWZpZWRfaW92ID0gTlVMTDsKKyAg
ICB9CisKICAgICBpZiAoKmlvdl9jbnQgPT0gMCkgewogICAgICAgICByZXR1cm4gMDsKICAgICB9
CkBAIC02NzMsNiArNzA0LDExIEBAIHNpemVfdCBpb3ZfZGlzY2FyZF9iYWNrKHN0cnVjdCBpb3Zl
YyAqaW92LCB1bnNpZ25lZCBpbnQgKmlvdl9jbnQsCiAKICAgICB3aGlsZSAoKmlvdl9jbnQgPiAw
KSB7CiAgICAgICAgIGlmIChjdXItPmlvdl9sZW4gPiBieXRlcykgeworICAgICAgICAgICAgaWYg
KHVuZG8pIHsKKyAgICAgICAgICAgICAgICB1bmRvLT5tb2RpZmllZF9pb3YgPSBjdXI7CisgICAg
ICAgICAgICAgICAgdW5kby0+b3JpZyA9ICpjdXI7CisgICAgICAgICAgICB9CisKICAgICAgICAg
ICAgIGN1ci0+aW92X2xlbiAtPSBieXRlczsKICAgICAgICAgICAgIHRvdGFsICs9IGJ5dGVzOwog
ICAgICAgICAgICAgYnJlYWs7CkBAIC02ODcsNiArNzIzLDEyIEBAIHNpemVfdCBpb3ZfZGlzY2Fy
ZF9iYWNrKHN0cnVjdCBpb3ZlYyAqaW92LCB1bnNpZ25lZCBpbnQgKmlvdl9jbnQsCiAgICAgcmV0
dXJuIHRvdGFsOwogfQogCitzaXplX3QgaW92X2Rpc2NhcmRfYmFjayhzdHJ1Y3QgaW92ZWMgKmlv
diwgdW5zaWduZWQgaW50ICppb3ZfY250LAorICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZV90
IGJ5dGVzKQoreworICAgIHJldHVybiBpb3ZfZGlzY2FyZF9iYWNrX3VuZG9hYmxlKGlvdiwgaW92
X2NudCwgYnl0ZXMsIE5VTEwpOworfQorCiB2b2lkIHFlbXVfaW92ZWNfZGlzY2FyZF9iYWNrKFFF
TVVJT1ZlY3RvciAqcWlvdiwgc2l6ZV90IGJ5dGVzKQogewogICAgIHNpemVfdCB0b3RhbDsKLS0g
CjIuMjYuMgoK


