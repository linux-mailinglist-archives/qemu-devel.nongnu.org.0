Return-Path: <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>
X-Original-To: lists+qemu-devel@lfdr.de
Delivered-To: lists+qemu-devel@lfdr.de
Received: from lists.gnu.org (lists.gnu.org [209.51.188.17])
	by mail.lfdr.de (Postfix) with ESMTPS id 5625A38E728
	for <lists+qemu-devel@lfdr.de>; Mon, 24 May 2021 15:12:38 +0200 (CEST)
Received: from localhost ([::1]:55080 helo=lists1p.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.90_1)
	(envelope-from <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>)
	id 1llANp-00027E-CP
	for lists+qemu-devel@lfdr.de; Mon, 24 May 2021 09:12:37 -0400
Received: from eggs.gnu.org ([2001:470:142:3::10]:51616)
 by lists.gnu.org with esmtps (TLS1.2:ECDHE_RSA_AES_256_GCM_SHA384:256)
 (Exim 4.90_1) (envelope-from <stefanha@redhat.com>)
 id 1llAEL-0003Bj-FA
 for qemu-devel@nongnu.org; Mon, 24 May 2021 09:02:49 -0400
Received: from us-smtp-delivery-124.mimecast.com ([170.10.133.124]:24192)
 by eggs.gnu.org with esmtps (TLS1.2:ECDHE_RSA_AES_256_GCM_SHA384:256)
 (Exim 4.90_1) (envelope-from <stefanha@redhat.com>)
 id 1llAEE-0007uM-D4
 for qemu-devel@nongnu.org; Mon, 24 May 2021 09:02:49 -0400
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1621861360;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=uO4+E8RP2Ua5+4hVx4LGaMf6mX/r5La2/K1i3KqW4Xg=;
 b=hFOzfixFHarKyVtUrv8veRpN8lYI9mJBN4KCpRWJAl4uT8q4H/xmeEFr8gCJpEivA7ZSMX
 yYagcUEOUMp0naGyDOxQnEMxiA7k5B12rVrT+HMseg+pdpPwyudY0XCVPzYQI0CD6DcQbw
 heU4ayvjBqHUgFCVdfB1391JPxYpSk0=
Received: from mimecast-mx01.redhat.com (mimecast-mx01.redhat.com
 [209.132.183.4]) (Using TLS) by relay.mimecast.com with ESMTP id
 us-mta-312-VbpXtGcaN4WV9jkdQ6DdfQ-1; Mon, 24 May 2021 09:02:36 -0400
X-MC-Unique: VbpXtGcaN4WV9jkdQ6DdfQ-1
Received: from smtp.corp.redhat.com (int-mx03.intmail.prod.int.phx2.redhat.com
 [10.5.11.13])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mimecast-mx01.redhat.com (Postfix) with ESMTPS id 7C5D8107ACF2;
 Mon, 24 May 2021 13:02:35 +0000 (UTC)
Received: from localhost (ovpn-113-244.ams2.redhat.com [10.36.113.244])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 21BE06EF42;
 Mon, 24 May 2021 13:02:34 +0000 (UTC)
From: Stefan Hajnoczi <stefanha@redhat.com>
To: Peter Maydell <peter.maydell@linaro.org>,
	qemu-devel@nongnu.org
Subject: [PULL 7/8] coroutine-sleep: replace QemuCoSleepState pointer with
 struct in the API
Date: Mon, 24 May 2021 14:01:49 +0100
Message-Id: <20210524130150.50998-8-stefanha@redhat.com>
In-Reply-To: <20210524130150.50998-1-stefanha@redhat.com>
References: <20210524130150.50998-1-stefanha@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.13
Authentication-Results: relay.mimecast.com;
 auth=pass smtp.auth=CUSA124A263 smtp.mailfrom=stefanha@redhat.com
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: redhat.com
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="US-ASCII"
Received-SPF: pass client-ip=170.10.133.124; envelope-from=stefanha@redhat.com;
 helo=us-smtp-delivery-124.mimecast.com
X-Spam_score_int: -13
X-Spam_score: -1.4
X-Spam_bar: -
X-Spam_report: (-1.4 / 5.0 requ) BAYES_00=-1.9, DKIMWL_WL_HIGH=-0.371,
 DKIM_SIGNED=0.1, DKIM_VALID=-0.1, DKIM_VALID_AU=-0.1, DKIM_VALID_EF=-0.1,
 MIME_BASE64_TEXT=1.741, RCVD_IN_DNSWL_LOW=-0.7, RCVD_IN_MSPIKE_H4=0.001,
 RCVD_IN_MSPIKE_WL=0.001, SPF_HELO_NONE=0.001,
 SPF_PASS=-0.001 autolearn=ham autolearn_force=no
X-Spam_action: no action
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <https://lists.nongnu.org/archive/html/qemu-devel>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Cc: Kevin Wolf <kwolf@redhat.com>, Elena Ufimtseva <elena.ufimtseva@oracle.com>,
 Vladimir Sementsov-Ogievskiy <vsementsov@virtuozzo.com>,
 Jagannathan Raman <jag.raman@oracle.com>, qemu-block@nongnu.org,
 John G Johnson <john.g.johnson@oracle.com>, John Snow <jsnow@redhat.com>,
 Max Reitz <mreitz@redhat.com>, Stefan Hajnoczi <stefanha@redhat.com>,
 Paolo Bonzini <pbonzini@redhat.com>
Errors-To: qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org
Sender: "Qemu-devel" <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>

RnJvbTogUGFvbG8gQm9uemluaSA8cGJvbnppbmlAcmVkaGF0LmNvbT4KClJpZ2h0IG5vdywgdXNl
cnMgb2YgcWVtdV9jb19zbGVlcF9uc193YWtlYWJsZSBhcmUgc2ltcGx5IHBhc3NpbmcKYSBwb2lu
dGVyIHRvIFFlbXVDb1NsZWVwU3RhdGUgYnkgcmVmZXJlbmNlIHRvIHRoZSBmdW5jdGlvbi4gIEJ1
dApRZW11Q29TbGVlcFN0YXRlIHJlYWxseSBpcyBqdXN0IGEgQ29yb3V0aW5lKjsgbWFraW5nIHRo
ZQpjb250ZW50IG9mIHRoZSBzdHJ1Y3QgcHVibGljIGlzIGp1c3QgYXMgZWZmaWNpZW50IGFuZCBs
ZXRzIHVzCnNraXAgdGhlIHVzZXJfc3RhdGVfcG9pbnRlciBpbmRpcmVjdGlvbi4KClNpbmNlIHRo
ZSB1c2FnZSBpcyBjaGFuZ2VkLCB0YWtlIHRoZSBvY2Nhc2lvbiB0byByZW5hbWUgdGhlCnN0cnVj
dCB0byBRZW11Q29TbGVlcC4KClJldmlld2VkLWJ5OiBWbGFkaW1pciBTZW1lbnRzb3YtT2dpZXZz
a2l5IDx2c2VtZW50c292QHZpcnR1b3p6by5jb20+ClNpZ25lZC1vZmYtYnk6IFBhb2xvIEJvbnpp
bmkgPHBib256aW5pQHJlZGhhdC5jb20+Ck1lc3NhZ2UtaWQ6IDIwMjEwNTE3MTAwNTQ4LjI4ODA2
LTYtcGJvbnppbmlAcmVkaGF0LmNvbQpTaWduZWQtb2ZmLWJ5OiBTdGVmYW4gSGFqbm9jemkgPHN0
ZWZhbmhhQHJlZGhhdC5jb20+Ci0tLQogaW5jbHVkZS9xZW11L2Nvcm91dGluZS5oICAgIHwgMjMg
KysrKysrKysrKystLS0tLS0tLS0tCiBibG9jay9ibG9jay1jb3B5LmMgICAgICAgICAgfCAgOCAr
KysrLS0tLQogYmxvY2svbmJkLmMgICAgICAgICAgICAgICAgIHwgMTAgKysrKy0tLS0tCiB1dGls
L3FlbXUtY29yb3V0aW5lLXNsZWVwLmMgfCA0MSArKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0t
LS0tLS0tLS0tCiA0IGZpbGVzIGNoYW5nZWQsIDM5IGluc2VydGlvbnMoKyksIDQzIGRlbGV0aW9u
cygtKQoKZGlmZiAtLWdpdCBhL2luY2x1ZGUvcWVtdS9jb3JvdXRpbmUuaCBiL2luY2x1ZGUvcWVt
dS9jb3JvdXRpbmUuaAppbmRleCBjNWQ3NzQyOTg5Li44MmMwNjcxZjgwIDEwMDY0NAotLS0gYS9p
bmNsdWRlL3FlbXUvY29yb3V0aW5lLmgKKysrIGIvaW5jbHVkZS9xZW11L2Nvcm91dGluZS5oCkBA
IC0yOTEsMjEgKzI5MSwyMiBAQCB2b2lkIHFlbXVfY29fcndsb2NrX3dybG9jayhDb1J3bG9jayAq
bG9jayk7CiAgKi8KIHZvaWQgcWVtdV9jb19yd2xvY2tfdW5sb2NrKENvUndsb2NrICpsb2NrKTsK
IAotdHlwZWRlZiBzdHJ1Y3QgUWVtdUNvU2xlZXBTdGF0ZSBRZW11Q29TbGVlcFN0YXRlOwordHlw
ZWRlZiBzdHJ1Y3QgUWVtdUNvU2xlZXAgeworICAgIENvcm91dGluZSAqdG9fd2FrZTsKK30gUWVt
dUNvU2xlZXA7CiAKIC8qKgotICogWWllbGQgdGhlIGNvcm91dGluZSBmb3IgYSBnaXZlbiBkdXJh
dGlvbi4gRHVyaW5nIHRoaXMgeWllbGQsIEBzbGVlcF9zdGF0ZQotICogaXMgc2V0IHRvIGFuIG9w
YXF1ZSBwb2ludGVyLCB3aGljaCBtYXkgYmUgdXNlZCBmb3IKLSAqIHFlbXVfY29fc2xlZXBfd2Fr
ZSgpLiBCZSBjYXJlZnVsLCB0aGUgcG9pbnRlciBpcyBzZXQgYmFjayB0byB6ZXJvIHdoZW4gdGhl
Ci0gKiB0aW1lciBmaXJlcy4gRG9uJ3Qgc2F2ZSB0aGUgb2J0YWluZWQgdmFsdWUgdG8gb3RoZXIg
dmFyaWFibGVzIGFuZCBkb24ndCBjYWxsCi0gKiBxZW11X2NvX3NsZWVwX3dha2UgZnJvbSBhbm90
aGVyIGFpbyBjb250ZXh0LgorICogWWllbGQgdGhlIGNvcm91dGluZSBmb3IgYSBnaXZlbiBkdXJh
dGlvbi4gSW5pdGlhbGl6ZXMgQHcgc28gdGhhdCwKKyAqIGR1cmluZyB0aGlzIHlpZWxkLCBpdCBj
YW4gYmUgcGFzc2VkIHRvIHFlbXVfY29fc2xlZXBfd2FrZSgpIHRvCisgKiB0ZXJtaW5hdGUgdGhl
IHNsZWVwLgogICovCi12b2lkIGNvcm91dGluZV9mbiBxZW11X2NvX3NsZWVwX25zX3dha2VhYmxl
KFFFTVVDbG9ja1R5cGUgdHlwZSwgaW50NjRfdCBucywKLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgUWVtdUNvU2xlZXBTdGF0ZSAqKnNsZWVwX3N0YXRlKTsKK3Zv
aWQgY29yb3V0aW5lX2ZuIHFlbXVfY29fc2xlZXBfbnNfd2FrZWFibGUoUWVtdUNvU2xlZXAgKncs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFFFTVVDbG9ja1R5
cGUgdHlwZSwgaW50NjRfdCBucyk7CisKIHN0YXRpYyBpbmxpbmUgdm9pZCBjb3JvdXRpbmVfZm4g
cWVtdV9jb19zbGVlcF9ucyhRRU1VQ2xvY2tUeXBlIHR5cGUsIGludDY0X3QgbnMpCiB7Ci0gICAg
UWVtdUNvU2xlZXBTdGF0ZSAqdW51c2VkID0gTlVMTDsKLSAgICBxZW11X2NvX3NsZWVwX25zX3dh
a2VhYmxlKHR5cGUsIG5zLCAmdW51c2VkKTsKKyAgICBRZW11Q29TbGVlcCB3ID0geyAwIH07Cisg
ICAgcWVtdV9jb19zbGVlcF9uc193YWtlYWJsZSgmdywgdHlwZSwgbnMpOwogfQogCiAvKioKQEAg
LTMxNCw3ICszMTUsNyBAQCBzdGF0aWMgaW5saW5lIHZvaWQgY29yb3V0aW5lX2ZuIHFlbXVfY29f
c2xlZXBfbnMoUUVNVUNsb2NrVHlwZSB0eXBlLCBpbnQ2NF90IG5zKQogICogcWVtdV9jb19zbGVl
cF9ucygpIGFuZCBzaG91bGQgYmUgY2hlY2tlZCB0byBiZSBub24tTlVMTCBiZWZvcmUgY2FsbGlu
ZwogICogcWVtdV9jb19zbGVlcF93YWtlKCkuCiAgKi8KLXZvaWQgcWVtdV9jb19zbGVlcF93YWtl
KFFlbXVDb1NsZWVwU3RhdGUgKnNsZWVwX3N0YXRlKTsKK3ZvaWQgcWVtdV9jb19zbGVlcF93YWtl
KFFlbXVDb1NsZWVwICp3KTsKIAogLyoqCiAgKiBZaWVsZCB1bnRpbCBhIGZpbGUgZGVzY3JpcHRv
ciBiZWNvbWVzIHJlYWRhYmxlCmRpZmYgLS1naXQgYS9ibG9jay9ibG9jay1jb3B5LmMgYi9ibG9j
ay9ibG9jay1jb3B5LmMKaW5kZXggZjg5NmRjNTZmMi4uYzJlNTA5MDQxMiAxMDA2NDQKLS0tIGEv
YmxvY2svYmxvY2stY29weS5jCisrKyBiL2Jsb2NrL2Jsb2NrLWNvcHkuYwpAQCAtNTAsNyArNTAs
NyBAQCB0eXBlZGVmIHN0cnVjdCBCbG9ja0NvcHlDYWxsU3RhdGUgewogICAgIC8qIFN0YXRlICov
CiAgICAgaW50IHJldDsKICAgICBib29sIGZpbmlzaGVkOwotICAgIFFlbXVDb1NsZWVwU3RhdGUg
KnNsZWVwX3N0YXRlOworICAgIFFlbXVDb1NsZWVwIHNsZWVwOwogICAgIGJvb2wgY2FuY2VsbGVk
OwogCiAgICAgLyogT1VUIHBhcmFtZXRlcnMgKi8KQEAgLTYyNSw4ICs2MjUsOCBAQCBibG9ja19j
b3B5X2RpcnR5X2NsdXN0ZXJzKEJsb2NrQ29weUNhbGxTdGF0ZSAqY2FsbF9zdGF0ZSkKICAgICAg
ICAgICAgICAgICBpZiAobnMgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgIGJsb2NrX2NvcHlf
dGFza19lbmQodGFzaywgLUVBR0FJTik7CiAgICAgICAgICAgICAgICAgICAgIGdfZnJlZSh0YXNr
KTsKLSAgICAgICAgICAgICAgICAgICAgcWVtdV9jb19zbGVlcF9uc193YWtlYWJsZShRRU1VX0NM
T0NLX1JFQUxUSU1FLCBucywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAmY2FsbF9zdGF0ZS0+c2xlZXBfc3RhdGUpOworICAgICAgICAgICAgICAgICAgICBx
ZW11X2NvX3NsZWVwX25zX3dha2VhYmxlKCZjYWxsX3N0YXRlLT5zbGVlcCwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBRRU1VX0NMT0NLX1JFQUxUSU1FLCBu
cyk7CiAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgIH0KICAg
ICAgICAgICAgIH0KQEAgLTY3NCw3ICs2NzQsNyBAQCBvdXQ6CiAKIHZvaWQgYmxvY2tfY29weV9r
aWNrKEJsb2NrQ29weUNhbGxTdGF0ZSAqY2FsbF9zdGF0ZSkKIHsKLSAgICBxZW11X2NvX3NsZWVw
X3dha2UoY2FsbF9zdGF0ZS0+c2xlZXBfc3RhdGUpOworICAgIHFlbXVfY29fc2xlZXBfd2FrZSgm
Y2FsbF9zdGF0ZS0+c2xlZXApOwogfQogCiAvKgpkaWZmIC0tZ2l0IGEvYmxvY2svbmJkLmMgYi9i
bG9jay9uYmQuYwppbmRleCAxYzYzMTViMTY4Li42MTZmOWFlNmM0IDEwMDY0NAotLS0gYS9ibG9j
ay9uYmQuYworKysgYi9ibG9jay9uYmQuYwpAQCAtMTE2LDcgKzExNiw3IEBAIHR5cGVkZWYgc3Ry
dWN0IEJEUlZOQkRTdGF0ZSB7CiAgICAgQ29RdWV1ZSBmcmVlX3NlbWE7CiAgICAgQ29yb3V0aW5l
ICpjb25uZWN0aW9uX2NvOwogICAgIENvcm91dGluZSAqdGVhcmRvd25fY287Ci0gICAgUWVtdUNv
U2xlZXBTdGF0ZSAqY29ubmVjdGlvbl9jb19zbGVlcF9uc19zdGF0ZTsKKyAgICBRZW11Q29TbGVl
cCByZWNvbm5lY3Rfc2xlZXA7CiAgICAgYm9vbCBkcmFpbmVkOwogICAgIGJvb2wgd2FpdF9kcmFp
bmVkX2VuZDsKICAgICBpbnQgaW5fZmxpZ2h0OwpAQCAtMjg5LDcgKzI4OSw3IEBAIHN0YXRpYyB2
b2lkIGNvcm91dGluZV9mbiBuYmRfY2xpZW50X2NvX2RyYWluX2JlZ2luKEJsb2NrRHJpdmVyU3Rh
dGUgKmJzKQogICAgIEJEUlZOQkRTdGF0ZSAqcyA9IChCRFJWTkJEU3RhdGUgKilicy0+b3BhcXVl
OwogCiAgICAgcy0+ZHJhaW5lZCA9IHRydWU7Ci0gICAgcWVtdV9jb19zbGVlcF93YWtlKHMtPmNv
bm5lY3Rpb25fY29fc2xlZXBfbnNfc3RhdGUpOworICAgIHFlbXVfY29fc2xlZXBfd2FrZSgmcy0+
cmVjb25uZWN0X3NsZWVwKTsKIAogICAgIG5iZF9jb19lc3RhYmxpc2hfY29ubmVjdGlvbl9jYW5j
ZWwoYnMsIGZhbHNlKTsKIApAQCAtMzI4LDcgKzMyOCw3IEBAIHN0YXRpYyB2b2lkIG5iZF90ZWFy
ZG93bl9jb25uZWN0aW9uKEJsb2NrRHJpdmVyU3RhdGUgKmJzKQogCiAgICAgcy0+c3RhdGUgPSBO
QkRfQ0xJRU5UX1FVSVQ7CiAgICAgaWYgKHMtPmNvbm5lY3Rpb25fY28pIHsKLSAgICAgICAgcWVt
dV9jb19zbGVlcF93YWtlKHMtPmNvbm5lY3Rpb25fY29fc2xlZXBfbnNfc3RhdGUpOworICAgICAg
ICBxZW11X2NvX3NsZWVwX3dha2UoJnMtPnJlY29ubmVjdF9zbGVlcCk7CiAgICAgICAgIG5iZF9j
b19lc3RhYmxpc2hfY29ubmVjdGlvbl9jYW5jZWwoYnMsIHRydWUpOwogICAgIH0KICAgICBpZiAo
cWVtdV9pbl9jb3JvdXRpbmUoKSkgewpAQCAtNjg1LDggKzY4NSw4IEBAIHN0YXRpYyBjb3JvdXRp
bmVfZm4gdm9pZCBuYmRfY29fcmVjb25uZWN0X2xvb3AoQkRSVk5CRFN0YXRlICpzKQogICAgICAg
ICAgICAgfQogICAgICAgICAgICAgYmRydl9pbmNfaW5fZmxpZ2h0KHMtPmJzKTsKICAgICAgICAg
fSBlbHNlIHsKLSAgICAgICAgICAgIHFlbXVfY29fc2xlZXBfbnNfd2FrZWFibGUoUUVNVV9DTE9D
S19SRUFMVElNRSwgdGltZW91dCwKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgJnMtPmNvbm5lY3Rpb25fY29fc2xlZXBfbnNfc3RhdGUpOworICAgICAgICAgICAgcWVtdV9j
b19zbGVlcF9uc193YWtlYWJsZSgmcy0+cmVjb25uZWN0X3NsZWVwLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBRRU1VX0NMT0NLX1JFQUxUSU1FLCB0aW1lb3V0KTsKICAg
ICAgICAgICAgIGlmIChzLT5kcmFpbmVkKSB7CiAgICAgICAgICAgICAgICAgY29udGludWU7CiAg
ICAgICAgICAgICB9CmRpZmYgLS1naXQgYS91dGlsL3FlbXUtY29yb3V0aW5lLXNsZWVwLmMgYi91
dGlsL3FlbXUtY29yb3V0aW5lLXNsZWVwLmMKaW5kZXggMWQyNTAxOTYyMC4uODljM2I3NThjNSAx
MDA2NDQKLS0tIGEvdXRpbC9xZW11LWNvcm91dGluZS1zbGVlcC5jCisrKyBiL3V0aWwvcWVtdS1j
b3JvdXRpbmUtc2xlZXAuYwpAQCAtMTksNDIgKzE5LDM3IEBACiAKIHN0YXRpYyBjb25zdCBjaGFy
ICpxZW11X2NvX3NsZWVwX25zX19zY2hlZHVsZWQgPSAicWVtdV9jb19zbGVlcF9ucyI7CiAKLXN0
cnVjdCBRZW11Q29TbGVlcFN0YXRlIHsKK3ZvaWQgcWVtdV9jb19zbGVlcF93YWtlKFFlbXVDb1Ns
ZWVwICp3KQorewogICAgIENvcm91dGluZSAqY287Ci0gICAgUWVtdUNvU2xlZXBTdGF0ZSAqKnVz
ZXJfc3RhdGVfcG9pbnRlcjsKLX07CiAKLXZvaWQgcWVtdV9jb19zbGVlcF93YWtlKFFlbXVDb1Ns
ZWVwU3RhdGUgKnNsZWVwX3N0YXRlKQotewotICAgIGlmIChzbGVlcF9zdGF0ZSkgeworICAgIGNv
ID0gdy0+dG9fd2FrZTsKKyAgICB3LT50b193YWtlID0gTlVMTDsKKyAgICBpZiAoY28pIHsKICAg
ICAgICAgLyogV3JpdGUgb2Ygc2NoZWR1bGUgcHJvdGVjdGVkIGJ5IGJhcnJpZXIgd3JpdGUgaW4g
YWlvX2NvX3NjaGVkdWxlICovCi0gICAgICAgIGNvbnN0IGNoYXIgKnNjaGVkdWxlZCA9IHFhdG9t
aWNfY21weGNoZygmc2xlZXBfc3RhdGUtPmNvLT5zY2hlZHVsZWQsCisgICAgICAgIGNvbnN0IGNo
YXIgKnNjaGVkdWxlZCA9IHFhdG9taWNfY21weGNoZygmY28tPnNjaGVkdWxlZCwKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFlbXVfY29fc2xlZXBfbnNf
X3NjaGVkdWxlZCwgTlVMTCk7CiAKICAgICAgICAgYXNzZXJ0KHNjaGVkdWxlZCA9PSBxZW11X2Nv
X3NsZWVwX25zX19zY2hlZHVsZWQpOwotICAgICAgICAqc2xlZXBfc3RhdGUtPnVzZXJfc3RhdGVf
cG9pbnRlciA9IE5VTEw7Ci0gICAgICAgIGFpb19jb193YWtlKHNsZWVwX3N0YXRlLT5jbyk7Cisg
ICAgICAgIGFpb19jb193YWtlKGNvKTsKICAgICB9CiB9CiAKIHN0YXRpYyB2b2lkIGNvX3NsZWVw
X2NiKHZvaWQgKm9wYXF1ZSkKIHsKLSAgICBRZW11Q29TbGVlcFN0YXRlICoqc2xlZXBfc3RhdGUg
PSBvcGFxdWU7Ci0gICAgcWVtdV9jb19zbGVlcF93YWtlKCpzbGVlcF9zdGF0ZSk7CisgICAgUWVt
dUNvU2xlZXAgKncgPSBvcGFxdWU7CisgICAgcWVtdV9jb19zbGVlcF93YWtlKHcpOwogfQogCi12
b2lkIGNvcm91dGluZV9mbiBxZW11X2NvX3NsZWVwX25zX3dha2VhYmxlKFFFTVVDbG9ja1R5cGUg
dHlwZSwgaW50NjRfdCBucywKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgUWVtdUNvU2xlZXBTdGF0ZSAqKnNsZWVwX3N0YXRlKQordm9pZCBjb3JvdXRpbmVfZm4g
cWVtdV9jb19zbGVlcF9uc193YWtlYWJsZShRZW11Q29TbGVlcCAqdywKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUUVNVUNsb2NrVHlwZSB0eXBlLCBpbnQ2NF90
IG5zKQogeworICAgIENvcm91dGluZSAqY28gPSBxZW11X2Nvcm91dGluZV9zZWxmKCk7CiAgICAg
QWlvQ29udGV4dCAqY3R4ID0gcWVtdV9nZXRfY3VycmVudF9haW9fY29udGV4dCgpOwogICAgIFFF
TVVUaW1lciB0czsKLSAgICBRZW11Q29TbGVlcFN0YXRlIHN0YXRlID0gewotICAgICAgICAuY28g
PSBxZW11X2Nvcm91dGluZV9zZWxmKCksCi0gICAgICAgIC51c2VyX3N0YXRlX3BvaW50ZXIgPSBz
bGVlcF9zdGF0ZSwKLSAgICB9OwogCi0gICAgY29uc3QgY2hhciAqc2NoZWR1bGVkID0gcWF0b21p
Y19jbXB4Y2hnKCZzdGF0ZS5jby0+c2NoZWR1bGVkLCBOVUxMLAotICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIHFlbXVfY29fc2xlZXBfbnNfX3NjaGVkdWxlZCk7Cisg
ICAgY29uc3QgY2hhciAqc2NoZWR1bGVkID0gcWF0b21pY19jbXB4Y2hnKCZjby0+c2NoZWR1bGVk
LCBOVUxMLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxZW11
X2NvX3NsZWVwX25zX19zY2hlZHVsZWQpOwogICAgIGlmIChzY2hlZHVsZWQpIHsKICAgICAgICAg
ZnByaW50ZihzdGRlcnIsCiAgICAgICAgICAgICAgICAgIiVzOiBDby1yb3V0aW5lIHdhcyBhbHJl
YWR5IHNjaGVkdWxlZCBpbiAnJXMnXG4iLApAQCAtNjIsMTIgKzU3LDEyIEBAIHZvaWQgY29yb3V0
aW5lX2ZuIHFlbXVfY29fc2xlZXBfbnNfd2FrZWFibGUoUUVNVUNsb2NrVHlwZSB0eXBlLCBpbnQ2
NF90IG5zLAogICAgICAgICBhYm9ydCgpOwogICAgIH0KIAotICAgIGFpb190aW1lcl9pbml0KGN0
eCwgJnRzLCB0eXBlLCBTQ0FMRV9OUywgY29fc2xlZXBfY2IsIHNsZWVwX3N0YXRlKTsKLSAgICAq
c2xlZXBfc3RhdGUgPSAmc3RhdGU7CisgICAgdy0+dG9fd2FrZSA9IGNvOworICAgIGFpb190aW1l
cl9pbml0KGN0eCwgJnRzLCB0eXBlLCBTQ0FMRV9OUywgY29fc2xlZXBfY2IsIHcpLAogICAgIHRp
bWVyX21vZCgmdHMsIHFlbXVfY2xvY2tfZ2V0X25zKHR5cGUpICsgbnMpOwogICAgIHFlbXVfY29y
b3V0aW5lX3lpZWxkKCk7CiAgICAgdGltZXJfZGVsKCZ0cyk7CiAKLSAgICAvKiBxZW11X2NvX3Ns
ZWVwX3dha2UgY2xlYXJzICpzbGVlcF9zdGF0ZSBiZWZvcmUgcmVzdW1pbmcgdGhpcyBjb3JvdXRp
bmUuICAqLwotICAgIGFzc2VydCgqc2xlZXBfc3RhdGUgPT0gTlVMTCk7CisgICAgLyogdy0+dG9f
d2FrZSBpcyBjbGVhcmVkIGJlZm9yZSByZXN1bWluZyB0aGlzIGNvcm91dGluZS4gICovCisgICAg
YXNzZXJ0KHctPnRvX3dha2UgPT0gTlVMTCk7CiB9Ci0tIAoyLjMxLjEKCg==


