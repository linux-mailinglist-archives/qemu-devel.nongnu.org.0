Return-Path: <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>
X-Original-To: lists+qemu-devel@lfdr.de
Delivered-To: lists+qemu-devel@lfdr.de
Received: from lists.gnu.org (lists.gnu.org [209.51.188.17])
	by mail.lfdr.de (Postfix) with ESMTPS id 533FD173E8D
	for <lists+qemu-devel@lfdr.de>; Fri, 28 Feb 2020 18:29:42 +0100 (CET)
Received: from localhost ([::1]:51316 helo=lists1p.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.90_1)
	(envelope-from <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>)
	id 1j7jSH-0007pG-D8
	for lists+qemu-devel@lfdr.de; Fri, 28 Feb 2020 12:29:41 -0500
Received: from eggs.gnu.org ([2001:470:142:3::10]:58618)
 by lists.gnu.org with esmtp (Exim 4.90_1)
 (envelope-from <tsimpson@qualcomm.com>) id 1j7imR-0005rU-PS
 for qemu-devel@nongnu.org; Fri, 28 Feb 2020 11:46:29 -0500
Received: from Debian-exim by eggs.gnu.org with spam-scanned (Exim 4.71)
 (envelope-from <tsimpson@qualcomm.com>) id 1j7imP-0007VI-M6
 for qemu-devel@nongnu.org; Fri, 28 Feb 2020 11:46:27 -0500
Received: from alexa-out-sd-02.qualcomm.com ([199.106.114.39]:27049)
 by eggs.gnu.org with esmtps (TLS1.0:RSA_AES_256_CBC_SHA1:32)
 (Exim 4.71) (envelope-from <tsimpson@qualcomm.com>)
 id 1j7imP-0005V5-8b
 for qemu-devel@nongnu.org; Fri, 28 Feb 2020 11:46:25 -0500
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=quicinc.com; i=@quicinc.com; q=dns/txt; s=qcdkim;
 t=1582908385; x=1614444385;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=zBSsenuL99bAnEL69hm+U2pbTVoWHiQlIwHhAN1ZnmM=;
 b=iPJhG3g7CGIYsXZYk20+TwfClykUZIBmkpTCNNVsyhO5xgi6e6qnj4Uy
 AZu2j6CJNeca6IFVzC1RXl4o2lmn2XcBW3HXrL3ouTa69lg4n5xH74RCy
 cQVo3nCMKvAhS+XTnP7xDLIrfrEh/2xh0JgnQPxSNnr6L4cJa8nzUGFGE Y=;
Received: from unknown (HELO ironmsg-SD-alpha.qualcomm.com) ([10.53.140.30])
 by alexa-out-sd-02.qualcomm.com with ESMTP; 28 Feb 2020 08:44:34 -0800
Received: from vu-tsimpson-aus.qualcomm.com (HELO
 vu-tsimpson1-aus.qualcomm.com) ([10.222.150.1])
 by ironmsg-SD-alpha.qualcomm.com with ESMTP; 28 Feb 2020 08:44:34 -0800
Received: by vu-tsimpson1-aus.qualcomm.com (Postfix, from userid 47164)
 id 2F6AA115A; Fri, 28 Feb 2020 10:44:34 -0600 (CST)
From: Taylor Simpson <tsimpson@quicinc.com>
To: qemu-devel@nongnu.org
Subject: [RFC PATCH v2 66/67] Hexagon HVX translation
Date: Fri, 28 Feb 2020 10:44:02 -0600
Message-Id: <1582908244-304-67-git-send-email-tsimpson@quicinc.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1582908244-304-1-git-send-email-tsimpson@quicinc.com>
References: <1582908244-304-1-git-send-email-tsimpson@quicinc.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
X-detected-operating-system: by eggs.gnu.org: FreeBSD 9.x [fuzzy]
X-Received-From: 199.106.114.39
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <https://lists.nongnu.org/archive/html/qemu-devel>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Cc: riku.voipio@iki.fi, richard.henderson@linaro.org, laurent@vivier.eu,
 Taylor Simpson <tsimpson@quicinc.com>, philmd@redhat.com,
 aleksandar.m.mail@gmail.com
Errors-To: qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org
Sender: "Qemu-devel" <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>

Q2hhbmdlcyB0byBwYWNrZXQgc2VtYW50aWNzIHRvIHN1cHBvcnQgSFZYCgpTaWduZWQtb2ZmLWJ5
OiBUYXlsb3IgU2ltcHNvbiA8dHNpbXBzb25AcXVpY2luYy5jb20+Ci0tLQogdGFyZ2V0L2hleGFn
b24vdHJhbnNsYXRlLmggfCAgMzAgKysrKysrKysKIHRhcmdldC9oZXhhZ29uL3RyYW5zbGF0ZS5j
IHwgMTg4ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKwogMiBm
aWxlcyBjaGFuZ2VkLCAyMTggaW5zZXJ0aW9ucygrKQoKZGlmZiAtLWdpdCBhL3RhcmdldC9oZXhh
Z29uL3RyYW5zbGF0ZS5oIGIvdGFyZ2V0L2hleGFnb24vdHJhbnNsYXRlLmgKaW5kZXggNjViNzIx
ZS4uNDgxZGJiZCAxMDA2NDQKLS0tIGEvdGFyZ2V0L2hleGFnb24vdHJhbnNsYXRlLmgKKysrIGIv
dGFyZ2V0L2hleGFnb24vdHJhbnNsYXRlLmgKQEAgLTMyLDYgKzMyLDE0IEBAIHR5cGVkZWYgc3Ry
dWN0IERpc2FzQ29udGV4dCB7CiAgICAgaW50IGN0eF9wcmVnX2xvZ1tQUkVEX1dSSVRFU19NQVhd
OwogICAgIGludCBjdHhfcHJlZ19sb2dfaWR4OwogICAgIHVpbnQ4X3QgY3R4X3N0b3JlX3dpZHRo
W1NUT1JFU19NQVhdOworICAgIGludCBjdHhfdGVtcF92cmVnc19pZHg7CisgICAgaW50IGN0eF90
ZW1wX3FyZWdzX2lkeDsKKyAgICBpbnQgY3R4X3ZyZWdfbG9nW05VTV9WUkVHU107CisgICAgaW50
IGN0eF92cmVnX2lzX3ByZWRpY2F0ZWRbTlVNX1ZSRUdTXTsKKyAgICBpbnQgY3R4X3ZyZWdfbG9n
X2lkeDsKKyAgICBpbnQgY3R4X3FyZWdfbG9nW05VTV9RUkVHU107CisgICAgaW50IGN0eF9xcmVn
X2lzX3ByZWRpY2F0ZWRbTlVNX1FSRUdTXTsKKyAgICBpbnQgY3R4X3FyZWdfbG9nX2lkeDsKIH0g
RGlzYXNDb250ZXh0OwogCiBzdGF0aWMgaW5saW5lIHZvaWQgY3R4X2xvZ19yZWdfd3JpdGUoRGlz
YXNDb250ZXh0ICpjdHgsIGludCBybnVtKQpAQCAtNTQsNiArNjIsMjIgQEAgc3RhdGljIGlubGlu
ZSB2b2lkIGN0eF9sb2dfcHJlZF93cml0ZShEaXNhc0NvbnRleHQgKmN0eCwgaW50IHBudW0pCiAg
ICAgY3R4LT5jdHhfcHJlZ19sb2dfaWR4Kys7CiB9CiAKK3N0YXRpYyBpbmxpbmUgdm9pZCBjdHhf
bG9nX3ZyZWdfd3JpdGUoRGlzYXNDb250ZXh0ICpjdHgsCisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGludCBybnVtLCBpbnQgaXNfcHJlZGljYXRlZCkKK3sKKyAgICBjdHgt
PmN0eF92cmVnX2xvZ1tjdHgtPmN0eF92cmVnX2xvZ19pZHhdID0gcm51bTsKKyAgICBjdHgtPmN0
eF92cmVnX2lzX3ByZWRpY2F0ZWRbY3R4LT5jdHhfdnJlZ19sb2dfaWR4XSA9IGlzX3ByZWRpY2F0
ZWQ7CisgICAgY3R4LT5jdHhfdnJlZ19sb2dfaWR4Kys7Cit9CisKK3N0YXRpYyBpbmxpbmUgdm9p
ZCBjdHhfbG9nX3FyZWdfd3JpdGUoRGlzYXNDb250ZXh0ICpjdHgsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGludCBybnVtLCBpbnQgaXNfcHJlZGljYXRlZCkKK3sKKyAg
ICBjdHgtPmN0eF9xcmVnX2xvZ1tjdHgtPmN0eF9xcmVnX2xvZ19pZHhdID0gcm51bTsKKyAgICBj
dHgtPmN0eF9xcmVnX2lzX3ByZWRpY2F0ZWRbY3R4LT5jdHhfcXJlZ19sb2dfaWR4XSA9IGlzX3By
ZWRpY2F0ZWQ7CisgICAgY3R4LT5jdHhfcXJlZ19sb2dfaWR4Kys7Cit9CisKIGV4dGVybiBUQ0d2
IGhleF9ncHJbVE9UQUxfUEVSX1RIUkVBRF9SRUdTXTsKIGV4dGVybiBUQ0d2IGhleF9wcmVkW05V
TV9QUkVHU107CiBleHRlcm4gVENHdiBoZXhfbmV4dF9QQzsKQEAgLTc0LDkgKzk4LDE1IEBAIGV4
dGVybiBUQ0d2IGxsc2NfdmFsOwogZXh0ZXJuIFRDR3ZfaTY0IGxsc2NfdmFsX2k2NDsKIGV4dGVy
biBUQ0d2IGhleF9pc19nYXRoZXJfc3RvcmVfaW5zbjsKIGV4dGVybiBUQ0d2IGhleF9nYXRoZXJf
aXNzdWVkOworZXh0ZXJuIFRDR3YgaGV4X1ZSZWdzX3VwZGF0ZWRfdG1wOworZXh0ZXJuIFRDR3Yg
aGV4X1ZSZWdzX3VwZGF0ZWQ7CitleHRlcm4gVENHdiBoZXhfVlJlZ3Nfc2VsZWN0OworZXh0ZXJu
IFRDR3YgaGV4X1FSZWdzX3VwZGF0ZWQ7CiAKIHZvaWQgaGV4YWdvbl90cmFuc2xhdGVfaW5pdCh2
b2lkKTsKIGV4dGVybiB2b2lkIGdlbl9leGNlcHRpb24oaW50IGV4Y3ApOwogZXh0ZXJuIHZvaWQg
Z2VuX2V4Y2VwdGlvbl9kZWJ1Zyh2b2lkKTsKIAorZXh0ZXJuIHZvaWQgZ2VuX21lbWNweShUQ0d2
X3B0ciBkZXN0LCBUQ0d2X3B0ciBzcmMsIHNpemVfdCBuKTsKKwogI2VuZGlmCmRpZmYgLS1naXQg
YS90YXJnZXQvaGV4YWdvbi90cmFuc2xhdGUuYyBiL3RhcmdldC9oZXhhZ29uL3RyYW5zbGF0ZS5j
CmluZGV4IDU3YWIyOTQuLmY1YzEzNWIgMTAwNjQ0Ci0tLSBhL3RhcmdldC9oZXhhZ29uL3RyYW5z
bGF0ZS5jCisrKyBiL3RhcmdldC9oZXhhZ29uL3RyYW5zbGF0ZS5jCkBAIC01MSw2ICs1MSwxMCBA
QCBUQ0d2IGxsc2NfdmFsOwogVENHdl9pNjQgbGxzY192YWxfaTY0OwogVENHdiBoZXhfaXNfZ2F0
aGVyX3N0b3JlX2luc247CiBUQ0d2IGhleF9nYXRoZXJfaXNzdWVkOworVENHdiBoZXhfVlJlZ3Nf
dXBkYXRlZF90bXA7CitUQ0d2IGhleF9WUmVnc191cGRhdGVkOworVENHdiBoZXhfVlJlZ3Nfc2Vs
ZWN0OworVENHdiBoZXhfUVJlZ3NfdXBkYXRlZDsKIAogc3RhdGljIGNvbnN0IGNoYXIgKiBjb25z
dCBoZXhhZ29uX3ByZWRuYW1lc1tdID0gewogICAicDAiLCAicDEiLCAicDIiLCAicDMiCkBAIC0x
MzcsNiArMTQxLDEwIEBAIHN0YXRpYyB2b2lkIGdlbl9zdGFydF9wYWNrZXQoRGlzYXNDb250ZXh0
ICpjdHgsIHBhY2tldF90ICpwa3QpCiAgICAgLyogQ2xlYXIgb3V0IHRoZSBkaXNhc3NlbWJseSBj
b250ZXh0ICovCiAgICAgY3R4LT5jdHhfcmVnX2xvZ19pZHggPSAwOwogICAgIGN0eC0+Y3R4X3By
ZWdfbG9nX2lkeCA9IDA7CisgICAgY3R4LT5jdHhfdGVtcF92cmVnc19pZHggPSAwOworICAgIGN0
eC0+Y3R4X3RlbXBfcXJlZ3NfaWR4ID0gMDsKKyAgICBjdHgtPmN0eF92cmVnX2xvZ19pZHggPSAw
OworICAgIGN0eC0+Y3R4X3FyZWdfbG9nX2lkeCA9IDA7CiAgICAgZm9yIChpID0gMDsgaSA8IFNU
T1JFU19NQVg7IGkrKykgewogICAgICAgICBjdHgtPmN0eF9zdG9yZV93aWR0aFtpXSA9IDA7CiAg
ICAgfQpAQCAtMTU1LDYgKzE2MywxNSBAQCBzdGF0aWMgdm9pZCBnZW5fc3RhcnRfcGFja2V0KERp
c2FzQ29udGV4dCAqY3R4LCBwYWNrZXRfdCAqcGt0KQogICAgICAgICB0Y2dfZ2VuX21vdmlfdGwo
aGV4X25leHRfUEMsIG5leHRfUEMpOwogICAgIH0KICAgICB0Y2dfZ2VuX21vdmlfdGwoaGV4X3By
ZWRfd3JpdHRlbiwgMCk7CisKKyAgICBpZiAocGt0LT5wa3RfaGFzX2h2eCkgeworICAgICAgICB0
Y2dfZ2VuX21vdmlfdGwoaGV4X1ZSZWdzX3VwZGF0ZWRfdG1wLCAwKTsKKyAgICAgICAgdGNnX2dl
bl9tb3ZpX3RsKGhleF9WUmVnc191cGRhdGVkLCAwKTsKKyAgICAgICAgdGNnX2dlbl9tb3ZpX3Rs
KGhleF9WUmVnc19zZWxlY3QsIDApOworICAgICAgICB0Y2dfZ2VuX21vdmlfdGwoaGV4X1FSZWdz
X3VwZGF0ZWQsIDApOworICAgICAgICB0Y2dfZ2VuX21vdmlfdGwoaGV4X2lzX2dhdGhlcl9zdG9y
ZV9pbnNuLCAwKTsKKyAgICAgICAgdGNnX2dlbl9tb3ZpX3RsKGhleF9nYXRoZXJfaXNzdWVkLCAw
KTsKKyAgICB9CiB9CiAKIHN0YXRpYyBpbnQgaXNfZ2F0aGVyX3N0b3JlX2luc24oaW5zbl90ICpp
bnNuKQpAQCAtNDQ1LDEwICs0NjIsMTYzIEBAIHN0YXRpYyBib29sIHByb2Nlc3NfY2hhbmdlX29m
X2Zsb3coRGlzYXNDb250ZXh0ICpjdHgsIHBhY2tldF90ICpwa3QpCiAgICAgcmV0dXJuIGZhbHNl
OwogfQogCit2b2lkIGdlbl9tZW1jcHkoVENHdl9wdHIgZGVzdCwgVENHdl9wdHIgc3JjLCBzaXpl
X3QgbikKK3sKKyAgICBUQ0d2X3B0ciBkID0gdGNnX3RlbXBfbmV3X3B0cigpOworICAgIFRDR3Zf
cHRyIHMgPSB0Y2dfdGVtcF9uZXdfcHRyKCk7CisgICAgaW50IGk7CisKKyAgICB0Y2dfZ2VuX2Fk
ZGlfcHRyKGQsIGRlc3QsIDApOworICAgIHRjZ19nZW5fYWRkaV9wdHIocywgc3JjLCAwKTsKKyAg
ICBpZiAobiAlIDggPT0gMCkgeworICAgICAgICBUQ0d2X2k2NCB0ZW1wID0gdGNnX3RlbXBfbmV3
X2k2NCgpOworICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbiAvIDg7IGkrKykgeworICAgICAgICAg
ICAgdGNnX2dlbl9sZF9pNjQodGVtcCwgcywgMCk7CisgICAgICAgICAgICB0Y2dfZ2VuX3N0X2k2
NCh0ZW1wLCBkLCAwKTsKKyAgICAgICAgICAgIHRjZ19nZW5fYWRkaV9wdHIocywgcywgOCk7Cisg
ICAgICAgICAgICB0Y2dfZ2VuX2FkZGlfcHRyKGQsIGQsIDgpOworICAgICAgICB9CisgICAgICAg
IHRjZ190ZW1wX2ZyZWVfaTY0KHRlbXApOworICAgIH0gZWxzZSBpZiAobiAlIDQgPT0gMCkgewor
ICAgICAgICBUQ0d2IHRlbXAgPSB0Y2dfdGVtcF9uZXcoKTsKKyAgICAgICAgZm9yIChpID0gMDsg
aSA8IG4gLyA0OyBpKyspIHsKKyAgICAgICAgICAgIHRjZ19nZW5fbGQzMnVfdGwodGVtcCwgcywg
MCk7CisgICAgICAgICAgICB0Y2dfZ2VuX3N0MzJfdGwodGVtcCwgZCwgMCk7CisgICAgICAgICAg
ICB0Y2dfZ2VuX2FkZGlfcHRyKHMsIHMsIDQpOworICAgICAgICAgICAgdGNnX2dlbl9hZGRpX3B0
cihkLCBkLCA0KTsKKyAgICAgICAgfQorICAgICAgICB0Y2dfdGVtcF9mcmVlKHRlbXApOworICAg
IH0gZWxzZSBpZiAobiAlIDIgPT0gMCkgeworICAgICAgICBUQ0d2IHRlbXAgPSB0Y2dfdGVtcF9u
ZXcoKTsKKyAgICAgICAgZm9yIChpID0gMDsgaSA8IG4gLyAyOyBpKyspIHsKKyAgICAgICAgICAg
IHRjZ19nZW5fbGQxNnVfdGwodGVtcCwgcywgMCk7CisgICAgICAgICAgICB0Y2dfZ2VuX3N0MTZf
dGwodGVtcCwgZCwgMCk7CisgICAgICAgICAgICB0Y2dfZ2VuX2FkZGlfcHRyKHMsIHMsIDIpOwor
ICAgICAgICAgICAgdGNnX2dlbl9hZGRpX3B0cihkLCBkLCAyKTsKKyAgICAgICAgfQorICAgICAg
ICB0Y2dfdGVtcF9mcmVlKHRlbXApOworICAgIH0gZWxzZSB7CisgICAgICAgIFRDR3YgdGVtcCA9
IHRjZ190ZW1wX25ldygpOworICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbjsgaSsrKSB7CisgICAg
ICAgICAgICB0Y2dfZ2VuX2xkOHVfdGwodGVtcCwgcywgMCk7CisgICAgICAgICAgICB0Y2dfZ2Vu
X3N0OF90bCh0ZW1wLCBkLCAwKTsKKyAgICAgICAgICAgIHRjZ19nZW5fYWRkaV9wdHIocywgcywg
MSk7CisgICAgICAgICAgICB0Y2dfZ2VuX2FkZGlfcHRyKGQsIGQsIDEpOworICAgICAgICB9Cisg
ICAgICAgIHRjZ190ZW1wX2ZyZWUodGVtcCk7CisgICAgfQorCisgICAgdGNnX3RlbXBfZnJlZV9w
dHIoZCk7CisgICAgdGNnX3RlbXBfZnJlZV9wdHIocyk7Cit9CisKK3N0YXRpYyBpbmxpbmUgdm9p
ZCBnZW5fdmVjX2NvcHkoaW50cHRyX3QgZHN0b2ZmLCBpbnRwdHJfdCBzcmNvZmYsIHNpemVfdCBz
aXplKQoreworICAgIFRDR3ZfcHRyIHNyYyA9IHRjZ190ZW1wX25ld19wdHIoKTsKKyAgICBUQ0d2
X3B0ciBkc3QgPSB0Y2dfdGVtcF9uZXdfcHRyKCk7CisgICAgdGNnX2dlbl9hZGRpX3B0cihzcmMs
IGNwdV9lbnYsIHNyY29mZik7CisgICAgdGNnX2dlbl9hZGRpX3B0cihkc3QsIGNwdV9lbnYsIGRz
dG9mZik7CisgICAgZ2VuX21lbWNweShkc3QsIHNyYywgc2l6ZSk7CisgICAgdGNnX3RlbXBfZnJl
ZV9wdHIoc3JjKTsKKyAgICB0Y2dfdGVtcF9mcmVlX3B0cihkc3QpOworfQorCitzdGF0aWMgaW5s
aW5lIGJvb2wgcGt0X2hhc19odnhfc3RvcmUocGFja2V0X3QgKnBrdCkKK3sKKyAgICBpbnQgaTsK
KyAgICBmb3IgKGkgPSAwOyBpIDwgcGt0LT5udW1faW5zbnM7IGkrKykgeworICAgICAgICBpbnQg
b3Bjb2RlID0gcGt0LT5pbnNuW2ldLm9wY29kZTsKKyAgICAgICAgaWYgKEdFVF9BVFRSSUIob3Bj
b2RlLCBBX0NWSSkgJiYgR0VUX0FUVFJJQihvcGNvZGUsIEFfU1RPUkUpKSB7CisgICAgICAgICAg
ICByZXR1cm4gdHJ1ZTsKKyAgICAgICAgfQorICAgIH0KKyAgICByZXR1cm4gZmFsc2U7Cit9CisK
K3N0YXRpYyB2b2lkIGdlbl9jb21taXRfaHZ4KERpc2FzQ29udGV4dCAqY3R4LCBwYWNrZXRfdCAq
cGt0KQoreworICAgIGludCBpOworCisgICAgLyoKKyAgICAgKiAgICBmb3IgKGkgPSAwOyBpIDwg
Y3R4LT5jdHhfdnJlZ19sb2dfaWR4OyBpKyspIHsKKyAgICAgKiAgICAgICAgaW50IHJudW0gPSBj
dHgtPmN0eF92cmVnX2xvZ1tpXTsKKyAgICAgKiAgICAgICAgaWYgKGN0eC0+Y3R4X3ZyZWdfaXNf
cHJlZGljYXRlZFtpXSkgeworICAgICAqICAgICAgICAgICAgaWYgKGVudi0+VlJlZ3NfdXBkYXRl
ZCAmICgxIDw8IHJudW0pKSB7CisgICAgICogICAgICAgICAgICAgICAgZW52LT5WUmVnc1tybnVt
XSA9IGVudi0+ZnV0dXJlX1ZSZWdzW3JudW1dOworICAgICAqICAgICAgICAgICAgfQorICAgICAq
ICAgICAgICB9IGVsc2UgeworICAgICAqICAgICAgICAgICAgZW52LT5WUmVnc1tybnVtXSA9IGVu
di0+ZnV0dXJlX1ZSZWdzW3JudW1dOworICAgICAqICAgICAgICB9CisgICAgICogICAgfQorICAg
ICAqLworICAgIGZvciAoaSA9IDA7IGkgPCBjdHgtPmN0eF92cmVnX2xvZ19pZHg7IGkrKykgewor
ICAgICAgICBpbnQgcm51bSA9IGN0eC0+Y3R4X3ZyZWdfbG9nW2ldOworICAgICAgICBpbnQgaXNf
cHJlZGljYXRlZCA9IGN0eC0+Y3R4X3ZyZWdfaXNfcHJlZGljYXRlZFtpXTsKKyAgICAgICAgaW50
cHRyX3QgZHN0b2ZmID0gb2Zmc2V0b2YoQ1BVSGV4YWdvblN0YXRlLCBWUmVnc1tybnVtXSk7Cisg
ICAgICAgIGludHB0cl90IHNyY29mZiA9IG9mZnNldG9mKENQVUhleGFnb25TdGF0ZSwgZnV0dXJl
X1ZSZWdzW3JudW1dKTsKKyAgICAgICAgc2l6ZV90IHNpemUgPSBzaXplb2YobW12ZWN0b3JfdCk7
CisKKyAgICAgICAgaWYgKGlzX3ByZWRpY2F0ZWQpIHsKKyAgICAgICAgICAgIFRDR3YgY21wID0g
dGNnX3RlbXBfbG9jYWxfbmV3KCk7CisgICAgICAgICAgICBUQ0dMYWJlbCAqbGFiZWxfc2tpcCA9
IGdlbl9uZXdfbGFiZWwoKTsKKworICAgICAgICAgICAgdGNnX2dlbl9hbmRpX3RsKGNtcCwgaGV4
X1ZSZWdzX3VwZGF0ZWQsIDEgPDwgcm51bSk7CisgICAgICAgICAgICB0Y2dfZ2VuX2JyY29uZGlf
dGwoVENHX0NPTkRfRVEsIGNtcCwgMCwgbGFiZWxfc2tpcCk7CisgICAgICAgICAgICB7CisgICAg
ICAgICAgICAgICAgZ2VuX3ZlY19jb3B5KGRzdG9mZiwgc3Jjb2ZmLCBzaXplKTsKKyAgICAgICAg
ICAgIH0KKyAgICAgICAgICAgIGdlbl9zZXRfbGFiZWwobGFiZWxfc2tpcCk7CisgICAgICAgICAg
ICB0Y2dfdGVtcF9mcmVlKGNtcCk7CisgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAgICBnZW5f
dmVjX2NvcHkoZHN0b2ZmLCBzcmNvZmYsIHNpemUpOworICAgICAgICB9CisgICAgfQorCisgICAg
LyoKKyAgICAgKiAgICBmb3IgKGkgPSAwOyBpIDwgY3R4LV9jdHhfcXJlZ19sb2dfaWR4OyBpKysp
IHsKKyAgICAgKiAgICAgICAgaW50IHJudW0gPSBjdHgtPmN0eF9xcmVnX2xvZ1tpXTsKKyAgICAg
KiAgICAgICAgaWYgKGN0eC0+Y3R4X3FyZWdfaXNfcHJlZGljYXRlZFtpXSkgeworICAgICAqICAg
ICAgICAgICAgaWYgKGVudi0+UVJlZ3NfdXBkYXRlZCkgJiAoMSA8PCBybnVtKSkgeworICAgICAq
ICAgICAgICAgICAgICAgIGVudi0+UVJlZ3Nbcm51bV0gPSBlbnYtPmZ1dHVyZV9RUmVnc1tybnVt
XTsKKyAgICAgKiAgICAgICAgICAgIH0KKyAgICAgKiAgICAgICAgfSBlbHNlIHsKKyAgICAgKiAg
ICAgICAgICAgIGVudi0+UVJlZ3Nbcm51bV0gPSBlbnYtPmZ1dHVyZV9RUmVnc1tybnVtXTsKKyAg
ICAgKiAgICAgICAgfQorICAgICAqICAgIH0KKyAgICAgKi8KKyAgICBmb3IgKGkgPSAwOyBpIDwg
Y3R4LT5jdHhfcXJlZ19sb2dfaWR4OyBpKyspIHsKKyAgICAgICAgaW50IHJudW0gPSBjdHgtPmN0
eF9xcmVnX2xvZ1tpXTsKKyAgICAgICAgaW50IGlzX3ByZWRpY2F0ZWQgPSBjdHgtPmN0eF9xcmVn
X2lzX3ByZWRpY2F0ZWRbaV07CisgICAgICAgIGludHB0cl90IGRzdG9mZiA9IG9mZnNldG9mKENQ
VUhleGFnb25TdGF0ZSwgUVJlZ3Nbcm51bV0pOworICAgICAgICBpbnRwdHJfdCBzcmNvZmYgPSBv
ZmZzZXRvZihDUFVIZXhhZ29uU3RhdGUsIGZ1dHVyZV9RUmVnc1tybnVtXSk7CisgICAgICAgIHNp
emVfdCBzaXplID0gc2l6ZW9mKG1tcXJlZ190KTsKKworICAgICAgICBpZiAoaXNfcHJlZGljYXRl
ZCkgeworICAgICAgICAgICAgVENHdiBjbXAgPSB0Y2dfdGVtcF9sb2NhbF9uZXcoKTsKKyAgICAg
ICAgICAgIFRDR0xhYmVsICpsYWJlbF9za2lwID0gZ2VuX25ld19sYWJlbCgpOworCisgICAgICAg
ICAgICB0Y2dfZ2VuX2FuZGlfdGwoY21wLCBoZXhfUVJlZ3NfdXBkYXRlZCwgMSA8PCBybnVtKTsK
KyAgICAgICAgICAgIHRjZ19nZW5fYnJjb25kaV90bChUQ0dfQ09ORF9FUSwgY21wLCAwLCBsYWJl
bF9za2lwKTsKKyAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAgICBnZW5fdmVjX2NvcHkoZHN0
b2ZmLCBzcmNvZmYsIHNpemUpOworICAgICAgICAgICAgfQorICAgICAgICAgICAgZ2VuX3NldF9s
YWJlbChsYWJlbF9za2lwKTsKKyAgICAgICAgICAgIHRjZ190ZW1wX2ZyZWUoY21wKTsKKyAgICAg
ICAgfSBlbHNlIHsKKyAgICAgICAgICAgIGdlbl92ZWNfY29weShkc3RvZmYsIHNyY29mZiwgc2l6
ZSk7CisgICAgICAgIH0KKyAgICB9CisKKyAgICBpZiAocGt0X2hhc19odnhfc3RvcmUocGt0KSkg
eworICAgICAgICBnZW5faGVscGVyX2NvbW1pdF9odnhfc3RvcmVzKGNwdV9lbnYpOworICAgIH0K
K30KKwogc3RhdGljIHZvaWQgZ2VuX2V4ZWNfY291bnRlcnMocGFja2V0X3QgKnBrdCkKIHsKICAg
ICBpbnQgbnVtX2luc25zID0gcGt0LT5udW1faW5zbnM7CiAgICAgaW50IG51bV9yZWFsX2luc25z
ID0gMDsKKyAgICBpbnQgbnVtX2h2eF9pbnNucyA9IDA7CiAgICAgaW50IGk7CiAKICAgICBmb3Ig
KGkgPSAwOyBpIDwgbnVtX2luc25zOyBpKyspIHsKQEAgLTQ1Nyw2ICs2MjcsOSBAQCBzdGF0aWMg
dm9pZCBnZW5fZXhlY19jb3VudGVycyhwYWNrZXRfdCAqcGt0KQogICAgICAgICAgICAgIUdFVF9B
VFRSSUIocGt0LT5pbnNuW2ldLm9wY29kZSwgQV9JVF9OT1ApKSB7CiAgICAgICAgICAgICBudW1f
cmVhbF9pbnNucysrOwogICAgICAgICB9CisgICAgICAgIGlmIChwa3QtPmluc25baV0uaHZ4X3Jl
c291cmNlKSB7CisgICAgICAgICAgICBudW1faHZ4X2luc25zKys7CisgICAgICAgIH0KICAgICB9
CiAKICAgICB0Y2dfZ2VuX2FkZGlfdGwoaGV4X2dwcltIRVhfUkVHX1FFTVVfUEtUX0NOVF0sCkBA
IC00NjUsNiArNjM4LDEwIEBAIHN0YXRpYyB2b2lkIGdlbl9leGVjX2NvdW50ZXJzKHBhY2tldF90
ICpwa3QpCiAgICAgICAgIHRjZ19nZW5fYWRkaV90bChoZXhfZ3ByW0hFWF9SRUdfUUVNVV9JTlNO
X0NOVF0sCiAgICAgICAgICAgICAgICAgICAgICAgICBoZXhfZ3ByW0hFWF9SRUdfUUVNVV9JTlNO
X0NOVF0sIG51bV9yZWFsX2luc25zKTsKICAgICB9CisgICAgaWYgKG51bV9odnhfaW5zbnMpIHsK
KyAgICAgICAgdGNnX2dlbl9hZGRpX3RsKGhleF9ncHJbSEVYX1JFR19RRU1VX0hWWF9DTlRdLAor
ICAgICAgICAgICAgICAgICAgICAgICAgaGV4X2dwcltIRVhfUkVHX1FFTVVfSFZYX0NOVF0sIG51
bV9odnhfaW5zbnMpOworICAgIH0KIH0KIAogc3RhdGljIHZvaWQgZ2VuX2NvbW1pdF9wYWNrZXQo
RGlzYXNDb250ZXh0ICpjdHgsIHBhY2tldF90ICpwa3QpCkBAIC00NzYsNiArNjUzLDkgQEAgc3Rh
dGljIHZvaWQgZ2VuX2NvbW1pdF9wYWNrZXQoRGlzYXNDb250ZXh0ICpjdHgsIHBhY2tldF90ICpw
a3QpCiAgICAgcHJvY2Vzc19zdG9yZV9sb2coY3R4LCBwa3QpOwogICAgIHByb2Nlc3NfZGN6ZXJv
YShjdHgsIHBrdCk7CiAgICAgZW5kX3RiIHw9IHByb2Nlc3NfY2hhbmdlX29mX2Zsb3coY3R4LCBw
a3QpOworICAgIGlmIChwa3QtPnBrdF9oYXNfaHZ4KSB7CisgICAgICAgIGdlbl9jb21taXRfaHZ4
KGN0eCwgcGt0KTsKKyAgICB9CiAgICAgZ2VuX2V4ZWNfY291bnRlcnMocGt0KTsKICNpZiBIRVhf
REVCVUcKICAgICB7CkBAIC03MDIsNiArODgyLDE0IEBAIHZvaWQgaGV4YWdvbl90cmFuc2xhdGVf
aW5pdCh2b2lkKQogICAgICAgICAiaXNfZ2F0aGVyX3N0b3JlX2luc24iKTsKICAgICBoZXhfZ2F0
aGVyX2lzc3VlZCA9IHRjZ19nbG9iYWxfbWVtX25ldyhjcHVfZW52LAogICAgICAgICBvZmZzZXRv
ZihDUFVIZXhhZ29uU3RhdGUsIGdhdGhlcl9pc3N1ZWQpLCAiZ2F0aGVyX2lzc3VlZCIpOworICAg
IGhleF9WUmVnc191cGRhdGVkX3RtcCA9IHRjZ19nbG9iYWxfbWVtX25ldyhjcHVfZW52LAorICAg
ICAgICBvZmZzZXRvZihDUFVIZXhhZ29uU3RhdGUsIFZSZWdzX3VwZGF0ZWRfdG1wKSwgIlZSZWdz
X3VwZGF0ZWRfdG1wIik7CisgICAgaGV4X1ZSZWdzX3VwZGF0ZWQgPSB0Y2dfZ2xvYmFsX21lbV9u
ZXcoY3B1X2VudiwKKyAgICAgICAgb2Zmc2V0b2YoQ1BVSGV4YWdvblN0YXRlLCBWUmVnc191cGRh
dGVkKSwgIlZSZWdzX3VwZGF0ZWQiKTsKKyAgICBoZXhfVlJlZ3Nfc2VsZWN0ID0gdGNnX2dsb2Jh
bF9tZW1fbmV3KGNwdV9lbnYsCisgICAgICAgIG9mZnNldG9mKENQVUhleGFnb25TdGF0ZSwgVlJl
Z3Nfc2VsZWN0KSwgIlZSZWdzX3NlbGVjdCIpOworICAgIGhleF9RUmVnc191cGRhdGVkID0gdGNn
X2dsb2JhbF9tZW1fbmV3KGNwdV9lbnYsCisgICAgICAgIG9mZnNldG9mKENQVUhleGFnb25TdGF0
ZSwgUVJlZ3NfdXBkYXRlZCksICJRUmVnc191cGRhdGVkIik7CiAgICAgZm9yIChpID0gMDsgaSA8
IFNUT1JFU19NQVg7IGkrKykgewogICAgICAgICBzcHJpbnRmKHN0b3JlX2FkZHJfbmFtZXNbaV0s
ICJzdG9yZV9hZGRyXyVkIiwgaSk7CiAgICAgICAgIGhleF9zdG9yZV9hZGRyW2ldID0gdGNnX2ds
b2JhbF9tZW1fbmV3KGNwdV9lbnYsCi0tIAoyLjcuNAoK

