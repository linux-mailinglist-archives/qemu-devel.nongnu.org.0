Return-Path: <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>
X-Original-To: lists+qemu-devel@lfdr.de
Delivered-To: lists+qemu-devel@lfdr.de
Received: from lists.gnu.org (lists.gnu.org [209.51.188.17])
	by mail.lfdr.de (Postfix) with ESMTPS id 08F002D17A8
	for <lists+qemu-devel@lfdr.de>; Mon,  7 Dec 2020 18:38:04 +0100 (CET)
Received: from localhost ([::1]:49514 helo=lists1p.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.90_1)
	(envelope-from <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>)
	id 1kmKSZ-0001cn-2v
	for lists+qemu-devel@lfdr.de; Mon, 07 Dec 2020 12:38:03 -0500
Received: from eggs.gnu.org ([2001:470:142:3::10]:46862)
 by lists.gnu.org with esmtps (TLS1.2:ECDHE_RSA_AES_256_GCM_SHA384:256)
 (Exim 4.90_1) (envelope-from <stefanha@redhat.com>)
 id 1kmKGO-00018e-3A
 for qemu-devel@nongnu.org; Mon, 07 Dec 2020 12:25:28 -0500
Received: from us-smtp-delivery-124.mimecast.com ([63.128.21.124]:39694)
 by eggs.gnu.org with esmtps (TLS1.2:ECDHE_RSA_AES_256_CBC_SHA1:256)
 (Exim 4.90_1) (envelope-from <stefanha@redhat.com>)
 id 1kmKGG-0006zp-9R
 for qemu-devel@nongnu.org; Mon, 07 Dec 2020 12:25:27 -0500
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1607361918;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=+FQrRHS7kBHT8XDx7nfWamKdj5it2JlGbo0CRE1h0bY=;
 b=PC1wSRpTH+TsE4RkhVw9ZOqRwiV/c0gK35XlEslwtD7jJnrlICcvlk0VbWkNcLeKwZsAb6
 i3fbagn32LmPkRASXcuviEyJIC3/UE0GYPCcPBVOgRhcY+SUKJnZgzdzen103wep/KZWsr
 dyMgYqMeK0E5aaoqETOHwzC3ZGKodlE=
Received: from mimecast-mx01.redhat.com (mimecast-mx01.redhat.com
 [209.132.183.4]) (Using TLS) by relay.mimecast.com with ESMTP id
 us-mta-216--Uil90M6NvyTs1nafBJk8Q-1; Mon, 07 Dec 2020 12:25:12 -0500
X-MC-Unique: -Uil90M6NvyTs1nafBJk8Q-1
Received: from smtp.corp.redhat.com (int-mx03.intmail.prod.int.phx2.redhat.com
 [10.5.11.13])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mimecast-mx01.redhat.com (Postfix) with ESMTPS id 36DC51842140;
 Mon,  7 Dec 2020 17:25:11 +0000 (UTC)
Received: from localhost (ovpn-114-128.ams2.redhat.com [10.36.114.128])
 by smtp.corp.redhat.com (Postfix) with ESMTP id 7583C6B8DC;
 Mon,  7 Dec 2020 17:25:10 +0000 (UTC)
From: Stefan Hajnoczi <stefanha@redhat.com>
To: qemu-devel@nongnu.org
Subject: [PATCH v2 05/12] test: new qTest case to test the
 vhost-user-blk-server
Date: Mon,  7 Dec 2020 17:20:23 +0000
Message-Id: <20201207172030.251905-6-stefanha@redhat.com>
In-Reply-To: <20201207172030.251905-1-stefanha@redhat.com>
References: <20201207172030.251905-1-stefanha@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.79 on 10.5.11.13
Authentication-Results: relay.mimecast.com;
 auth=pass smtp.auth=CUSA124A263 smtp.mailfrom=stefanha@redhat.com
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: redhat.com
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: base64
Received-SPF: pass client-ip=63.128.21.124; envelope-from=stefanha@redhat.com;
 helo=us-smtp-delivery-124.mimecast.com
X-Spam_score_int: -20
X-Spam_score: -2.1
X-Spam_bar: --
X-Spam_report: (-2.1 / 5.0 requ) BAYES_00=-1.9, DKIMWL_WL_HIGH=-0.001,
 DKIM_SIGNED=0.1, DKIM_VALID=-0.1, DKIM_VALID_AU=-0.1, DKIM_VALID_EF=-0.1,
 RCVD_IN_DNSWL_NONE=-0.0001, RCVD_IN_MSPIKE_H4=0.001, RCVD_IN_MSPIKE_WL=0.001,
 SPF_HELO_NONE=0.001, SPF_PASS=-0.001 autolearn=ham autolearn_force=no
X-Spam_action: no action
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <https://lists.nongnu.org/archive/html/qemu-devel>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Cc: Laurent Vivier <lvivier@redhat.com>, Kevin Wolf <kwolf@redhat.com>,
 Thomas Huth <thuth@redhat.com>, qemu-block@nongnu.org,
 Peter Maydell <peter.maydell@linaro.org>,
 "Michael S . Tsirkin" <mst@redhat.com>, Coiby Xu <Coiby.Xu@gmail.com>,
 Max Reitz <mreitz@redhat.com>, Stefan Hajnoczi <stefanha@redhat.com>,
 Paolo Bonzini <pbonzini@redhat.com>,
 Raphael Norwitz <raphael.norwitz@nutanix.com>
Errors-To: qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org
Sender: "Qemu-devel" <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>

RnJvbTogQ29pYnkgWHUgPGNvaWJ5Lnh1QGdtYWlsLmNvbT4KClRoaXMgdGVzdCBjYXNlIGhhcyB0
aGUgc2FtZSB0ZXN0cyBhcyB0ZXN0cy92aXJ0aW8tYmxrLXRlc3QuYyBleGNlcHQgZm9yCnRlc3Rz
IGhhdmUgYmxvY2tfcmVzaXplLiBTaW5jZSB0aGUgdmhvc3QtdXNlci1ibGsgZXhwb3J0IG9ubHkg
c2VydmVzIG9uZQpjbGllbnQgb25lIHRpbWUsIHR3byBleHBvcnRzIGFyZSBzdGFydGVkIGJ5IHFl
bXUtc3RvcmFnZS1kYWVtb24gZm9yIHRoZQpob3RwbHVnIHRlc3QuCgpTdWdnZXN0ZWQtYnk6IFRo
b21hcyBIdXRoIDx0aHV0aEByZWRoYXQuY29tPgpTaWduZWQtb2ZmLWJ5OiBDb2lieSBYdSA8Y29p
YnkueHVAZ21haWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBTdGVmYW4gSGFqbm9jemkgPHN0ZWZhbmhh
QHJlZGhhdC5jb20+Ci0tLQogTUFJTlRBSU5FUlMgICAgICAgICAgICAgICAgICAgICAgICAgfCAg
IDIgKwogdGVzdHMvcXRlc3QvbGlicW9zL3Zob3N0LXVzZXItYmxrLmggfCAgNDggKysKIHRlc3Rz
L3F0ZXN0L2xpYnFvcy92aG9zdC11c2VyLWJsay5jIHwgMTMwICsrKysrCiB0ZXN0cy9xdGVzdC92
aG9zdC11c2VyLWJsay10ZXN0LmMgICB8IDc4OCArKysrKysrKysrKysrKysrKysrKysrKysrKysr
CiB0ZXN0cy9xdGVzdC9saWJxb3MvbWVzb24uYnVpbGQgICAgICB8ICAgMSArCiB0ZXN0cy9xdGVz
dC9tZXNvbi5idWlsZCAgICAgICAgICAgICB8ICAgNCArCiA2IGZpbGVzIGNoYW5nZWQsIDk3MyBp
bnNlcnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQgdGVzdHMvcXRlc3QvbGlicW9zL3Zob3N0
LXVzZXItYmxrLmgKIGNyZWF0ZSBtb2RlIDEwMDY0NCB0ZXN0cy9xdGVzdC9saWJxb3Mvdmhvc3Qt
dXNlci1ibGsuYwogY3JlYXRlIG1vZGUgMTAwNjQ0IHRlc3RzL3F0ZXN0L3Zob3N0LXVzZXItYmxr
LXRlc3QuYwoKZGlmZiAtLWdpdCBhL01BSU5UQUlORVJTIGIvTUFJTlRBSU5FUlMKaW5kZXggNjhi
YzE2MGY0MS4uZDM1MTI4MGQxZiAxMDA2NDQKLS0tIGEvTUFJTlRBSU5FUlMKKysrIGIvTUFJTlRB
SU5FUlMKQEAgLTMxMDMsNiArMzEwMyw4IEBAIEY6IGJsb2NrL2V4cG9ydC92aG9zdC11c2VyLWJs
ay1zZXJ2ZXIuYwogRjogYmxvY2svZXhwb3J0L3Zob3N0LXVzZXItYmxrLXNlcnZlci5oCiBGOiBp
bmNsdWRlL3FlbXUvdmhvc3QtdXNlci1zZXJ2ZXIuaAogRjogdGVzdHMvcXRlc3QvbGlicW9zL3Zo
b3N0LXVzZXItYmxrLmMKK0Y6IHRlc3RzL3F0ZXN0L2xpYnFvcy92aG9zdC11c2VyLWJsay5oCitG
OiB0ZXN0cy9xdGVzdC92aG9zdC11c2VyLWJsay10ZXN0LmMKIEY6IHV0aWwvdmhvc3QtdXNlci1z
ZXJ2ZXIuYwogCiBSZXBsaWNhdGlvbgpkaWZmIC0tZ2l0IGEvdGVzdHMvcXRlc3QvbGlicW9zL3Zo
b3N0LXVzZXItYmxrLmggYi90ZXN0cy9xdGVzdC9saWJxb3Mvdmhvc3QtdXNlci1ibGsuaApuZXcg
ZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwLi4yYTAzNDU2YTQ1Ci0tLSAvZGV2L251
bGwKKysrIGIvdGVzdHMvcXRlc3QvbGlicW9zL3Zob3N0LXVzZXItYmxrLmgKQEAgLTAsMCArMSw0
OCBAQAorLyoKKyAqIGxpYnFvcyBkcml2ZXIgZnJhbWV3b3JrCisgKgorICogQmFzZWQgb24gdGVz
dHMvcXRlc3QvbGlicW9zL3ZpcnRpby1ibGsuYworICoKKyAqIENvcHlyaWdodCAoYykgMjAyMCBD
b2lieSBYdSA8Y29pYnkueHVAZ21haWwuY29tPgorICoKKyAqIENvcHlyaWdodCAoYykgMjAxOCBF
bWFudWVsZSBHaXVzZXBwZSBFc3Bvc2l0byA8ZS5lbWFudWVsZWdpdXNlcHBlQGdtYWlsLmNvbT4K
KyAqCisgKiBUaGlzIGxpYnJhcnkgaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1
dGUgaXQgYW5kL29yCisgKiBtb2RpZnkgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgTGVz
c2VyIEdlbmVyYWwgUHVibGljCisgKiBMaWNlbnNlIHZlcnNpb24gMiBhcyBwdWJsaXNoZWQgYnkg
dGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbi4KKyAqCisgKiBUaGlzIGxpYnJhcnkgaXMgZGlz
dHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKKyAqIGJ1dCBXSVRI
T1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCisg
KiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBT
ZWUgdGhlIEdOVQorICogTGVzc2VyIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0
YWlscy4KKyAqCisgKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUg
TGVzc2VyIEdlbmVyYWwgUHVibGljCisgKiBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBsaWJyYXJ5
OyBpZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4KKyAqLworCisjaWZu
ZGVmIFRFU1RTX0xJQlFPU19WSE9TVF9VU0VSX0JMS19ICisjZGVmaW5lIFRFU1RTX0xJQlFPU19W
SE9TVF9VU0VSX0JMS19ICisKKyNpbmNsdWRlICJxZ3JhcGguaCIKKyNpbmNsdWRlICJ2aXJ0aW8u
aCIKKyNpbmNsdWRlICJ2aXJ0aW8tcGNpLmgiCisKK3R5cGVkZWYgc3RydWN0IFFWaG9zdFVzZXJC
bGsgUVZob3N0VXNlckJsazsKK3R5cGVkZWYgc3RydWN0IFFWaG9zdFVzZXJCbGtQQ0kgUVZob3N0
VXNlckJsa1BDSTsKK3R5cGVkZWYgc3RydWN0IFFWaG9zdFVzZXJCbGtEZXZpY2UgUVZob3N0VXNl
ckJsa0RldmljZTsKKworc3RydWN0IFFWaG9zdFVzZXJCbGsgeworICAgIFFWaXJ0aW9EZXZpY2Ug
KnZkZXY7Cit9OworCitzdHJ1Y3QgUVZob3N0VXNlckJsa1BDSSB7CisgICAgUVZpcnRpb1BDSURl
dmljZSBwY2lfdmRldjsKKyAgICBRVmhvc3RVc2VyQmxrIGJsazsKK307CisKK3N0cnVjdCBRVmhv
c3RVc2VyQmxrRGV2aWNlIHsKKyAgICBRT1NHcmFwaE9iamVjdCBvYmo7CisgICAgUVZob3N0VXNl
ckJsayBibGs7Cit9OworCisjZW5kaWYKZGlmZiAtLWdpdCBhL3Rlc3RzL3F0ZXN0L2xpYnFvcy92
aG9zdC11c2VyLWJsay5jIGIvdGVzdHMvcXRlc3QvbGlicW9zL3Zob3N0LXVzZXItYmxrLmMKbmV3
IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMC4uNTY4YzM0MjZlZAotLS0gL2Rldi9u
dWxsCisrKyBiL3Rlc3RzL3F0ZXN0L2xpYnFvcy92aG9zdC11c2VyLWJsay5jCkBAIC0wLDAgKzEs
MTMwIEBACisvKgorICogbGlicW9zIGRyaXZlciBmcmFtZXdvcmsKKyAqCisgKiBCYXNlZCBvbiB0
ZXN0cy9xdGVzdC9saWJxb3MvdmlydGlvLWJsay5jCisgKgorICogQ29weXJpZ2h0IChjKSAyMDIw
IENvaWJ5IFh1IDxjb2lieS54dUBnbWFpbC5jb20+CisgKgorICogQ29weXJpZ2h0IChjKSAyMDE4
IEVtYW51ZWxlIEdpdXNlcHBlIEVzcG9zaXRvIDxlLmVtYW51ZWxlZ2l1c2VwcGVAZ21haWwuY29t
PgorICoKKyAqIFRoaXMgbGlicmFyeSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJp
YnV0ZSBpdCBhbmQvb3IKKyAqIG1vZGlmeSBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBM
ZXNzZXIgR2VuZXJhbCBQdWJsaWMKKyAqIExpY2Vuc2UgdmVyc2lvbiAyLjEgYXMgcHVibGlzaGVk
IGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24uCisgKgorICogVGhpcyBsaWJyYXJ5IGlz
IGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCisgKiBidXQg
V0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBv
ZgorICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NF
LiAgU2VlIHRoZSBHTlUKKyAqIExlc3NlciBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3Jl
IGRldGFpbHMuCisgKgorICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUg
R05VIExlc3NlciBHZW5lcmFsIFB1YmxpYworICogTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgbGli
cmFyeTsgaWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+CisgKi8KKwor
I2luY2x1ZGUgInFlbXUvb3NkZXAuaCIKKyNpbmNsdWRlICJsaWJxdGVzdC5oIgorI2luY2x1ZGUg
InFlbXUvbW9kdWxlLmgiCisjaW5jbHVkZSAic3RhbmRhcmQtaGVhZGVycy9saW51eC92aXJ0aW9f
YmxrLmgiCisjaW5jbHVkZSAidmhvc3QtdXNlci1ibGsuaCIKKworI2RlZmluZSBQQ0lfU0xPVCAg
ICAgICAgICAgICAgICAweDA0CisjZGVmaW5lIFBDSV9GTiAgICAgICAgICAgICAgICAgIDB4MDAK
KworLyogdmlydGlvLWJsay1kZXZpY2UgKi8KK3N0YXRpYyB2b2lkICpxdmhvc3RfdXNlcl9ibGtf
Z2V0X2RyaXZlcihRVmhvc3RVc2VyQmxrICp2X2JsaywKKyAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIGNvbnN0IGNoYXIgKmludGVyZmFjZSkKK3sKKyAgICBpZiAoIWdfc3RyY21w
MChpbnRlcmZhY2UsICJ2aG9zdC11c2VyLWJsayIpKSB7CisgICAgICAgIHJldHVybiB2X2JsazsK
KyAgICB9CisgICAgaWYgKCFnX3N0cmNtcDAoaW50ZXJmYWNlLCAidmlydGlvIikpIHsKKyAgICAg
ICAgcmV0dXJuIHZfYmxrLT52ZGV2OworICAgIH0KKworICAgIGZwcmludGYoc3RkZXJyLCAiJXMg
bm90IHByZXNlbnQgaW4gdmhvc3QtdXNlci1ibGstZGV2aWNlXG4iLCBpbnRlcmZhY2UpOworICAg
IGdfYXNzZXJ0X25vdF9yZWFjaGVkKCk7Cit9CisKK3N0YXRpYyB2b2lkICpxdmhvc3RfdXNlcl9i
bGtfZGV2aWNlX2dldF9kcml2ZXIodm9pZCAqb2JqZWN0LAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoYXIgKmludGVyZmFjZSkKK3sKKyAgICBRVmhv
c3RVc2VyQmxrRGV2aWNlICp2X2JsayA9IG9iamVjdDsKKyAgICByZXR1cm4gcXZob3N0X3VzZXJf
YmxrX2dldF9kcml2ZXIoJnZfYmxrLT5ibGssIGludGVyZmFjZSk7Cit9CisKK3N0YXRpYyB2b2lk
ICp2aG9zdF91c2VyX2Jsa19kZXZpY2VfY3JlYXRlKHZvaWQgKnZpcnRpb19kZXYsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFFHdWVzdEFsbG9jYXRvciAqdF9hbGxvYywK
KyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9pZCAqYWRkcikKK3sKKyAg
ICBRVmhvc3RVc2VyQmxrRGV2aWNlICp2aG9zdF91c2VyX2JsayA9IGdfbmV3MChRVmhvc3RVc2Vy
QmxrRGV2aWNlLCAxKTsKKyAgICBRVmhvc3RVc2VyQmxrICppbnRlcmZhY2UgPSAmdmhvc3RfdXNl
cl9ibGstPmJsazsKKworICAgIGludGVyZmFjZS0+dmRldiA9IHZpcnRpb19kZXY7CisKKyAgICB2
aG9zdF91c2VyX2Jsay0+b2JqLmdldF9kcml2ZXIgPSBxdmhvc3RfdXNlcl9ibGtfZGV2aWNlX2dl
dF9kcml2ZXI7CisKKyAgICByZXR1cm4gJnZob3N0X3VzZXJfYmxrLT5vYmo7Cit9CisKKy8qIHZp
cnRpby1ibGstcGNpICovCitzdGF0aWMgdm9pZCAqcXZob3N0X3VzZXJfYmxrX3BjaV9nZXRfZHJp
dmVyKHZvaWQgKm9iamVjdCwgY29uc3QgY2hhciAqaW50ZXJmYWNlKQoreworICAgIFFWaG9zdFVz
ZXJCbGtQQ0kgKnZfYmxrID0gb2JqZWN0OworICAgIGlmICghZ19zdHJjbXAwKGludGVyZmFjZSwg
InBjaS1kZXZpY2UiKSkgeworICAgICAgICByZXR1cm4gdl9ibGstPnBjaV92ZGV2LnBkZXY7Cisg
ICAgfQorICAgIHJldHVybiBxdmhvc3RfdXNlcl9ibGtfZ2V0X2RyaXZlcigmdl9ibGstPmJsaywg
aW50ZXJmYWNlKTsKK30KKworc3RhdGljIHZvaWQgKnZob3N0X3VzZXJfYmxrX3BjaV9jcmVhdGUo
dm9pZCAqcGNpX2J1cywgUUd1ZXN0QWxsb2NhdG9yICp0X2FsbG9jLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICB2b2lkICphZGRyKQoreworICAgIFFWaG9zdFVzZXJCbGtQ
Q0kgKnZob3N0X3VzZXJfYmxrID0gZ19uZXcwKFFWaG9zdFVzZXJCbGtQQ0ksIDEpOworICAgIFFW
aG9zdFVzZXJCbGsgKmludGVyZmFjZSA9ICZ2aG9zdF91c2VyX2Jsay0+YmxrOworICAgIFFPU0dy
YXBoT2JqZWN0ICpvYmogPSAmdmhvc3RfdXNlcl9ibGstPnBjaV92ZGV2Lm9iajsKKworICAgIHZp
cnRpb19wY2lfaW5pdCgmdmhvc3RfdXNlcl9ibGstPnBjaV92ZGV2LCBwY2lfYnVzLCBhZGRyKTsK
KyAgICBpbnRlcmZhY2UtPnZkZXYgPSAmdmhvc3RfdXNlcl9ibGstPnBjaV92ZGV2LnZkZXY7CisK
KyAgICBnX2Fzc2VydF9jbXBoZXgoaW50ZXJmYWNlLT52ZGV2LT5kZXZpY2VfdHlwZSwgPT0sIFZJ
UlRJT19JRF9CTE9DSyk7CisKKyAgICBvYmotPmdldF9kcml2ZXIgPSBxdmhvc3RfdXNlcl9ibGtf
cGNpX2dldF9kcml2ZXI7CisKKyAgICByZXR1cm4gb2JqOworfQorCitzdGF0aWMgdm9pZCB2aG9z
dF91c2VyX2Jsa19yZWdpc3Rlcl9ub2Rlcyh2b2lkKQoreworICAgIC8qCisgICAgICogRklYTUU6
IGV2ZXJ5IHRlc3QgdXNpbmcgdGhlc2UgdHdvIG5vZGVzIG5lZWRzIHRvIHNldHVwIGEKKyAgICAg
KiAtZHJpdmUsaWQ9ZHJpdmUwIG90aGVyd2lzZSBRRU1VIGlzIG5vdCBnb2luZyB0byBzdGFydC4K
KyAgICAgKiBUaGVyZWZvcmUsIHdlIGRvIG5vdCBpbmNsdWRlICJwcm9kdWNlcyIgZWRnZSBmb3Ig
dmlydGlvCisgICAgICogYW5kIHBjaS1kZXZpY2UgeWV0LgorICAgICAqLworCisgICAgY2hhciAq
YXJnID0gZ19zdHJkdXBfcHJpbnRmKCJpZD1kcnYwLGNoYXJkZXY9Y2hhcjEsYWRkcj0leC4leCIs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBDSV9TTE9ULCBQQ0lfRk4pOworCisg
ICAgUVBDSUFkZHJlc3MgYWRkciA9IHsKKyAgICAgICAgLmRldmZuID0gUVBDSV9ERVZGTihQQ0lf
U0xPVCwgUENJX0ZOKSwKKyAgICB9OworCisgICAgUU9TR3JhcGhFZGdlT3B0aW9ucyBvcHRzID0g
eyB9OworCisgICAgLyogdmlydGlvLWJsay1kZXZpY2UgKi8KKyAgICAvKiogb3B0cy5leHRyYV9k
ZXZpY2Vfb3B0cyA9ICJkcml2ZT1kcml2ZTAiOyAqLworICAgIHFvc19ub2RlX2NyZWF0ZV9kcml2
ZXIoInZob3N0LXVzZXItYmxrLWRldmljZSIsCisgICAgICAgICAgICAgICAgICAgICAgICAgICB2
aG9zdF91c2VyX2Jsa19kZXZpY2VfY3JlYXRlKTsKKyAgICBxb3Nfbm9kZV9jb25zdW1lcygidmhv
c3QtdXNlci1ibGstZGV2aWNlIiwgInZpcnRpby1idXMiLCAmb3B0cyk7CisgICAgcW9zX25vZGVf
cHJvZHVjZXMoInZob3N0LXVzZXItYmxrLWRldmljZSIsICJ2aG9zdC11c2VyLWJsayIpOworCisg
ICAgLyogdmlydGlvLWJsay1wY2kgKi8KKyAgICBvcHRzLmV4dHJhX2RldmljZV9vcHRzID0gYXJn
OworICAgIGFkZF9xcGNpX2FkZHJlc3MoJm9wdHMsICZhZGRyKTsKKyAgICBxb3Nfbm9kZV9jcmVh
dGVfZHJpdmVyKCJ2aG9zdC11c2VyLWJsay1wY2kiLCB2aG9zdF91c2VyX2Jsa19wY2lfY3JlYXRl
KTsKKyAgICBxb3Nfbm9kZV9jb25zdW1lcygidmhvc3QtdXNlci1ibGstcGNpIiwgInBjaS1idXMi
LCAmb3B0cyk7CisgICAgcW9zX25vZGVfcHJvZHVjZXMoInZob3N0LXVzZXItYmxrLXBjaSIsICJ2
aG9zdC11c2VyLWJsayIpOworCisgICAgZ19mcmVlKGFyZyk7Cit9CisKK2xpYnFvc19pbml0KHZo
b3N0X3VzZXJfYmxrX3JlZ2lzdGVyX25vZGVzKTsKZGlmZiAtLWdpdCBhL3Rlc3RzL3F0ZXN0L3Zo
b3N0LXVzZXItYmxrLXRlc3QuYyBiL3Rlc3RzL3F0ZXN0L3Zob3N0LXVzZXItYmxrLXRlc3QuYwpu
ZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwLi4xNzVkY2NhYjk4Ci0tLSAvZGV2
L251bGwKKysrIGIvdGVzdHMvcXRlc3Qvdmhvc3QtdXNlci1ibGstdGVzdC5jCkBAIC0wLDAgKzEs
Nzg4IEBACisvKgorICogUVRlc3QgdGVzdGNhc2UgZm9yIFZob3N0LXVzZXIgQmxvY2sgRGV2aWNl
CisgKgorICogQmFzZWQgb24gdGVzdHMvcXRlc3QvL3ZpcnRpby1ibGstdGVzdC5jCisKKyAqIENv
cHlyaWdodCAoYykgMjAxNCBTVVNFIExJTlVYIFByb2R1Y3RzIEdtYkgKKyAqIENvcHlyaWdodCAo
YykgMjAxNCBNYXJjIE1hcsOtCisgKiBDb3B5cmlnaHQgKGMpIDIwMjAgQ29pYnkgWHUKKyAqCisg
KiBUaGlzIHdvcmsgaXMgbGljZW5zZWQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR1BMLCB2
ZXJzaW9uIDIgb3IgbGF0ZXIuCisgKiBTZWUgdGhlIENPUFlJTkcgZmlsZSBpbiB0aGUgdG9wLWxl
dmVsIGRpcmVjdG9yeS4KKyAqLworCisjaW5jbHVkZSAicWVtdS9vc2RlcC5oIgorI2luY2x1ZGUg
ImxpYnF0ZXN0LXNpbmdsZS5oIgorI2luY2x1ZGUgInFlbXUvYnN3YXAuaCIKKyNpbmNsdWRlICJx
ZW11L21vZHVsZS5oIgorI2luY2x1ZGUgInN0YW5kYXJkLWhlYWRlcnMvbGludXgvdmlydGlvX2Js
ay5oIgorI2luY2x1ZGUgInN0YW5kYXJkLWhlYWRlcnMvbGludXgvdmlydGlvX3BjaS5oIgorI2lu
Y2x1ZGUgImxpYnFvcy9xZ3JhcGguaCIKKyNpbmNsdWRlICJsaWJxb3Mvdmhvc3QtdXNlci1ibGsu
aCIKKyNpbmNsdWRlICJsaWJxb3MvbGlicW9zLXBjLmgiCisKKyNkZWZpbmUgVEVTVF9JTUFHRV9T
SVpFICAgICAgICAgKDY0ICogMTAyNCAqIDEwMjQpCisjZGVmaW5lIFFWSVJUSU9fQkxLX1RJTUVP
VVRfVVMgICgzMCAqIDEwMDAgKiAxMDAwKQorI2RlZmluZSBQQ0lfU0xPVF9IUCAgICAgICAgICAg
ICAweDA2CisKK3R5cGVkZWYgc3RydWN0IHsKKyAgICBwaWRfdCBwaWQ7Cit9IFFlbXVTdG9yYWdl
RGFlbW9uU3RhdGU7CisKK3R5cGVkZWYgc3RydWN0IFFWaXJ0aW9CbGtSZXEgeworICAgIHVpbnQz
Ml90IHR5cGU7CisgICAgdWludDMyX3QgaW9wcmlvOworICAgIHVpbnQ2NF90IHNlY3RvcjsKKyAg
ICBjaGFyICpkYXRhOworICAgIHVpbnQ4X3Qgc3RhdHVzOworfSBRVmlydGlvQmxrUmVxOworCisj
aWZkZWYgSE9TVF9XT1JEU19CSUdFTkRJQU4KK3N0YXRpYyBjb25zdCBib29sIGhvc3RfaXNfYmln
X2VuZGlhbiA9IHRydWU7CisjZWxzZQorc3RhdGljIGNvbnN0IGJvb2wgaG9zdF9pc19iaWdfZW5k
aWFuOyAvKiBmYWxzZSAqLworI2VuZGlmCisKK3N0YXRpYyBpbmxpbmUgdm9pZCB2aXJ0aW9fYmxr
X2ZpeF9yZXF1ZXN0KFFWaXJ0aW9EZXZpY2UgKmQsIFFWaXJ0aW9CbGtSZXEgKnJlcSkKK3sKKyAg
ICBpZiAocXZpcnRpb19pc19iaWdfZW5kaWFuKGQpICE9IGhvc3RfaXNfYmlnX2VuZGlhbikgewor
ICAgICAgICByZXEtPnR5cGUgPSBic3dhcDMyKHJlcS0+dHlwZSk7CisgICAgICAgIHJlcS0+aW9w
cmlvID0gYnN3YXAzMihyZXEtPmlvcHJpbyk7CisgICAgICAgIHJlcS0+c2VjdG9yID0gYnN3YXA2
NChyZXEtPnNlY3Rvcik7CisgICAgfQorfQorCitzdGF0aWMgaW5saW5lIHZvaWQgdmlydGlvX2Js
a19maXhfZHd6X2hkcihRVmlydGlvRGV2aWNlICpkLAorICAgIHN0cnVjdCB2aXJ0aW9fYmxrX2Rp
c2NhcmRfd3JpdGVfemVyb2VzICpkd3pfaGRyKQoreworICAgIGlmIChxdmlydGlvX2lzX2JpZ19l
bmRpYW4oZCkgIT0gaG9zdF9pc19iaWdfZW5kaWFuKSB7CisgICAgICAgIGR3el9oZHItPnNlY3Rv
ciA9IGJzd2FwNjQoZHd6X2hkci0+c2VjdG9yKTsKKyAgICAgICAgZHd6X2hkci0+bnVtX3NlY3Rv
cnMgPSBic3dhcDMyKGR3el9oZHItPm51bV9zZWN0b3JzKTsKKyAgICAgICAgZHd6X2hkci0+Zmxh
Z3MgPSBic3dhcDMyKGR3el9oZHItPmZsYWdzKTsKKyAgICB9Cit9CisKK3N0YXRpYyB1aW50NjRf
dCB2aXJ0aW9fYmxrX3JlcXVlc3QoUUd1ZXN0QWxsb2NhdG9yICphbGxvYywgUVZpcnRpb0Rldmlj
ZSAqZCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUVZpcnRpb0Jsa1JlcSAq
cmVxLCB1aW50NjRfdCBkYXRhX3NpemUpCit7CisgICAgdWludDY0X3QgYWRkcjsKKyAgICB1aW50
OF90IHN0YXR1cyA9IDB4RkY7CisgICAgUVRlc3RTdGF0ZSAqcXRzID0gZ2xvYmFsX3F0ZXN0Owor
CisgICAgc3dpdGNoIChyZXEtPnR5cGUpIHsKKyAgICBjYXNlIFZJUlRJT19CTEtfVF9JTjoKKyAg
ICBjYXNlIFZJUlRJT19CTEtfVF9PVVQ6CisgICAgICAgIGdfYXNzZXJ0X2NtcHVpbnQoZGF0YV9z
aXplICUgNTEyLCA9PSwgMCk7CisgICAgICAgIGJyZWFrOworICAgIGNhc2UgVklSVElPX0JMS19U
X0RJU0NBUkQ6CisgICAgY2FzZSBWSVJUSU9fQkxLX1RfV1JJVEVfWkVST0VTOgorICAgICAgICBn
X2Fzc2VydF9jbXB1aW50KGRhdGFfc2l6ZSAlCisgICAgICAgICAgICAgICAgICAgICAgICAgc2l6
ZW9mKHN0cnVjdCB2aXJ0aW9fYmxrX2Rpc2NhcmRfd3JpdGVfemVyb2VzKSwgPT0sIDApOworICAg
ICAgICBicmVhazsKKyAgICBkZWZhdWx0OgorICAgICAgICBnX2Fzc2VydF9jbXB1aW50KGRhdGFf
c2l6ZSwgPT0sIDApOworICAgIH0KKworICAgIGFkZHIgPSBndWVzdF9hbGxvYyhhbGxvYywgc2l6
ZW9mKCpyZXEpICsgZGF0YV9zaXplKTsKKworICAgIHZpcnRpb19ibGtfZml4X3JlcXVlc3QoZCwg
cmVxKTsKKworICAgIHF0ZXN0X21lbXdyaXRlKHF0cywgYWRkciwgcmVxLCAxNik7CisgICAgcXRl
c3RfbWVtd3JpdGUocXRzLCBhZGRyICsgMTYsIHJlcS0+ZGF0YSwgZGF0YV9zaXplKTsKKyAgICBx
dGVzdF9tZW13cml0ZShxdHMsIGFkZHIgKyAxNiArIGRhdGFfc2l6ZSwgJnN0YXR1cywgc2l6ZW9m
KHN0YXR1cykpOworCisgICAgcmV0dXJuIGFkZHI7Cit9CisKKy8qIFJldHVybnMgdGhlIHJlcXVl
c3QgdmlydHF1ZXVlIHNvIHRoZSBjYWxsZXIgY2FuIHBlcmZvcm0gZnVydGhlciB0ZXN0cyAqLwor
c3RhdGljIFFWaXJ0UXVldWUgKnRlc3RfYmFzaWMoUVZpcnRpb0RldmljZSAqZGV2LCBRR3Vlc3RB
bGxvY2F0b3IgKmFsbG9jKQoreworICAgIFFWaXJ0aW9CbGtSZXEgcmVxOworICAgIHVpbnQ2NF90
IHJlcV9hZGRyOworICAgIHVpbnQ2NF90IGNhcGFjaXR5OworICAgIHVpbnQ2NF90IGZlYXR1cmVz
OworICAgIHVpbnQzMl90IGZyZWVfaGVhZDsKKyAgICB1aW50OF90IHN0YXR1czsKKyAgICBjaGFy
ICpkYXRhOworICAgIFFUZXN0U3RhdGUgKnF0cyA9IGdsb2JhbF9xdGVzdDsKKyAgICBRVmlydFF1
ZXVlICp2cTsKKworICAgIGZlYXR1cmVzID0gcXZpcnRpb19nZXRfZmVhdHVyZXMoZGV2KTsKKyAg
ICBmZWF0dXJlcyA9IGZlYXR1cmVzICYgfihRVklSVElPX0ZfQkFEX0ZFQVRVUkUgfAorICAgICAg
ICAgICAgICAgICAgICAoMXUgPDwgVklSVElPX1JJTkdfRl9JTkRJUkVDVF9ERVNDKSB8CisgICAg
ICAgICAgICAgICAgICAgICgxdSA8PCBWSVJUSU9fUklOR19GX0VWRU5UX0lEWCkgfAorICAgICAg
ICAgICAgICAgICAgICAoMXUgPDwgVklSVElPX0JMS19GX1NDU0kpKTsKKyAgICBxdmlydGlvX3Nl
dF9mZWF0dXJlcyhkZXYsIGZlYXR1cmVzKTsKKworICAgIGNhcGFjaXR5ID0gcXZpcnRpb19jb25m
aWdfcmVhZHEoZGV2LCAwKTsKKyAgICBnX2Fzc2VydF9jbXBpbnQoY2FwYWNpdHksID09LCBURVNU
X0lNQUdFX1NJWkUgLyA1MTIpOworCisgICAgdnEgPSBxdmlydHF1ZXVlX3NldHVwKGRldiwgYWxs
b2MsIDApOworCisgICAgcXZpcnRpb19zZXRfZHJpdmVyX29rKGRldik7CisKKyAgICAvKiBXcml0
ZSBhbmQgcmVhZCB3aXRoIDMgZGVzY3JpcHRvciBsYXlvdXQgKi8KKyAgICAvKiBXcml0ZSByZXF1
ZXN0ICovCisgICAgcmVxLnR5cGUgPSBWSVJUSU9fQkxLX1RfT1VUOworICAgIHJlcS5pb3ByaW8g
PSAxOworICAgIHJlcS5zZWN0b3IgPSAwOworICAgIHJlcS5kYXRhID0gZ19tYWxsb2MwKDUxMik7
CisgICAgc3RyY3B5KHJlcS5kYXRhLCAiVEVTVCIpOworCisgICAgcmVxX2FkZHIgPSB2aXJ0aW9f
YmxrX3JlcXVlc3QoYWxsb2MsIGRldiwgJnJlcSwgNTEyKTsKKworICAgIGdfZnJlZShyZXEuZGF0
YSk7CisKKyAgICBmcmVlX2hlYWQgPSBxdmlydHF1ZXVlX2FkZChxdHMsIHZxLCByZXFfYWRkciwg
MTYsIGZhbHNlLCB0cnVlKTsKKyAgICBxdmlydHF1ZXVlX2FkZChxdHMsIHZxLCByZXFfYWRkciAr
IDE2LCA1MTIsIGZhbHNlLCB0cnVlKTsKKyAgICBxdmlydHF1ZXVlX2FkZChxdHMsIHZxLCByZXFf
YWRkciArIDUyOCwgMSwgdHJ1ZSwgZmFsc2UpOworCisgICAgcXZpcnRxdWV1ZV9raWNrKHF0cywg
ZGV2LCB2cSwgZnJlZV9oZWFkKTsKKworICAgIHF2aXJ0aW9fd2FpdF91c2VkX2VsZW0ocXRzLCBk
ZXYsIHZxLCBmcmVlX2hlYWQsIE5VTEwsCisgICAgICAgICAgICAgICAgICAgICAgICAgICBRVklS
VElPX0JMS19USU1FT1VUX1VTKTsKKyAgICBzdGF0dXMgPSByZWFkYihyZXFfYWRkciArIDUyOCk7
CisgICAgZ19hc3NlcnRfY21waW50KHN0YXR1cywgPT0sIDApOworCisgICAgZ3Vlc3RfZnJlZShh
bGxvYywgcmVxX2FkZHIpOworCisgICAgLyogUmVhZCByZXF1ZXN0ICovCisgICAgcmVxLnR5cGUg
PSBWSVJUSU9fQkxLX1RfSU47CisgICAgcmVxLmlvcHJpbyA9IDE7CisgICAgcmVxLnNlY3RvciA9
IDA7CisgICAgcmVxLmRhdGEgPSBnX21hbGxvYzAoNTEyKTsKKworICAgIHJlcV9hZGRyID0gdmly
dGlvX2Jsa19yZXF1ZXN0KGFsbG9jLCBkZXYsICZyZXEsIDUxMik7CisKKyAgICBnX2ZyZWUocmVx
LmRhdGEpOworCisgICAgZnJlZV9oZWFkID0gcXZpcnRxdWV1ZV9hZGQocXRzLCB2cSwgcmVxX2Fk
ZHIsIDE2LCBmYWxzZSwgdHJ1ZSk7CisgICAgcXZpcnRxdWV1ZV9hZGQocXRzLCB2cSwgcmVxX2Fk
ZHIgKyAxNiwgNTEyLCB0cnVlLCB0cnVlKTsKKyAgICBxdmlydHF1ZXVlX2FkZChxdHMsIHZxLCBy
ZXFfYWRkciArIDUyOCwgMSwgdHJ1ZSwgZmFsc2UpOworCisgICAgcXZpcnRxdWV1ZV9raWNrKHF0
cywgZGV2LCB2cSwgZnJlZV9oZWFkKTsKKworICAgIHF2aXJ0aW9fd2FpdF91c2VkX2VsZW0ocXRz
LCBkZXYsIHZxLCBmcmVlX2hlYWQsIE5VTEwsCisgICAgICAgICAgICAgICAgICAgICAgICAgICBR
VklSVElPX0JMS19USU1FT1VUX1VTKTsKKyAgICBzdGF0dXMgPSByZWFkYihyZXFfYWRkciArIDUy
OCk7CisgICAgZ19hc3NlcnRfY21waW50KHN0YXR1cywgPT0sIDApOworCisgICAgZGF0YSA9IGdf
bWFsbG9jMCg1MTIpOworICAgIHF0ZXN0X21lbXJlYWQocXRzLCByZXFfYWRkciArIDE2LCBkYXRh
LCA1MTIpOworICAgIGdfYXNzZXJ0X2NtcHN0cihkYXRhLCA9PSwgIlRFU1QiKTsKKyAgICBnX2Zy
ZWUoZGF0YSk7CisKKyAgICBndWVzdF9mcmVlKGFsbG9jLCByZXFfYWRkcik7CisKKyAgICBpZiAo
ZmVhdHVyZXMgJiAoMXUgPDwgVklSVElPX0JMS19GX1dSSVRFX1pFUk9FUykpIHsKKyAgICAgICAg
c3RydWN0IHZpcnRpb19ibGtfZGlzY2FyZF93cml0ZV96ZXJvZXMgZHd6X2hkcjsKKyAgICAgICAg
dm9pZCAqZXhwZWN0ZWQ7CisKKyAgICAgICAgLyoKKyAgICAgICAgICogV1JJVEVfWkVST0VTIHJl
cXVlc3Qgb24gdGhlIHNhbWUgc2VjdG9yIG9mIHByZXZpb3VzIHRlc3Qgd2hlcmUKKyAgICAgICAg
ICogd2Ugd3JvdGUgIlRFU1QiLgorICAgICAgICAgKi8KKyAgICAgICAgcmVxLnR5cGUgPSBWSVJU
SU9fQkxLX1RfV1JJVEVfWkVST0VTOworICAgICAgICByZXEuZGF0YSA9IChjaGFyICopICZkd3pf
aGRyOworICAgICAgICBkd3pfaGRyLnNlY3RvciA9IDA7CisgICAgICAgIGR3el9oZHIubnVtX3Nl
Y3RvcnMgPSAxOworICAgICAgICBkd3pfaGRyLmZsYWdzID0gMDsKKworICAgICAgICB2aXJ0aW9f
YmxrX2ZpeF9kd3pfaGRyKGRldiwgJmR3el9oZHIpOworCisgICAgICAgIHJlcV9hZGRyID0gdmly
dGlvX2Jsa19yZXF1ZXN0KGFsbG9jLCBkZXYsICZyZXEsIHNpemVvZihkd3pfaGRyKSk7CisKKyAg
ICAgICAgZnJlZV9oZWFkID0gcXZpcnRxdWV1ZV9hZGQocXRzLCB2cSwgcmVxX2FkZHIsIDE2LCBm
YWxzZSwgdHJ1ZSk7CisgICAgICAgIHF2aXJ0cXVldWVfYWRkKHF0cywgdnEsIHJlcV9hZGRyICsg
MTYsIHNpemVvZihkd3pfaGRyKSwgZmFsc2UsIHRydWUpOworICAgICAgICBxdmlydHF1ZXVlX2Fk
ZChxdHMsIHZxLCByZXFfYWRkciArIDE2ICsgc2l6ZW9mKGR3el9oZHIpLCAxLCB0cnVlLAorICAg
ICAgICAgICAgICAgICAgICAgICBmYWxzZSk7CisKKyAgICAgICAgcXZpcnRxdWV1ZV9raWNrKHF0
cywgZGV2LCB2cSwgZnJlZV9oZWFkKTsKKworICAgICAgICBxdmlydGlvX3dhaXRfdXNlZF9lbGVt
KHF0cywgZGV2LCB2cSwgZnJlZV9oZWFkLCBOVUxMLAorICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIFFWSVJUSU9fQkxLX1RJTUVPVVRfVVMpOworICAgICAgICBzdGF0dXMgPSByZWFkYihy
ZXFfYWRkciArIDE2ICsgc2l6ZW9mKGR3el9oZHIpKTsKKyAgICAgICAgZ19hc3NlcnRfY21waW50
KHN0YXR1cywgPT0sIDApOworCisgICAgICAgIGd1ZXN0X2ZyZWUoYWxsb2MsIHJlcV9hZGRyKTsK
KworICAgICAgICAvKiBSZWFkIHJlcXVlc3QgdG8gY2hlY2sgaWYgdGhlIHNlY3RvciBjb250YWlu
cyBhbGwgemVyb2VzICovCisgICAgICAgIHJlcS50eXBlID0gVklSVElPX0JMS19UX0lOOworICAg
ICAgICByZXEuaW9wcmlvID0gMTsKKyAgICAgICAgcmVxLnNlY3RvciA9IDA7CisgICAgICAgIHJl
cS5kYXRhID0gZ19tYWxsb2MwKDUxMik7CisKKyAgICAgICAgcmVxX2FkZHIgPSB2aXJ0aW9fYmxr
X3JlcXVlc3QoYWxsb2MsIGRldiwgJnJlcSwgNTEyKTsKKworICAgICAgICBnX2ZyZWUocmVxLmRh
dGEpOworCisgICAgICAgIGZyZWVfaGVhZCA9IHF2aXJ0cXVldWVfYWRkKHF0cywgdnEsIHJlcV9h
ZGRyLCAxNiwgZmFsc2UsIHRydWUpOworICAgICAgICBxdmlydHF1ZXVlX2FkZChxdHMsIHZxLCBy
ZXFfYWRkciArIDE2LCA1MTIsIHRydWUsIHRydWUpOworICAgICAgICBxdmlydHF1ZXVlX2FkZChx
dHMsIHZxLCByZXFfYWRkciArIDUyOCwgMSwgdHJ1ZSwgZmFsc2UpOworCisgICAgICAgIHF2aXJ0
cXVldWVfa2ljayhxdHMsIGRldiwgdnEsIGZyZWVfaGVhZCk7CisKKyAgICAgICAgcXZpcnRpb193
YWl0X3VzZWRfZWxlbShxdHMsIGRldiwgdnEsIGZyZWVfaGVhZCwgTlVMTCwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBRVklSVElPX0JMS19USU1FT1VUX1VTKTsKKyAgICAgICAgc3Rh
dHVzID0gcmVhZGIocmVxX2FkZHIgKyA1MjgpOworICAgICAgICBnX2Fzc2VydF9jbXBpbnQoc3Rh
dHVzLCA9PSwgMCk7CisKKyAgICAgICAgZGF0YSA9IGdfbWFsbG9jKDUxMik7CisgICAgICAgIGV4
cGVjdGVkID0gZ19tYWxsb2MwKDUxMik7CisgICAgICAgIHF0ZXN0X21lbXJlYWQocXRzLCByZXFf
YWRkciArIDE2LCBkYXRhLCA1MTIpOworICAgICAgICBnX2Fzc2VydF9jbXBtZW0oZGF0YSwgNTEy
LCBleHBlY3RlZCwgNTEyKTsKKyAgICAgICAgZ19mcmVlKGV4cGVjdGVkKTsKKyAgICAgICAgZ19m
cmVlKGRhdGEpOworCisgICAgICAgIGd1ZXN0X2ZyZWUoYWxsb2MsIHJlcV9hZGRyKTsKKyAgICB9
CisKKyAgICBpZiAoZmVhdHVyZXMgJiAoMXUgPDwgVklSVElPX0JMS19GX0RJU0NBUkQpKSB7Cisg
ICAgICAgIHN0cnVjdCB2aXJ0aW9fYmxrX2Rpc2NhcmRfd3JpdGVfemVyb2VzIGR3el9oZHI7CisK
KyAgICAgICAgcmVxLnR5cGUgPSBWSVJUSU9fQkxLX1RfRElTQ0FSRDsKKyAgICAgICAgcmVxLmRh
dGEgPSAoY2hhciAqKSAmZHd6X2hkcjsKKyAgICAgICAgZHd6X2hkci5zZWN0b3IgPSAwOworICAg
ICAgICBkd3pfaGRyLm51bV9zZWN0b3JzID0gMTsKKyAgICAgICAgZHd6X2hkci5mbGFncyA9IDA7
CisKKyAgICAgICAgdmlydGlvX2Jsa19maXhfZHd6X2hkcihkZXYsICZkd3pfaGRyKTsKKworICAg
ICAgICByZXFfYWRkciA9IHZpcnRpb19ibGtfcmVxdWVzdChhbGxvYywgZGV2LCAmcmVxLCBzaXpl
b2YoZHd6X2hkcikpOworCisgICAgICAgIGZyZWVfaGVhZCA9IHF2aXJ0cXVldWVfYWRkKHF0cywg
dnEsIHJlcV9hZGRyLCAxNiwgZmFsc2UsIHRydWUpOworICAgICAgICBxdmlydHF1ZXVlX2FkZChx
dHMsIHZxLCByZXFfYWRkciArIDE2LCBzaXplb2YoZHd6X2hkciksIGZhbHNlLCB0cnVlKTsKKyAg
ICAgICAgcXZpcnRxdWV1ZV9hZGQocXRzLCB2cSwgcmVxX2FkZHIgKyAxNiArIHNpemVvZihkd3pf
aGRyKSwKKyAgICAgICAgICAgICAgICAgICAgICAgMSwgdHJ1ZSwgZmFsc2UpOworCisgICAgICAg
IHF2aXJ0cXVldWVfa2ljayhxdHMsIGRldiwgdnEsIGZyZWVfaGVhZCk7CisKKyAgICAgICAgcXZp
cnRpb193YWl0X3VzZWRfZWxlbShxdHMsIGRldiwgdnEsIGZyZWVfaGVhZCwgTlVMTCwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBRVklSVElPX0JMS19USU1FT1VUX1VTKTsKKyAgICAg
ICAgc3RhdHVzID0gcmVhZGIocmVxX2FkZHIgKyAxNiArIHNpemVvZihkd3pfaGRyKSk7CisgICAg
ICAgIGdfYXNzZXJ0X2NtcGludChzdGF0dXMsID09LCAwKTsKKworICAgICAgICBndWVzdF9mcmVl
KGFsbG9jLCByZXFfYWRkcik7CisgICAgfQorCisgICAgaWYgKGZlYXR1cmVzICYgKDF1IDw8IFZJ
UlRJT19GX0FOWV9MQVlPVVQpKSB7CisgICAgICAgIC8qIFdyaXRlIGFuZCByZWFkIHdpdGggMiBk
ZXNjcmlwdG9yIGxheW91dCAqLworICAgICAgICAvKiBXcml0ZSByZXF1ZXN0ICovCisgICAgICAg
IHJlcS50eXBlID0gVklSVElPX0JMS19UX09VVDsKKyAgICAgICAgcmVxLmlvcHJpbyA9IDE7Cisg
ICAgICAgIHJlcS5zZWN0b3IgPSAxOworICAgICAgICByZXEuZGF0YSA9IGdfbWFsbG9jMCg1MTIp
OworICAgICAgICBzdHJjcHkocmVxLmRhdGEsICJURVNUIik7CisKKyAgICAgICAgcmVxX2FkZHIg
PSB2aXJ0aW9fYmxrX3JlcXVlc3QoYWxsb2MsIGRldiwgJnJlcSwgNTEyKTsKKworICAgICAgICBn
X2ZyZWUocmVxLmRhdGEpOworCisgICAgICAgIGZyZWVfaGVhZCA9IHF2aXJ0cXVldWVfYWRkKHF0
cywgdnEsIHJlcV9hZGRyLCA1MjgsIGZhbHNlLCB0cnVlKTsKKyAgICAgICAgcXZpcnRxdWV1ZV9h
ZGQocXRzLCB2cSwgcmVxX2FkZHIgKyA1MjgsIDEsIHRydWUsIGZhbHNlKTsKKyAgICAgICAgcXZp
cnRxdWV1ZV9raWNrKHF0cywgZGV2LCB2cSwgZnJlZV9oZWFkKTsKKworICAgICAgICBxdmlydGlv
X3dhaXRfdXNlZF9lbGVtKHF0cywgZGV2LCB2cSwgZnJlZV9oZWFkLCBOVUxMLAorICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIFFWSVJUSU9fQkxLX1RJTUVPVVRfVVMpOworICAgICAgICBz
dGF0dXMgPSByZWFkYihyZXFfYWRkciArIDUyOCk7CisgICAgICAgIGdfYXNzZXJ0X2NtcGludChz
dGF0dXMsID09LCAwKTsKKworICAgICAgICBndWVzdF9mcmVlKGFsbG9jLCByZXFfYWRkcik7CisK
KyAgICAgICAgLyogUmVhZCByZXF1ZXN0ICovCisgICAgICAgIHJlcS50eXBlID0gVklSVElPX0JM
S19UX0lOOworICAgICAgICByZXEuaW9wcmlvID0gMTsKKyAgICAgICAgcmVxLnNlY3RvciA9IDE7
CisgICAgICAgIHJlcS5kYXRhID0gZ19tYWxsb2MwKDUxMik7CisKKyAgICAgICAgcmVxX2FkZHIg
PSB2aXJ0aW9fYmxrX3JlcXVlc3QoYWxsb2MsIGRldiwgJnJlcSwgNTEyKTsKKworICAgICAgICBn
X2ZyZWUocmVxLmRhdGEpOworCisgICAgICAgIGZyZWVfaGVhZCA9IHF2aXJ0cXVldWVfYWRkKHF0
cywgdnEsIHJlcV9hZGRyLCAxNiwgZmFsc2UsIHRydWUpOworICAgICAgICBxdmlydHF1ZXVlX2Fk
ZChxdHMsIHZxLCByZXFfYWRkciArIDE2LCA1MTMsIHRydWUsIGZhbHNlKTsKKworICAgICAgICBx
dmlydHF1ZXVlX2tpY2socXRzLCBkZXYsIHZxLCBmcmVlX2hlYWQpOworCisgICAgICAgIHF2aXJ0
aW9fd2FpdF91c2VkX2VsZW0ocXRzLCBkZXYsIHZxLCBmcmVlX2hlYWQsIE5VTEwsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgUVZJUlRJT19CTEtfVElNRU9VVF9VUyk7CisgICAgICAg
IHN0YXR1cyA9IHJlYWRiKHJlcV9hZGRyICsgNTI4KTsKKyAgICAgICAgZ19hc3NlcnRfY21waW50
KHN0YXR1cywgPT0sIDApOworCisgICAgICAgIGRhdGEgPSBnX21hbGxvYzAoNTEyKTsKKyAgICAg
ICAgcXRlc3RfbWVtcmVhZChxdHMsIHJlcV9hZGRyICsgMTYsIGRhdGEsIDUxMik7CisgICAgICAg
IGdfYXNzZXJ0X2NtcHN0cihkYXRhLCA9PSwgIlRFU1QiKTsKKyAgICAgICAgZ19mcmVlKGRhdGEp
OworCisgICAgICAgIGd1ZXN0X2ZyZWUoYWxsb2MsIHJlcV9hZGRyKTsKKyAgICB9CisKKyAgICBy
ZXR1cm4gdnE7Cit9CisKK3N0YXRpYyB2b2lkIGJhc2ljKHZvaWQgKm9iaiwgdm9pZCAqZGF0YSwg
UUd1ZXN0QWxsb2NhdG9yICp0X2FsbG9jKQoreworICAgIFFWaG9zdFVzZXJCbGsgKmJsa19pZiA9
IG9iajsKKyAgICBRVmlydFF1ZXVlICp2cTsKKworICAgIHZxID0gdGVzdF9iYXNpYyhibGtfaWYt
PnZkZXYsIHRfYWxsb2MpOworICAgIHF2aXJ0cXVldWVfY2xlYW51cChibGtfaWYtPnZkZXYtPmJ1
cywgdnEsIHRfYWxsb2MpOworCit9CisKK3N0YXRpYyB2b2lkIGluZGlyZWN0KHZvaWQgKm9iaiwg
dm9pZCAqdV9kYXRhLCBRR3Vlc3RBbGxvY2F0b3IgKnRfYWxsb2MpCit7CisgICAgUVZpcnRRdWV1
ZSAqdnE7CisgICAgUVZob3N0VXNlckJsayAqYmxrX2lmID0gb2JqOworICAgIFFWaXJ0aW9EZXZp
Y2UgKmRldiA9IGJsa19pZi0+dmRldjsKKyAgICBRVmlydGlvQmxrUmVxIHJlcTsKKyAgICBRVlJp
bmdJbmRpcmVjdERlc2MgKmluZGlyZWN0OworICAgIHVpbnQ2NF90IHJlcV9hZGRyOworICAgIHVp
bnQ2NF90IGNhcGFjaXR5OworICAgIHVpbnQ2NF90IGZlYXR1cmVzOworICAgIHVpbnQzMl90IGZy
ZWVfaGVhZDsKKyAgICB1aW50OF90IHN0YXR1czsKKyAgICBjaGFyICpkYXRhOworICAgIFFUZXN0
U3RhdGUgKnF0cyA9IGdsb2JhbF9xdGVzdDsKKworICAgIGZlYXR1cmVzID0gcXZpcnRpb19nZXRf
ZmVhdHVyZXMoZGV2KTsKKyAgICBnX2Fzc2VydF9jbXBoZXgoZmVhdHVyZXMgJiAoMXUgPDwgVklS
VElPX1JJTkdfRl9JTkRJUkVDVF9ERVNDKSwgIT0sIDApOworICAgIGZlYXR1cmVzID0gZmVhdHVy
ZXMgJiB+KFFWSVJUSU9fRl9CQURfRkVBVFVSRSB8CisgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgKDF1IDw8IFZJUlRJT19SSU5HX0ZfRVZFTlRfSURYKSB8CisgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgKDF1IDw8IFZJUlRJT19CTEtfRl9TQ1NJKSk7CisgICAgcXZpcnRpb19zZXRfZmVh
dHVyZXMoZGV2LCBmZWF0dXJlcyk7CisKKyAgICBjYXBhY2l0eSA9IHF2aXJ0aW9fY29uZmlnX3Jl
YWRxKGRldiwgMCk7CisgICAgZ19hc3NlcnRfY21waW50KGNhcGFjaXR5LCA9PSwgVEVTVF9JTUFH
RV9TSVpFIC8gNTEyKTsKKworICAgIHZxID0gcXZpcnRxdWV1ZV9zZXR1cChkZXYsIHRfYWxsb2Ms
IDApOworICAgIHF2aXJ0aW9fc2V0X2RyaXZlcl9vayhkZXYpOworCisgICAgLyogV3JpdGUgcmVx
dWVzdCAqLworICAgIHJlcS50eXBlID0gVklSVElPX0JMS19UX09VVDsKKyAgICByZXEuaW9wcmlv
ID0gMTsKKyAgICByZXEuc2VjdG9yID0gMDsKKyAgICByZXEuZGF0YSA9IGdfbWFsbG9jMCg1MTIp
OworICAgIHN0cmNweShyZXEuZGF0YSwgIlRFU1QiKTsKKworICAgIHJlcV9hZGRyID0gdmlydGlv
X2Jsa19yZXF1ZXN0KHRfYWxsb2MsIGRldiwgJnJlcSwgNTEyKTsKKworICAgIGdfZnJlZShyZXEu
ZGF0YSk7CisKKyAgICBpbmRpcmVjdCA9IHF2cmluZ19pbmRpcmVjdF9kZXNjX3NldHVwKHF0cywg
ZGV2LCB0X2FsbG9jLCAyKTsKKyAgICBxdnJpbmdfaW5kaXJlY3RfZGVzY19hZGQoZGV2LCBxdHMs
IGluZGlyZWN0LCByZXFfYWRkciwgNTI4LCBmYWxzZSk7CisgICAgcXZyaW5nX2luZGlyZWN0X2Rl
c2NfYWRkKGRldiwgcXRzLCBpbmRpcmVjdCwgcmVxX2FkZHIgKyA1MjgsIDEsIHRydWUpOworICAg
IGZyZWVfaGVhZCA9IHF2aXJ0cXVldWVfYWRkX2luZGlyZWN0KHF0cywgdnEsIGluZGlyZWN0KTsK
KyAgICBxdmlydHF1ZXVlX2tpY2socXRzLCBkZXYsIHZxLCBmcmVlX2hlYWQpOworCisgICAgcXZp
cnRpb193YWl0X3VzZWRfZWxlbShxdHMsIGRldiwgdnEsIGZyZWVfaGVhZCwgTlVMTCwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgIFFWSVJUSU9fQkxLX1RJTUVPVVRfVVMpOworICAgIHN0YXR1
cyA9IHJlYWRiKHJlcV9hZGRyICsgNTI4KTsKKyAgICBnX2Fzc2VydF9jbXBpbnQoc3RhdHVzLCA9
PSwgMCk7CisKKyAgICBnX2ZyZWUoaW5kaXJlY3QpOworICAgIGd1ZXN0X2ZyZWUodF9hbGxvYywg
cmVxX2FkZHIpOworCisgICAgLyogUmVhZCByZXF1ZXN0ICovCisgICAgcmVxLnR5cGUgPSBWSVJU
SU9fQkxLX1RfSU47CisgICAgcmVxLmlvcHJpbyA9IDE7CisgICAgcmVxLnNlY3RvciA9IDA7Cisg
ICAgcmVxLmRhdGEgPSBnX21hbGxvYzAoNTEyKTsKKyAgICBzdHJjcHkocmVxLmRhdGEsICJURVNU
Iik7CisKKyAgICByZXFfYWRkciA9IHZpcnRpb19ibGtfcmVxdWVzdCh0X2FsbG9jLCBkZXYsICZy
ZXEsIDUxMik7CisKKyAgICBnX2ZyZWUocmVxLmRhdGEpOworCisgICAgaW5kaXJlY3QgPSBxdnJp
bmdfaW5kaXJlY3RfZGVzY19zZXR1cChxdHMsIGRldiwgdF9hbGxvYywgMik7CisgICAgcXZyaW5n
X2luZGlyZWN0X2Rlc2NfYWRkKGRldiwgcXRzLCBpbmRpcmVjdCwgcmVxX2FkZHIsIDE2LCBmYWxz
ZSk7CisgICAgcXZyaW5nX2luZGlyZWN0X2Rlc2NfYWRkKGRldiwgcXRzLCBpbmRpcmVjdCwgcmVx
X2FkZHIgKyAxNiwgNTEzLCB0cnVlKTsKKyAgICBmcmVlX2hlYWQgPSBxdmlydHF1ZXVlX2FkZF9p
bmRpcmVjdChxdHMsIHZxLCBpbmRpcmVjdCk7CisgICAgcXZpcnRxdWV1ZV9raWNrKHF0cywgZGV2
LCB2cSwgZnJlZV9oZWFkKTsKKworICAgIHF2aXJ0aW9fd2FpdF91c2VkX2VsZW0ocXRzLCBkZXYs
IHZxLCBmcmVlX2hlYWQsIE5VTEwsCisgICAgICAgICAgICAgICAgICAgICAgICAgICBRVklSVElP
X0JMS19USU1FT1VUX1VTKTsKKyAgICBzdGF0dXMgPSByZWFkYihyZXFfYWRkciArIDUyOCk7Cisg
ICAgZ19hc3NlcnRfY21waW50KHN0YXR1cywgPT0sIDApOworCisgICAgZGF0YSA9IGdfbWFsbG9j
MCg1MTIpOworICAgIHF0ZXN0X21lbXJlYWQocXRzLCByZXFfYWRkciArIDE2LCBkYXRhLCA1MTIp
OworICAgIGdfYXNzZXJ0X2NtcHN0cihkYXRhLCA9PSwgIlRFU1QiKTsKKyAgICBnX2ZyZWUoZGF0
YSk7CisKKyAgICBnX2ZyZWUoaW5kaXJlY3QpOworICAgIGd1ZXN0X2ZyZWUodF9hbGxvYywgcmVx
X2FkZHIpOworICAgIHF2aXJ0cXVldWVfY2xlYW51cChkZXYtPmJ1cywgdnEsIHRfYWxsb2MpOwor
fQorCitzdGF0aWMgdm9pZCBpZHgodm9pZCAqb2JqLCB2b2lkICp1X2RhdGEsIFFHdWVzdEFsbG9j
YXRvciAqdF9hbGxvYykKK3sKKyAgICBRVmlydFF1ZXVlICp2cTsKKyAgICBRVmhvc3RVc2VyQmxr
UENJICpibGsgPSBvYmo7CisgICAgUVZpcnRpb1BDSURldmljZSAqcGRldiA9ICZibGstPnBjaV92
ZGV2OworICAgIFFWaXJ0aW9EZXZpY2UgKmRldiA9ICZwZGV2LT52ZGV2OworICAgIFFWaXJ0aW9C
bGtSZXEgcmVxOworICAgIHVpbnQ2NF90IHJlcV9hZGRyOworICAgIHVpbnQ2NF90IGNhcGFjaXR5
OworICAgIHVpbnQ2NF90IGZlYXR1cmVzOworICAgIHVpbnQzMl90IGZyZWVfaGVhZDsKKyAgICB1
aW50MzJfdCB3cml0ZV9oZWFkOworICAgIHVpbnQzMl90IGRlc2NfaWR4OworICAgIHVpbnQ4X3Qg
c3RhdHVzOworICAgIGNoYXIgKmRhdGE7CisgICAgUU9TR3JhcGhPYmplY3QgKmJsa19vYmplY3Qg
PSBvYmo7CisgICAgUVBDSURldmljZSAqcGNpX2RldiA9IGJsa19vYmplY3QtPmdldF9kcml2ZXIo
YmxrX29iamVjdCwgInBjaS1kZXZpY2UiKTsKKyAgICBRVGVzdFN0YXRlICpxdHMgPSBnbG9iYWxf
cXRlc3Q7CisKKyAgICBpZiAocXBjaV9jaGVja19idWdneV9tc2kocGNpX2RldikpIHsKKyAgICAg
ICAgcmV0dXJuOworICAgIH0KKworICAgIHFwY2lfbXNpeF9lbmFibGUocGRldi0+cGRldik7Cisg
ICAgcXZpcnRpb19wY2lfc2V0X21zaXhfY29uZmlndXJhdGlvbl92ZWN0b3IocGRldiwgdF9hbGxv
YywgMCk7CisKKyAgICBmZWF0dXJlcyA9IHF2aXJ0aW9fZ2V0X2ZlYXR1cmVzKGRldik7CisgICAg
ZmVhdHVyZXMgPSBmZWF0dXJlcyAmIH4oUVZJUlRJT19GX0JBRF9GRUFUVVJFIHwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAoMXUgPDwgVklSVElPX1JJTkdfRl9JTkRJUkVDVF9ERVNDKSB8
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgKDF1IDw8IFZJUlRJT19GX05PVElGWV9PTl9F
TVBUWSkgfAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICgxdSA8PCBWSVJUSU9fQkxLX0Zf
U0NTSSkpOworICAgIHF2aXJ0aW9fc2V0X2ZlYXR1cmVzKGRldiwgZmVhdHVyZXMpOworCisgICAg
Y2FwYWNpdHkgPSBxdmlydGlvX2NvbmZpZ19yZWFkcShkZXYsIDApOworICAgIGdfYXNzZXJ0X2Nt
cGludChjYXBhY2l0eSwgPT0sIFRFU1RfSU1BR0VfU0laRSAvIDUxMik7CisKKyAgICB2cSA9IHF2
aXJ0cXVldWVfc2V0dXAoZGV2LCB0X2FsbG9jLCAwKTsKKyAgICBxdmlydHF1ZXVlX3BjaV9tc2l4
X3NldHVwKHBkZXYsIChRVmlydFF1ZXVlUENJICopdnEsIHRfYWxsb2MsIDEpOworCisgICAgcXZp
cnRpb19zZXRfZHJpdmVyX29rKGRldik7CisKKyAgICAvKiBXcml0ZSByZXF1ZXN0ICovCisgICAg
cmVxLnR5cGUgPSBWSVJUSU9fQkxLX1RfT1VUOworICAgIHJlcS5pb3ByaW8gPSAxOworICAgIHJl
cS5zZWN0b3IgPSAwOworICAgIHJlcS5kYXRhID0gZ19tYWxsb2MwKDUxMik7CisgICAgc3RyY3B5
KHJlcS5kYXRhLCAiVEVTVCIpOworCisgICAgcmVxX2FkZHIgPSB2aXJ0aW9fYmxrX3JlcXVlc3Qo
dF9hbGxvYywgZGV2LCAmcmVxLCA1MTIpOworCisgICAgZ19mcmVlKHJlcS5kYXRhKTsKKworICAg
IGZyZWVfaGVhZCA9IHF2aXJ0cXVldWVfYWRkKHF0cywgdnEsIHJlcV9hZGRyLCAxNiwgZmFsc2Us
IHRydWUpOworICAgIHF2aXJ0cXVldWVfYWRkKHF0cywgdnEsIHJlcV9hZGRyICsgMTYsIDUxMiwg
ZmFsc2UsIHRydWUpOworICAgIHF2aXJ0cXVldWVfYWRkKHF0cywgdnEsIHJlcV9hZGRyICsgNTI4
LCAxLCB0cnVlLCBmYWxzZSk7CisgICAgcXZpcnRxdWV1ZV9raWNrKHF0cywgZGV2LCB2cSwgZnJl
ZV9oZWFkKTsKKworICAgIHF2aXJ0aW9fd2FpdF91c2VkX2VsZW0ocXRzLCBkZXYsIHZxLCBmcmVl
X2hlYWQsIE5VTEwsCisgICAgICAgICAgICAgICAgICAgICAgICAgICBRVklSVElPX0JMS19USU1F
T1VUX1VTKTsKKworICAgIC8qIFdyaXRlIHJlcXVlc3QgKi8KKyAgICByZXEudHlwZSA9IFZJUlRJ
T19CTEtfVF9PVVQ7CisgICAgcmVxLmlvcHJpbyA9IDE7CisgICAgcmVxLnNlY3RvciA9IDE7Cisg
ICAgcmVxLmRhdGEgPSBnX21hbGxvYzAoNTEyKTsKKyAgICBzdHJjcHkocmVxLmRhdGEsICJURVNU
Iik7CisKKyAgICByZXFfYWRkciA9IHZpcnRpb19ibGtfcmVxdWVzdCh0X2FsbG9jLCBkZXYsICZy
ZXEsIDUxMik7CisKKyAgICBnX2ZyZWUocmVxLmRhdGEpOworCisgICAgLyogTm90aWZ5IGFmdGVy
IHByb2Nlc3NpbmcgdGhlIHRoaXJkIHJlcXVlc3QgKi8KKyAgICBxdmlydHF1ZXVlX3NldF91c2Vk
X2V2ZW50KHF0cywgdnEsIDIpOworICAgIGZyZWVfaGVhZCA9IHF2aXJ0cXVldWVfYWRkKHF0cywg
dnEsIHJlcV9hZGRyLCAxNiwgZmFsc2UsIHRydWUpOworICAgIHF2aXJ0cXVldWVfYWRkKHF0cywg
dnEsIHJlcV9hZGRyICsgMTYsIDUxMiwgZmFsc2UsIHRydWUpOworICAgIHF2aXJ0cXVldWVfYWRk
KHF0cywgdnEsIHJlcV9hZGRyICsgNTI4LCAxLCB0cnVlLCBmYWxzZSk7CisgICAgcXZpcnRxdWV1
ZV9raWNrKHF0cywgZGV2LCB2cSwgZnJlZV9oZWFkKTsKKyAgICB3cml0ZV9oZWFkID0gZnJlZV9o
ZWFkOworCisgICAgLyogTm8gbm90aWZpY2F0aW9uIGV4cGVjdGVkICovCisgICAgc3RhdHVzID0g
cXZpcnRpb193YWl0X3N0YXR1c19ieXRlX25vX2lzcihxdHMsIGRldiwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZxLCByZXFfYWRkciArIDUyOCwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFFWSVJUSU9fQkxLX1RJTUVP
VVRfVVMpOworICAgIGdfYXNzZXJ0X2NtcGludChzdGF0dXMsID09LCAwKTsKKworICAgIGd1ZXN0
X2ZyZWUodF9hbGxvYywgcmVxX2FkZHIpOworCisgICAgLyogUmVhZCByZXF1ZXN0ICovCisgICAg
cmVxLnR5cGUgPSBWSVJUSU9fQkxLX1RfSU47CisgICAgcmVxLmlvcHJpbyA9IDE7CisgICAgcmVx
LnNlY3RvciA9IDE7CisgICAgcmVxLmRhdGEgPSBnX21hbGxvYzAoNTEyKTsKKworICAgIHJlcV9h
ZGRyID0gdmlydGlvX2Jsa19yZXF1ZXN0KHRfYWxsb2MsIGRldiwgJnJlcSwgNTEyKTsKKworICAg
IGdfZnJlZShyZXEuZGF0YSk7CisKKyAgICBmcmVlX2hlYWQgPSBxdmlydHF1ZXVlX2FkZChxdHMs
IHZxLCByZXFfYWRkciwgMTYsIGZhbHNlLCB0cnVlKTsKKyAgICBxdmlydHF1ZXVlX2FkZChxdHMs
IHZxLCByZXFfYWRkciArIDE2LCA1MTIsIHRydWUsIHRydWUpOworICAgIHF2aXJ0cXVldWVfYWRk
KHF0cywgdnEsIHJlcV9hZGRyICsgNTI4LCAxLCB0cnVlLCBmYWxzZSk7CisKKyAgICBxdmlydHF1
ZXVlX2tpY2socXRzLCBkZXYsIHZxLCBmcmVlX2hlYWQpOworCisgICAgLyogV2UgZ2V0IGp1c3Qg
b25lIG5vdGlmaWNhdGlvbiBmb3IgYm90aCByZXF1ZXN0cyAqLworICAgIHF2aXJ0aW9fd2FpdF91
c2VkX2VsZW0ocXRzLCBkZXYsIHZxLCB3cml0ZV9oZWFkLCBOVUxMLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgUVZJUlRJT19CTEtfVElNRU9VVF9VUyk7CisgICAgZ19hc3NlcnQocXZpcnRx
dWV1ZV9nZXRfYnVmKHF0cywgdnEsICZkZXNjX2lkeCwgTlVMTCkpOworICAgIGdfYXNzZXJ0X2Nt
cGludChkZXNjX2lkeCwgPT0sIGZyZWVfaGVhZCk7CisKKyAgICBzdGF0dXMgPSByZWFkYihyZXFf
YWRkciArIDUyOCk7CisgICAgZ19hc3NlcnRfY21waW50KHN0YXR1cywgPT0sIDApOworCisgICAg
ZGF0YSA9IGdfbWFsbG9jMCg1MTIpOworICAgIHF0ZXN0X21lbXJlYWQocXRzLCByZXFfYWRkciAr
IDE2LCBkYXRhLCA1MTIpOworICAgIGdfYXNzZXJ0X2NtcHN0cihkYXRhLCA9PSwgIlRFU1QiKTsK
KyAgICBnX2ZyZWUoZGF0YSk7CisKKyAgICBndWVzdF9mcmVlKHRfYWxsb2MsIHJlcV9hZGRyKTsK
KworICAgIC8qIEVuZCB0ZXN0ICovCisgICAgcXBjaV9tc2l4X2Rpc2FibGUocGRldi0+cGRldik7
CisKKyAgICBxdmlydHF1ZXVlX2NsZWFudXAoZGV2LT5idXMsIHZxLCB0X2FsbG9jKTsKK30KKwor
c3RhdGljIHZvaWQgcGNpX2hvdHBsdWcodm9pZCAqb2JqLCB2b2lkICpkYXRhLCBRR3Vlc3RBbGxv
Y2F0b3IgKnRfYWxsb2MpCit7CisgICAgUVZpcnRpb1BDSURldmljZSAqZGV2MSA9IG9iajsKKyAg
ICBRVmlydGlvUENJRGV2aWNlICpkZXY7CisgICAgUVRlc3RTdGF0ZSAqcXRzID0gZGV2MS0+cGRl
di0+YnVzLT5xdHM7CisKKyAgICAvKiBwbHVnIHNlY29uZGFyeSBkaXNrICovCisgICAgcXRlc3Rf
cW1wX2RldmljZV9hZGQocXRzLCAidmhvc3QtdXNlci1ibGstcGNpIiwgImRydjEiLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICJ7J2FkZHInOiAlcywgJ2NoYXJkZXYnOiAnY2hhcjInfSIsCisg
ICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5naWZ5KFBDSV9TTE9UX0hQKSAiLjAiKTsKKwor
ICAgIGRldiA9IHZpcnRpb19wY2lfbmV3KGRldjEtPnBkZXYtPmJ1cywKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAmKFFQQ0lBZGRyZXNzKSB7IC5kZXZmbiA9IFFQQ0lfREVWRk4oUENJX1NMT1Rf
SFAsIDApCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CisgICAg
Z19hc3NlcnRfbm9ubnVsbChkZXYpOworICAgIGdfYXNzZXJ0X2NtcGludChkZXYtPnZkZXYuZGV2
aWNlX3R5cGUsID09LCBWSVJUSU9fSURfQkxPQ0spOworICAgIHF2aXJ0aW9fcGNpX2RldmljZV9k
aXNhYmxlKGRldik7CisgICAgcW9zX29iamVjdF9kZXN0cm95KChRT1NHcmFwaE9iamVjdCAqKWRl
dik7CisKKyAgICAvKiB1bnBsdWcgc2Vjb25kYXJ5IGRpc2sgKi8KKyAgICBxcGNpX3VucGx1Z19h
Y3BpX2RldmljZV90ZXN0KHF0cywgImRydjEiLCBQQ0lfU0xPVF9IUCk7Cit9CisKKy8qCisgKiBD
aGVjayB0aGF0IHNldHRpbmcgdGhlIHZyaW5nIGFkZHIgb24gYSBub24tZXhpc3RlbnQgdmlydHF1
ZXVlIGRvZXMKKyAqIG5vdCBjcmFzaC4KKyAqLworc3RhdGljIHZvaWQgdGVzdF9ub25leGlzdGVu
dF92aXJ0cXVldWUodm9pZCAqb2JqLCB2b2lkICpkYXRhLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgUUd1ZXN0QWxsb2NhdG9yICp0X2FsbG9jKQoreworICAgIFFWaG9z
dFVzZXJCbGtQQ0kgKmJsayA9IG9iajsKKyAgICBRVmlydGlvUENJRGV2aWNlICpwZGV2ID0gJmJs
ay0+cGNpX3ZkZXY7CisgICAgUVBDSUJhciBiYXIwOworICAgIFFQQ0lEZXZpY2UgKmRldjsKKwor
ICAgIGRldiA9IHFwY2lfZGV2aWNlX2ZpbmQocGRldi0+cGRldi0+YnVzLCBRUENJX0RFVkZOKDQs
IDApKTsKKyAgICBnX2Fzc2VydChkZXYgIT0gTlVMTCk7CisgICAgcXBjaV9kZXZpY2VfZW5hYmxl
KGRldik7CisKKyAgICBiYXIwID0gcXBjaV9pb21hcChkZXYsIDAsIE5VTEwpOworCisgICAgcXBj
aV9pb193cml0ZWIoZGV2LCBiYXIwLCBWSVJUSU9fUENJX1FVRVVFX1NFTCwgMik7CisgICAgcXBj
aV9pb193cml0ZWwoZGV2LCBiYXIwLCBWSVJUSU9fUENJX1FVRVVFX1BGTiwgMSk7CisKKyAgICBn
X2ZyZWUoZGV2KTsKK30KKworc3RhdGljIGNvbnN0IGNoYXIgKnF0ZXN0X3FlbXVfc3RvcmFnZV9k
YWVtb25fYmluYXJ5KHZvaWQpCit7CisgICAgY29uc3QgY2hhciAqcWVtdV9zdG9yYWdlX2RhZW1v
bl9iaW47CisKKyAgICBxZW11X3N0b3JhZ2VfZGFlbW9uX2JpbiA9IGdldGVudigiUVRFU1RfUUVN
VV9TVE9SQUdFX0RBRU1PTl9CSU5BUlkiKTsKKyAgICBpZiAoIXFlbXVfc3RvcmFnZV9kYWVtb25f
YmluKSB7CisgICAgICAgIGZwcmludGYoc3RkZXJyLCAiRW52aXJvbm1lbnQgdmFyaWFibGUgIgor
ICAgICAgICAgICAgICAgICAgICAgICAgIlFURVNUX1FFTVVfU1RPUkFHRV9EQUVNT05fQklOQVJZ
IHJlcXVpcmVkXG4iKTsKKyAgICAgICAgZXhpdCgwKTsKKyAgICB9CisKKyAgICByZXR1cm4gcWVt
dV9zdG9yYWdlX2RhZW1vbl9iaW47Cit9CisKKy8qIGdfdGVzdF9xdWV1ZV9kZXN0cm95KCkgY2xl
YW51cCBmdW5jdGlvbiBmb3IgZmlsZXMgKi8KK3N0YXRpYyB2b2lkIGRlc3Ryb3lfZmlsZSh2b2lk
ICpwYXRoKQoreworICAgIHVubGluayhwYXRoKTsKKyAgICBnX2ZyZWUocGF0aCk7CisgICAgcW9z
X2ludmFsaWRhdGVfY29tbWFuZF9saW5lKCk7Cit9CisKK3N0YXRpYyBjaGFyICpkcml2ZV9jcmVh
dGUodm9pZCkKK3sKKyAgICBpbnQgZmQsIHJldDsKKyAgICAvKiogdmhvc3QtdXNlci1ibGsgd29u
J3QgcmVjb2duaXplIGRyaXZlIGxvY2F0ZWQgaW4gL3RtcCAqLworICAgIGNoYXIgKnRfcGF0aCA9
IGdfc3RyZHVwKCJxdGVzdC5YWFhYWFgiKTsKKworICAgIC8qKiBDcmVhdGUgYSB0ZW1wb3Jhcnkg
cmF3IGltYWdlICovCisgICAgZmQgPSBta3N0ZW1wKHRfcGF0aCk7CisgICAgZ19hc3NlcnRfY21w
aW50KGZkLCA+PSwgMCk7CisgICAgcmV0ID0gZnRydW5jYXRlKGZkLCBURVNUX0lNQUdFX1NJWkUp
OworICAgIGdfYXNzZXJ0X2NtcGludChyZXQsID09LCAwKTsKKyAgICBjbG9zZShmZCk7CisKKyAg
ICBnX3Rlc3RfcXVldWVfZGVzdHJveShkZXN0cm95X2ZpbGUsIHRfcGF0aCk7CisgICAgcmV0dXJu
IHRfcGF0aDsKK30KKworc3RhdGljIGNoYXIgKmNyZWF0ZV9saXN0ZW5fc29ja2V0KGludCAqZmQp
Cit7CisgICAgaW50IHRtcF9mZDsKKyAgICBjaGFyICpwYXRoOworCisgICAgLyogTm8gcmFjZSBi
ZWNhdXNlIG91ciBwaWQgbWFrZXMgdGhlIHBhdGggdW5pcXVlICovCisgICAgcGF0aCA9IGdfc3Ry
ZHVwX3ByaW50ZigiL3RtcC9xdGVzdC0lZC1zb2NrLlhYWFhYWCIsIGdldHBpZCgpKTsKKyAgICB0
bXBfZmQgPSBta3N0ZW1wKHBhdGgpOworICAgIGdfYXNzZXJ0X2NtcGludCh0bXBfZmQsID49LCAw
KTsKKyAgICBjbG9zZSh0bXBfZmQpOworICAgIHVubGluayhwYXRoKTsKKworICAgICpmZCA9IHF0
ZXN0X3NvY2tldF9zZXJ2ZXIocGF0aCk7CisgICAgZ190ZXN0X3F1ZXVlX2Rlc3Ryb3koZGVzdHJv
eV9maWxlLCBwYXRoKTsKKyAgICByZXR1cm4gcGF0aDsKK30KKworLyoKKyAqIGdfdGVzdF9xdWV1
ZV9kZXN0cm95KCkgYW5kIHF0ZXN0X2FkZF9hYnJ0X2hhbmRsZXIoKSBjbGVhbnVwIGZ1bmN0aW9u
IGZvcgorICogcWVtdS1zdG9yYWdlLWRhZW1vbi4KKyAqLworc3RhdGljIHZvaWQgcXVpdF9zdG9y
YWdlX2RhZW1vbih2b2lkICpkYXRhKQoreworICAgIFFlbXVTdG9yYWdlRGFlbW9uU3RhdGUgKnFz
ZCA9IGRhdGE7CisgICAgaW50IHdzdGF0dXM7CisgICAgcGlkX3QgcGlkOworCisgICAgLyoKKyAg
ICAgKiBJZiB3ZSB3ZXJlIGludm9rZWQgYXMgYSBnX3Rlc3RfcXVldWVfZGVzdHJveSgpIGNsZWFu
dXAgZnVuY3Rpb24gd2UgbmVlZAorICAgICAqIHRvIHJlbW92ZSB0aGUgYWJydCBoYW5kbGVyIHRv
IGF2b2lkIGJlaW5nIGNhbGxlZCBhZ2FpbiBpZiB0aGUgY29kZSBiZWxvdworICAgICAqIGFib3J0
cy4gQWxzbywgd2UgbXVzdCBub3QgbGVhdmUgdGhlIGFicnQgaGFuZGxlciBpbnN0YWxsZWQgYWZ0
ZXIKKyAgICAgKiBjbGVhbnVwLgorICAgICAqLworICAgIHF0ZXN0X3JlbW92ZV9hYnJ0X2hhbmRs
ZXIoZGF0YSk7CisKKyAgICAvKiBCZWZvcmUgcXVpdHRpbmcgc3RvcmFnZS1kYWVtb24sIHF1aXQg
cWVtdSB0byBhdm9pZCBkdWJpb3VzIG1lc3NhZ2VzICovCisgICAgcXRlc3Rfa2lsbF9xZW11KGds
b2JhbF9xdGVzdCk7CisKKyAgICBraWxsKHFzZC0+cGlkLCBTSUdURVJNKTsKKyAgICBwaWQgPSB3
YWl0cGlkKHFzZC0+cGlkLCAmd3N0YXR1cywgMCk7CisgICAgZ19hc3NlcnRfY21waW50KHBpZCwg
PT0sIHFzZC0+cGlkKTsKKyAgICBpZiAoIVdJRkVYSVRFRCh3c3RhdHVzKSkgeworICAgICAgICBm
cHJpbnRmKHN0ZGVyciwgIiVzOiBleHBlY3RlZCBxZW11LXN0b3JhZ2UtZGFlbW9uIHRvIGV4aXRc
biIsCisgICAgICAgICAgICAgICAgX19mdW5jX18pOworICAgICAgICBhYm9ydCgpOworICAgIH0K
KyAgICBpZiAoV0VYSVRTVEFUVVMod3N0YXR1cykgIT0gMCkgeworICAgICAgICBmcHJpbnRmKHN0
ZGVyciwgIiVzOiBleHBlY3RlZCBxZW11LXN0b3JhZ2UtZGFlbW9uIHRvIGV4aXQgIgorICAgICAg
ICAgICAgICAgICJzdWNjZXNzZnVsbHksIGdvdCAlZFxuIiwKKyAgICAgICAgICAgICAgICBfX2Z1
bmNfXywgV0VYSVRTVEFUVVMod3N0YXR1cykpOworICAgICAgICBhYm9ydCgpOworICAgIH0KKwor
ICAgIGdfZnJlZShkYXRhKTsKK30KKworc3RhdGljIHZvaWQgc3RhcnRfdmhvc3RfdXNlcl9ibGso
R1N0cmluZyAqY21kX2xpbmUsIGludCB2dXNfaW5zdGFuY2VzKQoreworICAgIGNvbnN0IGNoYXIg
KnZob3N0X3VzZXJfYmxrX2JpbiA9IHF0ZXN0X3FlbXVfc3RvcmFnZV9kYWVtb25fYmluYXJ5KCk7
CisgICAgaW50IGk7CisgICAgZ2NoYXIgKmltZ19wYXRoOworICAgIEdTdHJpbmcgKnN0b3JhZ2Vf
ZGFlbW9uX2NvbW1hbmQgPSBnX3N0cmluZ19uZXcoTlVMTCk7CisgICAgUWVtdVN0b3JhZ2VEYWVt
b25TdGF0ZSAqcXNkOworCisgICAgZ19zdHJpbmdfYXBwZW5kX3ByaW50ZihzdG9yYWdlX2RhZW1v
bl9jb21tYW5kLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgImV4ZWMgJXMgIiwKKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgIHZob3N0X3VzZXJfYmxrX2Jpbik7CisKKyAgICBnX3N0cmlu
Z19hcHBlbmRfcHJpbnRmKGNtZF9saW5lLAorICAgICAgICAgICAgIiAtb2JqZWN0IG1lbW9yeS1i
YWNrZW5kLW1lbWZkLGlkPW1lbSxzaXplPTI1Nk0sc2hhcmU9b24gIgorICAgICAgICAgICAgIiAt
TSBtZW1vcnktYmFja2VuZD1tZW0gIik7CisKKyAgICBmb3IgKGkgPSAwOyBpIDwgdnVzX2luc3Rh
bmNlczsgaSsrKSB7CisgICAgICAgIGludCBmZDsKKyAgICAgICAgY2hhciAqc29ja19wYXRoID0g
Y3JlYXRlX2xpc3Rlbl9zb2NrZXQoJmZkKTsKKworICAgICAgICAvKiBjcmVhdGUgaW1hZ2UgZmls
ZSAqLworICAgICAgICBpbWdfcGF0aCA9IGRyaXZlX2NyZWF0ZSgpOworICAgICAgICBnX3N0cmlu
Z19hcHBlbmRfcHJpbnRmKHN0b3JhZ2VfZGFlbW9uX2NvbW1hbmQsCisgICAgICAgICAgICAiLS1i
bG9ja2RldiBkcml2ZXI9ZmlsZSxub2RlLW5hbWU9ZGlzayVkLGZpbGVuYW1lPSVzICIKKyAgICAg
ICAgICAgICItLWV4cG9ydCB0eXBlPXZob3N0LXVzZXItYmxrLGlkPWRpc2slZCxhZGRyLnR5cGU9
dW5peCxhZGRyLnBhdGg9JXMsIgorICAgICAgICAgICAgIm5vZGUtbmFtZT1kaXNrJWksd3JpdGFi
bGU9b24gIiwKKyAgICAgICAgICAgIGksIGltZ19wYXRoLCBpLCBzb2NrX3BhdGgsIGkpOworCisg
ICAgICAgIGdfc3RyaW5nX2FwcGVuZF9wcmludGYoY21kX2xpbmUsICItY2hhcmRldiBzb2NrZXQs
aWQ9Y2hhciVkLHBhdGg9JXMgIiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpICsg
MSwgc29ja19wYXRoKTsKKyAgICB9CisKKyAgICBnX3Rlc3RfbWVzc2FnZSgic3RhcnRpbmcgdmhv
c3QtdXNlciBiYWNrZW5kOiAlcyIsCisgICAgICAgICAgICAgICAgICAgc3RvcmFnZV9kYWVtb25f
Y29tbWFuZC0+c3RyKTsKKyAgICBwaWRfdCBwaWQgPSBmb3JrKCk7CisgICAgaWYgKHBpZCA9PSAw
KSB7CisgICAgICAgIC8qCisgICAgICAgICAqIENsb3NlIHN0YW5kYXJkIGZpbGUgZGVzY3JpcHRv
cnMgc28gdGFwLWRyaXZlci5wbCBwaXBlIGRldGVjdHMgd2hlbgorICAgICAgICAgKiBvdXIgcGFy
ZW50IHRlcm1pbmF0ZXMuCisgICAgICAgICAqLworICAgICAgICBjbG9zZSgwKTsKKyAgICAgICAg
Y2xvc2UoMSk7CisgICAgICAgIG9wZW4oIi9kZXYvbnVsbCIsIE9fUkRPTkxZKTsKKyAgICAgICAg
b3BlbigiL2Rldi9udWxsIiwgT19XUk9OTFkpOworCisgICAgICAgIGV4ZWNscCgiL2Jpbi9zaCIs
ICJzaCIsICItYyIsIHN0b3JhZ2VfZGFlbW9uX2NvbW1hbmQtPnN0ciwgTlVMTCk7CisgICAgICAg
IGV4aXQoMSk7CisgICAgfQorICAgIGdfc3RyaW5nX2ZyZWUoc3RvcmFnZV9kYWVtb25fY29tbWFu
ZCwgdHJ1ZSk7CisKKyAgICBxc2QgPSBnX25ldyhRZW11U3RvcmFnZURhZW1vblN0YXRlLCAxKTsK
KyAgICBxc2QtPnBpZCA9IHBpZDsKKworICAgIC8qIE1ha2Ugc3VyZSBxZW11LXN0b3JhZ2UtZGFl
bW9uIGlzIHN0b3BwZWQgKi8KKyAgICBxdGVzdF9hZGRfYWJydF9oYW5kbGVyKHF1aXRfc3RvcmFn
ZV9kYWVtb24sIHFzZCk7CisgICAgZ190ZXN0X3F1ZXVlX2Rlc3Ryb3kocXVpdF9zdG9yYWdlX2Rh
ZW1vbiwgcXNkKTsKK30KKworc3RhdGljIHZvaWQgKnZob3N0X3VzZXJfYmxrX3Rlc3Rfc2V0dXAo
R1N0cmluZyAqY21kX2xpbmUsIHZvaWQgKmFyZykKK3sKKyAgICBzdGFydF92aG9zdF91c2VyX2Js
ayhjbWRfbGluZSwgMSk7CisgICAgcmV0dXJuIGFyZzsKK30KKworLyoKKyAqIFNldHVwIGZvciBo
b3RwbHVnLgorICoKKyAqIFNpbmNlIHZob3N0LXVzZXIgc2VydmVyIG9ubHkgc2VydmVzIG9uZSB2
aG9zdC11c2VyIGNsaWVudCBvbmUgdGltZSwKKyAqIGFub3RoZXIgZXhwcm90CisgKgorICovCitz
dGF0aWMgdm9pZCAqdmhvc3RfdXNlcl9ibGtfaG90cGx1Z190ZXN0X3NldHVwKEdTdHJpbmcgKmNt
ZF9saW5lLCB2b2lkICphcmcpCit7CisgICAgLyogIi1jaGFyZGV2IHNvY2tldCxpZD1jaGFyMiIg
aXMgdXNlZCBmb3IgcGNpX2hvdHBsdWcqLworICAgIHN0YXJ0X3Zob3N0X3VzZXJfYmxrKGNtZF9s
aW5lLCAyKTsKKyAgICByZXR1cm4gYXJnOworfQorCitzdGF0aWMgdm9pZCByZWdpc3Rlcl92aG9z
dF91c2VyX2Jsa190ZXN0KHZvaWQpCit7CisgICAgUU9TR3JhcGhUZXN0T3B0aW9ucyBvcHRzID0g
eworICAgICAgICAuYmVmb3JlID0gdmhvc3RfdXNlcl9ibGtfdGVzdF9zZXR1cCwKKyAgICB9Owor
CisgICAgLyoKKyAgICAgKiB0ZXN0cyBmb3Igdmhvc3QtdXNlci1ibGsgYW5kIHZob3N0LXVzZXIt
YmxrLXBjaQorICAgICAqIFRoZSB0ZXN0cyBhcmUgYm9ycm93ZWQgZnJvbSB0ZXN0cy92aXJ0aW8t
YmxrLXRlc3QuYy4gQnV0IHNvbWUgdGVzdHMKKyAgICAgKiByZWdhcmRpbmcgYmxvY2tfcmVzaXpl
IGRvbid0IHdvcmsgZm9yIHZob3N0LXVzZXItYmxrLgorICAgICAqIHZob3N0LXVzZXItYmxrIGRl
dmljZSBkb2Vzbid0IGhhdmUgLWRyaXZlLCBzbyB0ZXN0cyBjb250YWluaW5nCisgICAgICogYmxv
Y2tfcmVzaXplIGFyZSBhbHNvIGFiYW5kb25lZCwKKyAgICAgKiAgLSBjb25maWcKKyAgICAgKiAg
LSByZXNpemUKKyAgICAgKi8KKyAgICBxb3NfYWRkX3Rlc3QoImJhc2ljIiwgInZob3N0LXVzZXIt
YmxrIiwgYmFzaWMsICZvcHRzKTsKKyAgICBxb3NfYWRkX3Rlc3QoImluZGlyZWN0IiwgInZob3N0
LXVzZXItYmxrIiwgaW5kaXJlY3QsICZvcHRzKTsKKyAgICBxb3NfYWRkX3Rlc3QoImlkeCIsICJ2
aG9zdC11c2VyLWJsay1wY2kiLCBpZHgsICZvcHRzKTsKKyAgICBxb3NfYWRkX3Rlc3QoIm54dmly
dHEiLCAidmhvc3QtdXNlci1ibGstcGNpIiwKKyAgICAgICAgICAgICAgICAgdGVzdF9ub25leGlz
dGVudF92aXJ0cXVldWUsICZvcHRzKTsKKworICAgIG9wdHMuYmVmb3JlID0gdmhvc3RfdXNlcl9i
bGtfaG90cGx1Z190ZXN0X3NldHVwOworICAgIHFvc19hZGRfdGVzdCgiaG90cGx1ZyIsICJ2aG9z
dC11c2VyLWJsay1wY2kiLCBwY2lfaG90cGx1ZywgJm9wdHMpOworfQorCitsaWJxb3NfaW5pdChy
ZWdpc3Rlcl92aG9zdF91c2VyX2Jsa190ZXN0KTsKZGlmZiAtLWdpdCBhL3Rlc3RzL3F0ZXN0L2xp
YnFvcy9tZXNvbi5idWlsZCBiL3Rlc3RzL3F0ZXN0L2xpYnFvcy9tZXNvbi5idWlsZAppbmRleCAx
Y2RkZjViZGFhLi4xZjVjOGYxMDUzIDEwMDY0NAotLS0gYS90ZXN0cy9xdGVzdC9saWJxb3MvbWVz
b24uYnVpbGQKKysrIGIvdGVzdHMvcXRlc3QvbGlicW9zL21lc29uLmJ1aWxkCkBAIC0zMiw2ICsz
Miw3IEBAIGxpYnFvc19zcmNzID0gZmlsZXMoJy4uL2xpYnF0ZXN0LmMnLAogICAgICAgICAndmly
dGlvLTlwLmMnLAogICAgICAgICAndmlydGlvLWJhbGxvb24uYycsCiAgICAgICAgICd2aXJ0aW8t
YmxrLmMnLAorICAgICAgICAndmhvc3QtdXNlci1ibGsuYycsCiAgICAgICAgICd2aXJ0aW8tbW1p
by5jJywKICAgICAgICAgJ3ZpcnRpby1uZXQuYycsCiAgICAgICAgICd2aXJ0aW8tcGNpLmMnLApk
aWZmIC0tZ2l0IGEvdGVzdHMvcXRlc3QvbWVzb24uYnVpbGQgYi90ZXN0cy9xdGVzdC9tZXNvbi5i
dWlsZAppbmRleCBjMTlmMWM4NTAzLi4zOWFmMWNkZGM0IDEwMDY0NAotLS0gYS90ZXN0cy9xdGVz
dC9tZXNvbi5idWlsZAorKysgYi90ZXN0cy9xdGVzdC9tZXNvbi5idWlsZApAQCAtMTk5LDYgKzE5
OSw5IEBAIHFvc190ZXN0X3NzLmFkZCgKICkKIHFvc190ZXN0X3NzLmFkZCh3aGVuOiAnQ09ORklH
X1ZJUlRGUycsIGlmX3RydWU6IGZpbGVzKCd2aXJ0aW8tOXAtdGVzdC5jJykpCiBxb3NfdGVzdF9z
cy5hZGQod2hlbjogJ0NPTkZJR19WSE9TVF9VU0VSJywgaWZfdHJ1ZTogZmlsZXMoJ3Zob3N0LXVz
ZXItdGVzdC5jJykpCitpZiBoYXZlX3Zob3N0X3VzZXJfYmxrX3NlcnZlcgorICBxb3NfdGVzdF9z
cy5hZGQoZmlsZXMoJ3Zob3N0LXVzZXItYmxrLXRlc3QuYycpKQorZW5kaWYKIAogdHBtZW11X2Zp
bGVzID0gWyd0cG0tZW11LmMnLCAndHBtLXV0aWwuYycsICd0cG0tdGVzdHMuYyddCiAKQEAgLTIz
Nyw2ICsyNDAsNyBAQCBmb3JlYWNoIGRpciA6IHRhcmdldF9kaXJzCiAgIGVuZGlmCiAgIHF0ZXN0
X2Vudi5zZXQoJ0dfVEVTVF9EQlVTX0RBRU1PTicsIG1lc29uLnNvdXJjZV9yb290KCkgLyAndGVz
dHMvZGJ1cy12bXN0YXRlLWRhZW1vbi5zaCcpCiAgIHF0ZXN0X2Vudi5zZXQoJ1FURVNUX1FFTVVf
QklOQVJZJywgJy4vcWVtdS1zeXN0ZW0tJyArIHRhcmdldF9iYXNlKQorICBxdGVzdF9lbnYuc2V0
KCdRVEVTVF9RRU1VX1NUT1JBR0VfREFFTU9OX0JJTkFSWScsICcuL3N0b3JhZ2UtZGFlbW9uL3Fl
bXUtc3RvcmFnZS1kYWVtb24nKQogICAKICAgZm9yZWFjaCB0ZXN0IDogdGFyZ2V0X3F0ZXN0cwog
ICAgICMgRXhlY3V0YWJsZXMgYXJlIHNoYXJlZCBhY3Jvc3MgdGFyZ2V0cywgZGVjbGFyZSB0aGVt
IG9ubHkgdGhlIGZpcnN0IHRpbWUgd2UKLS0gCjIuMjguMAoK


