Return-Path: <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>
X-Original-To: lists+qemu-devel@lfdr.de
Delivered-To: lists+qemu-devel@lfdr.de
Received: from lists.gnu.org (lists.gnu.org [209.51.188.17])
	by mail.lfdr.de (Postfix) with ESMTPS id 6D5491587B8
	for <lists+qemu-devel@lfdr.de>; Tue, 11 Feb 2020 02:10:16 +0100 (CET)
Received: from localhost ([::1]:41948 helo=lists1p.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.90_1)
	(envelope-from <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>)
	id 1j1K47-00052q-Ct
	for lists+qemu-devel@lfdr.de; Mon, 10 Feb 2020 20:10:15 -0500
Received: from eggs.gnu.org ([2001:470:142:3::10]:34792)
 by lists.gnu.org with esmtp (Exim 4.90_1)
 (envelope-from <tsimpson@qualcomm.com>) id 1j1Jd4-0002xv-VK
 for qemu-devel@nongnu.org; Mon, 10 Feb 2020 19:42:22 -0500
Received: from Debian-exim by eggs.gnu.org with spam-scanned (Exim 4.71)
 (envelope-from <tsimpson@qualcomm.com>) id 1j1Jcz-00041u-Ok
 for qemu-devel@nongnu.org; Mon, 10 Feb 2020 19:42:18 -0500
Received: from alexa-out-sd-01.qualcomm.com ([199.106.114.38]:3651)
 by eggs.gnu.org with esmtps (TLS1.0:RSA_AES_256_CBC_SHA1:32)
 (Exim 4.71) (envelope-from <tsimpson@qualcomm.com>)
 id 1j1Jcy-0004uE-Ut
 for qemu-devel@nongnu.org; Mon, 10 Feb 2020 19:42:13 -0500
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=quicinc.com; i=@quicinc.com; q=dns/txt; s=qcdkim;
 t=1581381732; x=1612917732;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=DSmHUEyfhElVVB/rw79PuA1edaI8Rn7rLFRXvHNpaac=;
 b=pmd54W06gmPrpsiGV4nRq9lVGJFU3kS/cicrhWAafioibHDYbOnATIzR
 TLO9eUlCBi9zpa2e3sAUMt2C8QVR2MhDuUYNwnAw9ZIcQbw8J7YtZTz5k
 1ablJqyClXgipoaYp6jQfJVBpF0RQmx1dxtdyorOemskjcTHj1DM4SEhI 4=;
Received: from unknown (HELO ironmsg01-sd.qualcomm.com) ([10.53.140.141])
 by alexa-out-sd-01.qualcomm.com with ESMTP; 10 Feb 2020 16:41:04 -0800
Received: from vu-tsimpson-aus.qualcomm.com (HELO
 vu-tsimpson1-aus.qualcomm.com) ([10.222.150.1])
 by ironmsg01-sd.qualcomm.com with ESMTP; 10 Feb 2020 16:41:03 -0800
Received: by vu-tsimpson1-aus.qualcomm.com (Postfix, from userid 47164)
 id 562B61B42; Mon, 10 Feb 2020 18:41:03 -0600 (CST)
From: Taylor Simpson <tsimpson@quicinc.com>
To: qemu-devel@nongnu.org
Subject: [RFC PATCH 59/66] Hexagon HVX instruction decoding
Date: Mon, 10 Feb 2020 18:40:37 -0600
Message-Id: <1581381644-13678-60-git-send-email-tsimpson@quicinc.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1581381644-13678-1-git-send-email-tsimpson@quicinc.com>
References: <1581381644-13678-1-git-send-email-tsimpson@quicinc.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
X-detected-operating-system: by eggs.gnu.org: FreeBSD 9.x [fuzzy]
X-Received-From: 199.106.114.38
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <https://lists.nongnu.org/archive/html/qemu-devel>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Cc: riku.voipio@iki.fi, richard.henderson@linaro.org, laurent@vivier.eu,
 Taylor Simpson <tsimpson@quicinc.com>, philmd@redhat.com,
 aleksandar.m.mail@gmail.com
Errors-To: qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org
Sender: "Qemu-devel" <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>

U2lnbmVkLW9mZi1ieTogVGF5bG9yIFNpbXBzb24gPHRzaW1wc29uQHF1aWNpbmMuY29tPgotLS0K
IHRhcmdldC9oZXhhZ29uL2RlY29kZS5jICAgICAgICAgICAgICAgICB8ICAyMyArLQogdGFyZ2V0
L2hleGFnb24vbW12ZWMvZGVjb2RlX2V4dF9tbXZlYy5jIHwgNjczICsrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrCiB0YXJnZXQvaGV4YWdvbi9tbXZlYy9kZWNvZGVfZXh0X21tdmVjLmgg
fCAgMjQgKysKIHRhcmdldC9oZXhhZ29uL3E2dl9kZWNvZGUuYyAgICAgICAgICAgICB8ICAxNCAr
CiA0IGZpbGVzIGNoYW5nZWQsIDczMiBpbnNlcnRpb25zKCspLCAyIGRlbGV0aW9ucygtKQogY3Jl
YXRlIG1vZGUgMTAwNjQ0IHRhcmdldC9oZXhhZ29uL21tdmVjL2RlY29kZV9leHRfbW12ZWMuYwog
Y3JlYXRlIG1vZGUgMTAwNjQ0IHRhcmdldC9oZXhhZ29uL21tdmVjL2RlY29kZV9leHRfbW12ZWMu
aAoKZGlmZiAtLWdpdCBhL3RhcmdldC9oZXhhZ29uL2RlY29kZS5jIGIvdGFyZ2V0L2hleGFnb24v
ZGVjb2RlLmMKaW5kZXggNGQ3NGEyNS4uOGMzNjY3YyAxMDA2NDQKLS0tIGEvdGFyZ2V0L2hleGFn
b24vZGVjb2RlLmMKKysrIGIvdGFyZ2V0L2hleGFnb24vZGVjb2RlLmMKQEAgLTI4LDYgKzI4LDgg
QEAKICNpbmNsdWRlICJpbnNuLmgiCiAjaW5jbHVkZSAibWFjcm9zLmgiCiAjaW5jbHVkZSAicHJp
bnRpbnNuLmgiCisjaW5jbHVkZSAibW12ZWMvbW12ZWMuaCIKKyNpbmNsdWRlICJtbXZlYy9kZWNv
ZGVfZXh0X21tdmVjLmgiCiAKIGVudW0gewogICAgIEVYVF9JRFhfbm9leHQgPSAwLApAQCAtMTUy
LDYgKzE1NCw5IEBAIHN0YXRpYyB2b2lkIGRlY29kZV9leHRfaW5pdCh2b2lkKQogICAgIGZvciAo
aSA9IEVYVF9JRFhfbm9leHQ7IGkgPCBFWFRfSURYX25vZXh0X0FGVEVSOyBpKyspIHsKICAgICAg
ICAgZXh0X3RyZWVzW2ldID0gJmRlY3RyZWVfdGFibGVfREVDT0RFX0VYVF9FWFRfbm9leHQ7CiAg
ICAgfQorICAgIGZvciAoaSA9IEVYVF9JRFhfbW12ZWM7IGkgPCBFWFRfSURYX21tdmVjX0FGVEVS
OyBpKyspIHsKKyAgICAgICAgZXh0X3RyZWVzW2ldID0gJmRlY3RyZWVfdGFibGVfREVDT0RFX0VY
VF9FWFRfbW12ZWM7CisgICAgfQogfQogCiB0eXBlZGVmIHN0cnVjdCB7CkBAIC00NDksNiArNDU0
LDkgQEAgc3RhdGljIGludCBkZWNvZGVfc2V0X2luc25fYXR0cl9maWVsZHMocGFja2V0X3QgKnBr
dCkKIAogICAgICAgICBpZiAoR0VUX0FUVFJJQihvcGNvZGUsIEFfU1RPUkUpKSB7CiAgICAgICAg
ICAgICBwa3QtPmluc25baV0uaXNfc3RvcmUgPSAxOworICAgICAgICAgICAgaWYgKEdFVF9BVFRS
SUIob3Bjb2RlLCBBX1ZNRU0pKSB7CisgICAgICAgICAgICAgICAgcGt0LT5pbnNuW2ldLmlzX3Zt
ZW1fc3QgPSAxOworICAgICAgICAgICAgfQogCiAgICAgICAgICAgICBpZiAocGt0LT5pbnNuW2ld
LnNsb3QgPT0gMCkgewogICAgICAgICAgICAgICAgIHBrdC0+cGt0X2hhc19zdG9yZV9zMCA9IDE7
CkBAIC00NjEsNiArNDY5LDkgQEAgc3RhdGljIGludCBkZWNvZGVfc2V0X2luc25fYXR0cl9maWVs
ZHMocGFja2V0X3QgKnBrdCkKICAgICAgICAgfQogICAgICAgICBpZiAoR0VUX0FUVFJJQihvcGNv
ZGUsIEFfTE9BRCkpIHsKICAgICAgICAgICAgIHBrdC0+aW5zbltpXS5pc19sb2FkID0gMTsKKyAg
ICAgICAgICAgIGlmIChHRVRfQVRUUklCKG9wY29kZSwgQV9WTUVNKSkgIHsKKyAgICAgICAgICAg
ICAgICBwa3QtPmluc25baV0uaXNfdm1lbV9sZCA9IDE7CisgICAgICAgICAgICB9CiAKICAgICAg
ICAgICAgIGlmIChwa3QtPmluc25baV0uc2xvdCA9PSAwKSB7CiAgICAgICAgICAgICAgICAgcGt0
LT5wa3RfaGFzX2xvYWRfczAgPSAxOwpAQCAtNDY4LDYgKzQ3OSwxMCBAQCBzdGF0aWMgaW50IGRl
Y29kZV9zZXRfaW5zbl9hdHRyX2ZpZWxkcyhwYWNrZXRfdCAqcGt0KQogICAgICAgICAgICAgICAg
IHBrdC0+cGt0X2hhc19sb2FkX3MxID0gMTsKICAgICAgICAgICAgIH0KICAgICAgICAgfQorICAg
ICAgICBpZiAoR0VUX0FUVFJJQihvcGNvZGUsIEFfQ1ZJX0dBVEhFUikgfHwKKyAgICAgICAgICAg
IEdFVF9BVFRSSUIob3Bjb2RlLCBBX0NWSV9TQ0FUVEVSKSkgeworICAgICAgICAgICAgcGt0LT5p
bnNuW2ldLmlzX3NjYXRnYXRoID0gMTsKKyAgICAgICAgfQogICAgICAgICBpZiAoR0VUX0FUVFJJ
QihvcGNvZGUsIEFfTUVNT1ApKSB7CiAgICAgICAgICAgICBwa3QtPmluc25baV0uaXNfbWVtb3Ag
PSAxOwogICAgICAgICB9CkBAIC03NDEsOCArNzU2LDEyIEBAIHN0YXRpYyBpbnQgZGVjb2RlX3Jl
bW92ZV9leHRlbmRlcnMocGFja2V0X3QgKnBhY2tldCkKIHN0YXRpYyBjb25zdCBjaGFyICoKIGdl
dF92YWxpZF9zbG90X3N0cihjb25zdCBwYWNrZXRfdCAqcGt0LCB1bnNpZ25lZCBpbnQgc2xvdCkK
IHsKLSAgICByZXR1cm4gZmluZF9pY2xhc3Nfc2xvdHMocGt0LT5pbnNuW3Nsb3RdLm9wY29kZSwK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGt0LT5pbnNuW3Nsb3RdLmljbGFzcyk7Cisg
ICAgaWYgKEdFVF9BVFRSSUIocGt0LT5pbnNuW3Nsb3RdLm9wY29kZSwgQV9FWFRFTlNJT04pKSB7
CisgICAgICAgIHJldHVybiBtbXZlY19leHRfZGVjb2RlX2ZpbmRfaWNsYXNzX3Nsb3RzKHBrdC0+
aW5zbltzbG90XS5vcGNvZGUpOworICAgIH0gZWxzZSB7CisgICAgICAgIHJldHVybiBmaW5kX2lj
bGFzc19zbG90cyhwa3QtPmluc25bc2xvdF0ub3Bjb2RlLAorICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgcGt0LT5pbnNuW3Nsb3RdLmljbGFzcyk7CisgICAgfQogfQogCiAjaW5jbHVk
ZSAicTZ2X2RlY29kZS5jIgpkaWZmIC0tZ2l0IGEvdGFyZ2V0L2hleGFnb24vbW12ZWMvZGVjb2Rl
X2V4dF9tbXZlYy5jIGIvdGFyZ2V0L2hleGFnb24vbW12ZWMvZGVjb2RlX2V4dF9tbXZlYy5jCm5l
dyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAuLmY3MjMwNDEKLS0tIC9kZXYvbnVsbAor
KysgYi90YXJnZXQvaGV4YWdvbi9tbXZlYy9kZWNvZGVfZXh0X21tdmVjLmMKQEAgLTAsMCArMSw2
NzMgQEAKKy8qCisgKiAgQ29weXJpZ2h0IChjKSAyMDE5IFF1YWxjb21tIElubm92YXRpb24gQ2Vu
dGVyLCBJbmMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCisgKgorICogIFRoaXMgcHJvZ3JhbSBpcyBm
cmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5CisgKiAg
aXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBw
dWJsaXNoZWQgYnkKKyAqICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVy
c2lvbiAyIG9mIHRoZSBMaWNlbnNlLCBvcgorICogIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVy
IHZlcnNpb24uCisgKgorICogIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9w
ZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAorICogIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsg
d2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCisgKiAgTUVSQ0hBTlRBQklMSVRZ
IG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQorICogIEdOVSBH
ZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCisgKgorICogIFlvdSBzaG91
bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNl
CisgKiAgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW07IGlmIG5vdCwgc2VlIDxodHRwOi8vd3d3Lmdu
dS5vcmcvbGljZW5zZXMvPi4KKyAqLworCisjaW5jbHVkZSAicWVtdS9vc2RlcC5oIgorI2luY2x1
ZGUgPHN0ZGxpYi5oPgorI2luY2x1ZGUgPHN0cmluZy5oPgorI2luY2x1ZGUgPGN0eXBlLmg+Cisj
aW5jbHVkZSAiZGVjb2RlLmgiCisjaW5jbHVkZSAib3Bjb2Rlcy5oIgorI2luY2x1ZGUgImluc24u
aCIKKyNpbmNsdWRlICJwcmludGluc24uaCIKKyNpbmNsdWRlICJtbXZlYy9tbXZlYy5oIgorI2lu
Y2x1ZGUgIm1tdmVjL2RlY29kZV9leHRfbW12ZWMuaCIKKwordHlwZWRlZiBlbnVtIGh2eF9yZXNv
dXJjZSB7CisgICAgSFZYX1JFU09VUkNFX0xPQUQgICAgPSAwLAorICAgIEhWWF9SRVNPVVJDRV9T
VE9SRSAgID0gMSwKKyAgICBIVlhfUkVTT1VSQ0VfUEVSTSAgICA9IDIsCisgICAgSFZYX1JFU09V
UkNFX1NISUZUICAgPSAzLAorICAgIEhWWF9SRVNPVVJDRV9NUFkwICAgID0gNCwKKyAgICBIVlhf
UkVTT1VSQ0VfTVBZMSAgICA9IDUsCisgICAgSFZYX1JFU09VUkNFX1pSICAgICAgPSA2LAorICAg
IEhWWF9SRVNPVVJDRV9aVyAgICAgID0gNworfSBodnhfcmVzb3VyY2VfdDsKKworI2RlZmluZSBG
UkVFICAgIDEKKyNkZWZpbmUgVVNFRCAgICAwCisKK3N0YXRpYyBpbnQKK2NoZWNrX2R2X2luc3Ry
dWN0aW9uKGh2eF9yZXNvdXJjZV90ICpyZXNvdXJjZXMsIGludCAqaWxpc3QsCisgICAgICAgICAg
ICAgICAgICAgICBpbnQgbnVtX2luc24sIHBhY2tldF90ICpwYWNrZXQsIHVuc2lnbmVkIGludCBh
dHRyaWJ1dGUsCisgICAgICAgICAgICAgICAgICAgICBodnhfcmVzb3VyY2VfdCByZXNvdXJjZTAs
IGh2eF9yZXNvdXJjZV90IHJlc291cmNlMSkKK3sKKworICAgIGludCBjdXJyZW50X2luc24gPSAw
OworICAgIC8qIExvb3Agb24gdmVjdG9yIGluc3RydWN0aW9uIGNvdW50ICovCisgICAgZm9yIChj
dXJyZW50X2luc24gPSAwOyBjdXJyZW50X2luc24gPCBudW1faW5zbjsgY3VycmVudF9pbnNuKysp
IHsKKyAgICAgICAgLyogdmFsaWQgaW5zdHJ1Y3Rpb24gKi8KKyAgICAgICAgaWYgKGlsaXN0W2N1
cnJlbnRfaW5zbl0gPiAtMSkgeworICAgICAgICAgICAgaW50IG9wY29kZSA9IHBhY2tldC0+aW5z
bltpbGlzdFtjdXJyZW50X2luc25dXS5vcGNvZGU7CisgICAgICAgICAgICBpZiAoR0VUX0FUVFJJ
QihvcGNvZGUsIGF0dHJpYnV0ZSkpIHsKKyAgICAgICAgICAgICAgICAvKiBOZWVkcyB0d28gYXZh
aWxhYmxlIHJlc291cmNlcyAqLworICAgICAgICAgICAgICAgIGlmICgocmVzb3VyY2VzW3Jlc291
cmNlMF0gKyByZXNvdXJjZXNbcmVzb3VyY2UxXSkgPT0gMiAqIEZSRUUpIHsKKyAgICAgICAgICAg
ICAgICAgICAgcmVzb3VyY2VzW3Jlc291cmNlMF0gPSBVU0VEOworICAgICAgICAgICAgICAgICAg
ICByZXNvdXJjZXNbcmVzb3VyY2UxXSA9IFVTRUQ7CisgICAgICAgICAgICAgICAgICAgIHBhY2tl
dC0+aW5zbltpbGlzdFtjdXJyZW50X2luc25dXS5odnhfcmVzb3VyY2UgfD0KKyAgICAgICAgICAg
ICAgICAgICAgICAgICgxIDw8IHJlc291cmNlMCk7CisgICAgICAgICAgICAgICAgICAgIHBhY2tl
dC0+aW5zbltpbGlzdFtjdXJyZW50X2luc25dXS5odnhfcmVzb3VyY2UgfD0KKyAgICAgICAgICAg
ICAgICAgICAgICAgICgxIDw8IHJlc291cmNlMSk7CisgICAgICAgICAgICAgICAgfSBlbHNlIHsK
KyAgICAgICAgICAgICAgICAgICAgZ19hc3NlcnRfbm90X3JlYWNoZWQoKTsKKyAgICAgICAgICAg
ICAgICB9CisgICAgICAgICAgICAgICAgaWxpc3RbY3VycmVudF9pbnNuXSA9IC0xOyAgICAgLyog
UmVtb3ZlIEluc3RydWN0aW9uICovCisgICAgICAgICAgICB9CisgICAgICAgIH0KKyAgICB9Cisg
ICAgcmV0dXJuIDA7Cit9CisKKy8qIERvdWJsZSBWZWN0b3IgaW5zdHJ1Y3Rpb25zIHRoYXQgY2Fu
IHVzZSBhbnkgb25lIG9mIHNwZWNpZmljIG9yIGJvdGggcGFpcnMgKi8KK3N0YXRpYyBpbnQKK2No
ZWNrX2R2X2luc3RydWN0aW9uMihodnhfcmVzb3VyY2VfdCAqcmVzb3VyY2VzLCBpbnQgKmlsaXN0
LAorICAgICAgICAgICAgICAgICAgICAgIGludCBudW1faW5zbiwgcGFja2V0X3QgKnBhY2tldCwg
dW5zaWduZWQgaW50IGF0dHJpYnV0ZSwKKyAgICAgICAgICAgICAgICAgICAgICBodnhfcmVzb3Vy
Y2VfdCByZXNvdXJjZTAsIGh2eF9yZXNvdXJjZV90IHJlc291cmNlMSwKKyAgICAgICAgICAgICAg
ICAgICAgICBodnhfcmVzb3VyY2VfdCByZXNvdXJjZTIsIGh2eF9yZXNvdXJjZV90IHJlc291cmNl
MykKK3sKKworICAgIGludCBjdXJyZW50X2luc24gPSAwOworICAgIC8qIExvb3Agb24gdmVjdG9y
IGluc3RydWN0aW9uIGNvdW50ICovCisgICAgZm9yIChjdXJyZW50X2luc24gPSAwOyBjdXJyZW50
X2luc24gPCBudW1faW5zbjsgY3VycmVudF9pbnNuKyspIHsKKyAgICAgICAgLyogdmFsaWQgaW5z
dHJ1Y3Rpb24gKi8KKyAgICAgICAgaWYgKGlsaXN0W2N1cnJlbnRfaW5zbl0gPiAtMSkgeworICAg
ICAgICAgICAgaW50IG9wY29kZSA9IHBhY2tldC0+aW5zbltpbGlzdFtjdXJyZW50X2luc25dXS5v
cGNvZGU7CisgICAgICAgICAgICBpZiAoR0VUX0FUVFJJQihvcGNvZGUsIGF0dHJpYnV0ZSkpIHsK
KyAgICAgICAgICAgICAgICAvKiBOZWVkcyB0d28gYXZhaWxhYmxlIHJlc291cmNlcyAqLworICAg
ICAgICAgICAgICAgIGlmICgocmVzb3VyY2VzW3Jlc291cmNlMF0gKyByZXNvdXJjZXNbcmVzb3Vy
Y2UxXSkgPT0gMiAqIEZSRUUpIHsKKyAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzW3Jlc291
cmNlMF0gPSBVU0VEOworICAgICAgICAgICAgICAgICAgICByZXNvdXJjZXNbcmVzb3VyY2UxXSA9
IFVTRUQ7CisgICAgICAgICAgICAgICAgICAgIHBhY2tldC0+aW5zbltpbGlzdFtjdXJyZW50X2lu
c25dXS5odnhfcmVzb3VyY2UgfD0KKyAgICAgICAgICAgICAgICAgICAgICAgKDEgPDwgcmVzb3Vy
Y2UwKTsKKyAgICAgICAgICAgICAgICAgICAgcGFja2V0LT5pbnNuW2lsaXN0W2N1cnJlbnRfaW5z
bl1dLmh2eF9yZXNvdXJjZSB8PQorICAgICAgICAgICAgICAgICAgICAgICAoMSA8PCByZXNvdXJj
ZTEpOworICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoKHJlc291cmNlc1tyZXNvdXJjZTJdICsg
cmVzb3VyY2VzW3Jlc291cmNlM10pID09CisgICAgICAgICAgICAgICAgICAgICAgICAgICAyICog
RlJFRSkgeworICAgICAgICAgICAgICAgICAgICByZXNvdXJjZXNbcmVzb3VyY2UyXSA9IFVTRUQ7
CisgICAgICAgICAgICAgICAgICAgIHJlc291cmNlc1tyZXNvdXJjZTNdID0gVVNFRDsKKyAgICAg
ICAgICAgICAgICAgICAgcGFja2V0LT5pbnNuW2lsaXN0W2N1cnJlbnRfaW5zbl1dLmh2eF9yZXNv
dXJjZSB8PQorICAgICAgICAgICAgICAgICAgICAgICAgKDEgPDwgcmVzb3VyY2UwKTsKKyAgICAg
ICAgICAgICAgICAgICAgcGFja2V0LT5pbnNuW2lsaXN0W2N1cnJlbnRfaW5zbl1dLmh2eF9yZXNv
dXJjZSB8PQorICAgICAgICAgICAgICAgICAgICAgICAgKDEgPDwgcmVzb3VyY2UxKTsKKyAgICAg
ICAgICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgICAgICAgICBnX2Fzc2VydF9ub3RfcmVh
Y2hlZCgpOworICAgICAgICAgICAgICAgIH0KKyAgICAgICAgICAgICAgICBpbGlzdFtjdXJyZW50
X2luc25dID0gLTE7ICAgICAvKiBSZW1vdmUgSW5zdHJ1Y3Rpb24gKi8KKyAgICAgICAgICAgIH0K
KyAgICAgICAgfQorICAgIH0KKyAgICByZXR1cm4gMDsKK30KKworc3RhdGljIGludAorY2hlY2tf
dW1lbV9pbnN0cnVjdGlvbihodnhfcmVzb3VyY2VfdCAqcmVzb3VyY2VzLCBpbnQgKmlsaXN0LAor
ICAgICAgICAgICAgICAgICAgICAgICBpbnQgbnVtX2luc24sIHBhY2tldF90ICpwYWNrZXQpCit7
CisKKyAgICBpbnQgY3VycmVudF9pbnNuID0gMDsKKyAgICAvKiBMb29wIG9uIHZlY3RvciBpbnN0
cnVjdGlvbiBjb3VudCAqLworICAgIGZvciAoY3VycmVudF9pbnNuID0gMDsgY3VycmVudF9pbnNu
IDwgbnVtX2luc247IGN1cnJlbnRfaW5zbisrKSB7CisgICAgICAgIC8qIHZhbGlkIGluc3RydWN0
aW9uICovCisgICAgICAgIGlmIChpbGlzdFtjdXJyZW50X2luc25dID4gLTEpIHsKKyAgICAgICAg
ICAgIGludCBvcGNvZGUgPSBwYWNrZXQtPmluc25baWxpc3RbY3VycmVudF9pbnNuXV0ub3Bjb2Rl
OworICAgICAgICAgICAgLyogY2hlY2sgYXR0cmlidXRlICovCisgICAgICAgICAgICBpZiAoR0VU
X0FUVFJJQihvcGNvZGUsIEFfQ1ZJX1ZQKSAmJiBHRVRfQVRUUklCKG9wY29kZSwgQV9DVklfVk0p
KSB7CisgICAgICAgICAgICAgICAgLyogTmVlZHMgdGhyZWUgYXZhaWxhYmxlIHJlc291cmNlcywg
Ym90aCBtZW0gYW5kIHBlcm11dGUgKi8KKyAgICAgICAgICAgICAgICBpZiAoKHJlc291cmNlc1tI
VlhfUkVTT1VSQ0VfTE9BRF0gKworICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzW0hWWF9S
RVNPVVJDRV9TVE9SRV0gKworICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzW0hWWF9SRVNP
VVJDRV9QRVJNXSkgPT0gMyAqIEZSRUUpIHsKKyAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2Vz
W0hWWF9SRVNPVVJDRV9MT0FEXSA9IFVTRUQ7CisgICAgICAgICAgICAgICAgICAgIHJlc291cmNl
c1tIVlhfUkVTT1VSQ0VfU1RPUkVdID0gVVNFRDsKKyAgICAgICAgICAgICAgICAgICAgcmVzb3Vy
Y2VzW0hWWF9SRVNPVVJDRV9QRVJNXSA9IFVTRUQ7CisgICAgICAgICAgICAgICAgICAgIHBhY2tl
dC0+aW5zbltpbGlzdFtjdXJyZW50X2luc25dXS5odnhfcmVzb3VyY2UgfD0KKyAgICAgICAgICAg
ICAgICAgICAgICAgICgxIDw8IEhWWF9SRVNPVVJDRV9MT0FEKTsKKyAgICAgICAgICAgICAgICAg
ICAgcGFja2V0LT5pbnNuW2lsaXN0W2N1cnJlbnRfaW5zbl1dLmh2eF9yZXNvdXJjZSB8PQorICAg
ICAgICAgICAgICAgICAgICAgICAgKDEgPDwgSFZYX1JFU09VUkNFX1NUT1JFKTsKKyAgICAgICAg
ICAgICAgICAgICAgcGFja2V0LT5pbnNuW2lsaXN0W2N1cnJlbnRfaW5zbl1dLmh2eF9yZXNvdXJj
ZSB8PQorICAgICAgICAgICAgICAgICAgICAgICAgKDEgPDwgSFZYX1JFU09VUkNFX1BFUk0pOwor
ICAgICAgICAgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAgICAgICAgICAgIGdfYXNzZXJ0X25v
dF9yZWFjaGVkKCk7CisgICAgICAgICAgICAgICAgfQorCisgICAgICAgICAgICAgICAgaWxpc3Rb
Y3VycmVudF9pbnNuXSA9IC0xOyAgICAgLyogUmVtb3ZlIEluc3RydWN0aW9uICovCisgICAgICAg
ICAgICB9CisgICAgICAgIH0KKyAgICB9CisgICAgcmV0dXJuIDA7Cit9CisKKworLyogTWVtb3J5
IGluc3RydWN0aW9ucyAqLworc3RhdGljIGludAorY2hlY2tfbWVtX2luc3RydWN0aW9uKGh2eF9y
ZXNvdXJjZV90ICpyZXNvdXJjZXMsIGludCAqaWxpc3QsCisgICAgICAgICAgICAgICAgICAgICAg
aW50IG51bV9pbnNuLCBwYWNrZXRfdCAqcGFja2V0KQoreworCisgICAgaW50IGN1cnJlbnRfaW5z
biA9IDA7CisgICAgLyogTG9vcCBvbiB2ZWN0b3IgaW5zdHJ1Y3Rpb24gY291bnQgKi8KKyAgICBm
b3IgKGN1cnJlbnRfaW5zbiA9IDA7IGN1cnJlbnRfaW5zbiA8IG51bV9pbnNuOyBjdXJyZW50X2lu
c24rKykgeworICAgICAgICAvKiB2YWxpZCBpbnN0cnVjdGlvbiAqLworICAgICAgICBpZiAoaWxp
c3RbY3VycmVudF9pbnNuXSA+IC0xKSB7CisgICAgICAgICAgICBpbnQgb3Bjb2RlID0gcGFja2V0
LT5pbnNuW2lsaXN0W2N1cnJlbnRfaW5zbl1dLm9wY29kZTsKKyAgICAgICAgICAgIGlmIChHRVRf
QVRUUklCKG9wY29kZSwgQV9DVklfVk0pKSB7CisgICAgICAgICAgICAgICAgaWYgKEdFVF9BVFRS
SUIob3Bjb2RlLCBBX0xPQUQpKSB7CisgICAgICAgICAgICAgICAgICAgIGlmIChyZXNvdXJjZXNb
SFZYX1JFU09VUkNFX0xPQURdID09IEZSRUUpIHsKKyAgICAgICAgICAgICAgICAgICAgICAgIHJl
c291cmNlc1tIVlhfUkVTT1VSQ0VfTE9BRF0gPSBVU0VEOworICAgICAgICAgICAgICAgICAgICAg
ICAgcGFja2V0LT5pbnNuW2lsaXN0W2N1cnJlbnRfaW5zbl1dLmh2eF9yZXNvdXJjZSB8PQorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICgxIDw8IEhWWF9SRVNPVVJDRV9MT0FEKTsKKyAgICAg
ICAgICAgICAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgICAgICAgICAgICAgIGdfYXNzZXJ0
X25vdF9yZWFjaGVkKCk7CisgICAgICAgICAgICAgICAgICAgIH0KKworICAgICAgICAgICAgICAg
IH0gZWxzZSBpZiAoR0VUX0FUVFJJQihvcGNvZGUsIEFfU1RPUkUpKSB7CisgICAgICAgICAgICAg
ICAgICAgIGlmIChyZXNvdXJjZXNbSFZYX1JFU09VUkNFX1NUT1JFXSA9PSBGUkVFKSB7CisgICAg
ICAgICAgICAgICAgICAgICAgICByZXNvdXJjZXNbSFZYX1JFU09VUkNFX1NUT1JFXSA9IFVTRUQ7
CisgICAgICAgICAgICAgICAgICAgICAgICBwYWNrZXQtPmluc25baWxpc3RbY3VycmVudF9pbnNu
XV0uaHZ4X3Jlc291cmNlIHw9CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgKDEgPDwgSFZY
X1JFU09VUkNFX1NUT1JFKTsKKyAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKKyAgICAgICAg
ICAgICAgICAgICAgICAgIGdfYXNzZXJ0X25vdF9yZWFjaGVkKCk7CisgICAgICAgICAgICAgICAg
ICAgIH0KKyAgICAgICAgICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgICAgICAgICBnX2Fz
c2VydF9ub3RfcmVhY2hlZCgpOworICAgICAgICAgICAgICAgIH0KKworICAgICAgICAgICAgICAg
IC8qIE5vdCBhIGxvYWQgdGVtcCBhbmQgbm90IGEgc3RvcmUgbmV3ICovCisgICAgICAgICAgICAg
ICAgaWYgKCEoR0VUX0FUVFJJQihvcGNvZGUsIEFfQ1ZJX1RNUCkgJiYKKyAgICAgICAgICAgICAg
ICAgICAgICBHRVRfQVRUUklCKG9wY29kZSwgQV9MT0FEKSkgJiYKKyAgICAgICAgICAgICAgICAg
ICAgIShHRVRfQVRUUklCKG9wY29kZSwgQV9DVklfTkVXKSAmJgorICAgICAgICAgICAgICAgICAg
ICAgIEdFVF9BVFRSSUIob3Bjb2RlLCBBX1NUT1JFKSkpIHsKKyAgICAgICAgICAgICAgICAgICAg
LyogR3JhYiBhbnkgb25lIG9mIHRoZSBvdGhlciByZXNvdXJjZXMgKi8KKyAgICAgICAgICAgICAg
ICAgICAgaWYgKHJlc291cmNlc1tIVlhfUkVTT1VSQ0VfUEVSTV0gPT0gRlJFRSkgeworICAgICAg
ICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzW0hWWF9SRVNPVVJDRV9QRVJNXSA9IFVTRUQ7Cisg
ICAgICAgICAgICAgICAgICAgICAgICBwYWNrZXQtPmluc25baWxpc3RbY3VycmVudF9pbnNuXV0u
aHZ4X3Jlc291cmNlIHw9CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgKDEgPDwgSFZYX1JF
U09VUkNFX1BFUk0pOworICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc291cmNlc1tI
VlhfUkVTT1VSQ0VfU0hJRlRdID09IEZSRUUpIHsKKyAgICAgICAgICAgICAgICAgICAgICAgIHJl
c291cmNlc1tIVlhfUkVTT1VSQ0VfU0hJRlRdID0gVVNFRDsKKyAgICAgICAgICAgICAgICAgICAg
ICAgIHBhY2tldC0+aW5zbltpbGlzdFtjdXJyZW50X2luc25dXS5odnhfcmVzb3VyY2UgfD0KKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAoMSA8PCBIVlhfUkVTT1VSQ0VfU0hJRlQpOworICAg
ICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc291cmNlc1tIVlhfUkVTT1VSQ0VfTVBZMF0g
PT0gRlJFRSkgeworICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzW0hWWF9SRVNPVVJD
RV9NUFkwXSA9IFVTRUQ7CisgICAgICAgICAgICAgICAgICAgICAgICBwYWNrZXQtPmluc25baWxp
c3RbY3VycmVudF9pbnNuXV0uaHZ4X3Jlc291cmNlIHw9CisgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgKDEgPDwgSFZYX1JFU09VUkNFX01QWTApOworICAgICAgICAgICAgICAgICAgICB9IGVs
c2UgaWYgKHJlc291cmNlc1tIVlhfUkVTT1VSQ0VfTVBZMV0gPT0gRlJFRSkgeworICAgICAgICAg
ICAgICAgICAgICAgICAgcmVzb3VyY2VzW0hWWF9SRVNPVVJDRV9NUFkxXSA9IFVTRUQ7CisgICAg
ICAgICAgICAgICAgICAgICAgICBwYWNrZXQtPmluc25baWxpc3RbY3VycmVudF9pbnNuXV0uaHZ4
X3Jlc291cmNlIHw9CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgKDEgPDwgSFZYX1JFU09V
UkNFX01QWTEpOworICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgICAg
ICAgICAgICAgZ19hc3NlcnRfbm90X3JlYWNoZWQoKTsKKyAgICAgICAgICAgICAgICAgICAgfQor
ICAgICAgICAgICAgICAgIH0KKyAgICAgICAgICAgICAgICBpbGlzdFtjdXJyZW50X2luc25dID0g
LTE7ICAgICAvKiBSZW1vdmUgSW5zdHJ1Y3Rpb24gKi8KKyAgICAgICAgICAgIH0KKyAgICAgICAg
fQorICAgIH0KKyAgICByZXR1cm4gMDsKK30KKworLyoKKyAqIFNpbmdsZSBWZWN0b3IgaW5zdHJ1
Y3Rpb25zIHRoYXQgY2FuIHVzZSBvbmUsIHR3bywgb3IgZm91ciByZXNvdXJjZXMKKyAqIEluc2Vy
dCBpbnN0cnVjdGlvbiBpbnRvIG9uZSBwb3NzaWJsZSByZXNvdXJjZQorICovCitzdGF0aWMgaW50
CitjaGVja19pbnN0cnVjdGlvbjEoaHZ4X3Jlc291cmNlX3QgKnJlc291cmNlcywgaW50ICppbGlz
dCwKKyAgICAgICAgICAgICAgICAgICBpbnQgbnVtX2luc24sIHBhY2tldF90ICpwYWNrZXQsIHVu
c2lnbmVkIGludCBhdHRyaWJ1dGUsCisgICAgICAgICAgICAgICAgICAgaHZ4X3Jlc291cmNlX3Qg
cmVzb3VyY2UwKQoreworCisgICAgaW50IGN1cnJlbnRfaW5zbiA9IDA7CisgICAgLyogTG9vcCBv
biB2ZWN0b3IgaW5zdHJ1Y3Rpb24gY291bnQgKi8KKyAgICBmb3IgKGN1cnJlbnRfaW5zbiA9IDA7
IGN1cnJlbnRfaW5zbiA8IG51bV9pbnNuOyBjdXJyZW50X2luc24rKykgeworICAgICAgICAvKiB2
YWxpZCBpbnN0cnVjdGlvbiAqLworICAgICAgICBpZiAoaWxpc3RbY3VycmVudF9pbnNuXSA+IC0x
KSB7CisgICAgICAgICAgICBpbnQgb3Bjb2RlID0gcGFja2V0LT5pbnNuW2lsaXN0W2N1cnJlbnRf
aW5zbl1dLm9wY29kZTsKKyAgICAgICAgICAgIGlmIChHRVRfQVRUUklCKG9wY29kZSwgYXR0cmli
dXRlKSkgeworICAgICAgICAgICAgICAgIC8qIE5lZWRzIHR3byBhdmFpbGFibGUgcmVzb3VyY2Vz
ICovCisgICAgICAgICAgICAgICAgaWYgKHJlc291cmNlc1tyZXNvdXJjZTBdID09IEZSRUUpIHsK
KyAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzW3Jlc291cmNlMF0gPSBVU0VEOworICAgICAg
ICAgICAgICAgICAgICBwYWNrZXQtPmluc25baWxpc3RbY3VycmVudF9pbnNuXV0uaHZ4X3Jlc291
cmNlIHw9CisgICAgICAgICAgICAgICAgICAgICAgICAoMSA8PCByZXNvdXJjZTApOworICAgICAg
ICAgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAgICAgICAgICAgIGdfYXNzZXJ0X25vdF9yZWFj
aGVkKCk7CisgICAgICAgICAgICAgICAgfQorCisgICAgICAgICAgICAgICAgaWxpc3RbY3VycmVu
dF9pbnNuXSA9IC0xOyAgICAgLyogUmVtb3ZlIEluc3RydWN0aW9uICovCisgICAgICAgICAgICB9
CisgICAgICAgIH0KKyAgICB9CisgICAgcmV0dXJuIDA7Cit9CisKKy8qIEluc2VydCBpbnN0cnVj
dGlvbiBpbnRvIG9uZSBvZiB0d28gcG9zc2libGUgcmVzb3VyY2UyICovCitzdGF0aWMgaW50Citj
aGVja19pbnN0cnVjdGlvbjIoaHZ4X3Jlc291cmNlX3QgKnJlc291cmNlcywgaW50ICppbGlzdCwK
KyAgICAgICAgICAgICAgICAgICBpbnQgbnVtX2luc24sIHBhY2tldF90ICpwYWNrZXQsIHVuc2ln
bmVkIGludCBhdHRyaWJ1dGUsCisgICAgICAgICAgICAgICAgICAgaHZ4X3Jlc291cmNlX3QgcmVz
b3VyY2UwLCBodnhfcmVzb3VyY2VfdCByZXNvdXJjZTEpCit7CisKKyAgICBpbnQgY3VycmVudF9p
bnNuID0gMDsKKyAgICAvKiBMb29wIG9uIHZlY3RvciBpbnN0cnVjdGlvbiBjb3VudCAqLworICAg
IGZvciAoY3VycmVudF9pbnNuID0gMDsgY3VycmVudF9pbnNuIDwgbnVtX2luc247IGN1cnJlbnRf
aW5zbisrKSB7CisgICAgICAgIC8qIHZhbGlkIGluc3RydWN0aW9uICovCisgICAgICAgIGlmIChp
bGlzdFtjdXJyZW50X2luc25dID4gLTEpIHsKKyAgICAgICAgICAgIGludCBvcGNvZGUgPSBwYWNr
ZXQtPmluc25baWxpc3RbY3VycmVudF9pbnNuXV0ub3Bjb2RlOworICAgICAgICAgICAgaWYgKEdF
VF9BVFRSSUIob3Bjb2RlLCBhdHRyaWJ1dGUpKSB7CisgICAgICAgICAgICAgICAgLyogTmVlZHMg
b25lIG9mIHR3byBwb3NzaWJsZSBhdmFpbGFibGUgcmVzb3VyY2VzICovCisgICAgICAgICAgICAg
ICAgaWYgKHJlc291cmNlc1tyZXNvdXJjZTBdID09IEZSRUUpIHsKKyAgICAgICAgICAgICAgICAg
ICAgcmVzb3VyY2VzW3Jlc291cmNlMF0gPSBVU0VEOworICAgICAgICAgICAgICAgICAgICBwYWNr
ZXQtPmluc25baWxpc3RbY3VycmVudF9pbnNuXV0uaHZ4X3Jlc291cmNlIHw9CisgICAgICAgICAg
ICAgICAgICAgICAgICAoMSA8PCByZXNvdXJjZTApOworICAgICAgICAgICAgICAgIH0gZWxzZSBp
ZiAocmVzb3VyY2VzW3Jlc291cmNlMV0gPT0gRlJFRSkgIHsKKyAgICAgICAgICAgICAgICAgICAg
cmVzb3VyY2VzW3Jlc291cmNlMV0gPSBVU0VEOworICAgICAgICAgICAgICAgICAgICBwYWNrZXQt
Pmluc25baWxpc3RbY3VycmVudF9pbnNuXV0uaHZ4X3Jlc291cmNlIHw9CisgICAgICAgICAgICAg
ICAgICAgICAgICAoMSA8PCByZXNvdXJjZTEpOworICAgICAgICAgICAgICAgIH0gZWxzZSB7Cisg
ICAgICAgICAgICAgICAgICAgIGdfYXNzZXJ0X25vdF9yZWFjaGVkKCk7CisgICAgICAgICAgICAg
ICAgfQorCisgICAgICAgICAgICAgICAgaWxpc3RbY3VycmVudF9pbnNuXSA9IC0xOyAgICAgLyog
UmVtb3ZlIEluc3RydWN0aW9uICovCisgICAgICAgICAgICB9CisgICAgICAgIH0KKyAgICB9Cisg
ICAgcmV0dXJuIDA7Cit9CisKKy8qIEluc2VydCBpbnN0cnVjdGlvbiBpbnRvIG9uZSBvZiA0IGZv
dXIgcG9zc2libGUgcmVzb3VyY2UgKi8KK3N0YXRpYyBpbnQKK2NoZWNrX2luc3RydWN0aW9uNCho
dnhfcmVzb3VyY2VfdCAqcmVzb3VyY2VzLCBpbnQgKmlsaXN0LAorICAgICAgICAgICAgICAgICAg
IGludCBudW1faW5zbiwgcGFja2V0X3QgKnBhY2tldCwgdW5zaWduZWQgaW50IGF0dHJpYnV0ZSwK
KyAgICAgICAgICAgICAgICAgICBodnhfcmVzb3VyY2VfdCByZXNvdXJjZTAsIGh2eF9yZXNvdXJj
ZV90IHJlc291cmNlMSwKKyAgICAgICAgICAgICAgICAgICBodnhfcmVzb3VyY2VfdCByZXNvdXJj
ZTIsIGh2eF9yZXNvdXJjZV90IHJlc291cmNlMykKK3sKKworICAgIGludCBjdXJyZW50X2luc24g
PSAwOworICAgIC8qIExvb3Agb24gdmVjdG9yIGluc3RydWN0aW9uIGNvdW50ICovCisgICAgZm9y
IChjdXJyZW50X2luc24gPSAwOyBjdXJyZW50X2luc24gPCBudW1faW5zbjsgY3VycmVudF9pbnNu
KyspIHsKKyAgICAgICAgLyogdmFsaWQgaW5zdHJ1Y3Rpb24gKi8KKyAgICAgICAgaWYgKGlsaXN0
W2N1cnJlbnRfaW5zbl0gPiAtMSkgeworICAgICAgICAgICAgaW50IG9wY29kZSA9IHBhY2tldC0+
aW5zbltpbGlzdFtjdXJyZW50X2luc25dXS5vcGNvZGU7CisgICAgICAgICAgICBpZiAoR0VUX0FU
VFJJQihvcGNvZGUsIGF0dHJpYnV0ZSkpIHsKKyAgICAgICAgICAgICAgICAvKiBOZWVkcyBvbmUg
b2YgZm91ciBhdmFpbGFibGUgcmVzb3VyY2VzICovCisgICAgICAgICAgICAgICAgaWYgKHJlc291
cmNlc1tyZXNvdXJjZTBdID09IEZSRUUpIHsKKyAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2Vz
W3Jlc291cmNlMF0gPSBVU0VEOworICAgICAgICAgICAgICAgICAgICBwYWNrZXQtPmluc25baWxp
c3RbY3VycmVudF9pbnNuXV0uaHZ4X3Jlc291cmNlIHw9CisgICAgICAgICAgICAgICAgICAgICAg
ICAoMSA8PCByZXNvdXJjZTApOworICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzb3VyY2Vz
W3Jlc291cmNlMV0gPT0gRlJFRSkgeworICAgICAgICAgICAgICAgICAgICByZXNvdXJjZXNbcmVz
b3VyY2UxXSA9IFVTRUQ7CisgICAgICAgICAgICAgICAgICAgIHBhY2tldC0+aW5zbltpbGlzdFtj
dXJyZW50X2luc25dXS5odnhfcmVzb3VyY2UgfD0KKyAgICAgICAgICAgICAgICAgICAgICAgICgx
IDw8IHJlc291cmNlMSk7CisgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNvdXJjZXNbcmVz
b3VyY2UyXSA9PSBGUkVFKSB7CisgICAgICAgICAgICAgICAgICAgIHJlc291cmNlc1tyZXNvdXJj
ZTJdID0gVVNFRDsKKyAgICAgICAgICAgICAgICAgICAgcGFja2V0LT5pbnNuW2lsaXN0W2N1cnJl
bnRfaW5zbl1dLmh2eF9yZXNvdXJjZSB8PQorICAgICAgICAgICAgICAgICAgICAgICAgKDEgPDwg
cmVzb3VyY2UyKTsKKyAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc291cmNlc1tyZXNvdXJj
ZTNdID09IEZSRUUpIHsKKyAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzW3Jlc291cmNlM10g
PSBVU0VEOworICAgICAgICAgICAgICAgICAgICBwYWNrZXQtPmluc25baWxpc3RbY3VycmVudF9p
bnNuXV0uaHZ4X3Jlc291cmNlIHw9CisgICAgICAgICAgICAgICAgICAgICAgICAoMSA8PCByZXNv
dXJjZTMpOworICAgICAgICAgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAgICAgICAgICAgIGdf
YXNzZXJ0X25vdF9yZWFjaGVkKCk7CisgICAgICAgICAgICAgICAgfQorCisgICAgICAgICAgICAg
ICAgaWxpc3RbY3VycmVudF9pbnNuXSA9IC0xOyAgICAgLyogUmVtb3ZlIEluc3RydWN0aW9uICov
CisgICAgICAgICAgICB9CisgICAgICAgIH0KKyAgICB9CisgICAgcmV0dXJuIDA7Cit9CisKK3N0
YXRpYyBpbnQKK2NoZWNrXzRyZXNfaW5zdHJ1Y3Rpb24oaHZ4X3Jlc291cmNlX3QgKnJlc291cmNl
cywgaW50ICppbGlzdCwKKyAgICAgICAgICAgICAgICAgICAgICAgaW50IG51bV9pbnNuLCBwYWNr
ZXRfdCAqcGFja2V0KQoreworCisgICAgaW50IGN1cnJlbnRfaW5zbiA9IDA7CisgICAgZm9yIChj
dXJyZW50X2luc24gPSAwOyBjdXJyZW50X2luc24gPCBudW1faW5zbjsgY3VycmVudF9pbnNuKysp
IHsKKyAgICAgICAgaWYgKGlsaXN0W2N1cnJlbnRfaW5zbl0gPiAtMSkgeworICAgICAgICAgICAg
aW50IG9wY29kZSA9IHBhY2tldC0+aW5zbltpbGlzdFtjdXJyZW50X2luc25dXS5vcGNvZGU7Cisg
ICAgICAgICAgICBpZiAoR0VUX0FUVFJJQihvcGNvZGUsIEFfQ1ZJXzRTTE9UKSkgeworICAgICAg
ICAgICAgICAgIGludCBhdmFpbGFibGVfcmVzb3VyY2UgPQorICAgICAgICAgICAgICAgICAgICAg
ICAgcmVzb3VyY2VzW0hWWF9SRVNPVVJDRV9QRVJNXQorICAgICAgICAgICAgICAgICAgICAgICAg
KyByZXNvdXJjZXNbSFZYX1JFU09VUkNFX1NISUZUXQorICAgICAgICAgICAgICAgICAgICAgICAg
KyByZXNvdXJjZXNbSFZYX1JFU09VUkNFX01QWTBdCisgICAgICAgICAgICAgICAgICAgICAgICAr
IHJlc291cmNlc1tIVlhfUkVTT1VSQ0VfTVBZMV07CisKKyAgICAgICAgICAgICAgICBpZiAoYXZh
aWxhYmxlX3Jlc291cmNlID09IDQgKiBGUkVFKSB7CisgICAgICAgICAgICAgICAgICAgIHJlc291
cmNlc1tIVlhfUkVTT1VSQ0VfUEVSTV0gPSBVU0VEOworICAgICAgICAgICAgICAgICAgICByZXNv
dXJjZXNbSFZYX1JFU09VUkNFX1NISUZUXSA9IFVTRUQ7CisgICAgICAgICAgICAgICAgICAgIHJl
c291cmNlc1tIVlhfUkVTT1VSQ0VfTVBZMF0gPSBVU0VEOworICAgICAgICAgICAgICAgICAgICBy
ZXNvdXJjZXNbSFZYX1JFU09VUkNFX01QWTFdID0gVVNFRDsKKyAgICAgICAgICAgICAgICAgICAg
cGFja2V0LT5pbnNuW2lsaXN0W2N1cnJlbnRfaW5zbl1dLmh2eF9yZXNvdXJjZSB8PQorICAgICAg
ICAgICAgICAgICAgICAgICAgKDEgPDwgSFZYX1JFU09VUkNFX1BFUk0pOworICAgICAgICAgICAg
ICAgICAgICBwYWNrZXQtPmluc25baWxpc3RbY3VycmVudF9pbnNuXV0uaHZ4X3Jlc291cmNlIHw9
CisgICAgICAgICAgICAgICAgICAgICAgICAoMSA8PCBIVlhfUkVTT1VSQ0VfU0hJRlQpOworICAg
ICAgICAgICAgICAgICAgICBwYWNrZXQtPmluc25baWxpc3RbY3VycmVudF9pbnNuXV0uaHZ4X3Jl
c291cmNlIHw9CisgICAgICAgICAgICAgICAgICAgICAgICAoMSA8PCBIVlhfUkVTT1VSQ0VfTVBZ
MCk7CisgICAgICAgICAgICAgICAgICAgIHBhY2tldC0+aW5zbltpbGlzdFtjdXJyZW50X2luc25d
XS5odnhfcmVzb3VyY2UgfD0KKyAgICAgICAgICAgICAgICAgICAgICAgICgxIDw8IEhWWF9SRVNP
VVJDRV9NUFkxKTsKKyAgICAgICAgICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgICAgICAg
ICBnX2Fzc2VydF9ub3RfcmVhY2hlZCgpOworICAgICAgICAgICAgICAgIH0KKworICAgICAgICAg
ICAgICAgIGlsaXN0W2N1cnJlbnRfaW5zbl0gPSAtMTsgICAgIC8qIFJlbW92ZSBJbnN0cnVjdGlv
biAqLworICAgICAgICAgICAgfQorICAgICAgICB9CisKKyAgICB9CisgICAgcmV0dXJuIDA7Cit9
CisKKworc3RhdGljIGludAorZGVjb2RlX3BvcHVsYXRlX2N2aV9yZXNvdXJjZXMocGFja2V0X3Qg
KnBhY2tldCkKK3sKKworICAgIGludCBpLCBudW1faW5zbiA9IDA7CisgICAgaW50IHZsaXN0WzRd
ID0gey0xLCAtMSwgLTEsIC0xfTsKKyAgICBodnhfcmVzb3VyY2VfdCBodnhfcmVzb3VyY2VzWzhd
ID0geworICAgICAgICBGUkVFLAorICAgICAgICBGUkVFLAorICAgICAgICBGUkVFLAorICAgICAg
ICBGUkVFLAorICAgICAgICBGUkVFLAorICAgICAgICBGUkVFLAorICAgICAgICBGUkVFLAorICAg
ICAgICBGUkVFCisgICAgfTsgICAgLyogQWxsIEF2YWlsYWJsZSAqLworICAgIGludCBlcnJvcnMg
PSAwOworCisKKyAgICAvKiBDb3VudCBWZWN0b3IgaW5zdHJ1Y3Rpb25zIGFuZCBjaGVjayBmb3Ig
ZGVwcmVjYXRlZCBvbmVzICovCisgICAgZm9yIChudW1faW5zbiA9IDAsIGkgPSAwOyBpIDwgcGFj
a2V0LT5udW1faW5zbnM7IGkrKykgeworICAgICAgICBpZiAoR0VUX0FUVFJJQihwYWNrZXQtPmlu
c25baV0ub3Bjb2RlLCBBX0NWSSkpIHsKKyAgICAgICAgICAgIHZsaXN0W251bV9pbnNuKytdID0g
aTsKKyAgICAgICAgfQorICAgIH0KKworICAgIC8qIEluc3RydWN0aW9ucyB0aGF0IGNvbnN1bWUg
YWxsIHZlY3RvciByZXNvdXJjZXMgKi8KKyAgICBlcnJvcnMgKz0gY2hlY2tfNHJlc19pbnN0cnVj
dGlvbihodnhfcmVzb3VyY2VzLCB2bGlzdCwgbnVtX2luc24sIHBhY2tldCk7CisgICAgLyogSW5z
ZXJ0IFVuYWxpZ25lZCBNZW1vcnkgQWNjZXNzICovCisgICAgZXJyb3JzICs9IGNoZWNrX3VtZW1f
aW5zdHJ1Y3Rpb24oaHZ4X3Jlc291cmNlcywgdmxpc3QsIG51bV9pbnNuLCBwYWNrZXQpOworCisg
ICAgLyogZG91YmxlIHZlY3RvciBwZXJtdXRlIENvbnN1bWVzIGJvdGggcGVybXV0ZSBhbmQgc2hp
ZnQgcmVzb3VyY2VzICovCisgICAgZXJyb3JzICs9IGNoZWNrX2R2X2luc3RydWN0aW9uKGh2eF9y
ZXNvdXJjZXMsIHZsaXN0LCBudW1faW5zbiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgcGFja2V0LCBBX0NWSV9WUF9WUywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgSFZYX1JFU09VUkNFX1NISUZULCBIVlhfUkVTT1VSQ0VfUEVSTSk7CisgICAgLyogU2lu
Z2xlIHZlY3RvciBwZXJtdXRlIGNhbiBvbmx5IGdvIHRvIHBlcm11dGUgcmVzb3VyY2UgKi8KKyAg
ICBlcnJvcnMgKz0gY2hlY2tfaW5zdHJ1Y3Rpb24xKGh2eF9yZXNvdXJjZXMsIHZsaXN0LCBudW1f
aW5zbiwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhY2tldCwgQV9DVklfVlAs
IEhWWF9SRVNPVVJDRV9QRVJNKTsKKyAgICAvKiBTaW5nbGUgdmVjdG9yIHBlcm11dGUgY2FuIG9u
bHkgZ28gdG8gcGVybXV0ZSByZXNvdXJjZSAqLworICAgIGVycm9ycyArPSBjaGVja19pbnN0cnVj
dGlvbjEoaHZ4X3Jlc291cmNlcywgdmxpc3QsIG51bV9pbnNuLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgcGFja2V0LCBBX0NWSV9WUywgSFZYX1JFU09VUkNFX1NISUZUKTsKKwor
ICAgIC8qIFRyeSB0byBpbnNlcnQgZG91YmxlIHZlY3RvciBtdWx0aXBseSAqLworICAgIGVycm9y
cyArPSBjaGVja19kdl9pbnN0cnVjdGlvbihodnhfcmVzb3VyY2VzLCB2bGlzdCwgbnVtX2luc24s
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhY2tldCwgQV9DVklfVlhfRFYs
CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhWWF9SRVNPVVJDRV9NUFkwLCBI
VlhfUkVTT1VSQ0VfTVBZMSk7CisgICAgLyogVHJ5IHRvIGluc2VydCBkb3VibGUgY2FwYWNpdHkg
bXVsdCAqLworICAgIGVycm9ycyArPSBjaGVja19kdl9pbnN0cnVjdGlvbjIoaHZ4X3Jlc291cmNl
cywgdmxpc3QsIG51bV9pbnNuLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
cGFja2V0LCBBX0NWSV9WU19WWCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
IEhWWF9SRVNPVVJDRV9TSElGVCwgSFZYX1JFU09VUkNFX01QWTAsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBIVlhfUkVTT1VSQ0VfUEVSTSwgSFZYX1JFU09VUkNFX01QWTEp
OworICAgIC8qIFNpbmdsZSB2ZWN0b3IgcGVybXV0ZSBjYW4gb25seSBnbyB0byBwZXJtdXRlIHJl
c291cmNlICovCisgICAgZXJyb3JzICs9IGNoZWNrX2luc3RydWN0aW9uMihodnhfcmVzb3VyY2Vz
LCB2bGlzdCwgbnVtX2luc24sCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWNr
ZXQsIEFfQ1ZJX1ZYLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSFZYX1JFU09V
UkNFX01QWTAsIEhWWF9SRVNPVVJDRV9NUFkxKTsKKyAgICAvKiBUcnkgdG8gaW5zZXJ0IGRvdWJs
ZSB2ZWN0b3IgYWx1ICovCisgICAgZXJyb3JzICs9IGNoZWNrX2R2X2luc3RydWN0aW9uMihodnhf
cmVzb3VyY2VzLCB2bGlzdCwgbnVtX2luc24sCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBwYWNrZXQsIEFfQ1ZJX1ZBX0RWLAorICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgSFZYX1JFU09VUkNFX1NISUZULCBIVlhfUkVTT1VSQ0VfUEVSTSwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhWWF9SRVNPVVJDRV9NUFkwLCBIVlhfUkVTT1VS
Q0VfTVBZMSk7CisKKyAgICBlcnJvcnMgKz0gY2hlY2tfbWVtX2luc3RydWN0aW9uKGh2eF9yZXNv
dXJjZXMsIHZsaXN0LCBudW1faW5zbiwgcGFja2V0KTsKKyAgICAvKiBzaW5nbGUgdmVjdG9yIGFs
dSBjYW4gZ28gb24gYW55IG9mIHRoZSA0IHBpcGVzICovCisgICAgZXJyb3JzICs9IGNoZWNrX2lu
c3RydWN0aW9uNChodnhfcmVzb3VyY2VzLCB2bGlzdCwgbnVtX2luc24sCisgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICBwYWNrZXQsIEFfQ1ZJX1ZBLAorICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgSFZYX1JFU09VUkNFX1NISUZULCBIVlhfUkVTT1VSQ0VfUEVSTSwKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhWWF9SRVNPVVJDRV9NUFkwLCBIVlhfUkVT
T1VSQ0VfTVBZMSk7CisKKyAgICByZXR1cm4gZXJyb3JzOworfQorCisKKworc3RhdGljIGludAor
Y2hlY2tfbmV3X3ZhbHVlKHBhY2tldF90ICpwYWNrZXQpCit7CisgICAgLyogLk5ldyBWYWx1ZSBm
b3IgYSBNTVZlY3RvciBTdG9yZSAqLworICAgIGludCBpLCBqOworICAgIGNvbnN0IGNoYXIgKnJl
Z2luZm87CisgICAgY29uc3QgY2hhciAqZGVzdGxldHRlcnM7CisgICAgY29uc3QgY2hhciAqZHN0
c3RyID0gTlVMTDsKKyAgICBzaXplMnVfdCBkZWZfb3Bjb2RlOworICAgIGNoYXIgbGV0dGVyOwor
ICAgIGludCBkZWZfcmVnbnVtOworCisgICAgZm9yIChpID0gMTsgaSA8IHBhY2tldC0+bnVtX2lu
c25zOyBpKyspIHsKKyAgICAgICAgc2l6ZTJ1X3QgdXNlX29wY29kZSA9IHBhY2tldC0+aW5zbltp
XS5vcGNvZGU7CisgICAgICAgIGlmIChHRVRfQVRUUklCKHVzZV9vcGNvZGUsIEFfRE9UTkVXVkFM
VUUpICYmCisgICAgICAgICAgICBHRVRfQVRUUklCKHVzZV9vcGNvZGUsIEFfQ1ZJKSAmJgorICAg
ICAgICAgICAgR0VUX0FUVFJJQih1c2Vfb3Bjb2RlLCBBX1NUT1JFKSkgeworICAgICAgICAgICAg
aW50IHVzZV9yZWdpZHggPSBzdHJjaHIob3Bjb2RlX3JlZ2luZm9bdXNlX29wY29kZV0sICdzJykg
LQorICAgICAgICAgICAgICAgIG9wY29kZV9yZWdpbmZvW3VzZV9vcGNvZGVdOworICAgICAgICAg
ICAgLyoKKyAgICAgICAgICAgICAqIFdoYXQncyBlbmNvZGVkIGF0IHRoZSBOLWZpZWxkIGlzIHRo
ZSBvZmZzZXQgdG8gd2hvJ3MgcHJvZHVjaW5nCisgICAgICAgICAgICAgKiB0aGUgdmFsdWUuCisg
ICAgICAgICAgICAgKiBTaGlmdCBvZmYgdGhlIExTQiB3aGljaCBpbmRpY2F0ZXMgb2RkL2V2ZW4g
cmVnaXN0ZXIuCisgICAgICAgICAgICAgKi8KKyAgICAgICAgICAgIGludCBkZWZfb2ZmID0gKChw
YWNrZXQtPmluc25baV0ucmVnbm9bdXNlX3JlZ2lkeF0pID4+IDEpOworICAgICAgICAgICAgaW50
IGRlZl9vcmVnID0gcGFja2V0LT5pbnNuW2ldLnJlZ25vW3VzZV9yZWdpZHhdICYgMTsKKyAgICAg
ICAgICAgIGludCBkZWZfaWR4ID0gLTE7CisgICAgICAgICAgICBmb3IgKGogPSBpIC0gMTsgKGog
Pj0gMCkgJiYgKGRlZl9vZmYgPj0gMCk7IGotLSkgeworICAgICAgICAgICAgICAgIGlmICghR0VU
X0FUVFJJQihwYWNrZXQtPmluc25bal0ub3Bjb2RlLCBBX0NWSSkpIHsKKyAgICAgICAgICAgICAg
ICAgICAgY29udGludWU7CisgICAgICAgICAgICAgICAgfQorICAgICAgICAgICAgICAgIGRlZl9v
ZmYtLTsKKyAgICAgICAgICAgICAgICBpZiAoZGVmX29mZiA9PSAwKSB7CisgICAgICAgICAgICAg
ICAgICAgIGRlZl9pZHggPSBqOworICAgICAgICAgICAgICAgICAgICBicmVhazsKKyAgICAgICAg
ICAgICAgICB9CisgICAgICAgICAgICB9CisgICAgICAgICAgICAvKgorICAgICAgICAgICAgICog
Q2hlY2sgZm9yIGEgYmFkbHkgZW5jb2RlZCBOLWZpZWxkIHdoaWNoIHBvaW50cyB0byBhbiBpbnN0
cnVjdGlvbgorICAgICAgICAgICAgICogb3V0LW9mLXJhbmdlCisgICAgICAgICAgICAgKi8KKyAg
ICAgICAgICAgIGlmICgoZGVmX29mZiAhPSAwKSB8fCAoZGVmX2lkeCA8IDApIHx8CisgICAgICAg
ICAgICAgICAgKGRlZl9pZHggPiAocGFja2V0LT5udW1faW5zbnMgLSAxKSkpIHsKKyAgICAgICAg
ICAgICAgICBnX2Fzc2VydF9ub3RfcmVhY2hlZCgpOworICAgICAgICAgICAgfQorICAgICAgICAg
ICAgLyogcHJldmlvdXMgaW5zbiBpcyB0aGUgcHJvZHVjZXIgKi8KKyAgICAgICAgICAgIGRlZl9v
cGNvZGUgPSBwYWNrZXQtPmluc25bZGVmX2lkeF0ub3Bjb2RlOworICAgICAgICAgICAgcmVnaW5m
byA9IG9wY29kZV9yZWdpbmZvW2RlZl9vcGNvZGVdOworICAgICAgICAgICAgZGVzdGxldHRlcnMg
PSAiZGV4eSI7CisgICAgICAgICAgICBmb3IgKGogPSAwOyAobGV0dGVyID0gZGVzdGxldHRlcnNb
al0pICE9IDA7IGorKykgeworICAgICAgICAgICAgICAgIGRzdHN0ciA9IHN0cmNocihyZWdpbmZv
LCBsZXR0ZXIpOworICAgICAgICAgICAgICAgIGlmIChkc3RzdHIgIT0gTlVMTCkgeworICAgICAg
ICAgICAgICAgICAgICBicmVhazsKKyAgICAgICAgICAgICAgICB9CisgICAgICAgICAgICB9Cisg
ICAgICAgICAgICBpZiAoKGRzdHN0ciA9PSBOVUxMKSAgJiYgR0VUX0FUVFJJQihkZWZfb3Bjb2Rl
LCBBX0NWSV9HQVRIRVIpKSB7CisgICAgICAgICAgICAgICAgZGVmX3JlZ251bSA9IDA7CisgICAg
ICAgICAgICAgICAgcGFja2V0LT5pbnNuW2ldLnJlZ25vW3VzZV9yZWdpZHhdID0gZGVmX29yZWc7
CisgICAgICAgICAgICAgICAgcGFja2V0LT5pbnNuW2ldLm5ld192YWx1ZV9wcm9kdWNlcl9zbG90
ID0KKyAgICAgICAgICAgICAgICAgICAgcGFja2V0LT5pbnNuW2RlZl9pZHhdLnNsb3Q7CisgICAg
ICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAgICAgIGlmIChkc3RzdHIgPT0gTlVMTCkgewor
ICAgICAgICAgICAgICAgICAgICAvKiBzdGlsbCBub3QgdGhlcmUsIHdlIGhhdmUgYSBiYWQgcGFj
a2V0ICovCisgICAgICAgICAgICAgICAgICAgIGdfYXNzZXJ0X25vdF9yZWFjaGVkKCk7CisgICAg
ICAgICAgICAgICAgfQorICAgICAgICAgICAgICAgIGRlZl9yZWdudW0gPSBwYWNrZXQtPmluc25b
ZGVmX2lkeF0ucmVnbm9bZHN0c3RyIC0gcmVnaW5mb107CisgICAgICAgICAgICAgICAgLyogTm93
IHBhdGNoIHVwIHRoZSBjb25zdW1lciB3aXRoIHRoZSByZWdpc3RlciBudW1iZXIgKi8KKyAgICAg
ICAgICAgICAgICBwYWNrZXQtPmluc25baV0ucmVnbm9bdXNlX3JlZ2lkeF0gPSBkZWZfcmVnbnVt
IF4gZGVmX29yZWc7CisgICAgICAgICAgICAgICAgLyogc3BlY2lhbCBjYXNlIGZvciAoVngsVnkp
ICovCisgICAgICAgICAgICAgICAgZHN0c3RyID0gc3RyY2hyKHJlZ2luZm8sICd5Jyk7CisgICAg
ICAgICAgICAgICAgaWYgKGRlZl9vcmVnICYmIHN0cmNocihyZWdpbmZvLCAneCcpICYmIGRzdHN0
cikgeworICAgICAgICAgICAgICAgICAgICBkZWZfcmVnbnVtID0gcGFja2V0LT5pbnNuW2RlZl9p
ZHhdLnJlZ25vW2RzdHN0ciAtIHJlZ2luZm9dOworICAgICAgICAgICAgICAgICAgICBwYWNrZXQt
Pmluc25baV0ucmVnbm9bdXNlX3JlZ2lkeF0gPSBkZWZfcmVnbnVtOworICAgICAgICAgICAgICAg
IH0KKyAgICAgICAgICAgICAgICAvKgorICAgICAgICAgICAgICAgICAqIFdlIG5lZWQgdG8gcmVt
ZW1iZXIgd2hvIHByb2R1Y2VzIHRoaXMgdmFsdWUgdG8gbGF0ZXIKKyAgICAgICAgICAgICAgICAg
KiBjaGVjayBpZiBpdCB3YXMgZHluYW1pY2FsbHkgY2FuY2VsbGVkCisgICAgICAgICAgICAgICAg
ICovCisgICAgICAgICAgICAgICAgcGFja2V0LT5pbnNuW2ldLm5ld192YWx1ZV9wcm9kdWNlcl9z
bG90ID0KKyAgICAgICAgICAgICAgICAgICAgcGFja2V0LT5pbnNuW2RlZl9pZHhdLnNsb3Q7Cisg
ICAgICAgICAgICB9CisgICAgICAgIH0KKyAgICB9CisgICAgcmV0dXJuIDA7Cit9CisKKy8qCisg
KiBXZSBkb24ndCB3YW50IHRvIHJlb3JkZXIgc2xvdDEvc2xvdDAgd2l0aCByZXNwZWN0IHRvIGVh
Y2ggb3RoZXIuCisgKiBTbyBpbiBvdXIgc2h1ZmZsaW5nLCB3ZSBkb24ndCB3YW50IHRvIG1vdmUg
dGhlIC5jdXIgLyAudG1wIHZtZW0gZWFybGllcgorICogSW5zdGVhZCwgd2Ugc2hvdWxkIG1vdmUg
dGhlIHByb2R1Y2luZyBpbnN0cnVjdGlvbiBsYXRlcgorICogQnV0IHRoZSBwcm9kdWNpbmcgaW5z
dHJ1Y3Rpb24gbWlnaHQgZmVlZCBhIC5uZXcgc3RvcmUhCisgKiBTbyB3ZSBtYXkgbmVlZCB0byBt
b3ZlIHRoYXQgZXZlbiBsYXRlci4KKyAqLworCitzdGF0aWMgdm9pZAorZGVjb2RlX21tdmVjX21v
dmVfY3ZpX3RvX2VuZChwYWNrZXRfdCAqcGFja2V0LCBpbnQgbWF4KQoreworICAgIGludCBpOwor
ICAgIGZvciAoaSA9IDA7IGkgPCBtYXg7IGkrKykgeworICAgICAgICBpZiAoR0VUX0FUVFJJQihw
YWNrZXQtPmluc25baV0ub3Bjb2RlLCBBX0NWSSkpIHsKKyAgICAgICAgICAgIGludCBsYXN0X2lu
c3QgPSBwYWNrZXQtPm51bV9pbnNucyAtIDE7CisKKyAgICAgICAgICAgIC8qCisgICAgICAgICAg
ICAgKiBJZiB0aGUgbGFzdCBpbnN0cnVjdGlvbiBpcyBhbiBlbmRsb29wLCBtb3ZlIHRvIHRoZSBv
bmUgYmVmb3JlIGl0CisgICAgICAgICAgICAgKiBLZWVwIGVuZGxvb3AgYXMgdGhlIGxhc3QgdGhp
bmcgYWx3YXlzCisgICAgICAgICAgICAgKi8KKyAgICAgICAgICAgIGlmICgocGFja2V0LT5pbnNu
W2xhc3RfaW5zdF0ub3Bjb2RlID09IEoyX2VuZGxvb3AwKSB8fAorICAgICAgICAgICAgICAgIChw
YWNrZXQtPmluc25bbGFzdF9pbnN0XS5vcGNvZGUgPT0gSjJfZW5kbG9vcDEpIHx8CisgICAgICAg
ICAgICAgICAgKHBhY2tldC0+aW5zbltsYXN0X2luc3RdLm9wY29kZSA9PSBKMl9lbmRsb29wMDEp
KSB7CisgICAgICAgICAgICAgICAgbGFzdF9pbnN0LS07CisgICAgICAgICAgICB9CisKKyAgICAg
ICAgICAgIGRlY29kZV9zZW5kX2luc25fdG8ocGFja2V0LCBpLCBsYXN0X2luc3QpOworICAgICAg
ICAgICAgbWF4LS07CisgICAgICAgICAgICBpLS07ICAgIC8qIFJldHJ5IHRoaXMgaW5kZXggbm93
IHRoYXQgcGFja2V0IGhhcyByb3RhdGVkICovCisgICAgICAgIH0KKyAgICB9Cit9CisKK3N0YXRp
YyBpbnQKK2RlY29kZV9zaHVmZmxlX2Zvcl9leGVjdXRpb25fdm9wcyhwYWNrZXRfdCAqcGFja2V0
KQoreworICAgIC8qCisgICAgICogU29ydCBmb3IgVi5uZXcgPSBWTUVNKCkKKyAgICAgKiBSaWdo
dCBub3cgd2UgbmVlZCB0byBtYWtlIHN1cmUgdGhhdCB0aGUgdmxvYWQgb2NjdXJzIGJlZm9yZSB0
aGUKKyAgICAgKiBwZXJtdXRlIGluc3RydWN0aW9uIG9yIFZQVlggb3BzCisgICAgICovCisgICAg
aW50IGk7CisgICAgZm9yIChpID0gMDsgaSA8IHBhY2tldC0+bnVtX2luc25zOyBpKyspIHsKKyAg
ICAgICAgaWYgKEdFVF9BVFRSSUIocGFja2V0LT5pbnNuW2ldLm9wY29kZSwgQV9MT0FEKSAmJgor
ICAgICAgICAgICAgKEdFVF9BVFRSSUIocGFja2V0LT5pbnNuW2ldLm9wY29kZSwgQV9DVklfTkVX
KSB8fAorICAgICAgICAgICAgIEdFVF9BVFRSSUIocGFja2V0LT5pbnNuW2ldLm9wY29kZSwgQV9D
VklfVE1QKSkpIHsKKyAgICAgICAgICAgIC8qCisgICAgICAgICAgICAgKiBGaW5kIHByaW9yIGNv
bnN1bWluZyB2ZWN0b3IgaW5zdHJ1Y3Rpb25zCisgICAgICAgICAgICAgKiBNb3ZlIHRvIGVuZCBv
ZiBwYWNrZXQKKyAgICAgICAgICAgICAqLworICAgICAgICAgICAgZGVjb2RlX21tdmVjX21vdmVf
Y3ZpX3RvX2VuZChwYWNrZXQsIGkpOworICAgICAgICAgICAgYnJlYWs7CisgICAgICAgIH0KKyAg
ICB9CisgICAgZm9yIChpID0gMDsgaSA8IHBhY2tldC0+bnVtX2luc25zIC0gMTsgaSsrKSB7Cisg
ICAgICAgIGlmIChHRVRfQVRUUklCKHBhY2tldC0+aW5zbltpXS5vcGNvZGUsIEFfU1RPUkUpICYm
CisgICAgICAgICAgICBHRVRfQVRUUklCKHBhY2tldC0+aW5zbltpXS5vcGNvZGUsIEFfQ1ZJX05F
VykgJiYKKyAgICAgICAgICAgICFHRVRfQVRUUklCKHBhY2tldC0+aW5zbltpXS5vcGNvZGUsIEFf
Q1ZJX1NDQVRURVJfUkVMRUFTRSkpIHsKKyAgICAgICAgICAgIC8qIGRlY29kZV9zZW5kX2luc25f
dG8gdGhlIGVuZCAqLworICAgICAgICAgICAgaW50IGxhc3RfaW5zdCA9IHBhY2tldC0+bnVtX2lu
c25zIC0gMTsKKworICAgICAgICAgICAgLyoKKyAgICAgICAgICAgICAqIElmIHRoZSBsYXN0IGlu
c3RydWN0aW9uIGlzIGFuIGVuZGxvb3AsIG1vdmUgdG8gdGhlIG9uZSBiZWZvcmUgaXQKKyAgICAg
ICAgICAgICAqIEtlZXAgZW5kbG9vcCBhcyB0aGUgbGFzdCB0aGluZyBhbHdheXMKKyAgICAgICAg
ICAgICAqLworICAgICAgICAgICAgaWYgKChwYWNrZXQtPmluc25bbGFzdF9pbnN0XS5vcGNvZGUg
PT0gSjJfZW5kbG9vcDApIHx8CisgICAgICAgICAgICAgICAgKHBhY2tldC0+aW5zbltsYXN0X2lu
c3RdLm9wY29kZSA9PSBKMl9lbmRsb29wMSkgfHwKKyAgICAgICAgICAgICAgICAocGFja2V0LT5p
bnNuW2xhc3RfaW5zdF0ub3Bjb2RlID09IEoyX2VuZGxvb3AwMSkpIHsKKyAgICAgICAgICAgICAg
ICBsYXN0X2luc3QtLTsKKyAgICAgICAgICAgIH0KKworICAgICAgICAgICAgZGVjb2RlX3NlbmRf
aW5zbl90byhwYWNrZXQsIGksIGxhc3RfaW5zdCk7CisgICAgICAgICAgICBicmVhazsKKyAgICAg
ICAgfQorICAgIH0KKyAgICByZXR1cm4gMDsKK30KKworLyogQ29sbGVjdCBzdGF0cyBvbiBIVlgg
cGFja2V0ICovCitzdGF0aWMgdm9pZAorZGVjb2RlX2h2eF9wYWNrZXRfY29udGVudHMocGFja2V0
X3QgKnBrdCkgeworICAgIHBrdC0+cGt0X2h2eF92YSA9IDA7CisgICAgcGt0LT5wa3RfaHZ4X3Z4
ID0gMDsKKyAgICBwa3QtPnBrdF9odnhfdnAgPSAwOworICAgIHBrdC0+cGt0X2h2eF92cyA9IDA7
CisgICAgcGt0LT5wa3RfaHZ4X2FsbCA9IDA7CisgICAgcGt0LT5wa3RfaHZ4X25vbmUgPSAwOwor
ICAgIHBrdC0+cGt0X2hhc19odnggPSAwOworCisgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBwa3Qt
Pm51bV9pbnNuczsgaSsrKSB7CisgICAgICAgIHBrdC0+cGt0X2h2eF92YSArPSBHRVRfQVRUUklC
KHBrdC0+aW5zbltpXS5vcGNvZGUsIEFfQ1ZJX1ZBKTsKKyAgICAgICAgcGt0LT5wa3RfaHZ4X3Z4
ICs9IEdFVF9BVFRSSUIocGt0LT5pbnNuW2ldLm9wY29kZSwgQV9DVklfVlgpOworICAgICAgICBw
a3QtPnBrdF9odnhfdnAgKz0gR0VUX0FUVFJJQihwa3QtPmluc25baV0ub3Bjb2RlLCBBX0NWSV9W
UCk7CisgICAgICAgIHBrdC0+cGt0X2h2eF92cyArPSBHRVRfQVRUUklCKHBrdC0+aW5zbltpXS5v
cGNvZGUsIEFfQ1ZJX1ZTKTsKKyAgICAgICAgcGt0LT5wa3RfaHZ4X25vbmUgKz0gR0VUX0FUVFJJ
Qihwa3QtPmluc25baV0ub3Bjb2RlLCBBX0NWSV9UTVApOworICAgICAgICBwa3QtPnBrdF9odnhf
YWxsICs9IEdFVF9BVFRSSUIocGt0LT5pbnNuW2ldLm9wY29kZSwgQV9DVklfNFNMT1QpOworICAg
ICAgICBwa3QtPnBrdF9odnhfdmEgKz0gMiAqIEdFVF9BVFRSSUIocGt0LT5pbnNuW2ldLm9wY29k
ZSwgQV9DVklfVkFfRFYpOworICAgICAgICBwa3QtPnBrdF9odnhfdnggKz0gMiAqIEdFVF9BVFRS
SUIocGt0LT5pbnNuW2ldLm9wY29kZSwgQV9DVklfVlhfRFYpOworICAgICAgICBwa3QtPnBrdF9o
dnhfdnAgKz0gR0VUX0FUVFJJQihwa3QtPmluc25baV0ub3Bjb2RlLCBBX0NWSV9WUF9WUyk7Cisg
ICAgICAgIHBrdC0+cGt0X2h2eF92cyArPSBHRVRfQVRUUklCKHBrdC0+aW5zbltpXS5vcGNvZGUs
IEFfQ1ZJX1ZQX1ZTKTsKKyAgICAgICAgcGt0LT5wa3RfaGFzX2h2eCB8PSBwa3QtPmluc25baV0u
aHZ4X3Jlc291cmNlID8gMSA6IDA7CisgICAgfQorfQorCisvKgorICogUHVibGljIEZ1bmN0aW9u
cworICovCisKK2NvbnN0IGNoYXIgKgorbW12ZWNfZXh0X2RlY29kZV9maW5kX2ljbGFzc19zbG90
cyhpbnQgb3Bjb2RlKQoreworICAgIGlmIChHRVRfQVRUUklCKG9wY29kZSwgQV9DVklfVk0pKSB7
CisgICAgICAgIGlmIChHRVRfQVRUUklCKG9wY29kZSwgQV9SRVNUUklDVF9TTE9UME9OTFkpKSB7
CisgICAgICAgICAgICByZXR1cm4gIjAiOworICAgICAgICB9IGVsc2UgaWYgKEdFVF9BVFRSSUIo
b3Bjb2RlLCBBX1JFU1RSSUNUX1NMT1QxT05MWSkpIHsKKyAgICAgICAgICAgIHJldHVybiAiMSI7
CisgICAgICAgIH0KKyAgICAgICAgcmV0dXJuICIwMSI7CisgICAgfSBlbHNlIGlmIChHRVRfQVRU
UklCKG9wY29kZSwgQV9SRVNUUklDVF9TTE9UMk9OTFkpKSB7CisgICAgICAgIHJldHVybiAiMiI7
CisgICAgfSBlbHNlIGlmIChHRVRfQVRUUklCKG9wY29kZSwgQV9DVklfVlgpKSB7CisgICAgICAg
IHJldHVybiAiMjMiOworICAgIH0gZWxzZSBpZiAoR0VUX0FUVFJJQihvcGNvZGUsIEFfQ1ZJX1ZT
X1ZYKSkgeworICAgICAgICByZXR1cm4gIjIzIjsKKyAgICB9IGVsc2UgeworICAgICAgICByZXR1
cm4gIjAxMjMiOworICAgIH0KK30KKworaW50IG1tdmVjX2V4dF9kZWNvZGVfY2hlY2tzKHBhY2tl
dF90ICpwYWNrZXQpCit7CisgICAgaW50IGVycm9ycyA9IDA7CisgICAgZXJyb3JzICs9IGNoZWNr
X25ld192YWx1ZShwYWNrZXQpOworICAgIGVycm9ycyArPSBkZWNvZGVfcG9wdWxhdGVfY3ZpX3Jl
c291cmNlcyhwYWNrZXQpOworICAgIGVycm9ycyArPSBkZWNvZGVfc2h1ZmZsZV9mb3JfZXhlY3V0
aW9uX3ZvcHMocGFja2V0KTsKKworICAgIGlmIChlcnJvcnMgPT0gMCkgeworICAgICAgICBkZWNv
ZGVfaHZ4X3BhY2tldF9jb250ZW50cyhwYWNrZXQpOworICAgIH0KKworICAgIHJldHVybiBlcnJv
cnM7Cit9CisKZGlmZiAtLWdpdCBhL3RhcmdldC9oZXhhZ29uL21tdmVjL2RlY29kZV9leHRfbW12
ZWMuaCBiL3RhcmdldC9oZXhhZ29uL21tdmVjL2RlY29kZV9leHRfbW12ZWMuaApuZXcgZmlsZSBt
b2RlIDEwMDY0NAppbmRleCAwMDAwMDAwLi5mYTNlYjJkCi0tLSAvZGV2L251bGwKKysrIGIvdGFy
Z2V0L2hleGFnb24vbW12ZWMvZGVjb2RlX2V4dF9tbXZlYy5oCkBAIC0wLDAgKzEsMjQgQEAKKy8q
CisgKiAgQ29weXJpZ2h0IChjKSAyMDE5IFF1YWxjb21tIElubm92YXRpb24gQ2VudGVyLCBJbmMu
IEFsbCBSaWdodHMgUmVzZXJ2ZWQuCisgKgorICogIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3
YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5CisgKiAgaXQgdW5kZXIg
dGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQg
YnkKKyAqICB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAyIG9m
IHRoZSBMaWNlbnNlLCBvcgorICogIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24u
CisgKgorICogIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0
IHdpbGwgYmUgdXNlZnVsLAorICogIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBl
dmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCisgKiAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5F
U1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQorICogIEdOVSBHZW5lcmFsIFB1
YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCisgKgorICogIFlvdSBzaG91bGQgaGF2ZSBy
ZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCisgKiAgYWxv
bmcgd2l0aCB0aGlzIHByb2dyYW07IGlmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGlj
ZW5zZXMvPi4KKyAqLworCisjaWZuZGVmIERFQ09ERV9FWFRfTU1WRUNfSAorI2RlZmluZSBERUNP
REVfRVhUX01NVkVDX0gKKworZXh0ZXJuIGludCBtbXZlY19leHRfZGVjb2RlX2NoZWNrcyhwYWNr
ZXRfdCAqcGt0KTsKK2V4dGVybiBjb25zdCBjaGFyICptbXZlY19leHRfZGVjb2RlX2ZpbmRfaWNs
YXNzX3Nsb3RzKGludCBvcGNvZGUpOworCisjZW5kaWYKZGlmZiAtLWdpdCBhL3RhcmdldC9oZXhh
Z29uL3E2dl9kZWNvZGUuYyBiL3RhcmdldC9oZXhhZ29uL3E2dl9kZWNvZGUuYwppbmRleCAwMjk0
NzVmLi5lZmQ1Y2VmIDEwMDY0NAotLS0gYS90YXJnZXQvaGV4YWdvbi9xNnZfZGVjb2RlLmMKKysr
IGIvdGFyZ2V0L2hleGFnb24vcTZ2X2RlY29kZS5jCkBAIC0xNjEsNiArMTYxLDEzIEBAIGRlY29k
ZV9pbnNuc190YWJsZXdhbGsoaW5zbl90ICppbnNuLCBkZWN0cmVlX3RhYmxlX3QgKnRhYmxlLCBz
aXplNHVfdCBlbmNvZGluZykKICAgICAgICAgfQogICAgICAgICBkZWNvZGVfb3AoaW5zbiwgb3Bj
LCBlbmNvZGluZyk7CiAgICAgICAgIHJldHVybiAxOworICAgIH0gZWxzZSBpZiAodGFibGUtPnRh
YmxlW2ldLnR5cGUgPT0gREVDVFJFRV9FWFRTUEFDRSkgeworICAgICAgICBzaXplNHVfdCBhY3Rp
dmVfZXh0OworICAgICAgICAvKgorICAgICAgICAgKiBGb3Igbm93LCBIVlggd2lsbCBiZSB0aGUg
b25seSBjb3Byb2MKKyAgICAgICAgICovCisgICAgICAgIGFjdGl2ZV9leHQgPSA0OworICAgICAg
ICByZXR1cm4gZGVjb2RlX2luc25zX3RhYmxld2FsayhpbnNuLCBleHRfdHJlZXNbYWN0aXZlX2V4
dF0sIGVuY29kaW5nKTsKICAgICB9IGVsc2UgewogICAgICAgICByZXR1cm4gMDsKICAgICB9CkBA
IC0zNTYsMTAgKzM2MywxMyBAQCBzdGF0aWMgaW50IGRvX2RlY29kZV9wYWNrZXQoaW50IG1heF93
b3JkcywgY29uc3Qgc2l6ZTR1X3QgKndvcmRzLCBwYWNrZXRfdCAqcGt0KQogICAgICAgICAgICAg
cGt0LT5wa3RfaGFzX3BheWxvYWQgPSAxOwogICAgICAgICB9CiAgICAgfQorICAgIHBrdC0+cGt0
X2hhc19leHRlbnNpb24gPSAwOwogICAgIHBrdC0+cGt0X2hhc19pbml0bG9vcCA9IDA7CiAgICAg
cGt0LT5wa3RfaGFzX2luaXRsb29wMCA9IDA7CiAgICAgcGt0LT5wa3RfaGFzX2luaXRsb29wMSA9
IDA7CiAgICAgZm9yIChpID0gMDsgaSA8IG51bV9pbnNuczsgaSsrKSB7CisgICAgICAgIHBrdC0+
cGt0X2hhc19leHRlbnNpb24gfD0KKyAgICAgICAgICAgIEdFVF9BVFRSSUIocGt0LT5pbnNuW2ld
Lm9wY29kZSwgQV9FWFRFTlNJT04pOwogICAgICAgICBwa3QtPnBrdF9oYXNfaW5pdGxvb3AwIHw9
CiAgICAgICAgICAgICBHRVRfQVRUUklCKHBrdC0+aW5zbltpXS5vcGNvZGUsIEFfSFdMT09QMF9T
RVRVUCk7CiAgICAgICAgIHBrdC0+cGt0X2hhc19pbml0bG9vcDEgfD0KQEAgLTM5MSw2ICs0MDEs
MTAgQEAgc3RhdGljIGludCBkb19kZWNvZGVfcGFja2V0KGludCBtYXhfd29yZHMsIGNvbnN0IHNp
emU0dV90ICp3b3JkcywgcGFja2V0X3QgKnBrdCkKICAgICBlcnJvcnMgKz0gZGVjb2RlX3NldF9z
bG90X251bWJlcihwa3QpOwogICAgIGVycm9ycyArPSBkZWNvZGVfZmlsbF9uZXd2YWx1ZV9yZWdu
byhwa3QpOwogCisgICAgaWYgKHBrdC0+cGt0X2hhc19leHRlbnNpb24pIHsKKyAgICAgICAgZXJy
b3JzICs9IG1tdmVjX2V4dF9kZWNvZGVfY2hlY2tzKHBrdCk7CisgICAgfQorCiAgICAgZXJyb3Jz
ICs9IGRlY29kZV9zaHVmZmxlX2Zvcl9leGVjdXRpb24ocGt0KTsKICAgICBlcnJvcnMgKz0gZGVj
b2RlX3NwbGl0X2NtcGp1bXAocGt0KTsKICAgICBlcnJvcnMgKz0gZGVjb2RlX3NldF9pbnNuX2F0
dHJfZmllbGRzKHBrdCk7Ci0tIAoyLjcuNAoK

