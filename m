Return-Path: <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>
X-Original-To: lists+qemu-devel@lfdr.de
Delivered-To: lists+qemu-devel@lfdr.de
Received: from lists.gnu.org (lists.gnu.org [209.51.188.17])
	by mail.lfdr.de (Postfix) with ESMTPS id 17147343CE5
	for <lists+qemu-devel@lfdr.de>; Mon, 22 Mar 2021 10:32:37 +0100 (CET)
Received: from localhost ([::1]:53002 helo=lists1p.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.90_1)
	(envelope-from <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>)
	id 1lOGvM-0002Ws-5E
	for lists+qemu-devel@lfdr.de; Mon, 22 Mar 2021 05:32:36 -0400
Received: from eggs.gnu.org ([2001:470:142:3::10]:45208)
 by lists.gnu.org with esmtps (TLS1.2:ECDHE_RSA_AES_256_GCM_SHA384:256)
 (Exim 4.90_1) (envelope-from <stefanha@redhat.com>)
 id 1lOGmv-0005fO-Rb
 for qemu-devel@nongnu.org; Mon, 22 Mar 2021 05:23:53 -0400
Received: from us-smtp-delivery-124.mimecast.com ([216.205.24.124]:58255)
 by eggs.gnu.org with esmtps (TLS1.2:ECDHE_RSA_AES_256_CBC_SHA1:256)
 (Exim 4.90_1) (envelope-from <stefanha@redhat.com>)
 id 1lOGmt-0000qF-05
 for qemu-devel@nongnu.org; Mon, 22 Mar 2021 05:23:53 -0400
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=redhat.com;
 s=mimecast20190719; t=1616405029;
 h=from:from:reply-to:subject:subject:date:date:message-id:message-id:
 to:to:cc:cc:mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=ZDli/BBWRjbNgJ/c0MN/kHbemMqZeCXtJfEDZQ/s0yE=;
 b=PUOAz68YaDFgJAP8HDbwO3PNGnwX7OqmYkuNXT/Xs3qKa6674awtT9mhDXazBWRqfM74Uh
 5rs1YI6fhObbqc2AQ/uXu+zWuVCN8zsyT6+EoLD08gf1QGlR5SHj42rpJHhE5H6m4C8jlD
 NH+qOzt1/pKa8x99U1LNLR6H8Kq1gpo=
Received: from mimecast-mx01.redhat.com (mimecast-mx01.redhat.com
 [209.132.183.4]) (Using TLS) by relay.mimecast.com with ESMTP id
 us-mta-537-cqispat6P-SQA66yzMBlsA-1; Mon, 22 Mar 2021 05:23:47 -0400
X-MC-Unique: cqispat6P-SQA66yzMBlsA-1
Received: from smtp.corp.redhat.com (int-mx08.intmail.prod.int.phx2.redhat.com
 [10.5.11.23])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mimecast-mx01.redhat.com (Postfix) with ESMTPS id 4431280006E;
 Mon, 22 Mar 2021 09:23:46 +0000 (UTC)
Received: from localhost (ovpn-114-89.ams2.redhat.com [10.36.114.89])
 by smtp.corp.redhat.com (Postfix) with ESMTP id B6F8921ECB;
 Mon, 22 Mar 2021 09:23:45 +0000 (UTC)
From: Stefan Hajnoczi <stefanha@redhat.com>
To: qemu-devel@nongnu.org
Subject: [PATCH 3/3] vhost-user-blk-test: test discard/write zeroes invalid
 inputs
Date: Mon, 22 Mar 2021 09:23:27 +0000
Message-Id: <20210322092327.150720-4-stefanha@redhat.com>
In-Reply-To: <20210322092327.150720-1-stefanha@redhat.com>
References: <20210322092327.150720-1-stefanha@redhat.com>
MIME-Version: 1.0
X-Scanned-By: MIMEDefang 2.84 on 10.5.11.23
Authentication-Results: relay.mimecast.com;
 auth=pass smtp.auth=CUSA124A263 smtp.mailfrom=stefanha@redhat.com
X-Mimecast-Spam-Score: 0
X-Mimecast-Originator: redhat.com
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="US-ASCII"
Received-SPF: pass client-ip=216.205.24.124; envelope-from=stefanha@redhat.com;
 helo=us-smtp-delivery-124.mimecast.com
X-Spam_score_int: -10
X-Spam_score: -1.1
X-Spam_bar: -
X-Spam_report: (-1.1 / 5.0 requ) BAYES_00=-1.9, DKIMWL_WL_HIGH=-0.001,
 DKIM_SIGNED=0.1, DKIM_VALID=-0.1, DKIM_VALID_AU=-0.1, DKIM_VALID_EF=-0.1,
 MIME_BASE64_TEXT=1.741, RCVD_IN_DNSWL_LOW=-0.7, RCVD_IN_MSPIKE_H4=-0.01,
 RCVD_IN_MSPIKE_WL=-0.01, SPF_HELO_NONE=0.001,
 SPF_PASS=-0.001 autolearn=ham autolearn_force=no
X-Spam_action: no action
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <https://lists.nongnu.org/archive/html/qemu-devel>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Cc: Kevin Wolf <kwolf@redhat.com>, Laurent Vivier <lvivier@redhat.com>,
 Thomas Huth <thuth@redhat.com>, qemu-block@nongnu.org,
 Coiby Xu <Coiby.Xu@gmail.com>, Stefan Hajnoczi <stefanha@redhat.com>,
 Paolo Bonzini <pbonzini@redhat.com>
Errors-To: qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org
Sender: "Qemu-devel" <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>

RXhlcmNpc2UgaW5wdXQgdmFsaWRhdGlvbiBjb2RlIHBhdGhzIGluCmJsb2NrL2V4cG9ydC92aG9z
dC11c2VyLWJsay1zZXJ2ZXIuYy4KClNpZ25lZC1vZmYtYnk6IFN0ZWZhbiBIYWpub2N6aSA8c3Rl
ZmFuaGFAcmVkaGF0LmNvbT4KTWVzc2FnZS1JZDogPDIwMjEwMzA5MDk0MTA2LjE5NjkxMS01LXN0
ZWZhbmhhQHJlZGhhdC5jb20+ClNpZ25lZC1vZmYtYnk6IEtldmluIFdvbGYgPGt3b2xmQHJlZGhh
dC5jb20+Ci0tLQogdGVzdHMvcXRlc3Qvdmhvc3QtdXNlci1ibGstdGVzdC5jIHwgMTI0ICsrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKwogMSBmaWxlIGNoYW5nZWQsIDEyNCBpbnNlcnRpb25z
KCspCgpkaWZmIC0tZ2l0IGEvdGVzdHMvcXRlc3Qvdmhvc3QtdXNlci1ibGstdGVzdC5jIGIvdGVz
dHMvcXRlc3Qvdmhvc3QtdXNlci1ibGstdGVzdC5jCmluZGV4IGQzN2UxYzMwYmQuLjg3OTZjNzRj
YTQgMTAwNjQ0Ci0tLSBhL3Rlc3RzL3F0ZXN0L3Zob3N0LXVzZXItYmxrLXRlc3QuYworKysgYi90
ZXN0cy9xdGVzdC92aG9zdC11c2VyLWJsay10ZXN0LmMKQEAgLTk0LDYgKzk0LDEyNCBAQCBzdGF0
aWMgdWludDY0X3QgdmlydGlvX2Jsa19yZXF1ZXN0KFFHdWVzdEFsbG9jYXRvciAqYWxsb2MsIFFW
aXJ0aW9EZXZpY2UgKmQsCiAgICAgcmV0dXJuIGFkZHI7CiB9CiAKK3N0YXRpYyB2b2lkIHRlc3Rf
aW52YWxpZF9kaXNjYXJkX3dyaXRlX3plcm9lcyhRVmlydGlvRGV2aWNlICpkZXYsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUUd1ZXN0QWxsb2NhdG9yICph
bGxvYywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBRVGVz
dFN0YXRlICpxdHMsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgUVZpcnRRdWV1ZSAqdnEsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgdWludDMyX3QgdHlwZSkKK3sKKyAgICBRVmlydGlvQmxrUmVxIHJlcTsKKyAgICBz
dHJ1Y3QgdmlydGlvX2Jsa19kaXNjYXJkX3dyaXRlX3plcm9lcyBkd3pfaGRyOworICAgIHN0cnVj
dCB2aXJ0aW9fYmxrX2Rpc2NhcmRfd3JpdGVfemVyb2VzIGR3el9oZHIyWzJdOworICAgIHVpbnQ2
NF90IHJlcV9hZGRyOworICAgIHVpbnQzMl90IGZyZWVfaGVhZDsKKyAgICB1aW50OF90IHN0YXR1
czsKKworICAgIC8qIE1vcmUgdGhhbiBvbmUgZHd6IGlzIG5vdCBzdXBwb3J0ZWQgKi8KKyAgICBy
ZXEudHlwZSA9IHR5cGU7CisgICAgcmVxLmRhdGEgPSAoY2hhciAqKSBkd3pfaGRyMjsKKyAgICBk
d3pfaGRyMlswXS5zZWN0b3IgPSAwOworICAgIGR3el9oZHIyWzBdLm51bV9zZWN0b3JzID0gMTsK
KyAgICBkd3pfaGRyMlswXS5mbGFncyA9IDA7CisgICAgZHd6X2hkcjJbMV0uc2VjdG9yID0gMTsK
KyAgICBkd3pfaGRyMlsxXS5udW1fc2VjdG9ycyA9IDE7CisgICAgZHd6X2hkcjJbMV0uZmxhZ3Mg
PSAwOworCisgICAgdmlydGlvX2Jsa19maXhfZHd6X2hkcihkZXYsICZkd3pfaGRyMlswXSk7Cisg
ICAgdmlydGlvX2Jsa19maXhfZHd6X2hkcihkZXYsICZkd3pfaGRyMlsxXSk7CisKKyAgICByZXFf
YWRkciA9IHZpcnRpb19ibGtfcmVxdWVzdChhbGxvYywgZGV2LCAmcmVxLCBzaXplb2YoZHd6X2hk
cjIpKTsKKworICAgIGZyZWVfaGVhZCA9IHF2aXJ0cXVldWVfYWRkKHF0cywgdnEsIHJlcV9hZGRy
LCAxNiwgZmFsc2UsIHRydWUpOworICAgIHF2aXJ0cXVldWVfYWRkKHF0cywgdnEsIHJlcV9hZGRy
ICsgMTYsIHNpemVvZihkd3pfaGRyMiksIGZhbHNlLCB0cnVlKTsKKyAgICBxdmlydHF1ZXVlX2Fk
ZChxdHMsIHZxLCByZXFfYWRkciArIDE2ICsgc2l6ZW9mKGR3el9oZHIyKSwgMSwgdHJ1ZSwKKyAg
ICAgICAgICAgICAgICAgICBmYWxzZSk7CisKKyAgICBxdmlydHF1ZXVlX2tpY2socXRzLCBkZXYs
IHZxLCBmcmVlX2hlYWQpOworCisgICAgcXZpcnRpb193YWl0X3VzZWRfZWxlbShxdHMsIGRldiwg
dnEsIGZyZWVfaGVhZCwgTlVMTCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIFFWSVJUSU9f
QkxLX1RJTUVPVVRfVVMpOworICAgIHN0YXR1cyA9IHJlYWRiKHJlcV9hZGRyICsgMTYgKyBzaXpl
b2YoZHd6X2hkcjIpKTsKKyAgICBnX2Fzc2VydF9jbXBpbnQoc3RhdHVzLCA9PSwgVklSVElPX0JM
S19TX1VOU1VQUCk7CisKKyAgICBndWVzdF9mcmVlKGFsbG9jLCByZXFfYWRkcik7CisKKyAgICAv
KiBudW1fc2VjdG9ycyBtdXN0IGJlIGxlc3MgdGhhbiBjb25maWctPm1heF93cml0ZV96ZXJvZXNf
c2VjdG9ycyAqLworICAgIHJlcS50eXBlID0gdHlwZTsKKyAgICByZXEuZGF0YSA9IChjaGFyICop
ICZkd3pfaGRyOworICAgIGR3el9oZHIuc2VjdG9yID0gMDsKKyAgICBkd3pfaGRyLm51bV9zZWN0
b3JzID0gMHhmZmZmZmZmZjsKKyAgICBkd3pfaGRyLmZsYWdzID0gMDsKKworICAgIHZpcnRpb19i
bGtfZml4X2R3el9oZHIoZGV2LCAmZHd6X2hkcik7CisKKyAgICByZXFfYWRkciA9IHZpcnRpb19i
bGtfcmVxdWVzdChhbGxvYywgZGV2LCAmcmVxLCBzaXplb2YoZHd6X2hkcikpOworCisgICAgZnJl
ZV9oZWFkID0gcXZpcnRxdWV1ZV9hZGQocXRzLCB2cSwgcmVxX2FkZHIsIDE2LCBmYWxzZSwgdHJ1
ZSk7CisgICAgcXZpcnRxdWV1ZV9hZGQocXRzLCB2cSwgcmVxX2FkZHIgKyAxNiwgc2l6ZW9mKGR3
el9oZHIpLCBmYWxzZSwgdHJ1ZSk7CisgICAgcXZpcnRxdWV1ZV9hZGQocXRzLCB2cSwgcmVxX2Fk
ZHIgKyAxNiArIHNpemVvZihkd3pfaGRyKSwgMSwgdHJ1ZSwKKyAgICAgICAgICAgICAgICAgICBm
YWxzZSk7CisKKyAgICBxdmlydHF1ZXVlX2tpY2socXRzLCBkZXYsIHZxLCBmcmVlX2hlYWQpOwor
CisgICAgcXZpcnRpb193YWl0X3VzZWRfZWxlbShxdHMsIGRldiwgdnEsIGZyZWVfaGVhZCwgTlVM
TCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgIFFWSVJUSU9fQkxLX1RJTUVPVVRfVVMpOwor
ICAgIHN0YXR1cyA9IHJlYWRiKHJlcV9hZGRyICsgMTYgKyBzaXplb2YoZHd6X2hkcikpOworICAg
IGdfYXNzZXJ0X2NtcGludChzdGF0dXMsID09LCBWSVJUSU9fQkxLX1NfSU9FUlIpOworCisgICAg
Z3Vlc3RfZnJlZShhbGxvYywgcmVxX2FkZHIpOworCisgICAgLyogc2VjdG9yIG11c3QgYmUgbGVz
cyB0aGFuIHRoZSBkZXZpY2UgY2FwYWNpdHkgKi8KKyAgICByZXEudHlwZSA9IHR5cGU7CisgICAg
cmVxLmRhdGEgPSAoY2hhciAqKSAmZHd6X2hkcjsKKyAgICBkd3pfaGRyLnNlY3RvciA9IFRFU1Rf
SU1BR0VfU0laRSAvIDUxMiArIDE7CisgICAgZHd6X2hkci5udW1fc2VjdG9ycyA9IDE7CisgICAg
ZHd6X2hkci5mbGFncyA9IDA7CisKKyAgICB2aXJ0aW9fYmxrX2ZpeF9kd3pfaGRyKGRldiwgJmR3
el9oZHIpOworCisgICAgcmVxX2FkZHIgPSB2aXJ0aW9fYmxrX3JlcXVlc3QoYWxsb2MsIGRldiwg
JnJlcSwgc2l6ZW9mKGR3el9oZHIpKTsKKworICAgIGZyZWVfaGVhZCA9IHF2aXJ0cXVldWVfYWRk
KHF0cywgdnEsIHJlcV9hZGRyLCAxNiwgZmFsc2UsIHRydWUpOworICAgIHF2aXJ0cXVldWVfYWRk
KHF0cywgdnEsIHJlcV9hZGRyICsgMTYsIHNpemVvZihkd3pfaGRyKSwgZmFsc2UsIHRydWUpOwor
ICAgIHF2aXJ0cXVldWVfYWRkKHF0cywgdnEsIHJlcV9hZGRyICsgMTYgKyBzaXplb2YoZHd6X2hk
ciksIDEsIHRydWUsCisgICAgICAgICAgICAgICAgICAgZmFsc2UpOworCisgICAgcXZpcnRxdWV1
ZV9raWNrKHF0cywgZGV2LCB2cSwgZnJlZV9oZWFkKTsKKworICAgIHF2aXJ0aW9fd2FpdF91c2Vk
X2VsZW0ocXRzLCBkZXYsIHZxLCBmcmVlX2hlYWQsIE5VTEwsCisgICAgICAgICAgICAgICAgICAg
ICAgICAgICBRVklSVElPX0JMS19USU1FT1VUX1VTKTsKKyAgICBzdGF0dXMgPSByZWFkYihyZXFf
YWRkciArIDE2ICsgc2l6ZW9mKGR3el9oZHIpKTsKKyAgICBnX2Fzc2VydF9jbXBpbnQoc3RhdHVz
LCA9PSwgVklSVElPX0JMS19TX0lPRVJSKTsKKworICAgIGd1ZXN0X2ZyZWUoYWxsb2MsIHJlcV9h
ZGRyKTsKKworICAgIC8qIHJlc2VydmVkIGZsYWcgYml0cyBtdXN0IGJlIHplcm8gKi8KKyAgICBy
ZXEudHlwZSA9IHR5cGU7CisgICAgcmVxLmRhdGEgPSAoY2hhciAqKSAmZHd6X2hkcjsKKyAgICBk
d3pfaGRyLnNlY3RvciA9IDA7CisgICAgZHd6X2hkci5udW1fc2VjdG9ycyA9IDE7CisgICAgZHd6
X2hkci5mbGFncyA9IH5WSVJUSU9fQkxLX1dSSVRFX1pFUk9FU19GTEFHX1VOTUFQOworCisgICAg
dmlydGlvX2Jsa19maXhfZHd6X2hkcihkZXYsICZkd3pfaGRyKTsKKworICAgIHJlcV9hZGRyID0g
dmlydGlvX2Jsa19yZXF1ZXN0KGFsbG9jLCBkZXYsICZyZXEsIHNpemVvZihkd3pfaGRyKSk7CisK
KyAgICBmcmVlX2hlYWQgPSBxdmlydHF1ZXVlX2FkZChxdHMsIHZxLCByZXFfYWRkciwgMTYsIGZh
bHNlLCB0cnVlKTsKKyAgICBxdmlydHF1ZXVlX2FkZChxdHMsIHZxLCByZXFfYWRkciArIDE2LCBz
aXplb2YoZHd6X2hkciksIGZhbHNlLCB0cnVlKTsKKyAgICBxdmlydHF1ZXVlX2FkZChxdHMsIHZx
LCByZXFfYWRkciArIDE2ICsgc2l6ZW9mKGR3el9oZHIpLCAxLCB0cnVlLAorICAgICAgICAgICAg
ICAgICAgIGZhbHNlKTsKKworICAgIHF2aXJ0cXVldWVfa2ljayhxdHMsIGRldiwgdnEsIGZyZWVf
aGVhZCk7CisKKyAgICBxdmlydGlvX3dhaXRfdXNlZF9lbGVtKHF0cywgZGV2LCB2cSwgZnJlZV9o
ZWFkLCBOVUxMLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgUVZJUlRJT19CTEtfVElNRU9V
VF9VUyk7CisgICAgc3RhdHVzID0gcmVhZGIocmVxX2FkZHIgKyAxNiArIHNpemVvZihkd3pfaGRy
KSk7CisgICAgZ19hc3NlcnRfY21waW50KHN0YXR1cywgPT0sIFZJUlRJT19CTEtfU19VTlNVUFAp
OworCisgICAgZ3Vlc3RfZnJlZShhbGxvYywgcmVxX2FkZHIpOworfQorCiAvKiBSZXR1cm5zIHRo
ZSByZXF1ZXN0IHZpcnRxdWV1ZSBzbyB0aGUgY2FsbGVyIGNhbiBwZXJmb3JtIGZ1cnRoZXIgdGVz
dHMgKi8KIHN0YXRpYyBRVmlydFF1ZXVlICp0ZXN0X2Jhc2ljKFFWaXJ0aW9EZXZpY2UgKmRldiwg
UUd1ZXN0QWxsb2NhdG9yICphbGxvYykKIHsKQEAgLTIzNSw2ICszNTMsOSBAQCBzdGF0aWMgUVZp
cnRRdWV1ZSAqdGVzdF9iYXNpYyhRVmlydGlvRGV2aWNlICpkZXYsIFFHdWVzdEFsbG9jYXRvciAq
YWxsb2MpCiAgICAgICAgIGdfZnJlZShkYXRhKTsKIAogICAgICAgICBndWVzdF9mcmVlKGFsbG9j
LCByZXFfYWRkcik7CisKKyAgICAgICAgdGVzdF9pbnZhbGlkX2Rpc2NhcmRfd3JpdGVfemVyb2Vz
KGRldiwgYWxsb2MsIHF0cywgdnEsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBWSVJUSU9fQkxLX1RfV1JJVEVfWkVST0VTKTsKICAgICB9CiAKICAgICBpZiAoZmVh
dHVyZXMgJiAoMXUgPDwgVklSVElPX0JMS19GX0RJU0NBUkQpKSB7CkBAIC0yNjMsNiArMzg0LDkg
QEAgc3RhdGljIFFWaXJ0UXVldWUgKnRlc3RfYmFzaWMoUVZpcnRpb0RldmljZSAqZGV2LCBRR3Vl
c3RBbGxvY2F0b3IgKmFsbG9jKQogICAgICAgICBnX2Fzc2VydF9jbXBpbnQoc3RhdHVzLCA9PSwg
MCk7CiAKICAgICAgICAgZ3Vlc3RfZnJlZShhbGxvYywgcmVxX2FkZHIpOworCisgICAgICAgIHRl
c3RfaW52YWxpZF9kaXNjYXJkX3dyaXRlX3plcm9lcyhkZXYsIGFsbG9jLCBxdHMsIHZxLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVklSVElPX0JMS19UX0RJU0NB
UkQpOwogICAgIH0KIAogICAgIGlmIChmZWF0dXJlcyAmICgxdSA8PCBWSVJUSU9fRl9BTllfTEFZ
T1VUKSkgewotLSAKMi4zMC4yCgo=


