Return-Path: <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>
X-Original-To: lists+qemu-devel@lfdr.de
Delivered-To: lists+qemu-devel@lfdr.de
Received: from lists.gnu.org (lists.gnu.org [209.51.188.17])
	by mail.lfdr.de (Postfix) with ESMTPS id 4D5D33F8D84
	for <lists+qemu-devel@lfdr.de>; Thu, 26 Aug 2021 20:03:32 +0200 (CEST)
Received: from localhost ([::1]:36528 helo=lists1p.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.90_1)
	(envelope-from <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>)
	id 1mJJit-00018n-CL
	for lists+qemu-devel@lfdr.de; Thu, 26 Aug 2021 14:03:31 -0400
Received: from eggs.gnu.org ([2001:470:142:3::10]:52466)
 by lists.gnu.org with esmtps (TLS1.2:ECDHE_RSA_AES_256_GCM_SHA384:256)
 (Exim 4.90_1) (envelope-from <tsimpson@qualcomm.com>)
 id 1mJJJH-0005eF-4V
 for qemu-devel@nongnu.org; Thu, 26 Aug 2021 13:37:05 -0400
Received: from alexa-out-sd-01.qualcomm.com ([199.106.114.38]:48465)
 by eggs.gnu.org with esmtps (TLS1.2:RSA_AES_256_CBC_SHA1:256)
 (Exim 4.90_1) (envelope-from <tsimpson@qualcomm.com>)
 id 1mJJJB-00058q-4x
 for qemu-devel@nongnu.org; Thu, 26 Aug 2021 13:37:01 -0400
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=quicinc.com; i=@quicinc.com; q=dns/txt; s=qcdkim;
 t=1629999417; x=1661535417;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=SaEnbU31RQGCuRIqdDEu4GJtHQNzpKdMqLu4wyZ+R7U=;
 b=WpQPz4h2UgUdb5aDmFsu78uBCNE/pzWCIsuWCdeFtmRjjRBbA3diHANr
 7i6yx+HY+PRe6ttzXQh+oqE8MNSICZ2d1L+qZmrpY0eJFjJqUrqBR4Teb
 H/eEdWkeAv3BTRvjWV1+umlGFCsDWw8Udp+ZCH16lqReRTnUkyv4wVInv 4=;
Received: from unknown (HELO ironmsg-SD-alpha.qualcomm.com) ([10.53.140.30])
 by alexa-out-sd-01.qualcomm.com with ESMTP; 26 Aug 2021 10:36:16 -0700
X-QCInternal: smtphost
Received: from vu-tsimpson-aus.qualcomm.com (HELO
 vu-tsimpson1-aus.qualcomm.com) ([10.222.150.1])
 by ironmsg-SD-alpha.qualcomm.com with ESMTP; 26 Aug 2021 10:36:15 -0700
Received: by vu-tsimpson1-aus.qualcomm.com (Postfix, from userid 47164)
 id 9110416AF; Thu, 26 Aug 2021 12:36:13 -0500 (CDT)
From: Taylor Simpson <tsimpson@quicinc.com>
To: qemu-devel@nongnu.org
Subject: [PATCH v2 23/30] Hexagon HVX (target/hexagon) TCG generation
Date: Thu, 26 Aug 2021 12:35:51 -0500
Message-Id: <1629999358-25304-24-git-send-email-tsimpson@quicinc.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1629999358-25304-1-git-send-email-tsimpson@quicinc.com>
References: <1629999358-25304-1-git-send-email-tsimpson@quicinc.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Received-SPF: pass client-ip=199.106.114.38;
 envelope-from=tsimpson@qualcomm.com; helo=alexa-out-sd-01.qualcomm.com
X-Spam_score_int: -40
X-Spam_score: -4.1
X-Spam_bar: ----
X-Spam_report: (-4.1 / 5.0 requ) BAYES_00=-1.9, DKIM_SIGNED=0.1,
 DKIM_VALID=-0.1, DKIM_VALID_AU=-0.1, HEADER_FROM_DIFFERENT_DOMAINS=0.249,
 RCVD_IN_DNSWL_MED=-2.3, SPF_HELO_NONE=0.001,
 SPF_PASS=-0.001 autolearn=ham autolearn_force=no
X-Spam_action: no action
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <https://lists.nongnu.org/archive/html/qemu-devel>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Cc: ale@rev.ng, bcain@quicinc.com, tsimpson@quicinc.com,
 richard.henderson@linaro.org, f4bug@amsat.org
Errors-To: qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org
Sender: "Qemu-devel" <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>

U2lnbmVkLW9mZi1ieTogVGF5bG9yIFNpbXBzb24gPHRzaW1wc29uQHF1aWNpbmMuY29tPgotLS0K
IHRhcmdldC9oZXhhZ29uL3RyYW5zbGF0ZS5oIHwgIDYzICsrKysrKysrKysrKysKIHRhcmdldC9o
ZXhhZ29uL2dlbnB0ci5jICAgIHwgIDE1ICsrKwogdGFyZ2V0L2hleGFnb24vdHJhbnNsYXRlLmMg
fCAyMjEgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKystCiAzIGZp
bGVzIGNoYW5nZWQsIDI5NyBpbnNlcnRpb25zKCspLCAyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL3RhcmdldC9oZXhhZ29uL3RyYW5zbGF0ZS5oIGIvdGFyZ2V0L2hleGFnb24vdHJhbnNsYXRl
LmgKaW5kZXggNzAzZmQxMy4uYzViODZjMyAxMDA2NDQKLS0tIGEvdGFyZ2V0L2hleGFnb24vdHJh
bnNsYXRlLmgKKysrIGIvdGFyZ2V0L2hleGFnb24vdHJhbnNsYXRlLmgKQEAgLTI5LDYgKzI5LDcg
QEAgdHlwZWRlZiBzdHJ1Y3QgRGlzYXNDb250ZXh0IHsKICAgICB1aW50MzJfdCBtZW1faWR4Owog
ICAgIHVpbnQzMl90IG51bV9wYWNrZXRzOwogICAgIHVpbnQzMl90IG51bV9pbnNuczsKKyAgICB1
aW50MzJfdCBudW1faHZ4X2luc25zOwogICAgIGludCByZWdfbG9nW1JFR19XUklURVNfTUFYXTsK
ICAgICBpbnQgcmVnX2xvZ19pZHg7CiAgICAgREVDTEFSRV9CSVRNQVAocmVnc193cml0dGVuLCBU
T1RBTF9QRVJfVEhSRUFEX1JFR1MpOwpAQCAtMzcsNiArMzgsMjAgQEAgdHlwZWRlZiBzdHJ1Y3Qg
RGlzYXNDb250ZXh0IHsKICAgICBERUNMQVJFX0JJVE1BUChwcmVnc193cml0dGVuLCBOVU1fUFJF
R1MpOwogICAgIHVpbnQ4X3Qgc3RvcmVfd2lkdGhbU1RPUkVTX01BWF07CiAgICAgYm9vbCBzMV9z
dG9yZV9wcm9jZXNzZWQ7CisgICAgaW50IGZ1dHVyZV92cmVnc19pZHg7CisgICAgaW50IGZ1dHVy
ZV92cmVnc19udW1bVkVDVE9SX1RFTVBTX01BWF07CisgICAgaW50IHRtcF92cmVnc19pZHg7Cisg
ICAgaW50IHRtcF92cmVnc19udW1bVkVDVE9SX1RFTVBTX01BWF07CisgICAgaW50IHZyZWdfbG9n
W05VTV9WUkVHU107CisgICAgYm9vbCB2cmVnX2lzX3ByZWRpY2F0ZWRbTlVNX1ZSRUdTXTsKKyAg
ICBpbnQgdnJlZ19sb2dfaWR4OworICAgIERFQ0xBUkVfQklUTUFQKHZyZWdzX3VwZGF0ZWRfdG1w
LCBOVU1fVlJFR1MpOworICAgIERFQ0xBUkVfQklUTUFQKHZyZWdzX3VwZGF0ZWQsIE5VTV9WUkVH
Uyk7CisgICAgREVDTEFSRV9CSVRNQVAodnJlZ3Nfc2VsZWN0LCBOVU1fVlJFR1MpOworICAgIGlu
dCBxcmVnX2xvZ1tOVU1fUVJFR1NdOworICAgIGJvb2wgcXJlZ19pc19wcmVkaWNhdGVkW05VTV9R
UkVHU107CisgICAgaW50IHFyZWdfbG9nX2lkeDsKKyAgICBib29sIHByZV9jb21taXQ7CiB9IERp
c2FzQ29udGV4dDsKIAogc3RhdGljIGlubGluZSB2b2lkIGN0eF9sb2dfcmVnX3dyaXRlKERpc2Fz
Q29udGV4dCAqY3R4LCBpbnQgcm51bSkKQEAgLTY3LDYgKzgyLDQ2IEBAIHN0YXRpYyBpbmxpbmUg
Ym9vbCBpc19wcmVsb2FkZWQoRGlzYXNDb250ZXh0ICpjdHgsIGludCBudW0pCiAgICAgcmV0dXJu
IHRlc3RfYml0KG51bSwgY3R4LT5yZWdzX3dyaXR0ZW4pOwogfQogCitpbnRwdHJfdCBjdHhfZnV0
dXJlX3ZyZWdfb2ZmKERpc2FzQ29udGV4dCAqY3R4LCBpbnQgcmVnbnVtLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICBpbnQgbnVtLCBib29sIGFsbG9jX29rKTsKK2ludHB0cl90IGN0eF90
bXBfdnJlZ19vZmYoRGlzYXNDb250ZXh0ICpjdHgsIGludCByZWdudW0sCisgICAgICAgICAgICAg
ICAgICAgICAgICAgIGludCBudW0sIGJvb2wgYWxsb2Nfb2spOworCitzdGF0aWMgaW5saW5lIHZv
aWQgY3R4X2xvZ192cmVnX3dyaXRlKERpc2FzQ29udGV4dCAqY3R4LAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBpbnQgcm51bSwgVlJlZ1dyaXRlVHlwZSB0eXBlLAorICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib29sIGlzX3ByZWRpY2F0ZWQpCit7
CisgICAgaWYgKHR5cGUgIT0gRVhUX1RNUCkgeworICAgICAgICBjdHgtPnZyZWdfbG9nW2N0eC0+
dnJlZ19sb2dfaWR4XSA9IHJudW07CisgICAgICAgIGN0eC0+dnJlZ19pc19wcmVkaWNhdGVkW2N0
eC0+dnJlZ19sb2dfaWR4XSA9IGlzX3ByZWRpY2F0ZWQ7CisgICAgICAgIGN0eC0+dnJlZ19sb2df
aWR4Kys7CisKKyAgICAgICAgc2V0X2JpdChybnVtLCBjdHgtPnZyZWdzX3VwZGF0ZWQpOworICAg
IH0KKyAgICBpZiAodHlwZSA9PSBFWFRfTkVXKSB7CisgICAgICAgIHNldF9iaXQocm51bSwgY3R4
LT52cmVnc19zZWxlY3QpOworICAgIH0KKyAgICBpZiAodHlwZSA9PSBFWFRfVE1QKSB7CisgICAg
ICAgIHNldF9iaXQocm51bSwgY3R4LT52cmVnc191cGRhdGVkX3RtcCk7CisgICAgfQorfQorCitz
dGF0aWMgaW5saW5lIHZvaWQgY3R4X2xvZ192cmVnX3dyaXRlX3BhaXIoRGlzYXNDb250ZXh0ICpj
dHgsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IHJudW0s
IFZSZWdXcml0ZVR5cGUgdHlwZSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBib29sIGlzX3ByZWRpY2F0ZWQpCit7CisgICAgY3R4X2xvZ192cmVnX3dyaXRlKGN0
eCwgcm51bSBeIDAsIHR5cGUsIGlzX3ByZWRpY2F0ZWQpOworICAgIGN0eF9sb2dfdnJlZ193cml0
ZShjdHgsIHJudW0gXiAxLCB0eXBlLCBpc19wcmVkaWNhdGVkKTsKK30KKworc3RhdGljIGlubGlu
ZSB2b2lkIGN0eF9sb2dfcXJlZ193cml0ZShEaXNhc0NvbnRleHQgKmN0eCwKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IHJudW0sIGJvb2wgaXNfcHJlZGljYXRlZCkK
K3sKKyAgICBjdHgtPnFyZWdfbG9nW2N0eC0+cXJlZ19sb2dfaWR4XSA9IHJudW07CisgICAgY3R4
LT5xcmVnX2lzX3ByZWRpY2F0ZWRbY3R4LT5xcmVnX2xvZ19pZHhdID0gaXNfcHJlZGljYXRlZDsK
KyAgICBjdHgtPnFyZWdfbG9nX2lkeCsrOworfQorCiBleHRlcm4gVENHdiBoZXhfZ3ByW1RPVEFM
X1BFUl9USFJFQURfUkVHU107CiBleHRlcm4gVENHdiBoZXhfcHJlZFtOVU1fUFJFR1NdOwogZXh0
ZXJuIFRDR3YgaGV4X25leHRfUEM7CkBAIC04NSw2ICsxNDAsMTQgQEAgZXh0ZXJuIFRDR3YgaGV4
X2RjemVyb19hZGRyOwogZXh0ZXJuIFRDR3YgaGV4X2xsc2NfYWRkcjsKIGV4dGVybiBUQ0d2IGhl
eF9sbHNjX3ZhbDsKIGV4dGVybiBUQ0d2X2k2NCBoZXhfbGxzY192YWxfaTY0OworZXh0ZXJuIFRD
R3YgaGV4X1ZSZWdzX3VwZGF0ZWRfdG1wOworZXh0ZXJuIFRDR3YgaGV4X1ZSZWdzX3VwZGF0ZWQ7
CitleHRlcm4gVENHdiBoZXhfVlJlZ3Nfc2VsZWN0OworZXh0ZXJuIFRDR3YgaGV4X1FSZWdzX3Vw
ZGF0ZWQ7CitleHRlcm4gVENHdiBoZXhfdnN0b3JlX2FkZHJbVlNUT1JFU19NQVhdOworZXh0ZXJu
IFRDR3YgaGV4X3ZzdG9yZV9zaXplW1ZTVE9SRVNfTUFYXTsKK2V4dGVybiBUQ0d2IGhleF92c3Rv
cmVfcGVuZGluZ1tWU1RPUkVTX01BWF07CiAKK2Jvb2wgaXNfZ2F0aGVyX3N0b3JlX2luc24oSW5z
biAqaW5zbiwgUGFja2V0ICpwa3QpOwogdm9pZCBwcm9jZXNzX3N0b3JlKERpc2FzQ29udGV4dCAq
Y3R4LCBQYWNrZXQgKnBrdCwgaW50IHNsb3RfbnVtKTsKICNlbmRpZgpkaWZmIC0tZ2l0IGEvdGFy
Z2V0L2hleGFnb24vZ2VucHRyLmMgYi90YXJnZXQvaGV4YWdvbi9nZW5wdHIuYwppbmRleCA3N2I3
MDZhLi41YTlhN2RmIDEwMDY0NAotLS0gYS90YXJnZXQvaGV4YWdvbi9nZW5wdHIuYworKysgYi90
YXJnZXQvaGV4YWdvbi9nZW5wdHIuYwpAQCAtMTY4LDYgKzE2OCw5IEBAIHN0YXRpYyBpbmxpbmUg
dm9pZCBnZW5fcmVhZF9jdHJsX3JlZyhEaXNhc0NvbnRleHQgKmN0eCwgY29uc3QgaW50IHJlZ19u
dW0sCiAgICAgfSBlbHNlIGlmIChyZWdfbnVtID09IEhFWF9SRUdfUUVNVV9JTlNOX0NOVCkgewog
ICAgICAgICB0Y2dfZ2VuX2FkZGlfdGwoZGVzdCwgaGV4X2dwcltIRVhfUkVHX1FFTVVfSU5TTl9D
TlRdLAogICAgICAgICAgICAgICAgICAgICAgICAgY3R4LT5udW1faW5zbnMpOworICAgIH0gZWxz
ZSBpZiAocmVnX251bSA9PSBIRVhfUkVHX1FFTVVfSFZYX0NOVCkgeworICAgICAgICB0Y2dfZ2Vu
X2FkZGlfdGwoZGVzdCwgaGV4X2dwcltIRVhfUkVHX1FFTVVfSFZYX0NOVF0sCisgICAgICAgICAg
ICAgICAgICAgICAgICBjdHgtPm51bV9odnhfaW5zbnMpOwogICAgIH0gZWxzZSB7CiAgICAgICAg
IHRjZ19nZW5fbW92X3RsKGRlc3QsIGhleF9ncHJbcmVnX251bV0pOwogICAgIH0KQEAgLTE5NSw2
ICsxOTgsMTIgQEAgc3RhdGljIGlubGluZSB2b2lkIGdlbl9yZWFkX2N0cmxfcmVnX3BhaXIoRGlz
YXNDb250ZXh0ICpjdHgsIGNvbnN0IGludCByZWdfbnVtLAogICAgICAgICB0Y2dfZ2VuX2NvbmNh
dF9pMzJfaTY0KGRlc3QsIHBrdF9jbnQsIGluc25fY250KTsKICAgICAgICAgdGNnX3RlbXBfZnJl
ZShwa3RfY250KTsKICAgICAgICAgdGNnX3RlbXBfZnJlZShpbnNuX2NudCk7CisgICAgfSBlbHNl
IGlmIChyZWdfbnVtID09IEhFWF9SRUdfUUVNVV9IVlhfQ05UKSB7CisgICAgICAgIFRDR3YgaHZ4
X2NudCA9IHRjZ190ZW1wX25ldygpOworICAgICAgICB0Y2dfZ2VuX2FkZGlfdGwoaHZ4X2NudCwg
aGV4X2dwcltIRVhfUkVHX1FFTVVfSFZYX0NOVF0sCisgICAgICAgICAgICAgICAgICAgICAgICBj
dHgtPm51bV9odnhfaW5zbnMpOworICAgICAgICB0Y2dfZ2VuX2NvbmNhdF9pMzJfaTY0KGRlc3Qs
IGh2eF9jbnQsIGhleF9ncHJbcmVnX251bSArIDFdKTsKKyAgICAgICAgdGNnX3RlbXBfZnJlZSho
dnhfY250KTsKICAgICB9IGVsc2UgewogICAgICAgICB0Y2dfZ2VuX2NvbmNhdF9pMzJfaTY0KGRl
c3QsCiAgICAgICAgICAgICBoZXhfZ3ByW3JlZ19udW1dLApAQCAtMjMwLDYgKzIzOSw5IEBAIHN0
YXRpYyBpbmxpbmUgdm9pZCBnZW5fd3JpdGVfY3RybF9yZWcoRGlzYXNDb250ZXh0ICpjdHgsIGlu
dCByZWdfbnVtLAogICAgICAgICBpZiAocmVnX251bSA9PSBIRVhfUkVHX1FFTVVfSU5TTl9DTlQp
IHsKICAgICAgICAgICAgIGN0eC0+bnVtX2luc25zID0gMDsKICAgICAgICAgfQorICAgICAgICBp
ZiAocmVnX251bSA9PSBIRVhfUkVHX1FFTVVfSFZYX0NOVCkgeworICAgICAgICAgICAgY3R4LT5u
dW1faHZ4X2luc25zID0gMDsKKyAgICAgICAgfQogICAgIH0KIH0KIApAQCAtMjUxLDYgKzI2Myw5
IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBnZW5fd3JpdGVfY3RybF9yZWdfcGFpcihEaXNhc0NvbnRl
eHQgKmN0eCwgaW50IHJlZ19udW0sCiAgICAgICAgICAgICBjdHgtPm51bV9wYWNrZXRzID0gMDsK
ICAgICAgICAgICAgIGN0eC0+bnVtX2luc25zID0gMDsKICAgICAgICAgfQorICAgICAgICBpZiAo
cmVnX251bSA9PSBIRVhfUkVHX1FFTVVfSFZYX0NOVCkgeworICAgICAgICAgICAgY3R4LT5udW1f
aHZ4X2luc25zID0gMDsKKyAgICAgICAgfQogICAgIH0KIH0KIApkaWZmIC0tZ2l0IGEvdGFyZ2V0
L2hleGFnb24vdHJhbnNsYXRlLmMgYi90YXJnZXQvaGV4YWdvbi90cmFuc2xhdGUuYwppbmRleCA1
NGZkY2FhLi5hMTRhNmMxIDEwMDY0NAotLS0gYS90YXJnZXQvaGV4YWdvbi90cmFuc2xhdGUuYwor
KysgYi90YXJnZXQvaGV4YWdvbi90cmFuc2xhdGUuYwpAQCAtMTksNiArMTksNyBAQAogI2luY2x1
ZGUgInFlbXUvb3NkZXAuaCIKICNpbmNsdWRlICJjcHUuaCIKICNpbmNsdWRlICJ0Y2cvdGNnLW9w
LmgiCisjaW5jbHVkZSAidGNnL3RjZy1vcC1ndmVjLmgiCiAjaW5jbHVkZSAiZXhlYy9jcHVfbGRz
dC5oIgogI2luY2x1ZGUgImV4ZWMvbG9nLmgiCiAjaW5jbHVkZSAiaW50ZXJuYWwuaCIKQEAgLTQ3
LDExICs0OCw2MiBAQCBUQ0d2IGhleF9kY3plcm9fYWRkcjsKIFRDR3YgaGV4X2xsc2NfYWRkcjsK
IFRDR3YgaGV4X2xsc2NfdmFsOwogVENHdl9pNjQgaGV4X2xsc2NfdmFsX2k2NDsKK1RDR3YgaGV4
X1ZSZWdzX3VwZGF0ZWRfdG1wOworVENHdiBoZXhfVlJlZ3NfdXBkYXRlZDsKK1RDR3YgaGV4X1ZS
ZWdzX3NlbGVjdDsKK1RDR3YgaGV4X1FSZWdzX3VwZGF0ZWQ7CitUQ0d2IGhleF92c3RvcmVfYWRk
cltWU1RPUkVTX01BWF07CitUQ0d2IGhleF92c3RvcmVfc2l6ZVtWU1RPUkVTX01BWF07CitUQ0d2
IGhleF92c3RvcmVfcGVuZGluZ1tWU1RPUkVTX01BWF07CiAKIHN0YXRpYyBjb25zdCBjaGFyICog
Y29uc3QgaGV4YWdvbl9wcmVkbmFtZXNbXSA9IHsKICAgInAwIiwgInAxIiwgInAyIiwgInAzIgog
fTsKIAoraW50cHRyX3QgY3R4X2Z1dHVyZV92cmVnX29mZihEaXNhc0NvbnRleHQgKmN0eCwgaW50
IHJlZ251bSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IG51bSwgYm9vbCBhbGxvY19v
aykKK3sKKyAgICBpbnRwdHJfdCBvZmZzZXQ7CisKKyAgICAvKiBTZWUgaWYgaXQgaXMgYWxyZWFk
eSBhbGxvY2F0ZWQgKi8KKyAgICBmb3IgKGludCBpID0gMDsgaSA8IGN0eC0+ZnV0dXJlX3ZyZWdz
X2lkeDsgaSsrKSB7CisgICAgICAgIGlmIChjdHgtPmZ1dHVyZV92cmVnc19udW1baV0gPT0gcmVn
bnVtKSB7CisgICAgICAgICAgICByZXR1cm4gb2Zmc2V0b2YoQ1BVSGV4YWdvblN0YXRlLCBmdXR1
cmVfVlJlZ3NbaV0pOworICAgICAgICB9CisgICAgfQorCisgICAgZ19hc3NlcnQoYWxsb2Nfb2sp
OworICAgIG9mZnNldCA9IG9mZnNldG9mKENQVUhleGFnb25TdGF0ZSwgZnV0dXJlX1ZSZWdzW2N0
eC0+ZnV0dXJlX3ZyZWdzX2lkeF0pOworICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbnVtOyBpKysp
IHsKKyAgICAgICAgY3R4LT5mdXR1cmVfdnJlZ3NfbnVtW2N0eC0+ZnV0dXJlX3ZyZWdzX2lkeCAr
IGldID0gcmVnbnVtKys7CisgICAgfQorICAgIGN0eC0+ZnV0dXJlX3ZyZWdzX2lkeCArPSBudW07
CisgICAgZ19hc3NlcnQoY3R4LT5mdXR1cmVfdnJlZ3NfaWR4IDwgVkVDVE9SX1RFTVBTX01BWCk7
CisgICAgcmV0dXJuIG9mZnNldDsKK30KKworaW50cHRyX3QgY3R4X3RtcF92cmVnX29mZihEaXNh
c0NvbnRleHQgKmN0eCwgaW50IHJlZ251bSwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgaW50
IG51bSwgYm9vbCBhbGxvY19vaykKK3sKKyAgICBpbnRwdHJfdCBvZmZzZXQ7CisKKyAgICAvKiBT
ZWUgaWYgaXQgaXMgYWxyZWFkeSBhbGxvY2F0ZWQgKi8KKyAgICBmb3IgKGludCBpID0gMDsgaSA8
IGN0eC0+dG1wX3ZyZWdzX2lkeDsgaSsrKSB7CisgICAgICAgIGlmIChjdHgtPnRtcF92cmVnc19u
dW1baV0gPT0gcmVnbnVtKSB7CisgICAgICAgICAgICByZXR1cm4gb2Zmc2V0b2YoQ1BVSGV4YWdv
blN0YXRlLCB0bXBfVlJlZ3NbaV0pOworICAgICAgICB9CisgICAgfQorCisgICAgZ19hc3NlcnQo
YWxsb2Nfb2spOworICAgIG9mZnNldCA9IG9mZnNldG9mKENQVUhleGFnb25TdGF0ZSwgdG1wX1ZS
ZWdzW2N0eC0+dG1wX3ZyZWdzX2lkeF0pOworICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbnVtOyBp
KyspIHsKKyAgICAgICAgY3R4LT50bXBfdnJlZ3NfbnVtW2N0eC0+dG1wX3ZyZWdzX2lkeCArIGld
ID0gcmVnbnVtKys7CisgICAgfQorICAgIGN0eC0+dG1wX3ZyZWdzX2lkeCArPSBudW07CisgICAg
Z19hc3NlcnQoY3R4LT50bXBfdnJlZ3NfaWR4IDwgVkVDVE9SX1RFTVBTX01BWCk7CisgICAgcmV0
dXJuIG9mZnNldDsKK30KKwogc3RhdGljIHZvaWQgZ2VuX2V4Y2VwdGlvbl9yYXcoaW50IGV4Y3Ap
CiB7CiAgICAgVENHdl9pMzIgaGVscGVyX3RtcCA9IHRjZ19jb25zdF9pMzIoZXhjcCk7CkBAIC02
NSw2ICsxMTcsOCBAQCBzdGF0aWMgdm9pZCBnZW5fZXhlY19jb3VudGVycyhEaXNhc0NvbnRleHQg
KmN0eCkKICAgICAgICAgICAgICAgICAgICAgaGV4X2dwcltIRVhfUkVHX1FFTVVfUEtUX0NOVF0s
IGN0eC0+bnVtX3BhY2tldHMpOwogICAgIHRjZ19nZW5fYWRkaV90bChoZXhfZ3ByW0hFWF9SRUdf
UUVNVV9JTlNOX0NOVF0sCiAgICAgICAgICAgICAgICAgICAgIGhleF9ncHJbSEVYX1JFR19RRU1V
X0lOU05fQ05UXSwgY3R4LT5udW1faW5zbnMpOworICAgIHRjZ19nZW5fYWRkaV90bChoZXhfZ3By
W0hFWF9SRUdfUUVNVV9IVlhfQ05UXSwKKyAgICAgICAgICAgICAgICAgICAgaGV4X2dwcltIRVhf
UkVHX1FFTVVfSFZYX0NOVF0sIGN0eC0+bnVtX2h2eF9pbnNucyk7CiB9CiAKIHN0YXRpYyB2b2lk
IGdlbl9lbmRfdGIoRGlzYXNDb250ZXh0ICpjdHgpCkBAIC0xNzIsMTEgKzIyNiwxOSBAQCBzdGF0
aWMgdm9pZCBnZW5fc3RhcnRfcGFja2V0KERpc2FzQ29udGV4dCAqY3R4LCBQYWNrZXQgKnBrdCkK
ICAgICBiaXRtYXBfemVybyhjdHgtPnJlZ3Nfd3JpdHRlbiwgVE9UQUxfUEVSX1RIUkVBRF9SRUdT
KTsKICAgICBjdHgtPnByZWdfbG9nX2lkeCA9IDA7CiAgICAgYml0bWFwX3plcm8oY3R4LT5wcmVn
c193cml0dGVuLCBOVU1fUFJFR1MpOworICAgIGN0eC0+ZnV0dXJlX3ZyZWdzX2lkeCA9IDA7Cisg
ICAgY3R4LT50bXBfdnJlZ3NfaWR4ID0gMDsKKyAgICBjdHgtPnZyZWdfbG9nX2lkeCA9IDA7Cisg
ICAgYml0bWFwX3plcm8oY3R4LT52cmVnc191cGRhdGVkX3RtcCwgTlVNX1ZSRUdTKTsKKyAgICBi
aXRtYXBfemVybyhjdHgtPnZyZWdzX3VwZGF0ZWQsIE5VTV9WUkVHUyk7CisgICAgYml0bWFwX3pl
cm8oY3R4LT52cmVnc19zZWxlY3QsIE5VTV9WUkVHUyk7CisgICAgY3R4LT5xcmVnX2xvZ19pZHgg
PSAwOwogICAgIGZvciAoaSA9IDA7IGkgPCBTVE9SRVNfTUFYOyBpKyspIHsKICAgICAgICAgY3R4
LT5zdG9yZV93aWR0aFtpXSA9IDA7CiAgICAgfQogICAgIHRjZ19nZW5fbW92aV90bChoZXhfcGt0
X2hhc19zdG9yZV9zMSwgcGt0LT5wa3RfaGFzX3N0b3JlX3MxKTsKICAgICBjdHgtPnMxX3N0b3Jl
X3Byb2Nlc3NlZCA9IGZhbHNlOworICAgIGN0eC0+cHJlX2NvbW1pdCA9IHRydWU7CiAKICAgICBp
ZiAoSEVYX0RFQlVHKSB7CiAgICAgICAgIC8qIEhhbmR5IHBsYWNlIHRvIHNldCBhIGJyZWFrcG9p
bnQgYmVmb3JlIHRoZSBwYWNrZXQgZXhlY3V0ZXMgKi8KQEAgLTE5OCw2ICsyNjAsMjggQEAgc3Rh
dGljIHZvaWQgZ2VuX3N0YXJ0X3BhY2tldChEaXNhc0NvbnRleHQgKmN0eCwgUGFja2V0ICpwa3Qp
CiAgICAgaWYgKG5lZWRfcHJlZF93cml0dGVuKHBrdCkpIHsKICAgICAgICAgdGNnX2dlbl9tb3Zp
X3RsKGhleF9wcmVkX3dyaXR0ZW4sIDApOwogICAgIH0KKworICAgIGlmIChwa3QtPnBrdF9oYXNf
aHZ4KSB7CisgICAgICAgIHRjZ19nZW5fbW92aV90bChoZXhfVlJlZ3NfdXBkYXRlZCwgMCk7Cisg
ICAgICAgIHRjZ19nZW5fbW92aV90bChoZXhfVlJlZ3NfdXBkYXRlZF90bXAsIDApOworICAgICAg
ICB0Y2dfZ2VuX21vdmlfdGwoaGV4X1ZSZWdzX3NlbGVjdCwgMCk7CisgICAgICAgIHRjZ19nZW5f
bW92aV90bChoZXhfUVJlZ3NfdXBkYXRlZCwgMCk7CisgICAgfQorfQorCitib29sIGlzX2dhdGhl
cl9zdG9yZV9pbnNuKEluc24gKmluc24sIFBhY2tldCAqcGt0KQoreworICAgIGlmIChHRVRfQVRU
UklCKGluc24tPm9wY29kZSwgQV9DVklfTkVXKSAmJgorICAgICAgICBpbnNuLT5uZXdfdmFsdWVf
cHJvZHVjZXJfc2xvdCA9PSAxKSB7CisgICAgICAgIC8qIExvb2sgZm9yIGdhdGhlciBpbnN0cnVj
dGlvbiAqLworICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHBrdC0+bnVtX2luc25zOyBpKysp
IHsKKyAgICAgICAgICAgIEluc24gKmluID0gJnBrdC0+aW5zbltpXTsKKyAgICAgICAgICAgIGlm
IChHRVRfQVRUUklCKGluLT5vcGNvZGUsIEFfQ1ZJX0dBVEhFUikgJiYgaW4tPnNsb3QgPT0gMSkg
eworICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOworICAgICAgICAgICAgfQorICAgICAgICB9
CisgICAgfQorICAgIHJldHVybiBmYWxzZTsKIH0KIAogLyoKQEAgLTQ1MSwxMCArNTM1LDEwMiBA
QCBzdGF0aWMgdm9pZCBwcm9jZXNzX2RjemVyb2EoRGlzYXNDb250ZXh0ICpjdHgsIFBhY2tldCAq
cGt0KQogICAgIH0KIH0KIAorc3RhdGljIGJvb2wgcGt0X2hhc19odnhfc3RvcmUoUGFja2V0ICpw
a3QpCit7CisgICAgaW50IGk7CisgICAgZm9yIChpID0gMDsgaSA8IHBrdC0+bnVtX2luc25zOyBp
KyspIHsKKyAgICAgICAgaW50IG9wY29kZSA9IHBrdC0+aW5zbltpXS5vcGNvZGU7CisgICAgICAg
IGlmIChHRVRfQVRUUklCKG9wY29kZSwgQV9DVkkpICYmIEdFVF9BVFRSSUIob3Bjb2RlLCBBX1NU
T1JFKSkgeworICAgICAgICAgICAgcmV0dXJuIHRydWU7CisgICAgICAgIH0KKyAgICB9CisgICAg
cmV0dXJuIGZhbHNlOworfQorCitzdGF0aWMgdm9pZCBnZW5fY29tbWl0X2h2eChEaXNhc0NvbnRl
eHQgKmN0eCwgUGFja2V0ICpwa3QpCit7CisgICAgaW50IGk7CisKKyAgICAvKgorICAgICAqICAg
IGZvciAoaSA9IDA7IGkgPCBjdHgtPnZyZWdfbG9nX2lkeDsgaSsrKSB7CisgICAgICogICAgICAg
IGludCBybnVtID0gY3R4LT52cmVnX2xvZ1tpXTsKKyAgICAgKiAgICAgICAgaWYgKGN0eC0+dnJl
Z19pc19wcmVkaWNhdGVkW2ldKSB7CisgICAgICogICAgICAgICAgICBpZiAoZW52LT5WUmVnc191
cGRhdGVkICYgKDEgPDwgcm51bSkpIHsKKyAgICAgKiAgICAgICAgICAgICAgICBlbnYtPlZSZWdz
W3JudW1dID0gZW52LT5mdXR1cmVfVlJlZ3Nbcm51bV07CisgICAgICogICAgICAgICAgICB9Cisg
ICAgICogICAgICAgIH0gZWxzZSB7CisgICAgICogICAgICAgICAgICBlbnYtPlZSZWdzW3JudW1d
ID0gZW52LT5mdXR1cmVfVlJlZ3Nbcm51bV07CisgICAgICogICAgICAgIH0KKyAgICAgKiAgICB9
CisgICAgICovCisgICAgZm9yIChpID0gMDsgaSA8IGN0eC0+dnJlZ19sb2dfaWR4OyBpKyspIHsK
KyAgICAgICAgaW50IHJudW0gPSBjdHgtPnZyZWdfbG9nW2ldOworICAgICAgICBib29sIGlzX3By
ZWRpY2F0ZWQgPSBjdHgtPnZyZWdfaXNfcHJlZGljYXRlZFtpXTsKKyAgICAgICAgaW50cHRyX3Qg
ZHN0b2ZmID0gb2Zmc2V0b2YoQ1BVSGV4YWdvblN0YXRlLCBWUmVnc1tybnVtXSk7CisgICAgICAg
IGludHB0cl90IHNyY29mZiA9IGN0eF9mdXR1cmVfdnJlZ19vZmYoY3R4LCBybnVtLCAxLCBmYWxz
ZSk7CisgICAgICAgIHNpemVfdCBzaXplID0gc2l6ZW9mKE1NVmVjdG9yKTsKKworICAgICAgICBp
ZiAoaXNfcHJlZGljYXRlZCkgeworICAgICAgICAgICAgVENHdiBjbXAgPSB0Y2dfdGVtcF9sb2Nh
bF9uZXcoKTsKKyAgICAgICAgICAgIFRDR0xhYmVsICpsYWJlbF9za2lwID0gZ2VuX25ld19sYWJl
bCgpOworCisgICAgICAgICAgICB0Y2dfZ2VuX2FuZGlfdGwoY21wLCBoZXhfVlJlZ3NfdXBkYXRl
ZCwgMSA8PCBybnVtKTsKKyAgICAgICAgICAgIHRjZ19nZW5fYnJjb25kaV90bChUQ0dfQ09ORF9F
USwgY21wLCAwLCBsYWJlbF9za2lwKTsKKyAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAgICB0
Y2dfZ2VuX2d2ZWNfbW92KE1PXzY0LCBkc3RvZmYsIHNyY29mZiwgc2l6ZSwgc2l6ZSk7CisgICAg
ICAgICAgICB9CisgICAgICAgICAgICBnZW5fc2V0X2xhYmVsKGxhYmVsX3NraXApOworICAgICAg
ICAgICAgdGNnX3RlbXBfZnJlZShjbXApOworICAgICAgICB9IGVsc2UgeworICAgICAgICAgICAg
dGNnX2dlbl9ndmVjX21vdihNT182NCwgZHN0b2ZmLCBzcmNvZmYsIHNpemUsIHNpemUpOworICAg
ICAgICB9CisgICAgfQorCisgICAgLyoKKyAgICAgKiAgICBmb3IgKGkgPSAwOyBpIDwgY3R4LT5x
cmVnX2xvZ19pZHg7IGkrKykgeworICAgICAqICAgICAgICBpbnQgcm51bSA9IGN0eC0+cXJlZ19s
b2dbaV07CisgICAgICogICAgICAgIGlmIChjdHgtPnFyZWdfaXNfcHJlZGljYXRlZFtpXSkgewor
ICAgICAqICAgICAgICAgICAgaWYgKGVudi0+UVJlZ3NfdXBkYXRlZCkgJiAoMSA8PCBybnVtKSkg
eworICAgICAqICAgICAgICAgICAgICAgIGVudi0+UVJlZ3Nbcm51bV0gPSBlbnYtPmZ1dHVyZV9R
UmVnc1tybnVtXTsKKyAgICAgKiAgICAgICAgICAgIH0KKyAgICAgKiAgICAgICAgfSBlbHNlIHsK
KyAgICAgKiAgICAgICAgICAgIGVudi0+UVJlZ3Nbcm51bV0gPSBlbnYtPmZ1dHVyZV9RUmVnc1ty
bnVtXTsKKyAgICAgKiAgICAgICAgfQorICAgICAqICAgIH0KKyAgICAgKi8KKyAgICBmb3IgKGkg
PSAwOyBpIDwgY3R4LT5xcmVnX2xvZ19pZHg7IGkrKykgeworICAgICAgICBpbnQgcm51bSA9IGN0
eC0+cXJlZ19sb2dbaV07CisgICAgICAgIGJvb2wgaXNfcHJlZGljYXRlZCA9IGN0eC0+cXJlZ19p
c19wcmVkaWNhdGVkW2ldOworICAgICAgICBpbnRwdHJfdCBkc3RvZmYgPSBvZmZzZXRvZihDUFVI
ZXhhZ29uU3RhdGUsIFFSZWdzW3JudW1dKTsKKyAgICAgICAgaW50cHRyX3Qgc3Jjb2ZmID0gb2Zm
c2V0b2YoQ1BVSGV4YWdvblN0YXRlLCBmdXR1cmVfUVJlZ3Nbcm51bV0pOworICAgICAgICBzaXpl
X3Qgc2l6ZSA9IHNpemVvZihNTVFSZWcpOworCisgICAgICAgIGlmIChpc19wcmVkaWNhdGVkKSB7
CisgICAgICAgICAgICBUQ0d2IGNtcCA9IHRjZ190ZW1wX2xvY2FsX25ldygpOworICAgICAgICAg
ICAgVENHTGFiZWwgKmxhYmVsX3NraXAgPSBnZW5fbmV3X2xhYmVsKCk7CisKKyAgICAgICAgICAg
IHRjZ19nZW5fYW5kaV90bChjbXAsIGhleF9RUmVnc191cGRhdGVkLCAxIDw8IHJudW0pOworICAg
ICAgICAgICAgdGNnX2dlbl9icmNvbmRpX3RsKFRDR19DT05EX0VRLCBjbXAsIDAsIGxhYmVsX3Nr
aXApOworICAgICAgICAgICAgeworICAgICAgICAgICAgICAgIHRjZ19nZW5fZ3ZlY19tb3YoTU9f
NjQsIGRzdG9mZiwgc3Jjb2ZmLCBzaXplLCBzaXplKTsKKyAgICAgICAgICAgIH0KKyAgICAgICAg
ICAgIGdlbl9zZXRfbGFiZWwobGFiZWxfc2tpcCk7CisgICAgICAgICAgICB0Y2dfdGVtcF9mcmVl
KGNtcCk7CisgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAgICB0Y2dfZ2VuX2d2ZWNfbW92KE1P
XzY0LCBkc3RvZmYsIHNyY29mZiwgc2l6ZSwgc2l6ZSk7CisgICAgICAgIH0KKyAgICB9CisKKyAg
ICBpZiAocGt0X2hhc19odnhfc3RvcmUocGt0KSkgeworICAgICAgICBnZW5faGVscGVyX2NvbW1p
dF9odnhfc3RvcmVzKGNwdV9lbnYpOworICAgIH0KK30KKwogc3RhdGljIHZvaWQgdXBkYXRlX2V4
ZWNfY291bnRlcnMoRGlzYXNDb250ZXh0ICpjdHgsIFBhY2tldCAqcGt0KQogewogICAgIGludCBu
dW1faW5zbnMgPSBwa3QtPm51bV9pbnNuczsKICAgICBpbnQgbnVtX3JlYWxfaW5zbnMgPSAwOwor
ICAgIGludCBudW1faHZ4X2luc25zID0gMDsKIAogICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbnVt
X2luc25zOyBpKyspIHsKICAgICAgICAgaWYgKCFwa3QtPmluc25baV0uaXNfZW5kbG9vcCAmJgpA
QCAtNDYyLDE4ICs2MzgsMjYgQEAgc3RhdGljIHZvaWQgdXBkYXRlX2V4ZWNfY291bnRlcnMoRGlz
YXNDb250ZXh0ICpjdHgsIFBhY2tldCAqcGt0KQogICAgICAgICAgICAgIUdFVF9BVFRSSUIocGt0
LT5pbnNuW2ldLm9wY29kZSwgQV9JVF9OT1ApKSB7CiAgICAgICAgICAgICBudW1fcmVhbF9pbnNu
cysrOwogICAgICAgICB9CisgICAgICAgIGlmIChHRVRfQVRUUklCKHBrdC0+aW5zbltpXS5vcGNv
ZGUsIEFfQ1ZJKSkgeworICAgICAgICAgICAgbnVtX2h2eF9pbnNucysrOworICAgICAgICB9CiAg
ICAgfQogCiAgICAgY3R4LT5udW1fcGFja2V0cysrOwogICAgIGN0eC0+bnVtX2luc25zICs9IG51
bV9yZWFsX2luc25zOworICAgIGN0eC0+bnVtX2h2eF9pbnNucyArPSBudW1faHZ4X2luc25zOwog
fQogCi1zdGF0aWMgdm9pZCBnZW5fY29tbWl0X3BhY2tldChEaXNhc0NvbnRleHQgKmN0eCwgUGFj
a2V0ICpwa3QpCitzdGF0aWMgdm9pZCBnZW5fY29tbWl0X3BhY2tldChDUFVIZXhhZ29uU3RhdGUg
KmVudiwgRGlzYXNDb250ZXh0ICpjdHgsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQ
YWNrZXQgKnBrdCkKIHsKICAgICBnZW5fcmVnX3dyaXRlcyhjdHgpOwogICAgIGdlbl9wcmVkX3dy
aXRlcyhjdHgsIHBrdCk7CiAgICAgcHJvY2Vzc19zdG9yZV9sb2coY3R4LCBwa3QpOwogICAgIHBy
b2Nlc3NfZGN6ZXJvYShjdHgsIHBrdCk7CisgICAgaWYgKHBrdC0+cGt0X2hhc19odngpIHsKKyAg
ICAgICAgZ2VuX2NvbW1pdF9odngoY3R4LCBwa3QpOworICAgIH0KICAgICB1cGRhdGVfZXhlY19j
b3VudGVycyhjdHgsIHBrdCk7CiAgICAgaWYgKEhFWF9ERUJVRykgewogICAgICAgICBUQ0d2IGhh
c19zdDAgPQpAQCAtNDg4LDYgKzY3MiwxMSBAQCBzdGF0aWMgdm9pZCBnZW5fY29tbWl0X3BhY2tl
dChEaXNhc0NvbnRleHQgKmN0eCwgUGFja2V0ICpwa3QpCiAgICAgICAgIHRjZ190ZW1wX2ZyZWUo
aGFzX3N0MSk7CiAgICAgfQogCisgICAgaWYgKHBrdC0+dmhpc3RfaW5zbiAhPSBOVUxMKSB7Cisg
ICAgICAgIGN0eC0+cHJlX2NvbW1pdCA9IGZhbHNlOworICAgICAgICBwa3QtPnZoaXN0X2luc24t
PmdlbmVyYXRlKGVudiwgY3R4LCBwa3QtPnZoaXN0X2luc24sIHBrdCk7CisgICAgfQorCiAgICAg
aWYgKHBrdC0+cGt0X2hhc19jb2YpIHsKICAgICAgICAgZ2VuX2VuZF90YihjdHgpOwogICAgIH0K
QEAgLTUxMiw3ICs3MDEsNyBAQCBzdGF0aWMgdm9pZCBkZWNvZGVfYW5kX3RyYW5zbGF0ZV9wYWNr
ZXQoQ1BVSGV4YWdvblN0YXRlICplbnYsIERpc2FzQ29udGV4dCAqY3R4KQogICAgICAgICBmb3Ig
KGkgPSAwOyBpIDwgcGt0Lm51bV9pbnNuczsgaSsrKSB7CiAgICAgICAgICAgICBnZW5faW5zbihl
bnYsIGN0eCwgJnBrdC5pbnNuW2ldLCAmcGt0KTsKICAgICAgICAgfQotICAgICAgICBnZW5fY29t
bWl0X3BhY2tldChjdHgsICZwa3QpOworICAgICAgICBnZW5fY29tbWl0X3BhY2tldChlbnYsIGN0
eCwgJnBrdCk7CiAgICAgICAgIGN0eC0+YmFzZS5wY19uZXh0ICs9IHBrdC5lbmNvZF9wa3Rfc2l6
ZV9pbl9ieXRlczsKICAgICB9IGVsc2UgewogICAgICAgICBnZW5fZXhjZXB0aW9uX2VuZF90Yihj
dHgsIEhFWF9FWENQX0lOVkFMSURfUEFDS0VUKTsKQEAgLTUyNyw2ICs3MTYsNyBAQCBzdGF0aWMg
dm9pZCBoZXhhZ29uX3RyX2luaXRfZGlzYXNfY29udGV4dChEaXNhc0NvbnRleHRCYXNlICpkY2Jh
c2UsCiAgICAgY3R4LT5tZW1faWR4ID0gTU1VX1VTRVJfSURYOwogICAgIGN0eC0+bnVtX3BhY2tl
dHMgPSAwOwogICAgIGN0eC0+bnVtX2luc25zID0gMDsKKyAgICBjdHgtPm51bV9odnhfaW5zbnMg
PSAwOwogfQogCiBzdGF0aWMgdm9pZCBoZXhhZ29uX3RyX3RiX3N0YXJ0KERpc2FzQ29udGV4dEJh
c2UgKmRiLCBDUFVTdGF0ZSAqY3B1KQpAQCAtNjM1LDYgKzgyNSw5IEBAIHN0YXRpYyBjaGFyIHN0
b3JlX2FkZHJfbmFtZXNbU1RPUkVTX01BWF1bTkFNRV9MRU5dOwogc3RhdGljIGNoYXIgc3RvcmVf
d2lkdGhfbmFtZXNbU1RPUkVTX01BWF1bTkFNRV9MRU5dOwogc3RhdGljIGNoYXIgc3RvcmVfdmFs
MzJfbmFtZXNbU1RPUkVTX01BWF1bTkFNRV9MRU5dOwogc3RhdGljIGNoYXIgc3RvcmVfdmFsNjRf
bmFtZXNbU1RPUkVTX01BWF1bTkFNRV9MRU5dOworc3RhdGljIGNoYXIgdnN0b3JlX2FkZHJfbmFt
ZXNbVlNUT1JFU19NQVhdW05BTUVfTEVOXTsKK3N0YXRpYyBjaGFyIHZzdG9yZV9zaXplX25hbWVz
W1ZTVE9SRVNfTUFYXVtOQU1FX0xFTl07CitzdGF0aWMgY2hhciB2c3RvcmVfcGVuZGluZ19uYW1l
c1tWU1RPUkVTX01BWF1bTkFNRV9MRU5dOwogCiB2b2lkIGhleGFnb25fdHJhbnNsYXRlX2luaXQo
dm9pZCkKIHsKQEAgLTY5Nyw2ICs4OTAsMTQgQEAgdm9pZCBoZXhhZ29uX3RyYW5zbGF0ZV9pbml0
KHZvaWQpCiAgICAgICAgIG9mZnNldG9mKENQVUhleGFnb25TdGF0ZSwgbGxzY192YWwpLCAibGxz
Y192YWwiKTsKICAgICBoZXhfbGxzY192YWxfaTY0ID0gdGNnX2dsb2JhbF9tZW1fbmV3X2k2NChj
cHVfZW52LAogICAgICAgICBvZmZzZXRvZihDUFVIZXhhZ29uU3RhdGUsIGxsc2NfdmFsX2k2NCks
ICJsbHNjX3ZhbF9pNjQiKTsKKyAgICBoZXhfVlJlZ3NfdXBkYXRlZF90bXAgPSB0Y2dfZ2xvYmFs
X21lbV9uZXcoY3B1X2VudiwKKyAgICAgICAgb2Zmc2V0b2YoQ1BVSGV4YWdvblN0YXRlLCBWUmVn
c191cGRhdGVkX3RtcCksICJWUmVnc191cGRhdGVkX3RtcCIpOworICAgIGhleF9WUmVnc191cGRh
dGVkID0gdGNnX2dsb2JhbF9tZW1fbmV3KGNwdV9lbnYsCisgICAgICAgIG9mZnNldG9mKENQVUhl
eGFnb25TdGF0ZSwgVlJlZ3NfdXBkYXRlZCksICJWUmVnc191cGRhdGVkIik7CisgICAgaGV4X1ZS
ZWdzX3NlbGVjdCA9IHRjZ19nbG9iYWxfbWVtX25ldyhjcHVfZW52LAorICAgICAgICBvZmZzZXRv
ZihDUFVIZXhhZ29uU3RhdGUsIFZSZWdzX3NlbGVjdCksICJWUmVnc19zZWxlY3QiKTsKKyAgICBo
ZXhfUVJlZ3NfdXBkYXRlZCA9IHRjZ19nbG9iYWxfbWVtX25ldyhjcHVfZW52LAorICAgICAgICBv
ZmZzZXRvZihDUFVIZXhhZ29uU3RhdGUsIFFSZWdzX3VwZGF0ZWQpLCAiUVJlZ3NfdXBkYXRlZCIp
OwogICAgIGZvciAoaSA9IDA7IGkgPCBTVE9SRVNfTUFYOyBpKyspIHsKICAgICAgICAgc25wcmlu
dGYoc3RvcmVfYWRkcl9uYW1lc1tpXSwgTkFNRV9MRU4sICJzdG9yZV9hZGRyXyVkIiwgaSk7CiAg
ICAgICAgIGhleF9zdG9yZV9hZGRyW2ldID0gdGNnX2dsb2JhbF9tZW1fbmV3KGNwdV9lbnYsCkBA
IC03MTgsNCArOTE5LDIwIEBAIHZvaWQgaGV4YWdvbl90cmFuc2xhdGVfaW5pdCh2b2lkKQogICAg
ICAgICAgICAgb2Zmc2V0b2YoQ1BVSGV4YWdvblN0YXRlLCBtZW1fbG9nX3N0b3Jlc1tpXS5kYXRh
NjQpLAogICAgICAgICAgICAgc3RvcmVfdmFsNjRfbmFtZXNbaV0pOwogICAgIH0KKyAgICBmb3Ig
KGludCBpID0gMDsgaSA8IFZTVE9SRVNfTUFYOyBpKyspIHsKKyAgICAgICAgc25wcmludGYodnN0
b3JlX2FkZHJfbmFtZXNbaV0sIE5BTUVfTEVOLCAidnN0b3JlX2FkZHJfJWQiLCBpKTsKKyAgICAg
ICAgaGV4X3ZzdG9yZV9hZGRyW2ldID0gdGNnX2dsb2JhbF9tZW1fbmV3KGNwdV9lbnYsCisgICAg
ICAgICAgICBvZmZzZXRvZihDUFVIZXhhZ29uU3RhdGUsIHZzdG9yZVtpXS52YSksCisgICAgICAg
ICAgICB2c3RvcmVfYWRkcl9uYW1lc1tpXSk7CisKKyAgICAgICAgc25wcmludGYodnN0b3JlX3Np
emVfbmFtZXNbaV0sIE5BTUVfTEVOLCAidnN0b3JlX3NpemVfJWQiLCBpKTsKKyAgICAgICAgaGV4
X3ZzdG9yZV9zaXplW2ldID0gdGNnX2dsb2JhbF9tZW1fbmV3KGNwdV9lbnYsCisgICAgICAgICAg
ICBvZmZzZXRvZihDUFVIZXhhZ29uU3RhdGUsIHZzdG9yZVtpXS5zaXplKSwKKyAgICAgICAgICAg
IHZzdG9yZV9zaXplX25hbWVzW2ldKTsKKworICAgICAgICBzbnByaW50Zih2c3RvcmVfcGVuZGlu
Z19uYW1lc1tpXSwgTkFNRV9MRU4sICJ2c3RvcmVfcGVuZGluZ18lZCIsIGkpOworICAgICAgICBo
ZXhfdnN0b3JlX3BlbmRpbmdbaV0gPSB0Y2dfZ2xvYmFsX21lbV9uZXcoY3B1X2VudiwKKyAgICAg
ICAgICAgIG9mZnNldG9mKENQVUhleGFnb25TdGF0ZSwgdnN0b3JlX3BlbmRpbmdbaV0pLAorICAg
ICAgICAgICAgdnN0b3JlX3BlbmRpbmdfbmFtZXNbaV0pOworICAgIH0KIH0KLS0gCjIuNy40Cgo=

