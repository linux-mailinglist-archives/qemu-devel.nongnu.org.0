Return-Path: <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>
X-Original-To: lists+qemu-devel@lfdr.de
Delivered-To: lists+qemu-devel@lfdr.de
Received: from lists.gnu.org (lists.gnu.org [209.51.188.17])
	by mail.lfdr.de (Postfix) with ESMTPS id 3DDA31587D7
	for <lists+qemu-devel@lfdr.de>; Tue, 11 Feb 2020 02:18:14 +0100 (CET)
Received: from localhost ([::1]:42058 helo=lists1p.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.90_1)
	(envelope-from <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>)
	id 1j1KBp-0007hk-8P
	for lists+qemu-devel@lfdr.de; Mon, 10 Feb 2020 20:18:13 -0500
Received: from eggs.gnu.org ([2001:470:142:3::10]:34052)
 by lists.gnu.org with esmtp (Exim 4.90_1)
 (envelope-from <tsimpson@qualcomm.com>) id 1j1Jcm-0002TD-Na
 for qemu-devel@nongnu.org; Mon, 10 Feb 2020 19:42:07 -0500
Received: from Debian-exim by eggs.gnu.org with spam-scanned (Exim 4.71)
 (envelope-from <tsimpson@qualcomm.com>) id 1j1Jcj-0001t4-9O
 for qemu-devel@nongnu.org; Mon, 10 Feb 2020 19:42:00 -0500
Received: from alexa-out-sd-02.qualcomm.com ([199.106.114.39]:59203)
 by eggs.gnu.org with esmtps (TLS1.0:RSA_AES_256_CBC_SHA1:32)
 (Exim 4.71) (envelope-from <tsimpson@qualcomm.com>)
 id 1j1Jci-0004tJ-US
 for qemu-devel@nongnu.org; Mon, 10 Feb 2020 19:41:57 -0500
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=quicinc.com; i=@quicinc.com; q=dns/txt; s=qcdkim;
 t=1581381716; x=1612917716;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=qyyQ+IpbqI6duckxQEN7fmDYeXzbWzISBb946m4BDyw=;
 b=kkkhLl6MdgNmO7vKD1nVddDYQDcmzf9PeimAdUXXT5Nj9RlxhxIZHzmr
 tVE7JXOhDfjKIoxW7b+1OtEAQk0Z1q6Z5qe4XUVa9ibji8FG1h6iWyiK+
 c6BL+ntrZprErLfa3uBm/a/p4IccEbftBPbwA1Y7PLGHrbqijJCRDvIKJ w=;
Received: from unknown (HELO ironmsg05-sd.qualcomm.com) ([10.53.140.145])
 by alexa-out-sd-02.qualcomm.com with ESMTP; 10 Feb 2020 16:41:02 -0800
Received: from vu-tsimpson-aus.qualcomm.com (HELO
 vu-tsimpson1-aus.qualcomm.com) ([10.222.150.1])
 by ironmsg05-sd.qualcomm.com with ESMTP; 10 Feb 2020 16:41:02 -0800
Received: by vu-tsimpson1-aus.qualcomm.com (Postfix, from userid 47164)
 id F2D001BBA; Mon, 10 Feb 2020 18:41:01 -0600 (CST)
From: Taylor Simpson <tsimpson@quicinc.com>
To: qemu-devel@nongnu.org
Subject: [RFC PATCH 50/66] Hexagon translation
Date: Mon, 10 Feb 2020 18:40:28 -0600
Message-Id: <1581381644-13678-51-git-send-email-tsimpson@quicinc.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1581381644-13678-1-git-send-email-tsimpson@quicinc.com>
References: <1581381644-13678-1-git-send-email-tsimpson@quicinc.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
X-detected-operating-system: by eggs.gnu.org: FreeBSD 9.x [fuzzy]
X-Received-From: 199.106.114.39
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <https://lists.nongnu.org/archive/html/qemu-devel>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Cc: riku.voipio@iki.fi, richard.henderson@linaro.org, laurent@vivier.eu,
 Taylor Simpson <tsimpson@quicinc.com>, philmd@redhat.com,
 aleksandar.m.mail@gmail.com
Errors-To: qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org
Sender: "Qemu-devel" <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>

UmVhZCB0aGUgaW5zdHJ1Y3Rpb24gbWVtb3J5CkNyZWF0ZSBhIHBhY2tldCBkYXRhIHN0cnVjdHVy
ZQpHZW5lcmF0ZSBUQ0cgY29kZSBmb3IgdGhlIHN0YXJ0IG9mIHRoZSBwYWNrZXQKSW52b2tlIHRo
ZSBnZW5lcmF0ZSBmdW5jdGlvbiBmb3IgZWFjaCBpbnN0cnVjdGlvbgpHZW5lcmF0ZSBUQ0cgY29k
ZSBmb3IgdGhlIGVuZCBvZiB0aGUgcGFja2V0CgpTaWduZWQtb2ZmLWJ5OiBUYXlsb3IgU2ltcHNv
biA8dHNpbXBzb25AcXVpY2luYy5jb20+Ci0tLQogdGFyZ2V0L2hleGFnb24vdHJhbnNsYXRlLmMg
fCA3MzIgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiB0YXJn
ZXQvaGV4YWdvbi90cmFuc2xhdGUuaCB8ICA4MiArKysrKwogMiBmaWxlcyBjaGFuZ2VkLCA4MTQg
aW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0IHRhcmdldC9oZXhhZ29uL3RyYW5zbGF0
ZS5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgdGFyZ2V0L2hleGFnb24vdHJhbnNsYXRlLmgKCmRpZmYg
LS1naXQgYS90YXJnZXQvaGV4YWdvbi90cmFuc2xhdGUuYyBiL3RhcmdldC9oZXhhZ29uL3RyYW5z
bGF0ZS5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAuLjJmZTRkY2IKLS0tIC9k
ZXYvbnVsbAorKysgYi90YXJnZXQvaGV4YWdvbi90cmFuc2xhdGUuYwpAQCAtMCwwICsxLDczMiBA
QAorLyoKKyAqICBDb3B5cmlnaHQgKGMpIDIwMTkgUXVhbGNvbW0gSW5ub3ZhdGlvbiBDZW50ZXIs
IEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC4KKyAqCisgKiAgVGhpcyBwcm9ncmFtIGlzIGZyZWUg
c29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKKyAqICBpdCB1
bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxp
c2hlZCBieQorICogIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlciB2ZXJzaW9u
IDIgb2YgdGhlIExpY2Vuc2UsIG9yCisgKiAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVy
c2lvbi4KKyAqCisgKiAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRo
YXQgaXQgd2lsbCBiZSB1c2VmdWwsCisgKiAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRo
b3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKKyAqICBNRVJDSEFOVEFCSUxJVFkgb3Ig
RklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCisgKiAgR05VIEdlbmVy
YWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KKyAqCisgKiAgWW91IHNob3VsZCBo
YXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKKyAq
ICBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbTsgaWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9y
Zy9saWNlbnNlcy8+LgorICovCisKKyNkZWZpbmUgUUVNVV9HRU5FUkFURQorI2luY2x1ZGUgInFl
bXUvb3NkZXAuaCIKKyNpbmNsdWRlICJjcHUuaCIKKyNpbmNsdWRlICJ0Y2cvdGNnLW9wLmgiCisj
aW5jbHVkZSAiZXhlYy9jcHVfbGRzdC5oIgorI2luY2x1ZGUgImV4ZWMvbG9nLmgiCisjaW5jbHVk
ZSAiaW50ZXJuYWwuaCIKKyNpbmNsdWRlICJhdHRyaWJzLmgiCisjaW5jbHVkZSAiaW5zbi5oIgor
I2luY2x1ZGUgImRlY29kZS5oIgorI2luY2x1ZGUgInRyYW5zbGF0ZS5oIgorI2luY2x1ZGUgInBy
aW50aW5zbi5oIgorI2luY2x1ZGUgIm1hY3Jvcy5oIgorCitUQ0d2IGhleF9ncHJbVE9UQUxfUEVS
X1RIUkVBRF9SRUdTXTsKK1RDR3YgaGV4X3ByZWRbTlVNX1BSRUdTXTsKK1RDR3YgaGV4X25leHRf
UEM7CitUQ0d2IGhleF90aGlzX1BDOworVENHdiBoZXhfc2xvdF9jYW5jZWxsZWQ7CitUQ0d2IGhl
eF9icmFuY2hfdGFrZW47CitUQ0d2IGhleF9uZXdfdmFsdWVbVE9UQUxfUEVSX1RIUkVBRF9SRUdT
XTsKKyNpZiBIRVhfREVCVUcKK1RDR3YgaGV4X3JlZ193cml0dGVuW1RPVEFMX1BFUl9USFJFQURf
UkVHU107CisjZW5kaWYKK1RDR3YgaGV4X25ld19wcmVkX3ZhbHVlW05VTV9QUkVHU107CitUQ0d2
IGhleF9wcmVkX3dyaXR0ZW5bTlVNX1BSRUdTXTsKK1RDR3YgaGV4X3N0b3JlX2FkZHJbU1RPUkVT
X01BWF07CitUQ0d2IGhleF9zdG9yZV93aWR0aFtTVE9SRVNfTUFYXTsKK1RDR3YgaGV4X3N0b3Jl
X3ZhbDMyW1NUT1JFU19NQVhdOworVENHdl9pNjQgaGV4X3N0b3JlX3ZhbDY0W1NUT1JFU19NQVhd
OworVENHdiBoZXhfZGN6ZXJvX2FkZHI7CitUQ0d2IGxsc2NfYWRkcjsKK1RDR3YgbGxzY192YWw7
CitUQ0d2X2k2NCBsbHNjX3ZhbF9pNjQ7CitUQ0d2IGhleF9pc19nYXRoZXJfc3RvcmVfaW5zbjsK
K1RDR3YgaGV4X2dhdGhlcl9pc3N1ZWQ7CisKK3N0YXRpYyBjb25zdCBjaGFyICogY29uc3QgaGV4
YWdvbl9wcmVkbmFtZXNbXSA9IHsKKyAgInAwIiwgInAxIiwgInAyIiwgInAzIgorfTsKKwordm9p
ZCBnZW5fZXhjZXB0aW9uKGludCBleGNwKQoreworICAgIFRDR3ZfaTMyIGhlbHBlcl90bXAgPSB0
Y2dfY29uc3RfaTMyKGV4Y3ApOworICAgIGdlbl9oZWxwZXJfcmFpc2VfZXhjZXB0aW9uKGNwdV9l
bnYsIGhlbHBlcl90bXApOworICAgIHRjZ190ZW1wX2ZyZWVfaTMyKGhlbHBlcl90bXApOworfQor
Cit2b2lkIGdlbl9leGNlcHRpb25fZGVidWcodm9pZCkKK3sKKyAgICBnZW5fZXhjZXB0aW9uKEVY
Q1BfREVCVUcpOworfQorCisjaWYgSEVYX0RFQlVHCitzdGF0aWMgdm9pZCBwcmludF9wa3QocGFj
a2V0X3QgKnBrdCkKK3sKKyAgICBjaGFyIGJ1ZlsxMDI4XTsKKyAgICBzbnByaW50X2FfcGt0KGJ1
ZiwgMTI4LCBwa3QpOworICAgIEhFWF9ERUJVR19MT0coIiVzIiwgYnVmKTsKK30KKyNkZWZpbmUg
SEVYX0RFQlVHX1BSSU5UX1BLVChwa3QpICBwcmludF9wa3QocGt0KQorI2Vsc2UKKyNkZWZpbmUg
SEVYX0RFQlVHX1BSSU5UX1BLVChwa3QpICAvKiBub3RoaW5nICovCisjZW5kaWYKKworc3RhdGlj
IGludCByZWFkX3BhY2tldF93b3JkcyhDUFVIZXhhZ29uU3RhdGUgKmVudiwgRGlzYXNDb250ZXh0
ICpjdHgsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVpbnQzMl90IHdvcmRzW10pCit7
CisgICAgYm9vbCBmb3VuZF9lbmQgPSBmYWxzZTsKKyAgICBpbnQgbWF4X3dvcmRzOworICAgIGlu
dCBud29yZHM7CisgICAgaW50IGk7CisKKyAgICAvKiBNYWtlIHN1cmUgd2UgZG9uJ3QgY3Jvc3Mg
YSBwYWdlIGJvdW5kYXJ5ICovCisgICAgbWF4X3dvcmRzID0gLShjdHgtPmJhc2UucGNfbmV4dCB8
IFRBUkdFVF9QQUdFX01BU0spIC8gc2l6ZW9mKHVpbnQzMl90KTsKKyAgICBpZiAobWF4X3dvcmRz
IDwgUEFDS0VUX1dPUkRTX01BWCkgeworICAgICAgICAvKiBNaWdodCBjcm9zcyBhIHBhZ2UgYm91
bmRhcnkgKi8KKyAgICAgICAgaWYgKGN0eC0+YmFzZS5udW1faW5zbnMgPT0gMSkgeworICAgICAg
ICAgICAgLyogT0sgaWYgaXQncyB0aGUgZmlyc3QgcGFja2V0IGluIHRoZSBUQiAqLworICAgICAg
ICAgICAgbWF4X3dvcmRzID0gUEFDS0VUX1dPUkRTX01BWDsKKyAgICAgICAgfQorICAgIH0gZWxz
ZSB7CisgICAgICAgIG1heF93b3JkcyA9IFBBQ0tFVF9XT1JEU19NQVg7CisgICAgfQorCisgICAg
bWVtc2V0KHdvcmRzLCAwLCBQQUNLRVRfV09SRFNfTUFYICogc2l6ZW9mKHVpbnQzMl90KSk7Cisg
ICAgZm9yIChud29yZHMgPSAwOyAhZm91bmRfZW5kICYmIG53b3JkcyA8IG1heF93b3Jkczsgbndv
cmRzKyspIHsKKyAgICAgICAgd29yZHNbbndvcmRzXSA9IGNwdV9sZGxfY29kZShlbnYsCisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC0+YmFzZS5wY19uZXh0ICsgbndvcmRzICog
c2l6ZW9mKHVpbnQzMl90KSk7CisgICAgICAgIGZvdW5kX2VuZCA9IGlzX3BhY2tldF9lbmQod29y
ZHNbbndvcmRzXSk7CisgICAgfQorICAgIGlmICghZm91bmRfZW5kKSB7CisgICAgICAgIGlmIChu
d29yZHMgPT0gUEFDS0VUX1dPUkRTX01BWCkgeworICAgICAgICAgICAgLyogUmVhZCB0b28gbWFu
eSB3b3JkcyB3aXRob3V0IGZpbmRpbmcgdGhlIGVuZCAqLworICAgICAgICAgICAgZ2VuX2V4Y2Vw
dGlvbihIRVhfRVhDUF9JTlZBTElEX1BBQ0tFVCk7CisgICAgICAgICAgICBjdHgtPmJhc2UuaXNf
am1wID0gRElTQVNfTk9SRVRVUk47CisgICAgICAgICAgICByZXR1cm4gMDsKKyAgICAgICAgfQor
ICAgICAgICAvKiBDcm9zc2VzIHBhZ2UgYm91bmRhcnkgLSBkZWZlciB0byBuZXh0IFRCICovCisg
ICAgICAgIGN0eC0+YmFzZS5pc19qbXAgPSBESVNBU19UT09fTUFOWTsKKyAgICAgICAgcmV0dXJu
IDA7CisgICAgfQorCisgICAgSEVYX0RFQlVHX0xPRygiZGVjb2RlX3BhY2tldDogcGMgPSAweCV4
XG4iLCBjdHgtPmJhc2UucGNfbmV4dCk7CisgICAgSEVYX0RFQlVHX0xPRygiICAgIHdvcmRzID0g
eyAiKTsKKyAgICBmb3IgKGkgPSAwOyBpIDwgbndvcmRzOyBpKyspIHsKKyAgICAgICAgSEVYX0RF
QlVHX0xPRygiMHgleCwgIiwgd29yZHNbaV0pOworICAgIH0KKyAgICBIRVhfREVCVUdfTE9HKCJ9
XG4iKTsKKworICAgIHJldHVybiBud29yZHM7Cit9CisKK3N0YXRpYyB2b2lkIGdlbl9zdGFydF9w
YWNrZXQoRGlzYXNDb250ZXh0ICpjdHgsIHBhY2tldF90ICpwa3QpCit7CisgICAgdGFyZ2V0X3Vs
b25nIG5leHRfUEMgPSBjdHgtPmJhc2UucGNfbmV4dCArIHBrdC0+ZW5jb2RfcGt0X3NpemVfaW5f
Ynl0ZXM7CisgICAgaW50IGk7CisKKyAgICAvKiBDbGVhciBvdXQgdGhlIGRpc2Fzc2VtYmx5IGNv
bnRleHQgKi8KKyAgICBjdHgtPmN0eF9yZWdfbG9nX2lkeCA9IDA7CisgICAgY3R4LT5jdHhfcHJl
Z19sb2dfaWR4ID0gMDsKKyAgICBmb3IgKGkgPSAwOyBpIDwgU1RPUkVTX01BWDsgaSsrKSB7Cisg
ICAgICAgIGN0eC0+Y3R4X3N0b3JlX3dpZHRoW2ldID0gMDsKKyAgICB9CisKKyNpZiBIRVhfREVC
VUcKKyAgICAvKiBIYW5keSBwbGFjZSB0byBzZXQgYSBicmVha3BvaW50IGJlZm9yZSB0aGUgcGFj
a2V0IGV4ZWN1dGVzICovCisgICAgZ2VuX2hlbHBlcl9kZWJ1Z19zdGFydF9wYWNrZXQoY3B1X2Vu
dik7CisjZW5kaWYKKworICAgIC8qIEluaXRpYWxpemUgdGhlIHJ1bnRpbWUgc3RhdGUgZm9yIHBh
Y2tldCBzZW1hbnRpY3MgKi8KKyAgICB0Y2dfZ2VuX21vdmlfdGwoaGV4X2dwcltIRVhfUkVHX1BD
XSwgY3R4LT5iYXNlLnBjX25leHQpOworICAgIHRjZ19nZW5fbW92aV90bChoZXhfc2xvdF9jYW5j
ZWxsZWQsIDApOworICAgIHRjZ19nZW5fbW92aV90bChoZXhfYnJhbmNoX3Rha2VuLCAwKTsKKyAg
ICB0Y2dfZ2VuX21vdl90bChoZXhfdGhpc19QQywgaGV4X2dwcltIRVhfUkVHX1BDXSk7CisgICAg
dGNnX2dlbl9tb3ZpX3RsKGhleF9uZXh0X1BDLCBuZXh0X1BDKTsKKyAgICBmb3IgKGkgPSAwOyBp
IDwgTlVNX1BSRUdTOyBpKyspIHsKKyAgICAgICAgdGNnX2dlbl9tb3ZpX3RsKGhleF9wcmVkX3dy
aXR0ZW5baV0sIDApOworICAgIH0KK30KKworc3RhdGljIGludCBpc19nYXRoZXJfc3RvcmVfaW5z
bihpbnNuX3QgKmluc24pCit7CisgICAgaW50IGNoZWNrID0gR0VUX0FUVFJJQihpbnNuLT5vcGNv
ZGUsIEFfQ1ZJX05FVyk7CisgICAgY2hlY2sgJj0gKGluc24tPm5ld192YWx1ZV9wcm9kdWNlcl9z
bG90ID09IDEpOworICAgIHJldHVybiBjaGVjazsKK30KKworLyoKKyAqIFRoZSBMT0dfKl9XUklU
RSBtYWNyb3MgbWFyayBtb3N0IG9mIHRoZSB3cml0ZXMgaW4gYSBwYWNrZXQKKyAqIEhvd2V2ZXIs
IHRoZXJlIGFyZSBzb21lIGltcGxpY2l0IHdyaXRlcyBtYXJrZWQgYXMgYXR0cmlidXRlcworICog
b2YgdGhlIGFwcGxpY2FibGUgaW5zdHJ1Y3Rpb25zLgorICovCitzdGF0aWMgdm9pZCBtYXJrX2lt
cGxpY2l0X3JlZ193cml0ZShEaXNhc0NvbnRleHQgKmN0eCwgaW5zbl90ICppbnNuLAorICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IGF0dHJpYiwgaW50IHJudW0pCit7Cisg
ICAgaWYgKEdFVF9BVFRSSUIoaW5zbi0+b3Bjb2RlLCBhdHRyaWIpKSB7CisgICAgICAgIGN0eC0+
Y3R4X3JlZ19sb2dbY3R4LT5jdHhfcmVnX2xvZ19pZHhdID0gcm51bTsKKyAgICAgICAgY3R4LT5j
dHhfcmVnX2xvZ19pZHgrKzsKKyAgICB9Cit9CisKK3N0YXRpYyB2b2lkIG1hcmtfaW1wbGljaXRf
cHJlZF93cml0ZShEaXNhc0NvbnRleHQgKmN0eCwgaW5zbl90ICppbnNuLAorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGludCBhdHRyaWIsIGludCBwbnVtKQoreworICAgIGlm
IChHRVRfQVRUUklCKGluc24tPm9wY29kZSwgYXR0cmliKSkgeworICAgICAgICBjdHgtPmN0eF9w
cmVnX2xvZ1tjdHgtPmN0eF9wcmVnX2xvZ19pZHhdID0gcG51bTsKKyAgICAgICAgY3R4LT5jdHhf
cHJlZ19sb2dfaWR4Kys7CisgICAgfQorfQorCitzdGF0aWMgdm9pZCBtYXJrX2ltcGxpY2l0X3dy
aXRlcyhEaXNhc0NvbnRleHQgKmN0eCwgaW5zbl90ICppbnNuKQoreworICAgIG1hcmtfaW1wbGlj
aXRfcmVnX3dyaXRlKGN0eCwgaW5zbiwgQV9JTVBMSUNJVF9XUklURVNfTFIsICBIRVhfUkVHX0xS
KTsKKyAgICBtYXJrX2ltcGxpY2l0X3JlZ193cml0ZShjdHgsIGluc24sIEFfSU1QTElDSVRfV1JJ
VEVTX0xDMCwgSEVYX1JFR19MQzApOworICAgIG1hcmtfaW1wbGljaXRfcmVnX3dyaXRlKGN0eCwg
aW5zbiwgQV9JTVBMSUNJVF9XUklURVNfU0EwLCBIRVhfUkVHX1NBMCk7CisgICAgbWFya19pbXBs
aWNpdF9yZWdfd3JpdGUoY3R4LCBpbnNuLCBBX0lNUExJQ0lUX1dSSVRFU19MQzEsIEhFWF9SRUdf
TEMxKTsKKyAgICBtYXJrX2ltcGxpY2l0X3JlZ193cml0ZShjdHgsIGluc24sIEFfSU1QTElDSVRf
V1JJVEVTX1NBMSwgSEVYX1JFR19TQTEpOworCisgICAgbWFya19pbXBsaWNpdF9wcmVkX3dyaXRl
KGN0eCwgaW5zbiwgQV9JTVBMSUNJVF9XUklURVNfUDAsIDApOworICAgIG1hcmtfaW1wbGljaXRf
cHJlZF93cml0ZShjdHgsIGluc24sIEFfSU1QTElDSVRfV1JJVEVTX1AxLCAxKTsKKyAgICBtYXJr
X2ltcGxpY2l0X3ByZWRfd3JpdGUoY3R4LCBpbnNuLCBBX0lNUExJQ0lUX1dSSVRFU19QMiwgMik7
CisgICAgbWFya19pbXBsaWNpdF9wcmVkX3dyaXRlKGN0eCwgaW5zbiwgQV9JTVBMSUNJVF9XUklU
RVNfUDMsIDMpOworfQorCitzdGF0aWMgdm9pZCBnZW5faW5zbihDUFVIZXhhZ29uU3RhdGUgKmVu
diwgRGlzYXNDb250ZXh0ICpjdHgsIGluc25fdCAqaW5zbikKK3sKKyAgICBpZiAoaW5zbi0+Z2Vu
ZXJhdGUpIHsKKyAgICAgICAgYm9vbCBpc19nYXRoZXJfc3RvcmUgPSBpc19nYXRoZXJfc3RvcmVf
aW5zbihpbnNuKTsKKyAgICAgICAgaWYgKGlzX2dhdGhlcl9zdG9yZSkgeworICAgICAgICAgICAg
dGNnX2dlbl9tb3ZpX3RsKGhleF9pc19nYXRoZXJfc3RvcmVfaW5zbiwgMSk7CisgICAgICAgIH0K
KyAgICAgICAgaW5zbi0+Z2VuZXJhdGUoZW52LCBjdHgsIGluc24pOworICAgICAgICBtYXJrX2lt
cGxpY2l0X3dyaXRlcyhjdHgsIGluc24pOworICAgICAgICBpZiAoaXNfZ2F0aGVyX3N0b3JlKSB7
CisgICAgICAgICAgICB0Y2dfZ2VuX21vdmlfdGwoaGV4X2lzX2dhdGhlcl9zdG9yZV9pbnNuLCAw
KTsKKyAgICAgICAgfQorICAgIH0gZWxzZSB7CisgICAgICAgIGdlbl9leGNlcHRpb24oSEVYX0VY
Q1BfSU5WQUxJRF9PUENPREUpOworICAgICAgICBjdHgtPmJhc2UuaXNfam1wID0gRElTQVNfTk9S
RVRVUk47CisgICAgfQorfQorCisvKgorICogSGVscGVycyBmb3IgZ2VuZXJhdGluZyB0aGUgcGFj
a2V0IGNvbW1pdAorICovCitzdGF0aWMgdm9pZCBnZW5fcmVnX3dyaXRlcyhEaXNhc0NvbnRleHQg
KmN0eCkKK3sKKyAgICBpbnQgaTsKKworICAgIGZvciAoaSA9IDA7IGkgPCBjdHgtPmN0eF9yZWdf
bG9nX2lkeDsgaSsrKSB7CisgICAgICAgIGludCByZWdfbnVtID0gY3R4LT5jdHhfcmVnX2xvZ1tp
XTsKKworICAgICAgICB0Y2dfZ2VuX21vdl90bChoZXhfZ3ByW3JlZ19udW1dLCBoZXhfbmV3X3Zh
bHVlW3JlZ19udW1dKTsKKyNpZiBIRVhfREVCVUcKKyAgICAgICAgLyogRG8gdGhpcyBzbyBIRUxQ
RVIoZGVidWdfY29tbWl0X2VuZCkgd2lsbCBrbm93ICovCisgICAgICAgIHRjZ19nZW5fbW92aV90
bChoZXhfcmVnX3dyaXR0ZW5bcmVnX251bV0sIDEpOworI2VuZGlmCisgICAgfQorfQorCitzdGF0
aWMgdm9pZCBnZW5fcHJlZF93cml0ZXMoRGlzYXNDb250ZXh0ICpjdHgsIHBhY2tldF90ICpwa3Qp
Cit7CisgICAgLyogRWFybHkgZXhpdCBpZiB0aGUgbG9nIGlzIGVtcHR5ICovCisgICAgaWYgKCFj
dHgtPmN0eF9wcmVnX2xvZ19pZHgpIHsKKyAgICAgICAgcmV0dXJuOworICAgIH0KKworICAgIFRD
R3YgemVybyA9IHRjZ19jb25zdF90bCgwKTsKKyAgICBUQ0d2IGNvbnRyb2xfcmVnID0gdGNnX3Rl
bXBfbmV3KCk7CisgICAgVENHdiBwdmFsID0gdGNnX3RlbXBfbmV3KCk7CisgICAgaW50IGk7CisK
KyAgICAvKgorICAgICAqIE9ubHkgZW5kbG9vcCBpbnN0cnVjdGlvbnMgd2lsbCBjb25kaXRpb25h
bGx5CisgICAgICogd3JpdGUgYSBwcmVkaWNhdGUuICBJZiB0aGVyZSBhcmUgbm8gZW5kbG9vcAor
ICAgICAqIGluc3RydWN0aW9ucywgd2UgY2FuIHVzZSB0aGUgbm9uLWNvbmRpdGlvbmFsCisgICAg
ICogd3JpdGUgb2YgdGhlIHByZWRpY2F0ZXMuCisgICAgICovCisgICAgaWYgKHBrdC0+cGt0X2hh
c19lbmRsb29wKSB7CisgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjdHgtPmN0eF9wcmVnX2xvZ19p
ZHg7IGkrKykgeworICAgICAgICAgICAgaW50IHByZWRfbnVtID0gY3R4LT5jdHhfcHJlZ19sb2db
aV07CisKKyAgICAgICAgICAgIHRjZ19nZW5fbW92Y29uZF90bChUQ0dfQ09ORF9ORSwgaGV4X3By
ZWRbcHJlZF9udW1dLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhleF9wcmVkX3dy
aXR0ZW5bcHJlZF9udW1dLCB6ZXJvLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhl
eF9uZXdfcHJlZF92YWx1ZVtwcmVkX251bV0sCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgaGV4X3ByZWRbcHJlZF9udW1dKTsKKyAgICAgICAgfQorICAgIH0gZWxzZSB7CisgICAgICAg
IGZvciAoaSA9IDA7IGkgPCBjdHgtPmN0eF9wcmVnX2xvZ19pZHg7IGkrKykgeworICAgICAgICAg
ICAgaW50IHByZWRfbnVtID0gY3R4LT5jdHhfcHJlZ19sb2dbaV07CisgICAgICAgICAgICB0Y2df
Z2VuX21vdl90bChoZXhfcHJlZFtwcmVkX251bV0sIGhleF9uZXdfcHJlZF92YWx1ZVtwcmVkX251
bV0pOworI2lmIEhFWF9ERUJVRworICAgICAgICAgICAgLyogRG8gdGhpcyBzbyBIRUxQRVIoZGVi
dWdfY29tbWl0X2VuZCkgd2lsbCBrbm93ICovCisgICAgICAgICAgICB0Y2dfZ2VuX21vdmlfdGwo
aGV4X3ByZWRfd3JpdHRlbltwcmVkX251bV0sIDEpOworI2VuZGlmCisgICAgICAgIH0KKyAgICB9
CisKKyAgICB0Y2dfdGVtcF9mcmVlKHplcm8pOworICAgIHRjZ190ZW1wX2ZyZWUoY29udHJvbF9y
ZWcpOworICAgIHRjZ190ZW1wX2ZyZWUocHZhbCk7Cit9CisKKyNpZiBIRVhfREVCVUcKK3N0YXRp
YyBpbmxpbmUgdm9pZCBnZW5fY2hlY2tfc3RvcmVfd2lkdGgoRGlzYXNDb250ZXh0ICpjdHgsIGlu
dCBzbG90X251bSkKK3sKKyAgICBUQ0d2IHNsb3QgPSB0Y2dfY29uc3RfdGwoc2xvdF9udW0pOwor
ICAgIFRDR3YgY2hlY2sgPSB0Y2dfY29uc3RfdGwoY3R4LT5jdHhfc3RvcmVfd2lkdGhbc2xvdF9u
dW1dKTsKKyAgICBnZW5faGVscGVyX2RlYnVnX2NoZWNrX3N0b3JlX3dpZHRoKGNwdV9lbnYsIHNs
b3QsIGNoZWNrKTsKKyAgICB0Y2dfdGVtcF9mcmVlKHNsb3QpOworICAgIHRjZ190ZW1wX2ZyZWUo
Y2hlY2spOworfQorI2RlZmluZSBIRVhfREVCVUdfR0VOX0NIRUNLX1NUT1JFX1dJRFRIKGN0eCwg
c2xvdF9udW0pIFwKKyAgICBnZW5fY2hlY2tfc3RvcmVfd2lkdGgoY3R4LCBzbG90X251bSkKKyNl
bHNlCisjZGVmaW5lIEhFWF9ERUJVR19HRU5fQ0hFQ0tfU1RPUkVfV0lEVEgoY3R4LCBzbG90X251
bSkgIC8qIG5vdGhpbmcgKi8KKyNlbmRpZgorCitzdGF0aWMgdm9pZCBwcm9jZXNzX3N0b3JlKERp
c2FzQ29udGV4dCAqY3R4LCBpbnQgc2xvdF9udW0pCit7CisgICAgVENHdiBjYW5jZWxsZWQgPSB0
Y2dfdGVtcF9sb2NhbF9uZXcoKTsKKyAgICBUQ0dMYWJlbCAqbGFiZWxfZW5kID0gZ2VuX25ld19s
YWJlbCgpOworCisgICAgLyogRG9uJ3QgZG8gYW55dGhpbmcgaWYgdGhlIHNsb3Qgd2FzIGNhbmNl
bGxlZCAqLworICAgIGdlbl9zbG90X2NhbmNlbGxlZF9jaGVjayhjYW5jZWxsZWQsIHNsb3RfbnVt
KTsKKyAgICB0Y2dfZ2VuX2JyY29uZGlfdGwoVENHX0NPTkRfTkUsIGNhbmNlbGxlZCwgMCwgbGFi
ZWxfZW5kKTsKKyAgICB7CisgICAgICAgIGludCBjdHhfd2lkdGggPSBjdHgtPmN0eF9zdG9yZV93
aWR0aFtzbG90X251bV07CisgICAgICAgIFRDR3YgYWRkcmVzcyA9IHRjZ190ZW1wX2xvY2FsX25l
dygpOworICAgICAgICB0Y2dfZ2VuX21vdl90bChhZGRyZXNzLCBoZXhfc3RvcmVfYWRkcltzbG90
X251bV0pOworCisgICAgICAgIC8qCisgICAgICAgICAqIElmIHdlIGtub3cgdGhlIHdpZHRoIGZy
b20gdGhlIERpc2FzQ29udGV4dCwgd2UgY2FuCisgICAgICAgICAqIGdlbmVyYXRlIG11Y2ggY2xl
YW5lciBjb2RlLgorICAgICAgICAgKiBVbmZvcnR1bmF0ZWx5LCBub3QgYWxsIGluc3RydWN0aW9u
cyBleGVjdXRlIHRoZSBmU1RPUkUKKyAgICAgICAgICogbWFjcm8gZHVyaW5nIGNvZGUgZ2VuZXJh
dGlvbi4gIEFueXRoaW5nIHRoYXQgdXNlcyB0aGUKKyAgICAgICAgICogZ2VuZXJpYyBoZWxwZXIg
d2lsbCBoYXZlIHRoaXMgcHJvYmxlbS4gIEluc3RydWN0aW9ucworICAgICAgICAgKiB0aGF0IHVz
ZSBmV1JBUCB0byBnZW5lcmF0ZSBwcm9wZXIgVENHIGNvZGUgd2lsbCBiZSBPSy4KKyAgICAgICAg
ICovCisgICAgICAgIGlmIChjdHhfd2lkdGggPT0gMSkgeworICAgICAgICAgICAgSEVYX0RFQlVH
X0dFTl9DSEVDS19TVE9SRV9XSURUSChjdHgsIHNsb3RfbnVtKTsKKyAgICAgICAgICAgIFRDR3Yg
dmFsdWUgPSB0Y2dfdGVtcF9uZXcoKTsKKyAgICAgICAgICAgIHRjZ19nZW5fbW92X3RsKHZhbHVl
LCBoZXhfc3RvcmVfdmFsMzJbc2xvdF9udW1dKTsKKyAgICAgICAgICAgIHRjZ19nZW5fcWVtdV9z
dDgodmFsdWUsIGFkZHJlc3MsIGN0eC0+bWVtX2lkeCk7CisgICAgICAgICAgICB0Y2dfdGVtcF9m
cmVlKHZhbHVlKTsKKyAgICAgICAgfSBlbHNlIGlmIChjdHhfd2lkdGggPT0gMikgeworICAgICAg
ICAgICAgSEVYX0RFQlVHX0dFTl9DSEVDS19TVE9SRV9XSURUSChjdHgsIHNsb3RfbnVtKTsKKyAg
ICAgICAgICAgIFRDR3YgdmFsdWUgPSB0Y2dfdGVtcF9uZXcoKTsKKyAgICAgICAgICAgIHRjZ19n
ZW5fbW92X3RsKHZhbHVlLCBoZXhfc3RvcmVfdmFsMzJbc2xvdF9udW1dKTsKKyAgICAgICAgICAg
IHRjZ19nZW5fcWVtdV9zdDE2KHZhbHVlLCBhZGRyZXNzLCBjdHgtPm1lbV9pZHgpOworICAgICAg
ICAgICAgdGNnX3RlbXBfZnJlZSh2YWx1ZSk7CisgICAgICAgIH0gZWxzZSBpZiAoY3R4X3dpZHRo
ID09IDQpIHsKKyAgICAgICAgICAgIEhFWF9ERUJVR19HRU5fQ0hFQ0tfU1RPUkVfV0lEVEgoY3R4
LCBzbG90X251bSk7CisgICAgICAgICAgICBUQ0d2IHZhbHVlID0gdGNnX3RlbXBfbmV3KCk7Cisg
ICAgICAgICAgICB0Y2dfZ2VuX21vdl90bCh2YWx1ZSwgaGV4X3N0b3JlX3ZhbDMyW3Nsb3RfbnVt
XSk7CisgICAgICAgICAgICB0Y2dfZ2VuX3FlbXVfc3QzMih2YWx1ZSwgYWRkcmVzcywgY3R4LT5t
ZW1faWR4KTsKKyAgICAgICAgICAgIHRjZ190ZW1wX2ZyZWUodmFsdWUpOworICAgICAgICB9IGVs
c2UgaWYgKGN0eF93aWR0aCA9PSA4KSB7CisgICAgICAgICAgICBIRVhfREVCVUdfR0VOX0NIRUNL
X1NUT1JFX1dJRFRIKGN0eCwgc2xvdF9udW0pOworICAgICAgICAgICAgVENHdl9pNjQgdmFsdWUg
PSB0Y2dfdGVtcF9uZXdfaTY0KCk7CisgICAgICAgICAgICB0Y2dfZ2VuX21vdl9pNjQodmFsdWUs
IGhleF9zdG9yZV92YWw2NFtzbG90X251bV0pOworICAgICAgICAgICAgdGNnX2dlbl9xZW11X3N0
NjQodmFsdWUsIGFkZHJlc3MsIGN0eC0+bWVtX2lkeCk7CisgICAgICAgICAgICB0Y2dfdGVtcF9m
cmVlX2k2NCh2YWx1ZSk7CisgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAgICAvKgorICAgICAg
ICAgICAgICogSWYgd2UgZ2V0IHRvIGhlcmUsIHdlIGRvbid0IGtub3cgdGhlIHdpZHRoIGF0Cisg
ICAgICAgICAgICAgKiBUQ0cgZ2VuZXJhdGlvbiB0aW1lLCB3ZSdsbCBnZW5lcmF0ZSBicmFuY2hp
bmcKKyAgICAgICAgICAgICAqIGJhc2VkIG9uIHRoZSB3aWR0aCBhdCBydW50aW1lLgorICAgICAg
ICAgICAgICovCisgICAgICAgICAgICBUQ0dMYWJlbCAqbGFiZWxfdzIgPSBnZW5fbmV3X2xhYmVs
KCk7CisgICAgICAgICAgICBUQ0dMYWJlbCAqbGFiZWxfdzQgPSBnZW5fbmV3X2xhYmVsKCk7Cisg
ICAgICAgICAgICBUQ0dMYWJlbCAqbGFiZWxfdzggPSBnZW5fbmV3X2xhYmVsKCk7CisgICAgICAg
ICAgICBUQ0d2IHdpZHRoID0gdGNnX3RlbXBfbG9jYWxfbmV3KCk7CisKKyAgICAgICAgICAgIHRj
Z19nZW5fbW92X3RsKHdpZHRoLCBoZXhfc3RvcmVfd2lkdGhbc2xvdF9udW1dKTsKKyAgICAgICAg
ICAgIHRjZ19nZW5fYnJjb25kaV90bChUQ0dfQ09ORF9ORSwgd2lkdGgsIDEsIGxhYmVsX3cyKTsK
KyAgICAgICAgICAgIHsKKyAgICAgICAgICAgICAgICAvKiBXaWR0aCBpcyAxIGJ5dGUgKi8KKyAg
ICAgICAgICAgICAgICBUQ0d2IHZhbHVlID0gdGNnX3RlbXBfbmV3KCk7CisgICAgICAgICAgICAg
ICAgdGNnX2dlbl9tb3ZfdGwodmFsdWUsIGhleF9zdG9yZV92YWwzMltzbG90X251bV0pOworICAg
ICAgICAgICAgICAgIHRjZ19nZW5fcWVtdV9zdDgodmFsdWUsIGFkZHJlc3MsIGN0eC0+bWVtX2lk
eCk7CisgICAgICAgICAgICAgICAgdGNnX2dlbl9icihsYWJlbF9lbmQpOworICAgICAgICAgICAg
ICAgIHRjZ190ZW1wX2ZyZWUodmFsdWUpOworICAgICAgICAgICAgfQorICAgICAgICAgICAgZ2Vu
X3NldF9sYWJlbChsYWJlbF93Mik7CisgICAgICAgICAgICB0Y2dfZ2VuX2JyY29uZGlfdGwoVENH
X0NPTkRfTkUsIHdpZHRoLCAyLCBsYWJlbF93NCk7CisgICAgICAgICAgICB7CisgICAgICAgICAg
ICAgICAgLyogV2lkdGggaXMgMiBieXRlcyAqLworICAgICAgICAgICAgICAgIFRDR3YgdmFsdWUg
PSB0Y2dfdGVtcF9uZXcoKTsKKyAgICAgICAgICAgICAgICB0Y2dfZ2VuX21vdl90bCh2YWx1ZSwg
aGV4X3N0b3JlX3ZhbDMyW3Nsb3RfbnVtXSk7CisgICAgICAgICAgICAgICAgdGNnX2dlbl9xZW11
X3N0MTYodmFsdWUsIGFkZHJlc3MsIGN0eC0+bWVtX2lkeCk7CisgICAgICAgICAgICAgICAgdGNn
X2dlbl9icihsYWJlbF9lbmQpOworICAgICAgICAgICAgICAgIHRjZ190ZW1wX2ZyZWUodmFsdWUp
OworICAgICAgICAgICAgfQorICAgICAgICAgICAgZ2VuX3NldF9sYWJlbChsYWJlbF93NCk7Cisg
ICAgICAgICAgICB0Y2dfZ2VuX2JyY29uZGlfdGwoVENHX0NPTkRfTkUsIHdpZHRoLCA0LCBsYWJl
bF93OCk7CisgICAgICAgICAgICB7CisgICAgICAgICAgICAgICAgLyogV2lkdGggaXMgNCBieXRl
cyAqLworICAgICAgICAgICAgICAgIFRDR3YgdmFsdWUgPSB0Y2dfdGVtcF9uZXcoKTsKKyAgICAg
ICAgICAgICAgICB0Y2dfZ2VuX21vdl90bCh2YWx1ZSwgaGV4X3N0b3JlX3ZhbDMyW3Nsb3RfbnVt
XSk7CisgICAgICAgICAgICAgICAgdGNnX2dlbl9xZW11X3N0MzIodmFsdWUsIGFkZHJlc3MsIGN0
eC0+bWVtX2lkeCk7CisgICAgICAgICAgICAgICAgdGNnX2dlbl9icihsYWJlbF9lbmQpOworICAg
ICAgICAgICAgICAgIHRjZ190ZW1wX2ZyZWUodmFsdWUpOworICAgICAgICAgICAgfQorICAgICAg
ICAgICAgZ2VuX3NldF9sYWJlbChsYWJlbF93OCk7CisgICAgICAgICAgICB7CisgICAgICAgICAg
ICAgICAgLyogV2lkdGggaXMgOCBieXRlcyAqLworICAgICAgICAgICAgICAgIFRDR3ZfaTY0IHZh
bHVlID0gdGNnX3RlbXBfbmV3X2k2NCgpOworICAgICAgICAgICAgICAgIHRjZ19nZW5fbW92X2k2
NCh2YWx1ZSwgaGV4X3N0b3JlX3ZhbDY0W3Nsb3RfbnVtXSk7CisgICAgICAgICAgICAgICAgdGNn
X2dlbl9xZW11X3N0NjQodmFsdWUsIGFkZHJlc3MsIGN0eC0+bWVtX2lkeCk7CisgICAgICAgICAg
ICAgICAgdGNnX2dlbl9icihsYWJlbF9lbmQpOworICAgICAgICAgICAgICAgIHRjZ190ZW1wX2Zy
ZWVfaTY0KHZhbHVlKTsKKyAgICAgICAgICAgIH0KKworICAgICAgICAgICAgdGNnX3RlbXBfZnJl
ZSh3aWR0aCk7CisgICAgICAgIH0KKyAgICAgICAgdGNnX3RlbXBfZnJlZShhZGRyZXNzKTsKKyAg
ICB9CisgICAgZ2VuX3NldF9sYWJlbChsYWJlbF9lbmQpOworCisgICAgdGNnX3RlbXBfZnJlZShj
YW5jZWxsZWQpOworfQorCitzdGF0aWMgdm9pZCBwcm9jZXNzX3N0b3JlX2xvZyhEaXNhc0NvbnRl
eHQgKmN0eCwgcGFja2V0X3QgKnBrdCkKK3sKKyAgICAvKgorICAgICAqICBXaGVuIGEgcGFja2V0
IGhhcyB0d28gc3RvcmVzLCB0aGUgaGFyZHdhcmUgcHJvY2Vzc2VzCisgICAgICogIHNsb3QgMSBh
bmQgdGhlbiBzbG90IDIuICBUaGlzIHdpbGwgYmUgaW1wb3J0YW50IHdoZW4KKyAgICAgKiAgdGhl
IG1lbW9yeSBhY2Nlc3NlcyBvdmVybGFwLgorICAgICAqLworICAgIGlmIChwa3QtPnBrdF9oYXNf
c3RvcmVfczEgJiYgIXBrdC0+cGt0X2hhc19kY3plcm9hKSB7CisgICAgICAgIHByb2Nlc3Nfc3Rv
cmUoY3R4LCAxKTsKKyAgICB9CisgICAgaWYgKHBrdC0+cGt0X2hhc19zdG9yZV9zMCAmJiAhcGt0
LT5wa3RfaGFzX2RjemVyb2EpIHsKKyAgICAgICAgcHJvY2Vzc19zdG9yZShjdHgsIDApOworICAg
IH0KK30KKworLyogWmVybyBvdXQgYSAzMi1iaXQgY2FjaGUgbGluZSAqLworc3RhdGljIHZvaWQg
cHJvY2Vzc19kY3plcm9hKERpc2FzQ29udGV4dCAqY3R4LCBwYWNrZXRfdCAqcGt0KQoreworICAg
IGlmIChwa3QtPnBrdF9oYXNfZGN6ZXJvYSkgeworICAgICAgICAvKiBTdG9yZSAzMiBieXRlcyBv
ZiB6ZXJvIHN0YXJ0aW5nIGF0IChhZGRyICYgfjB4MWYpICovCisgICAgICAgIFRDR3YgYWRkciA9
IHRjZ190ZW1wX25ldygpOworICAgICAgICBUQ0d2X2k2NCB6ZXJvID0gdGNnX2NvbnN0X2k2NCgw
KTsKKworICAgICAgICB0Y2dfZ2VuX2FuZGlfdGwoYWRkciwgaGV4X2RjemVyb19hZGRyLCB+MHgx
Zik7CisgICAgICAgIHRjZ19nZW5fcWVtdV9zdDY0KHplcm8sIGFkZHIsIGN0eC0+bWVtX2lkeCk7
CisgICAgICAgIHRjZ19nZW5fYWRkaV90bChhZGRyLCBhZGRyLCA4KTsKKyAgICAgICAgdGNnX2dl
bl9xZW11X3N0NjQoemVybywgYWRkciwgY3R4LT5tZW1faWR4KTsKKyAgICAgICAgdGNnX2dlbl9h
ZGRpX3RsKGFkZHIsIGFkZHIsIDgpOworICAgICAgICB0Y2dfZ2VuX3FlbXVfc3Q2NCh6ZXJvLCBh
ZGRyLCBjdHgtPm1lbV9pZHgpOworICAgICAgICB0Y2dfZ2VuX2FkZGlfdGwoYWRkciwgYWRkciwg
OCk7CisgICAgICAgIHRjZ19nZW5fcWVtdV9zdDY0KHplcm8sIGFkZHIsIGN0eC0+bWVtX2lkeCk7
CisKKyAgICAgICAgdGNnX3RlbXBfZnJlZShhZGRyKTsKKyAgICAgICAgdGNnX3RlbXBfZnJlZV9p
NjQoemVybyk7CisgICAgfQorfQorCitzdGF0aWMgYm9vbCBwcm9jZXNzX2NoYW5nZV9vZl9mbG93
KERpc2FzQ29udGV4dCAqY3R4LCBwYWNrZXRfdCAqcGt0KQoreworICAgIGlmIChwa3QtPnBrdF9o
YXNfY29mKSB7CisgICAgICAgIHRjZ19nZW5fbW92X3RsKGhleF9ncHJbSEVYX1JFR19QQ10sIGhl
eF9uZXh0X1BDKTsKKyAgICAgICAgcmV0dXJuIHRydWU7CisgICAgfQorICAgIHJldHVybiBmYWxz
ZTsKK30KKworc3RhdGljIHZvaWQgZ2VuX2V4ZWNfY291bnRlcnMocGFja2V0X3QgKnBrdCkKK3sK
KyAgICBpbnQgbnVtX2luc25zID0gcGt0LT5udW1faW5zbnM7CisgICAgaW50IG51bV9yZWFsX2lu
c25zID0gMDsKKyAgICBpbnQgaTsKKworICAgIGZvciAoaSA9IDA7IGkgPCBudW1faW5zbnM7IGkr
KykgeworICAgICAgICBpZiAoIXBrdC0+aW5zbltpXS5pc19lbmRsb29wICYmCisgICAgICAgICAg
ICAhcGt0LT5pbnNuW2ldLnBhcnQxICYmCisgICAgICAgICAgICAhR0VUX0FUVFJJQihwa3QtPmlu
c25baV0ub3Bjb2RlLCBBX0lUX05PUCkpIHsKKyAgICAgICAgICAgIG51bV9yZWFsX2luc25zKys7
CisgICAgICAgIH0KKyAgICB9CisKKyAgICB0Y2dfZ2VuX2FkZGlfdGwoaGV4X2dwcltIRVhfUkVH
X1FFTVVfUEtUX0NOVF0sCisgICAgICAgICAgICAgICAgICAgIGhleF9ncHJbSEVYX1JFR19RRU1V
X1BLVF9DTlRdLCAxKTsKKyAgICBpZiAobnVtX3JlYWxfaW5zbnMpIHsKKyAgICAgICAgdGNnX2dl
bl9hZGRpX3RsKGhleF9ncHJbSEVYX1JFR19RRU1VX0lOU05fQ05UXSwKKyAgICAgICAgICAgICAg
ICAgICAgICAgIGhleF9ncHJbSEVYX1JFR19RRU1VX0lOU05fQ05UXSwgbnVtX3JlYWxfaW5zbnMp
OworICAgIH0KK30KKworc3RhdGljIHZvaWQgZ2VuX2NvbW1pdF9wYWNrZXQoRGlzYXNDb250ZXh0
ICpjdHgsIHBhY2tldF90ICpwa3QpCit7CisgICAgYm9vbCBlbmRfdGIgPSBmYWxzZTsKKworICAg
IGdlbl9yZWdfd3JpdGVzKGN0eCk7CisgICAgZ2VuX3ByZWRfd3JpdGVzKGN0eCwgcGt0KTsKKyAg
ICBwcm9jZXNzX3N0b3JlX2xvZyhjdHgsIHBrdCk7CisgICAgcHJvY2Vzc19kY3plcm9hKGN0eCwg
cGt0KTsKKyAgICBlbmRfdGIgfD0gcHJvY2Vzc19jaGFuZ2Vfb2ZfZmxvdyhjdHgsIHBrdCk7Cisg
ICAgZ2VuX2V4ZWNfY291bnRlcnMocGt0KTsKKyNpZiBIRVhfREVCVUcKKyAgICB7CisgICAgICAg
IFRDR3YgaGFzX3N0MCA9CisgICAgICAgICAgICB0Y2dfY29uc3RfdGwocGt0LT5wa3RfaGFzX3N0
b3JlX3MwICYmICFwa3QtPnBrdF9oYXNfZGN6ZXJvYSk7CisgICAgICAgIFRDR3YgaGFzX3N0MSA9
CisgICAgICAgICAgICB0Y2dfY29uc3RfdGwocGt0LT5wa3RfaGFzX3N0b3JlX3MxICYmICFwa3Qt
PnBrdF9oYXNfZGN6ZXJvYSk7CisKKyAgICAgICAgLyogSGFuZHkgcGxhY2UgdG8gc2V0IGEgYnJl
YWtwb2ludCBhdCB0aGUgZW5kIG9mIGV4ZWN1dGlvbiAqLworICAgICAgICBnZW5faGVscGVyX2Rl
YnVnX2NvbW1pdF9lbmQoY3B1X2VudiwgaGFzX3N0MCwgaGFzX3N0MSk7CisKKyAgICAgICAgdGNn
X3RlbXBfZnJlZShoYXNfc3QwKTsKKyAgICAgICAgdGNnX3RlbXBfZnJlZShoYXNfc3QxKTsKKyAg
ICB9CisjZW5kaWYKKworICAgIGlmIChlbmRfdGIpIHsKKyAgICAgICAgdGNnX2dlbl9leGl0X3Ri
KE5VTEwsIDApOworICAgICAgICBjdHgtPmJhc2UuaXNfam1wID0gRElTQVNfTk9SRVRVUk47Cisg
ICAgfQorfQorCitzdGF0aWMgdm9pZCBkZWNvZGVfYW5kX3RyYW5zbGF0ZV9wYWNrZXQoQ1BVSGV4
YWdvblN0YXRlICplbnYsIERpc2FzQ29udGV4dCAqY3R4KQoreworICAgIHVpbnQzMl90IHdvcmRz
W1BBQ0tFVF9XT1JEU19NQVhdOworICAgIGludCBud29yZHM7CisgICAgcGFja2V0X3QgcGt0Owor
ICAgIGludCBpOworCisgICAgbndvcmRzID0gcmVhZF9wYWNrZXRfd29yZHMoZW52LCBjdHgsIHdv
cmRzKTsKKyAgICBpZiAoIW53b3JkcykgeworICAgICAgICByZXR1cm47CisgICAgfQorCisgICAg
aWYgKGRlY29kZV90aGlzKG53b3Jkcywgd29yZHMsICZwa3QpKSB7CisgICAgICAgIEhFWF9ERUJV
R19QUklOVF9QS1QoJnBrdCk7CisgICAgICAgIGdlbl9zdGFydF9wYWNrZXQoY3R4LCAmcGt0KTsK
KyAgICAgICAgZm9yIChpID0gMDsgaSA8IHBrdC5udW1faW5zbnM7IGkrKykgeworICAgICAgICAg
ICAgZ2VuX2luc24oZW52LCBjdHgsICZwa3QuaW5zbltpXSk7CisgICAgICAgIH0KKyAgICAgICAg
Z2VuX2NvbW1pdF9wYWNrZXQoY3R4LCAmcGt0KTsKKyAgICAgICAgY3R4LT5iYXNlLnBjX25leHQg
Kz0gcGt0LmVuY29kX3BrdF9zaXplX2luX2J5dGVzOworICAgIH0gZWxzZSB7CisgICAgICAgIGdl
bl9leGNlcHRpb24oSEVYX0VYQ1BfSU5WQUxJRF9QQUNLRVQpOworICAgICAgICBjdHgtPmJhc2Uu
aXNfam1wID0gRElTQVNfTk9SRVRVUk47CisgICAgfQorfQorCitzdGF0aWMgdm9pZCBoZXhhZ29u
X3RyX2luaXRfZGlzYXNfY29udGV4dChEaXNhc0NvbnRleHRCYXNlICpkY2Jhc2UsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDUFVTdGF0ZSAqY3MpCit7CisgICAg
RGlzYXNDb250ZXh0ICpjdHggPSBjb250YWluZXJfb2YoZGNiYXNlLCBEaXNhc0NvbnRleHQsIGJh
c2UpOworCisgICAgY3R4LT5tZW1faWR4ID0gTU1VX1VTRVJfSURYOworfQorCitzdGF0aWMgdm9p
ZCBoZXhhZ29uX3RyX3RiX3N0YXJ0KERpc2FzQ29udGV4dEJhc2UgKmRiLCBDUFVTdGF0ZSAqY3B1
KQoreworfQorCitzdGF0aWMgdm9pZCBoZXhhZ29uX3RyX2luc25fc3RhcnQoRGlzYXNDb250ZXh0
QmFzZSAqZGNiYXNlLCBDUFVTdGF0ZSAqY3B1KQoreworICAgIERpc2FzQ29udGV4dCAqY3R4ID0g
Y29udGFpbmVyX29mKGRjYmFzZSwgRGlzYXNDb250ZXh0LCBiYXNlKTsKKworICAgIHRjZ19nZW5f
aW5zbl9zdGFydChjdHgtPmJhc2UucGNfbmV4dCk7Cit9CisKK3N0YXRpYyBib29sIGhleGFnb25f
dHJfYnJlYWtwb2ludF9jaGVjayhEaXNhc0NvbnRleHRCYXNlICpkY2Jhc2UsIENQVVN0YXRlICpj
cHUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgQ1BVQnJl
YWtwb2ludCAqYnApCit7CisgICAgRGlzYXNDb250ZXh0ICpjdHggPSBjb250YWluZXJfb2YoZGNi
YXNlLCBEaXNhc0NvbnRleHQsIGJhc2UpOworCisgICAgdGNnX2dlbl9tb3ZpX3RsKGhleF9ncHJb
SEVYX1JFR19QQ10sIGN0eC0+YmFzZS5wY19uZXh0KTsKKyAgICBjdHgtPmJhc2UuaXNfam1wID0g
RElTQVNfTk9SRVRVUk47CisgICAgZ2VuX2V4Y2VwdGlvbl9kZWJ1ZygpOworICAgIC8qCisgICAg
ICogVGhlIGFkZHJlc3MgY292ZXJlZCBieSB0aGUgYnJlYWtwb2ludCBtdXN0IGJlIGluY2x1ZGVk
IGluCisgICAgICogW3RiLT5wYywgdGItPnBjICsgdGItPnNpemUpIGluIG9yZGVyIHRvIGZvciBp
dCB0byBiZQorICAgICAqIHByb3Blcmx5IGNsZWFyZWQgLS0gdGh1cyB3ZSBpbmNyZW1lbnQgdGhl
IFBDIGhlcmUgc28gdGhhdAorICAgICAqIHRoZSBsb2dpYyBzZXR0aW5nIHRiLT5zaXplIGJlbG93
IGRvZXMgdGhlIHJpZ2h0IHRoaW5nLgorICAgICAqLworICAgIGN0eC0+YmFzZS5wY19uZXh0ICs9
IDQ7CisgICAgcmV0dXJuIHRydWU7Cit9CisKKworc3RhdGljIHZvaWQgaGV4YWdvbl90cl90cmFu
c2xhdGVfcGFja2V0KERpc2FzQ29udGV4dEJhc2UgKmRjYmFzZSwgQ1BVU3RhdGUgKmNwdSkKK3sK
KyAgICBEaXNhc0NvbnRleHQgKmN0eCA9IGNvbnRhaW5lcl9vZihkY2Jhc2UsIERpc2FzQ29udGV4
dCwgYmFzZSk7CisgICAgQ1BVSGV4YWdvblN0YXRlICplbnYgPSBjcHUtPmVudl9wdHI7CisKKyAg
ICBkZWNvZGVfYW5kX3RyYW5zbGF0ZV9wYWNrZXQoZW52LCBjdHgpOworCisgICAgaWYgKGN0eC0+
YmFzZS5pc19qbXAgPT0gRElTQVNfTkVYVCkgeworICAgICAgICB0YXJnZXRfdWxvbmcgcGFnZV9z
dGFydDsKKworICAgICAgICBwYWdlX3N0YXJ0ID0gY3R4LT5iYXNlLnBjX2ZpcnN0ICYgVEFSR0VU
X1BBR0VfTUFTSzsKKyAgICAgICAgaWYgKGN0eC0+YmFzZS5wY19uZXh0IC0gcGFnZV9zdGFydCA+
PSBUQVJHRVRfUEFHRV9TSVpFKSB7CisgICAgICAgICAgICBjdHgtPmJhc2UuaXNfam1wID0gRElT
QVNfVE9PX01BTlk7CisgICAgICAgIH0KKworICAgICAgICAvKgorICAgICAgICAgKiBUaGUgQ1BV
IGxvZyBpcyB1c2VkIHRvIGNvbXBhcmUgYWdhaW5zdCBMTERCIHNpbmdsZSBzdGVwcGluZywKKyAg
ICAgICAgICogc28gZW5kIHRoZSBUTEIgYWZ0ZXIgZXZlcnkgcGFja2V0LgorICAgICAgICAgKi8K
KyAgICAgICAgaWYgKHFlbXVfbG9nbGV2ZWxfbWFzayhDUFVfTE9HX1RCX0NQVSkpIHsKKyAgICAg
ICAgICAgIGN0eC0+YmFzZS5pc19qbXAgPSBESVNBU19UT09fTUFOWTsKKyAgICAgICAgfQorI2lm
IEhFWF9ERUJVRworICAgICAgICAvKiBXaGVuIGRlYnVnZ2luZywgb25seSBwdXQgb25lIHBhY2tl
dCBwZXIgVEIgKi8KKyAgICAgICAgY3R4LT5iYXNlLmlzX2ptcCA9IERJU0FTX1RPT19NQU5ZOwor
I2VuZGlmCisgICAgfQorfQorCitzdGF0aWMgdm9pZCBoZXhhZ29uX3RyX3RiX3N0b3AoRGlzYXND
b250ZXh0QmFzZSAqZGNiYXNlLCBDUFVTdGF0ZSAqY3B1KQoreworICAgIERpc2FzQ29udGV4dCAq
Y3R4ID0gY29udGFpbmVyX29mKGRjYmFzZSwgRGlzYXNDb250ZXh0LCBiYXNlKTsKKworICAgIHN3
aXRjaCAoY3R4LT5iYXNlLmlzX2ptcCkgeworICAgIGNhc2UgRElTQVNfVE9PX01BTlk6CisgICAg
ICAgIHRjZ19nZW5fbW92aV90bChoZXhfZ3ByW0hFWF9SRUdfUENdLCBjdHgtPmJhc2UucGNfbmV4
dCk7CisgICAgICAgIGlmIChjdHgtPmJhc2Uuc2luZ2xlc3RlcF9lbmFibGVkKSB7CisgICAgICAg
ICAgICBnZW5fZXhjZXB0aW9uX2RlYnVnKCk7CisgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAg
ICB0Y2dfZ2VuX2V4aXRfdGIoTlVMTCwgMCk7CisgICAgICAgIH0KKyAgICAgICAgYnJlYWs7Cisg
ICAgY2FzZSBESVNBU19OT1JFVFVSTjoKKyAgICAgICAgYnJlYWs7CisgICAgZGVmYXVsdDoKKyAg
ICAgICAgZ19hc3NlcnRfbm90X3JlYWNoZWQoKTsKKyAgICB9Cit9CisKK3N0YXRpYyB2b2lkIGhl
eGFnb25fdHJfZGlzYXNfbG9nKGNvbnN0IERpc2FzQ29udGV4dEJhc2UgKmRjYmFzZSwgQ1BVU3Rh
dGUgKmNwdSkKK3sKKyAgICBxZW11X2xvZygiSU46ICVzXG4iLCBsb29rdXBfc3ltYm9sKGRjYmFz
ZS0+cGNfZmlyc3QpKTsKKyAgICBsb2dfdGFyZ2V0X2Rpc2FzKGNwdSwgZGNiYXNlLT5wY19maXJz
dCwgZGNiYXNlLT50Yi0+c2l6ZSk7Cit9CisKKworc3RhdGljIGNvbnN0IFRyYW5zbGF0b3JPcHMg
aGV4YWdvbl90cl9vcHMgPSB7CisgICAgLmluaXRfZGlzYXNfY29udGV4dCA9IGhleGFnb25fdHJf
aW5pdF9kaXNhc19jb250ZXh0LAorICAgIC50Yl9zdGFydCAgICAgICAgICAgPSBoZXhhZ29uX3Ry
X3RiX3N0YXJ0LAorICAgIC5pbnNuX3N0YXJ0ICAgICAgICAgPSBoZXhhZ29uX3RyX2luc25fc3Rh
cnQsCisgICAgLmJyZWFrcG9pbnRfY2hlY2sgICA9IGhleGFnb25fdHJfYnJlYWtwb2ludF9jaGVj
aywKKyAgICAudHJhbnNsYXRlX2luc24gICAgID0gaGV4YWdvbl90cl90cmFuc2xhdGVfcGFja2V0
LAorICAgIC50Yl9zdG9wICAgICAgICAgICAgPSBoZXhhZ29uX3RyX3RiX3N0b3AsCisgICAgLmRp
c2FzX2xvZyAgICAgICAgICA9IGhleGFnb25fdHJfZGlzYXNfbG9nLAorfTsKKwordm9pZCBnZW5f
aW50ZXJtZWRpYXRlX2NvZGUoQ1BVU3RhdGUgKmNzLCBUcmFuc2xhdGlvbkJsb2NrICp0YiwgaW50
IG1heF9pbnNucykKK3sKKyAgICBEaXNhc0NvbnRleHQgY3R4OworCisgICAgdHJhbnNsYXRvcl9s
b29wKCZoZXhhZ29uX3RyX29wcywgJmN0eC5iYXNlLCBjcywgdGIsIG1heF9pbnNucyk7Cit9CisK
KyNkZWZpbmUgTkFNRV9MRU4gICAgICAgICAgICAgICA2NAorc3RhdGljIGNoYXIgbmV3X3ZhbHVl
X25hbWVzW1RPVEFMX1BFUl9USFJFQURfUkVHU11bTkFNRV9MRU5dOworI2lmIEhFWF9ERUJVRwor
c3RhdGljIGNoYXIgcmVnX3dyaXR0ZW5fbmFtZXNbVE9UQUxfUEVSX1RIUkVBRF9SRUdTXVtOQU1F
X0xFTl07CisjZW5kaWYKK3N0YXRpYyBjaGFyIG5ld19wcmVkX3ZhbHVlX25hbWVzW05VTV9QUkVH
U11bTkFNRV9MRU5dOworc3RhdGljIGNoYXIgcHJlZF93cml0dGVuX25hbWVzW05VTV9QUkVHU11b
TkFNRV9MRU5dOworc3RhdGljIGNoYXIgc3RvcmVfYWRkcl9uYW1lc1tTVE9SRVNfTUFYXVtOQU1F
X0xFTl07CitzdGF0aWMgY2hhciBzdG9yZV93aWR0aF9uYW1lc1tTVE9SRVNfTUFYXVtOQU1FX0xF
Tl07CitzdGF0aWMgY2hhciBzdG9yZV92YWwzMl9uYW1lc1tTVE9SRVNfTUFYXVtOQU1FX0xFTl07
CitzdGF0aWMgY2hhciBzdG9yZV92YWw2NF9uYW1lc1tTVE9SRVNfTUFYXVtOQU1FX0xFTl07CisK
K3ZvaWQgaGV4YWdvbl90cmFuc2xhdGVfaW5pdCh2b2lkKQoreworICAgIGludCBpOworCisgICAg
b3Bjb2RlX2luaXQoKTsKKworICAgIGZvciAoaSA9IDA7IGkgPCBUT1RBTF9QRVJfVEhSRUFEX1JF
R1M7IGkrKykgeworICAgICAgICBoZXhfZ3ByW2ldID0gdGNnX2dsb2JhbF9tZW1fbmV3KGNwdV9l
bnYsCisgICAgICAgICAgICBvZmZzZXRvZihDUFVIZXhhZ29uU3RhdGUsIGdwcltpXSksCisgICAg
ICAgICAgICBoZXhhZ29uX3JlZ25hbWVzW2ldKTsKKworICAgICAgICBzcHJpbnRmKG5ld192YWx1
ZV9uYW1lc1tpXSwgIm5ld18lcyIsIGhleGFnb25fcmVnbmFtZXNbaV0pOworICAgICAgICBoZXhf
bmV3X3ZhbHVlW2ldID0gdGNnX2dsb2JhbF9tZW1fbmV3KGNwdV9lbnYsCisgICAgICAgICAgICBv
ZmZzZXRvZihDUFVIZXhhZ29uU3RhdGUsIG5ld192YWx1ZVtpXSksCisgICAgICAgICAgICBuZXdf
dmFsdWVfbmFtZXNbaV0pOworCisjaWYgSEVYX0RFQlVHCisgICAgICAgIHNwcmludGYocmVnX3dy
aXR0ZW5fbmFtZXNbaV0sICJyZWdfd3JpdHRlbl8lcyIsIGhleGFnb25fcmVnbmFtZXNbaV0pOwor
ICAgICAgICBoZXhfcmVnX3dyaXR0ZW5baV0gPSB0Y2dfZ2xvYmFsX21lbV9uZXcoY3B1X2VudiwK
KyAgICAgICAgICAgIG9mZnNldG9mKENQVUhleGFnb25TdGF0ZSwgcmVnX3dyaXR0ZW5baV0pLAor
ICAgICAgICAgICAgcmVnX3dyaXR0ZW5fbmFtZXNbaV0pOworI2VuZGlmCisgICAgfQorICAgIGZv
ciAoaSA9IDA7IGkgPCBOVU1fUFJFR1M7IGkrKykgeworICAgICAgICBoZXhfcHJlZFtpXSA9IHRj
Z19nbG9iYWxfbWVtX25ldyhjcHVfZW52LAorICAgICAgICAgICAgb2Zmc2V0b2YoQ1BVSGV4YWdv
blN0YXRlLCBwcmVkW2ldKSwKKyAgICAgICAgICAgIGhleGFnb25fcHJlZG5hbWVzW2ldKTsKKwor
ICAgICAgICBzcHJpbnRmKG5ld19wcmVkX3ZhbHVlX25hbWVzW2ldLCAibmV3X3ByZWRfJXMiLCBo
ZXhhZ29uX3ByZWRuYW1lc1tpXSk7CisgICAgICAgIGhleF9uZXdfcHJlZF92YWx1ZVtpXSA9IHRj
Z19nbG9iYWxfbWVtX25ldyhjcHVfZW52LAorICAgICAgICAgICAgb2Zmc2V0b2YoQ1BVSGV4YWdv
blN0YXRlLCBuZXdfcHJlZF92YWx1ZVtpXSksCisgICAgICAgICAgICBuZXdfcHJlZF92YWx1ZV9u
YW1lc1tpXSk7CisKKyAgICAgICAgc3ByaW50ZihwcmVkX3dyaXR0ZW5fbmFtZXNbaV0sICJwcmVk
X3dyaXR0ZW5fJXMiLCBoZXhhZ29uX3ByZWRuYW1lc1tpXSk7CisgICAgICAgIGhleF9wcmVkX3dy
aXR0ZW5baV0gPSB0Y2dfZ2xvYmFsX21lbV9uZXcoY3B1X2VudiwKKyAgICAgICAgICAgIG9mZnNl
dG9mKENQVUhleGFnb25TdGF0ZSwgcHJlZF93cml0dGVuW2ldKSwKKyAgICAgICAgICAgIHByZWRf
d3JpdHRlbl9uYW1lc1tpXSk7CisgICAgfQorICAgIGhleF9uZXh0X1BDID0gdGNnX2dsb2JhbF9t
ZW1fbmV3KGNwdV9lbnYsCisgICAgICAgIG9mZnNldG9mKENQVUhleGFnb25TdGF0ZSwgbmV4dF9Q
QyksICJuZXh0X1BDIik7CisgICAgaGV4X3RoaXNfUEMgPSB0Y2dfZ2xvYmFsX21lbV9uZXcoY3B1
X2VudiwKKyAgICAgICAgb2Zmc2V0b2YoQ1BVSGV4YWdvblN0YXRlLCB0aGlzX1BDKSwgInRoaXNf
UEMiKTsKKyAgICBoZXhfc2xvdF9jYW5jZWxsZWQgPSB0Y2dfZ2xvYmFsX21lbV9uZXcoY3B1X2Vu
diwKKyAgICAgICAgb2Zmc2V0b2YoQ1BVSGV4YWdvblN0YXRlLCBzbG90X2NhbmNlbGxlZCksICJz
bG90X2NhbmNlbGxlZCIpOworICAgIGhleF9icmFuY2hfdGFrZW4gPSB0Y2dfZ2xvYmFsX21lbV9u
ZXcoY3B1X2VudiwKKyAgICAgICAgb2Zmc2V0b2YoQ1BVSGV4YWdvblN0YXRlLCBicmFuY2hfdGFr
ZW4pLCAiYnJhbmNoX3Rha2VuIik7CisgICAgaGV4X2RjemVyb19hZGRyID0gdGNnX2dsb2JhbF9t
ZW1fbmV3KGNwdV9lbnYsCisgICAgICAgIG9mZnNldG9mKENQVUhleGFnb25TdGF0ZSwgZGN6ZXJv
X2FkZHIpLCAiZGN6ZXJvX2FkZHIiKTsKKyAgICBsbHNjX2FkZHIgPSB0Y2dfZ2xvYmFsX21lbV9u
ZXcoY3B1X2VudiwKKyAgICAgICAgb2Zmc2V0b2YoQ1BVSGV4YWdvblN0YXRlLCBsbHNjX2FkZHIp
LCAibGxzY19hZGRyIik7CisgICAgbGxzY192YWwgPSB0Y2dfZ2xvYmFsX21lbV9uZXcoY3B1X2Vu
diwKKyAgICAgICAgb2Zmc2V0b2YoQ1BVSGV4YWdvblN0YXRlLCBsbHNjX3ZhbCksICJsbHNjX3Zh
bCIpOworICAgIGxsc2NfdmFsX2k2NCA9IHRjZ19nbG9iYWxfbWVtX25ld19pNjQoY3B1X2VudiwK
KyAgICAgICAgb2Zmc2V0b2YoQ1BVSGV4YWdvblN0YXRlLCBsbHNjX3ZhbF9pNjQpLCAibGxzY192
YWxfaTY0Iik7CisgICAgaGV4X2lzX2dhdGhlcl9zdG9yZV9pbnNuID0gdGNnX2dsb2JhbF9tZW1f
bmV3KGNwdV9lbnYsCisgICAgICAgIG9mZnNldG9mKENQVUhleGFnb25TdGF0ZSwgaXNfZ2F0aGVy
X3N0b3JlX2luc24pLAorICAgICAgICAiaXNfZ2F0aGVyX3N0b3JlX2luc24iKTsKKyAgICBoZXhf
Z2F0aGVyX2lzc3VlZCA9IHRjZ19nbG9iYWxfbWVtX25ldyhjcHVfZW52LAorICAgICAgICBvZmZz
ZXRvZihDUFVIZXhhZ29uU3RhdGUsIGdhdGhlcl9pc3N1ZWQpLCAiZ2F0aGVyX2lzc3VlZCIpOwor
ICAgIGZvciAoaSA9IDA7IGkgPCBTVE9SRVNfTUFYOyBpKyspIHsKKyAgICAgICAgc3ByaW50Zihz
dG9yZV9hZGRyX25hbWVzW2ldLCAic3RvcmVfYWRkcl8lZCIsIGkpOworICAgICAgICBoZXhfc3Rv
cmVfYWRkcltpXSA9IHRjZ19nbG9iYWxfbWVtX25ldyhjcHVfZW52LAorICAgICAgICAgICAgb2Zm
c2V0b2YoQ1BVSGV4YWdvblN0YXRlLCBtZW1fbG9nX3N0b3Jlc1tpXS52YSksCisgICAgICAgICAg
ICBzdG9yZV9hZGRyX25hbWVzW2ldKTsKKworICAgICAgICBzcHJpbnRmKHN0b3JlX3dpZHRoX25h
bWVzW2ldLCAic3RvcmVfd2lkdGhfJWQiLCBpKTsKKyAgICAgICAgaGV4X3N0b3JlX3dpZHRoW2ld
ID0gdGNnX2dsb2JhbF9tZW1fbmV3KGNwdV9lbnYsCisgICAgICAgICAgICBvZmZzZXRvZihDUFVI
ZXhhZ29uU3RhdGUsIG1lbV9sb2dfc3RvcmVzW2ldLndpZHRoKSwKKyAgICAgICAgICAgIHN0b3Jl
X3dpZHRoX25hbWVzW2ldKTsKKworICAgICAgICBzcHJpbnRmKHN0b3JlX3ZhbDMyX25hbWVzW2ld
LCAic3RvcmVfdmFsMzJfJWQiLCBpKTsKKyAgICAgICAgaGV4X3N0b3JlX3ZhbDMyW2ldID0gdGNn
X2dsb2JhbF9tZW1fbmV3KGNwdV9lbnYsCisgICAgICAgICAgICBvZmZzZXRvZihDUFVIZXhhZ29u
U3RhdGUsIG1lbV9sb2dfc3RvcmVzW2ldLmRhdGEzMiksCisgICAgICAgICAgICBzdG9yZV92YWwz
Ml9uYW1lc1tpXSk7CisKKyAgICAgICAgc3ByaW50ZihzdG9yZV92YWw2NF9uYW1lc1tpXSwgInN0
b3JlX3ZhbDY0XyVkIiwgaSk7CisgICAgICAgIGhleF9zdG9yZV92YWw2NFtpXSA9IHRjZ19nbG9i
YWxfbWVtX25ld19pNjQoY3B1X2VudiwKKyAgICAgICAgICAgIG9mZnNldG9mKENQVUhleGFnb25T
dGF0ZSwgbWVtX2xvZ19zdG9yZXNbaV0uZGF0YTY0KSwKKyAgICAgICAgICAgIHN0b3JlX3ZhbDY0
X25hbWVzW2ldKTsKKyAgICB9CisKKyAgICBpbml0X2dlbnB0cigpOworfQpkaWZmIC0tZ2l0IGEv
dGFyZ2V0L2hleGFnb24vdHJhbnNsYXRlLmggYi90YXJnZXQvaGV4YWdvbi90cmFuc2xhdGUuaApu
ZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwLi4yNjBmZjNjCi0tLSAvZGV2L251bGwK
KysrIGIvdGFyZ2V0L2hleGFnb24vdHJhbnNsYXRlLmgKQEAgLTAsMCArMSw4MiBAQAorLyoKKyAq
ICBDb3B5cmlnaHQgKGMpIDIwMTkgUXVhbGNvbW0gSW5ub3ZhdGlvbiBDZW50ZXIsIEluYy4gQWxs
IFJpZ2h0cyBSZXNlcnZlZC4KKyAqCisgKiAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU7
IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKKyAqICBpdCB1bmRlciB0aGUg
dGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQor
ICogIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlciB2ZXJzaW9uIDIgb2YgdGhl
IExpY2Vuc2UsIG9yCisgKiAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KKyAq
CisgKiAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2ls
bCBiZSB1c2VmdWwsCisgKiAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4g
dGhlIGltcGxpZWQgd2FycmFudHkgb2YKKyAqICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBG
T1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCisgKiAgR05VIEdlbmVyYWwgUHVibGlj
IExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KKyAqCisgKiAgWW91IHNob3VsZCBoYXZlIHJlY2Vp
dmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKKyAqICBhbG9uZyB3
aXRoIHRoaXMgcHJvZ3JhbTsgaWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNl
cy8+LgorICovCisKKyNpZm5kZWYgVFJBTlNMQVRFX0gKKyNkZWZpbmUgVFJBTlNMQVRFX0gKKwor
I2luY2x1ZGUgImNwdS5oIgorI2luY2x1ZGUgImV4ZWMvdHJhbnNsYXRvci5oIgorI2luY2x1ZGUg
ImV4ZWMvaGVscGVyLXByb3RvLmgiCisjaW5jbHVkZSAiZXhlYy9oZWxwZXItZ2VuLmgiCisjaW5j
bHVkZSAiaW50ZXJuYWwuaCIKKwordHlwZWRlZiBzdHJ1Y3QgRGlzYXNDb250ZXh0IHsKKyAgICBE
aXNhc0NvbnRleHRCYXNlIGJhc2U7CisgICAgdWludDMyX3QgbWVtX2lkeDsKKyAgICBpbnQgY3R4
X3JlZ19sb2dbUkVHX1dSSVRFU19NQVhdOworICAgIGludCBjdHhfcmVnX2xvZ19pZHg7CisgICAg
aW50IGN0eF9wcmVnX2xvZ1tQUkVEX1dSSVRFU19NQVhdOworICAgIGludCBjdHhfcHJlZ19sb2df
aWR4OworICAgIHVpbnQ4X3QgY3R4X3N0b3JlX3dpZHRoW1NUT1JFU19NQVhdOworfSBEaXNhc0Nv
bnRleHQ7CisKK3N0YXRpYyBpbmxpbmUgdm9pZCBjdHhfbG9nX3JlZ193cml0ZShEaXNhc0NvbnRl
eHQgKmN0eCwgaW50IHJudW0pCit7CisjaWYgSEVYX0RFQlVHCisgICAgaW50IGk7CisgICAgZm9y
IChpID0gMDsgaSA8IGN0eC0+Y3R4X3JlZ19sb2dfaWR4OyBpKyspIHsKKyAgICAgICAgaWYgKGN0
eC0+Y3R4X3JlZ19sb2dbaV0gPT0gcm51bSkgeworICAgICAgICAgICAgSEVYX0RFQlVHX0xPRygi
V0FSTklORzogTXVsdGlwbGUgd3JpdGVzIHRvIHIlZFxuIiwgcm51bSk7CisgICAgICAgIH0KKyAg
ICB9CisjZW5kaWYKKyAgICBjdHgtPmN0eF9yZWdfbG9nW2N0eC0+Y3R4X3JlZ19sb2dfaWR4XSA9
IHJudW07CisgICAgY3R4LT5jdHhfcmVnX2xvZ19pZHgrKzsKK30KKworc3RhdGljIGlubGluZSB2
b2lkIGN0eF9sb2dfcHJlZF93cml0ZShEaXNhc0NvbnRleHQgKmN0eCwgaW50IHBudW0pCit7Cisg
ICAgY3R4LT5jdHhfcHJlZ19sb2dbY3R4LT5jdHhfcHJlZ19sb2dfaWR4XSA9IHBudW07CisgICAg
Y3R4LT5jdHhfcHJlZ19sb2dfaWR4Kys7Cit9CisKK2V4dGVybiBUQ0d2IGhleF9ncHJbVE9UQUxf
UEVSX1RIUkVBRF9SRUdTXTsKK2V4dGVybiBUQ0d2IGhleF9wcmVkW05VTV9QUkVHU107CitleHRl
cm4gVENHdiBoZXhfbmV4dF9QQzsKK2V4dGVybiBUQ0d2IGhleF90aGlzX1BDOworZXh0ZXJuIFRD
R3YgaGV4X3Nsb3RfY2FuY2VsbGVkOworZXh0ZXJuIFRDR3YgaGV4X2JyYW5jaF90YWtlbjsKK2V4
dGVybiBUQ0d2IGhleF9uZXdfdmFsdWVbVE9UQUxfUEVSX1RIUkVBRF9SRUdTXTsKK2V4dGVybiBU
Q0d2IGhleF9yZWdfd3JpdHRlbltUT1RBTF9QRVJfVEhSRUFEX1JFR1NdOworZXh0ZXJuIFRDR3Yg
aGV4X25ld19wcmVkX3ZhbHVlW05VTV9QUkVHU107CitleHRlcm4gVENHdiBoZXhfcHJlZF93cml0
dGVuW05VTV9QUkVHU107CitleHRlcm4gVENHdiBoZXhfc3RvcmVfYWRkcltTVE9SRVNfTUFYXTsK
K2V4dGVybiBUQ0d2IGhleF9zdG9yZV93aWR0aFtTVE9SRVNfTUFYXTsKK2V4dGVybiBUQ0d2IGhl
eF9zdG9yZV92YWwzMltTVE9SRVNfTUFYXTsKK2V4dGVybiBUQ0d2X2k2NCBoZXhfc3RvcmVfdmFs
NjRbU1RPUkVTX01BWF07CitleHRlcm4gVENHdiBoZXhfZGN6ZXJvX2FkZHI7CitleHRlcm4gVENH
diBsbHNjX2FkZHI7CitleHRlcm4gVENHdiBsbHNjX3ZhbDsKK2V4dGVybiBUQ0d2X2k2NCBsbHNj
X3ZhbF9pNjQ7CitleHRlcm4gVENHdiBoZXhfaXNfZ2F0aGVyX3N0b3JlX2luc247CitleHRlcm4g
VENHdiBoZXhfZ2F0aGVyX2lzc3VlZDsKKwordm9pZCBoZXhhZ29uX3RyYW5zbGF0ZV9pbml0KHZv
aWQpOworZXh0ZXJuIHZvaWQgZ2VuX2V4Y2VwdGlvbihpbnQgZXhjcCk7CitleHRlcm4gdm9pZCBn
ZW5fZXhjZXB0aW9uX2RlYnVnKHZvaWQpOworCisjZW5kaWYKLS0gCjIuNy40Cgo=

