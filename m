Return-Path: <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>
X-Original-To: lists+qemu-devel@lfdr.de
Delivered-To: lists+qemu-devel@lfdr.de
Received: from lists.gnu.org (lists.gnu.org [209.51.188.17])
	by mail.lfdr.de (Postfix) with ESMTPS id 7EF192FC91C
	for <lists+qemu-devel@lfdr.de>; Wed, 20 Jan 2021 04:37:20 +0100 (CET)
Received: from localhost ([::1]:59272 helo=lists1p.gnu.org)
	by lists.gnu.org with esmtp (Exim 4.90_1)
	(envelope-from <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>)
	id 1l24J5-0007YH-H3
	for lists+qemu-devel@lfdr.de; Tue, 19 Jan 2021 22:37:19 -0500
Received: from eggs.gnu.org ([2001:470:142:3::10]:47438)
 by lists.gnu.org with esmtps (TLS1.2:ECDHE_RSA_AES_256_GCM_SHA384:256)
 (Exim 4.90_1) (envelope-from <tsimpson@qualcomm.com>)
 id 1l24Be-000790-0O
 for qemu-devel@nongnu.org; Tue, 19 Jan 2021 22:29:38 -0500
Received: from alexa-out-sd-02.qualcomm.com ([199.106.114.39]:53878)
 by eggs.gnu.org with esmtps (TLS1.2:RSA_AES_256_CBC_SHA1:256)
 (Exim 4.90_1) (envelope-from <tsimpson@qualcomm.com>)
 id 1l24BW-0007Vl-D7
 for qemu-devel@nongnu.org; Tue, 19 Jan 2021 22:29:37 -0500
DKIM-Signature: v=1; a=rsa-sha256; c=simple/simple;
 d=quicinc.com; i=@quicinc.com; q=dns/txt; s=qcdkim;
 t=1611113370; x=1642649370;
 h=from:to:cc:subject:date:message-id:in-reply-to:
 references:mime-version:content-transfer-encoding;
 bh=zqTCF0vmaG55wN0i1fhDLNsURGuieVQUpNdRGaqNB3Y=;
 b=WNiMKBCCKuu3foFAmkiAm5gb74WVuMABWAopDfRdSpUmUz8yQ50VLDv2
 u3tocdsNdoj+d1S2WTJKkasszynnjPnwLueQc3VEbthUbI+qVyHfQS5L0
 TJyAi/JEnDlM/2mnJzb+2mZ/RVsRrKIG4GvBUG0+UItvhXF6ag/CmQg+A U=;
Received: from unknown (HELO ironmsg02-sd.qualcomm.com) ([10.53.140.142])
 by alexa-out-sd-02.qualcomm.com with ESMTP; 19 Jan 2021 19:29:26 -0800
X-QCInternal: smtphost
Received: from vu-tsimpson-aus.qualcomm.com (HELO
 vu-tsimpson1-aus.qualcomm.com) ([10.222.150.1])
 by ironmsg02-sd.qualcomm.com with ESMTP; 19 Jan 2021 19:29:25 -0800
Received: by vu-tsimpson1-aus.qualcomm.com (Postfix, from userid 47164)
 id 40D5429BD; Tue, 19 Jan 2021 21:29:25 -0600 (CST)
From: Taylor Simpson <tsimpson@quicinc.com>
To: qemu-devel@nongnu.org
Subject: [PATCH v7 13/35] Hexagon (target/hexagon) instruction/packet decode
Date: Tue, 19 Jan 2021 21:28:46 -0600
Message-Id: <1611113349-24906-14-git-send-email-tsimpson@quicinc.com>
X-Mailer: git-send-email 2.7.4
In-Reply-To: <1611113349-24906-1-git-send-email-tsimpson@quicinc.com>
References: <1611113349-24906-1-git-send-email-tsimpson@quicinc.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Received-SPF: pass client-ip=199.106.114.39;
 envelope-from=tsimpson@qualcomm.com; helo=alexa-out-sd-02.qualcomm.com
X-Spam_score_int: -40
X-Spam_score: -4.1
X-Spam_bar: ----
X-Spam_report: (-4.1 / 5.0 requ) BAYES_00=-1.9, DKIM_SIGNED=0.1,
 DKIM_VALID=-0.1, DKIM_VALID_AU=-0.1, HEADER_FROM_DIFFERENT_DOMAINS=0.248,
 RCVD_IN_DNSWL_MED=-2.3, SPF_HELO_NONE=0.001,
 SPF_PASS=-0.001 autolearn=ham autolearn_force=no
X-Spam_action: no action
X-BeenThere: qemu-devel@nongnu.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: <qemu-devel.nongnu.org>
List-Unsubscribe: <https://lists.nongnu.org/mailman/options/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=unsubscribe>
List-Archive: <https://lists.nongnu.org/archive/html/qemu-devel>
List-Post: <mailto:qemu-devel@nongnu.org>
List-Help: <mailto:qemu-devel-request@nongnu.org?subject=help>
List-Subscribe: <https://lists.nongnu.org/mailman/listinfo/qemu-devel>,
 <mailto:qemu-devel-request@nongnu.org?subject=subscribe>
Cc: ale@rev.ng, bcain@quicinc.com, philmd@redhat.com,
 richard.henderson@linaro.org, laurent@vivier.eu, tsimpson@quicinc.com,
 alex.bennee@linaro.org
Errors-To: qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org
Sender: "Qemu-devel" <qemu-devel-bounces+lists+qemu-devel=lfdr.de@nongnu.org>

VGFrZSB0aGUgd29yZHMgZnJvbSBpbnN0cnVjdGlvbiBtZW1vcnkgYW5kIGJ1aWxkIGEgcGFja2V0
X3QgZm9yIFRDRyBjb2RlCmdlbmVyYXRpb24KClRoZSBmb2xsb3dpbmcgb3BlcmF0aW9ucyBhcmUg
cGVyZm9ybWVkCiAgICBDb252ZXJ0IHRoZSAubmV3IGVuY29kZWQgb2Zmc2V0IHRvIHRoZSByZWdp
c3RlciBudW1iZXIgb2YgdGhlIHByb2R1Y2VyCiAgICBSZW9yZGVyIHRoZSBwYWNrZXQgc28gLm5l
dyBwcm9kdWNlciBpcyBiZWZvcmUgY29uc3VtZXIKICAgIEFwcGx5IGNvbnN0YW50IGV4dGVuZGVy
cwogICAgU2VwYXJhdGUgc3ViaW5zbidzIGludG8gdHdvIGluc3RydWN0aW9ucwogICAgQnJlYWsg
Y29tcGFyZS1qdW1wcyBpbnRvIHR3byBpbnN0cnVjdGlvbnMKICAgIENyZWF0ZSBpbnN0cnVjdGlv
bnMgZm9yIDplbmRsb29wCgpTaWduZWQtb2ZmLWJ5OiBUYXlsb3IgU2ltcHNvbiA8dHNpbXBzb25A
cXVpY2luYy5jb20+Ci0tLQogdGFyZ2V0L2hleGFnb24vZGVjb2RlLmggICAgIHwgIDMyICsrKwog
dGFyZ2V0L2hleGFnb24vZGVjb2RlLmMgICAgIHwgNTg4ICsrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysrCiB0YXJnZXQvaGV4YWdvbi9xNnZfZGVjb2RlLmMgfCAzODUg
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysKIDMgZmlsZXMgY2hhbmdlZCwgMTAwNSBpbnNl
cnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQgdGFyZ2V0L2hleGFnb24vZGVjb2RlLmgKIGNy
ZWF0ZSBtb2RlIDEwMDY0NCB0YXJnZXQvaGV4YWdvbi9kZWNvZGUuYwogY3JlYXRlIG1vZGUgMTAw
NjQ0IHRhcmdldC9oZXhhZ29uL3E2dl9kZWNvZGUuYwoKZGlmZiAtLWdpdCBhL3RhcmdldC9oZXhh
Z29uL2RlY29kZS5oIGIvdGFyZ2V0L2hleGFnb24vZGVjb2RlLmgKbmV3IGZpbGUgbW9kZSAxMDA2
NDQKaW5kZXggMDAwMDAwMC4uMTYwMjhhOQotLS0gL2Rldi9udWxsCisrKyBiL3RhcmdldC9oZXhh
Z29uL2RlY29kZS5oCkBAIC0wLDAgKzEsMzIgQEAKKy8qCisgKiAgQ29weXJpZ2h0KGMpIDIwMTkt
MjAyMSBRdWFsY29tbSBJbm5vdmF0aW9uIENlbnRlciwgSW5jLiBBbGwgUmlnaHRzIFJlc2VydmVk
LgorICoKKyAqICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3Ry
aWJ1dGUgaXQgYW5kL29yIG1vZGlmeQorICogIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05V
IEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5CisgKiAgdGhlIEZyZWUgU29m
dHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMiBvZiB0aGUgTGljZW5zZSwgb3IKKyAq
ICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgorICoKKyAqICBUaGlzIHByb2dy
YW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKKyAq
ICBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJy
YW50eSBvZgorICogIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIg
UFVSUE9TRS4gIFNlZSB0aGUKKyAqICBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9y
ZSBkZXRhaWxzLgorICoKKyAqICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRo
ZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQorICogIGFsb25nIHdpdGggdGhpcyBwcm9ncmFt
OyBpZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCisgKi8KKworI2lm
bmRlZiBIRVhBR09OX0RFQ09ERV9ICisjZGVmaW5lIEhFWEFHT05fREVDT0RFX0gKKworI2luY2x1
ZGUgImNwdS5oIgorI2luY2x1ZGUgIm9wY29kZXMuaCIKKyNpbmNsdWRlICJpbnNuLmgiCisKK2V4
dGVybiB2b2lkIGRlY29kZV9pbml0KHZvaWQpOworCitleHRlcm4gdm9pZCBkZWNvZGVfc2VuZF9p
bnNuX3RvKFBhY2tldCAqcGFja2V0LCBpbnQgc3RhcnQsIGludCBuZXdsb2MpOworCitleHRlcm4g
aW50IGRlY29kZV9wYWNrZXQoaW50IG1heF93b3JkcywgY29uc3QgdWludDMyX3QgKndvcmRzLCBQ
YWNrZXQgKnBrdCwKKyAgICAgICAgICAgICAgICAgICAgICAgICBib29sIGRpc2FzX29ubHkpOwor
CisjZW5kaWYKZGlmZiAtLWdpdCBhL3RhcmdldC9oZXhhZ29uL2RlY29kZS5jIGIvdGFyZ2V0L2hl
eGFnb24vZGVjb2RlLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMC4uMWRlNmE2
ZQotLS0gL2Rldi9udWxsCisrKyBiL3RhcmdldC9oZXhhZ29uL2RlY29kZS5jCkBAIC0wLDAgKzEs
NTg4IEBACisvKgorICogIENvcHlyaWdodChjKSAyMDE5LTIwMjEgUXVhbGNvbW0gSW5ub3ZhdGlv
biBDZW50ZXIsIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC4KKyAqCisgKiAgVGhpcyBwcm9ncmFt
IGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkK
KyAqICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNl
IGFzIHB1Ymxpc2hlZCBieQorICogIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhl
ciB2ZXJzaW9uIDIgb2YgdGhlIExpY2Vuc2UsIG9yCisgKiAgKGF0IHlvdXIgb3B0aW9uKSBhbnkg
bGF0ZXIgdmVyc2lvbi4KKyAqCisgKiAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRo
ZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCisgKiAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJB
TlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKKyAqICBNRVJDSEFOVEFC
SUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCisgKiAg
R05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KKyAqCisgKiAgWW91
IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExp
Y2Vuc2UKKyAqICBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbTsgaWYgbm90LCBzZWUgPGh0dHA6Ly93
d3cuZ251Lm9yZy9saWNlbnNlcy8+LgorICovCisKKyNpbmNsdWRlICJxZW11L29zZGVwLmgiCisj
aW5jbHVkZSAicWVtdS9sb2cuaCIKKyNpbmNsdWRlICJpY2xhc3MuaCIKKyNpbmNsdWRlICJvcGNv
ZGVzLmgiCisjaW5jbHVkZSAiZ2VucHRyLmgiCisjaW5jbHVkZSAiZGVjb2RlLmgiCisjaW5jbHVk
ZSAiaW5zbi5oIgorI2luY2x1ZGUgInByaW50aW5zbi5oIgorCisjZGVmaW5lIGZaWFROKE4sIE0s
IFZBTCkgKChWQUwpICYgKCgxTEwgPDwgKE4pKSAtIDEpKQorCitlbnVtIHsKKyAgICBFWFRfSURY
X25vZXh0ID0gMCwKKyAgICBFWFRfSURYX25vZXh0X0FGVEVSID0gNCwKKyAgICBFWFRfSURYX21t
dmVjID0gNCwKKyAgICBFWFRfSURYX21tdmVjX0FGVEVSID0gOCwKKyAgICBYWF9MQVNUX0VYVF9J
RFgKK307CisKKy8qCisgKiAgQ2VydGFpbiBvcGVyYW5kIHR5cGVzIHJlcHJlc2VudCBhIG5vbi1j
b250aWd1b3VzIHNldCBvZiB2YWx1ZXMuCisgKiAgRm9yIGV4YW1wbGUsIHRoZSBjb21wb3VuZCBj
b21wYXJlLWFuZC1qdW1wIGluc3RydWN0aW9uIGNhbiBvbmx5IGFjY2VzcworICogIHJlZ2lzdGVy
cyBSMC1SNyBhbmQgUjE2LTIzLgorICogIFRoaXMgdGFibGUgcmVwcmVzZW50cyB0aGUgbWFwcGlu
ZyBmcm9tIHRoZSBlbmNvZGluZyB0byB0aGUgYWN0dWFsIHZhbHVlcy4KKyAqLworCisjZGVmaW5l
IERFRl9SRUdNQVAoTkFNRSwgRUxFTUVOVFMsIC4uLikgXAorICAgIHN0YXRpYyBjb25zdCB1bnNp
Z25lZCBpbnQgREVDT0RFX1JFR0lTVEVSXyMjTkFNRVtFTEVNRU5UU10gPSBcCisgICAgeyBfX1ZB
X0FSR1NfXyB9OworICAgICAgICAvKiBOYW1lICAgTnVtIFRhYmxlICovCitERUZfUkVHTUFQKFJf
MTYsICAxNiwgMCwgMSwgMiwgMywgNCwgNSwgNiwgNywgMTYsIDE3LCAxOCwgMTksIDIwLCAyMSwg
MjIsIDIzKQorREVGX1JFR01BUChSX184LCAgOCwgIDAsIDIsIDQsIDYsIDE2LCAxOCwgMjAsIDIy
KQorCisjZGVmaW5lIERFQ09ERV9NQVBQRURfUkVHKFJFR05PLCBOQU1FKSBcCisgICAgaW5zbi0+
cmVnbm9bUkVHTk9dID0gREVDT0RFX1JFR0lTVEVSXyMjTkFNRVtpbnNuLT5yZWdub1tSRUdOT11d
OworCit0eXBlZGVmIHN0cnVjdCB7CisgICAgY29uc3Qgc3RydWN0IERlY3RyZWVUYWJsZSAqdGFi
bGVfbGluazsKKyAgICBjb25zdCBzdHJ1Y3QgRGVjdHJlZVRhYmxlICp0YWJsZV9saW5rX2I7Cisg
ICAgT3Bjb2RlIG9wY29kZTsKKyAgICBlbnVtIHsKKyAgICAgICAgREVDVFJFRV9FTlRSWV9JTlZB
TElELAorICAgICAgICBERUNUUkVFX1RBQkxFX0xJTkssCisgICAgICAgIERFQ1RSRUVfU1VCSU5T
TlMsCisgICAgICAgIERFQ1RSRUVfRVhUU1BBQ0UsCisgICAgICAgIERFQ1RSRUVfVEVSTUlOQUwK
KyAgICB9IHR5cGU7Cit9IERlY3RyZWVFbnRyeTsKKwordHlwZWRlZiBzdHJ1Y3QgRGVjdHJlZVRh
YmxlIHsKKyAgICB1bnNpZ25lZCBpbnQgKCpsb29rdXBfZnVuY3Rpb24pKGludCBzdGFydGJpdCwg
aW50IHdpZHRoLCB1aW50MzJfdCBvcGNvZGUpOworICAgIHVuc2lnbmVkIGludCBzaXplOworICAg
IHVuc2lnbmVkIGludCBzdGFydGJpdDsKKyAgICB1bnNpZ25lZCBpbnQgd2lkdGg7CisgICAgY29u
c3QgRGVjdHJlZUVudHJ5IHRhYmxlW107Cit9IERlY3RyZWVUYWJsZTsKKworI2RlZmluZSBERUNP
REVfTkVXX1RBQkxFKFRBRywgU0laRSwgV0hBVE5PVCkgXAorICAgIHN0YXRpYyBjb25zdCBEZWN0
cmVlVGFibGUgZGVjdHJlZV90YWJsZV8jI1RBRzsKKyNkZWZpbmUgVEFCTEVfTElOSyhUQUJMRSkg
ICAgICAgICAgICAgICAgICAgICAvKiBOT1RISU5HICovCisjZGVmaW5lIFRFUk1JTkFMKFRBRywg
RU5DKSAgICAgICAgICAgICAgICAgICAgLyogTk9USElORyAqLworI2RlZmluZSBTVUJJTlNOUyhU
QUcsIENMQVNTQSwgQ0xBU1NCLCBFTkMpICAgIC8qIE5PVEhJTkcgKi8KKyNkZWZpbmUgRVhUU1BB
Q0UoVEFHLCBFTkMpICAgICAgICAgICAgICAgICAgICAvKiBOT1RISU5HICovCisjZGVmaW5lIElO
VkFMSUQoKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogTk9USElORyAqLworI2RlZmlu
ZSBERUNPREVfRU5EX1RBQkxFKC4uLikgICAgICAgICAgICAgICAgIC8qIE5PVEhJTkcgKi8KKyNk
ZWZpbmUgREVDT0RFX01BVENIX0lORk8oLi4uKSAgICAgICAgICAgICAgICAvKiBOT1RISU5HICov
CisjZGVmaW5lIERFQ09ERV9MRUdBQ1lfTUFUQ0hfSU5GTyguLi4pICAgICAgICAgLyogTk9USElO
RyAqLworI2RlZmluZSBERUNPREVfT1BJTkZPKC4uLikgICAgICAgICAgICAgICAgICAgIC8qIE5P
VEhJTkcgKi8KKworI2luY2x1ZGUgImRlY3RyZWVfZ2VuZXJhdGVkLmgiCisKKyN1bmRlZiBERUNP
REVfT1BJTkZPCisjdW5kZWYgREVDT0RFX01BVENIX0lORk8KKyN1bmRlZiBERUNPREVfTEVHQUNZ
X01BVENIX0lORk8KKyN1bmRlZiBERUNPREVfRU5EX1RBQkxFCisjdW5kZWYgSU5WQUxJRAorI3Vu
ZGVmIFRFUk1JTkFMCisjdW5kZWYgU1VCSU5TTlMKKyN1bmRlZiBFWFRTUEFDRQorI3VuZGVmIFRB
QkxFX0xJTksKKyN1bmRlZiBERUNPREVfTkVXX1RBQkxFCisjdW5kZWYgREVDT0RFX1NFUEFSQVRP
Ul9CSVRTCisKKyNkZWZpbmUgREVDT0RFX1NFUEFSQVRPUl9CSVRTKFNUQVJULCBXSURUSCkgTlVM
TCwgU1RBUlQsIFdJRFRICisjZGVmaW5lIERFQ09ERV9ORVdfVEFCTEVfSEVMUEVSKFRBRywgU0la
RSwgRk4sIFNUQVJULCBXSURUSCkgXAorICAgIHN0YXRpYyBjb25zdCBEZWN0cmVlVGFibGUgZGVj
dHJlZV90YWJsZV8jI1RBRyA9IHsgXAorICAgICAgICAuc2l6ZSA9IFNJWkUsIFwKKyAgICAgICAg
Lmxvb2t1cF9mdW5jdGlvbiA9IEZOLCBcCisgICAgICAgIC5zdGFydGJpdCA9IFNUQVJULCBcCisg
ICAgICAgIC53aWR0aCA9IFdJRFRILCBcCisgICAgICAgIC50YWJsZSA9IHsKKyNkZWZpbmUgREVD
T0RFX05FV19UQUJMRShUQUcsIFNJWkUsIFdIQVROT1QpIFwKKyAgICBERUNPREVfTkVXX1RBQkxF
X0hFTFBFUihUQUcsIFNJWkUsIFdIQVROT1QpCisKKyNkZWZpbmUgVEFCTEVfTElOSyhUQUJMRSkg
XAorICAgIHsgLnR5cGUgPSBERUNUUkVFX1RBQkxFX0xJTkssIC50YWJsZV9saW5rID0gJmRlY3Ry
ZWVfdGFibGVfIyNUQUJMRSB9LAorI2RlZmluZSBURVJNSU5BTChUQUcsIEVOQykgXAorICAgIHsg
LnR5cGUgPSBERUNUUkVFX1RFUk1JTkFMLCAub3Bjb2RlID0gVEFHICB9LAorI2RlZmluZSBTVUJJ
TlNOUyhUQUcsIENMQVNTQSwgQ0xBU1NCLCBFTkMpIFwKKyAgICB7IFwKKyAgICAgICAgLnR5cGUg
PSBERUNUUkVFX1NVQklOU05TLCBcCisgICAgICAgIC50YWJsZV9saW5rID0gJmRlY3RyZWVfdGFi
bGVfREVDT0RFX1NVQklOU05fIyNDTEFTU0EsIFwKKyAgICAgICAgLnRhYmxlX2xpbmtfYiA9ICZk
ZWN0cmVlX3RhYmxlX0RFQ09ERV9TVUJJTlNOXyMjQ0xBU1NCIFwKKyAgICB9LAorI2RlZmluZSBF
WFRTUEFDRShUQUcsIEVOQykgeyAudHlwZSA9IERFQ1RSRUVfRVhUU1BBQ0UgfSwKKyNkZWZpbmUg
SU5WQUxJRCgpIHsgLnR5cGUgPSBERUNUUkVFX0VOVFJZX0lOVkFMSUQsIC5vcGNvZGUgPSBYWF9M
QVNUX09QQ09ERSB9LAorCisjZGVmaW5lIERFQ09ERV9FTkRfVEFCTEUoLi4uKSB9IH07CisKKyNk
ZWZpbmUgREVDT0RFX01BVENIX0lORk8oLi4uKSAgICAgICAgICAgICAgICAvKiBOT1RISU5HICov
CisjZGVmaW5lIERFQ09ERV9MRUdBQ1lfTUFUQ0hfSU5GTyguLi4pICAgICAgICAgLyogTk9USElO
RyAqLworI2RlZmluZSBERUNPREVfT1BJTkZPKC4uLikgICAgICAgICAgICAgICAgICAgIC8qIE5P
VEhJTkcgKi8KKworI2luY2x1ZGUgImRlY3RyZWVfZ2VuZXJhdGVkLmgiCisKKyN1bmRlZiBERUNP
REVfT1BJTkZPCisjdW5kZWYgREVDT0RFX01BVENIX0lORk8KKyN1bmRlZiBERUNPREVfTEVHQUNZ
X01BVENIX0lORk8KKyN1bmRlZiBERUNPREVfRU5EX1RBQkxFCisjdW5kZWYgSU5WQUxJRAorI3Vu
ZGVmIFRFUk1JTkFMCisjdW5kZWYgU1VCSU5TTlMKKyN1bmRlZiBFWFRTUEFDRQorI3VuZGVmIFRB
QkxFX0xJTksKKyN1bmRlZiBERUNPREVfTkVXX1RBQkxFCisjdW5kZWYgREVDT0RFX05FV19UQUJM
RV9IRUxQRVIKKyN1bmRlZiBERUNPREVfU0VQQVJBVE9SX0JJVFMKKworc3RhdGljIGNvbnN0IERl
Y3RyZWVUYWJsZSBkZWN0cmVlX3RhYmxlX0RFQ09ERV9FWFRfRVhUX25vZXh0ID0geworICAgIC5z
aXplID0gMSwgLmxvb2t1cF9mdW5jdGlvbiA9IE5VTEwsIC5zdGFydGJpdCA9IDAsIC53aWR0aCA9
IDAsCisgICAgLnRhYmxlID0geworICAgICAgICB7IC50eXBlID0gREVDVFJFRV9FTlRSWV9JTlZB
TElELCAub3Bjb2RlID0gWFhfTEFTVF9PUENPREUgfSwKKyAgICB9Cit9OworCitzdGF0aWMgY29u
c3QgRGVjdHJlZVRhYmxlICpleHRfdHJlZXNbWFhfTEFTVF9FWFRfSURYXTsKKworc3RhdGljIHZv
aWQgZGVjb2RlX2V4dF9pbml0KHZvaWQpCit7CisgICAgaW50IGk7CisgICAgZm9yIChpID0gRVhU
X0lEWF9ub2V4dDsgaSA8IEVYVF9JRFhfbm9leHRfQUZURVI7IGkrKykgeworICAgICAgICBleHRf
dHJlZXNbaV0gPSAmZGVjdHJlZV90YWJsZV9ERUNPREVfRVhUX0VYVF9ub2V4dDsKKyAgICB9Cit9
CisKK3R5cGVkZWYgc3RydWN0IHsKKyAgICB1aW50MzJfdCBtYXNrOworICAgIHVpbnQzMl90IG1h
dGNoOworfSBEZWNvZGVJVGFibGVFbnRyeTsKKworI2RlZmluZSBERUNPREVfTkVXX1RBQkxFKFRB
RywgU0laRSwgV0hBVE5PVCkgIC8qIE5PVEhJTkcgKi8KKyNkZWZpbmUgVEFCTEVfTElOSyhUQUJM
RSkgICAgICAgICAgICAgICAgICAgICAvKiBOT1RISU5HICovCisjZGVmaW5lIFRFUk1JTkFMKFRB
RywgRU5DKSAgICAgICAgICAgICAgICAgICAgLyogTk9USElORyAqLworI2RlZmluZSBTVUJJTlNO
UyhUQUcsIENMQVNTQSwgQ0xBU1NCLCBFTkMpICAgIC8qIE5PVEhJTkcgKi8KKyNkZWZpbmUgRVhU
U1BBQ0UoVEFHLCBFTkMpICAgICAgICAgICAgICAgICAgICAvKiBOT1RISU5HICovCisjZGVmaW5l
IElOVkFMSUQoKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogTk9USElORyAqLworI2Rl
ZmluZSBERUNPREVfRU5EX1RBQkxFKC4uLikgICAgICAgICAgICAgICAgIC8qIE5PVEhJTkcgKi8K
KyNkZWZpbmUgREVDT0RFX09QSU5GTyguLi4pICAgICAgICAgICAgICAgICAgICAvKiBOT1RISU5H
ICovCisKKyNkZWZpbmUgREVDT0RFX01BVENIX0lORk9fTk9STUFMKFRBRywgTUFTSywgTUFUQ0gp
IFwKKyAgICBbVEFHXSA9IHsgXAorICAgICAgICAubWFzayA9IE1BU0ssIFwKKyAgICAgICAgLm1h
dGNoID0gTUFUQ0gsIFwKKyAgICB9LAorCisjZGVmaW5lIERFQ09ERV9NQVRDSF9JTkZPX05VTEwo
VEFHLCBNQVNLLCBNQVRDSCkgXAorICAgIFtUQUddID0geyAubWF0Y2ggPSB+MCB9LAorCisjZGVm
aW5lIERFQ09ERV9NQVRDSF9JTkZPKC4uLikgREVDT0RFX01BVENIX0lORk9fTk9STUFMKF9fVkFf
QVJHU19fKQorI2RlZmluZSBERUNPREVfTEVHQUNZX01BVENIX0lORk8oLi4uKSAvKiBOT1RISU5H
ICovCisKK3N0YXRpYyBjb25zdCBEZWNvZGVJVGFibGVFbnRyeSBkZWNvZGVfaXRhYmxlW1hYX0xB
U1RfT1BDT0RFXSA9IHsKKyNpbmNsdWRlICJkZWN0cmVlX2dlbmVyYXRlZC5oIgorfTsKKworI3Vu
ZGVmIERFQ09ERV9NQVRDSF9JTkZPCisjZGVmaW5lIERFQ09ERV9NQVRDSF9JTkZPKC4uLikgREVD
T0RFX01BVENIX0lORk9fTlVMTChfX1ZBX0FSR1NfXykKKworI3VuZGVmIERFQ09ERV9MRUdBQ1lf
TUFUQ0hfSU5GTworI2RlZmluZSBERUNPREVfTEVHQUNZX01BVENIX0lORk8oLi4uKSBERUNPREVf
TUFUQ0hfSU5GT19OT1JNQUwoX19WQV9BUkdTX18pCisKK3N0YXRpYyBjb25zdCBEZWNvZGVJVGFi
bGVFbnRyeSBkZWNvZGVfbGVnYWN5X2l0YWJsZVtYWF9MQVNUX09QQ09ERV0gPSB7CisjaW5jbHVk
ZSAiZGVjdHJlZV9nZW5lcmF0ZWQuaCIKK307CisKKyN1bmRlZiBERUNPREVfT1BJTkZPCisjdW5k
ZWYgREVDT0RFX01BVENIX0lORk8KKyN1bmRlZiBERUNPREVfTEVHQUNZX01BVENIX0lORk8KKyN1
bmRlZiBERUNPREVfRU5EX1RBQkxFCisjdW5kZWYgSU5WQUxJRAorI3VuZGVmIFRFUk1JTkFMCisj
dW5kZWYgU1VCSU5TTlMKKyN1bmRlZiBFWFRTUEFDRQorI3VuZGVmIFRBQkxFX0xJTksKKyN1bmRl
ZiBERUNPREVfTkVXX1RBQkxFCisjdW5kZWYgREVDT0RFX1NFUEFSQVRPUl9CSVRTCisKK3ZvaWQg
ZGVjb2RlX2luaXQodm9pZCkKK3sKKyAgICBkZWNvZGVfZXh0X2luaXQoKTsKK30KKwordm9pZCBk
ZWNvZGVfc2VuZF9pbnNuX3RvKFBhY2tldCAqcGFja2V0LCBpbnQgc3RhcnQsIGludCBuZXdsb2Mp
Cit7CisgICAgSW5zbiB0bXBpbnNuOworICAgIGludCBkaXJlY3Rpb247CisgICAgaW50IGk7Cisg
ICAgaWYgKHN0YXJ0ID09IG5ld2xvYykgeworICAgICAgICByZXR1cm47CisgICAgfQorICAgIGlm
IChzdGFydCA8IG5ld2xvYykgeworICAgICAgICAvKiBNb3ZlIHRvd2FyZHMgZW5kICovCisgICAg
ICAgIGRpcmVjdGlvbiA9IDE7CisgICAgfSBlbHNlIHsKKyAgICAgICAgLyogbW92ZSB0b3dhcmRz
IGJlZ2lubmluZyAqLworICAgICAgICBkaXJlY3Rpb24gPSAtMTsKKyAgICB9CisgICAgZm9yIChp
ID0gc3RhcnQ7IGkgIT0gbmV3bG9jOyBpICs9IGRpcmVjdGlvbikgeworICAgICAgICB0bXBpbnNu
ID0gcGFja2V0LT5pbnNuW2ldOworICAgICAgICBwYWNrZXQtPmluc25baV0gPSBwYWNrZXQtPmlu
c25baSArIGRpcmVjdGlvbl07CisgICAgICAgIHBhY2tldC0+aW5zbltpICsgZGlyZWN0aW9uXSA9
IHRtcGluc247CisgICAgfQorfQorCisvKiBGaWxsIG5ld3ZhbHVlIHJlZ2lzdGVycyB3aXRoIHRo
ZSBjb3JyZWN0IHJlZ25vICovCitzdGF0aWMgdm9pZAorZGVjb2RlX2ZpbGxfbmV3dmFsdWVfcmVn
bm8oUGFja2V0ICpwYWNrZXQpCit7CisgICAgaW50IGksIHVzZV9yZWdpZHgsIG9mZnNldCwgZGVm
X2lkeCwgZHN0X2lkeDsKKyAgICB1aW50MTZfdCBkZWZfb3Bjb2RlLCB1c2Vfb3Bjb2RlOworICAg
IGNoYXIgKmRzdHN0cjsKKworICAgIGZvciAoaSA9IDE7IGkgPCBwYWNrZXQtPm51bV9pbnNuczsg
aSsrKSB7CisgICAgICAgIGlmIChHRVRfQVRUUklCKHBhY2tldC0+aW5zbltpXS5vcGNvZGUsIEFf
RE9UTkVXVkFMVUUpICYmCisgICAgICAgICAgICAhR0VUX0FUVFJJQihwYWNrZXQtPmluc25baV0u
b3Bjb2RlLCBBX0VYVEVOU0lPTikpIHsKKyAgICAgICAgICAgIHVzZV9vcGNvZGUgPSBwYWNrZXQt
Pmluc25baV0ub3Bjb2RlOworCisgICAgICAgICAgICAvKiBJdCdzIGEgc3RvcmUsIHNvIHdlJ3Jl
IGFkanVzdGluZyB0aGUgTnQgZmllbGQgKi8KKyAgICAgICAgICAgIGlmIChHRVRfQVRUUklCKHVz
ZV9vcGNvZGUsIEFfU1RPUkUpKSB7CisgICAgICAgICAgICAgICAgdXNlX3JlZ2lkeCA9IHN0cmNo
cihvcGNvZGVfcmVnaW5mb1t1c2Vfb3Bjb2RlXSwgJ3QnKSAtCisgICAgICAgICAgICAgICAgICAg
IG9wY29kZV9yZWdpbmZvW3VzZV9vcGNvZGVdOworICAgICAgICAgICAgfSBlbHNlIHsgICAgLyog
SXQncyBhIEp1bXAsIHNvIHdlJ3JlIGFkanVzdGluZyB0aGUgTnMgZmllbGQgKi8KKyAgICAgICAg
ICAgICAgICB1c2VfcmVnaWR4ID0gc3RyY2hyKG9wY29kZV9yZWdpbmZvW3VzZV9vcGNvZGVdLCAn
cycpIC0KKyAgICAgICAgICAgICAgICAgICAgb3Bjb2RlX3JlZ2luZm9bdXNlX29wY29kZV07Cisg
ICAgICAgICAgICB9CisKKyAgICAgICAgICAgIC8qCisgICAgICAgICAgICAgKiBXaGF0J3MgZW5j
b2RlZCBhdCB0aGUgTi1maWVsZCBpcyB0aGUgb2Zmc2V0IHRvIHdobydzIHByb2R1Y2luZworICAg
ICAgICAgICAgICogdGhlIHZhbHVlLiAgU2hpZnQgb2ZmIHRoZSBMU0Igd2hpY2ggaW5kaWNhdGVz
IG9kZC9ldmVuIHJlZ2lzdGVyLAorICAgICAgICAgICAgICogdGhlbiB3YWxrIGJhY2t3YXJkcyBh
bmQgc2tpcCBvdmVyIHRoZSBjb25zdGFudCBleHRlbmRlcnMuCisgICAgICAgICAgICAgKi8KKyAg
ICAgICAgICAgIG9mZnNldCA9IHBhY2tldC0+aW5zbltpXS5yZWdub1t1c2VfcmVnaWR4XSA+PiAx
OworICAgICAgICAgICAgZGVmX2lkeCA9IGkgLSBvZmZzZXQ7CisgICAgICAgICAgICBmb3IgKGlu
dCBqID0gMDsgaiA8IG9mZnNldDsgaisrKSB7CisgICAgICAgICAgICAgICAgaWYgKEdFVF9BVFRS
SUIocGFja2V0LT5pbnNuW2kgLSBqIC0gMV0ub3Bjb2RlLCBBX0lUX0VYVEVOREVSKSkgeworICAg
ICAgICAgICAgICAgICAgICBkZWZfaWR4LS07CisgICAgICAgICAgICAgICAgfQorICAgICAgICAg
ICAgfQorCisgICAgICAgICAgICAvKgorICAgICAgICAgICAgICogQ2hlY2sgZm9yIGEgYmFkbHkg
ZW5jb2RlZCBOLWZpZWxkIHdoaWNoIHBvaW50cyB0byBhbiBpbnN0cnVjdGlvbgorICAgICAgICAg
ICAgICogb3V0LW9mLXJhbmdlCisgICAgICAgICAgICAgKi8KKyAgICAgICAgICAgIGdfYXNzZXJ0
KCEoKGRlZl9pZHggPCAwKSB8fCAoZGVmX2lkeCA+IChwYWNrZXQtPm51bV9pbnNucyAtIDEpKSkp
OworCisgICAgICAgICAgICAvKgorICAgICAgICAgICAgICogcGFja2V0LT5pbnNuW2RlZl9pZHhd
IGlzIHRoZSBwcm9kdWNlcgorICAgICAgICAgICAgICogRmlndXJlIG91dCB3aGljaCB0eXBlIG9m
IGRlc3RpbmF0aW9uIGl0IHByb2R1Y2VzCisgICAgICAgICAgICAgKiBhbmQgdGhlIGNvcnJlc3Bv
bmRpbmcgaW5kZXggaW4gdGhlIHJlZ2luZm8KKyAgICAgICAgICAgICAqLworICAgICAgICAgICAg
ZGVmX29wY29kZSA9IHBhY2tldC0+aW5zbltkZWZfaWR4XS5vcGNvZGU7CisgICAgICAgICAgICBk
c3RzdHIgPSBzdHJzdHIob3Bjb2RlX3dyZWdzW2RlZl9vcGNvZGVdLCAiUmQiKTsKKyAgICAgICAg
ICAgIGlmIChkc3RzdHIpIHsKKyAgICAgICAgICAgICAgICBkc3RzdHIgPSBzdHJjaHIob3Bjb2Rl
X3JlZ2luZm9bZGVmX29wY29kZV0sICdkJyk7CisgICAgICAgICAgICB9IGVsc2UgeworICAgICAg
ICAgICAgICAgIGRzdHN0ciA9IHN0cnN0cihvcGNvZGVfd3JlZ3NbZGVmX29wY29kZV0sICJSeCIp
OworICAgICAgICAgICAgICAgIGlmIChkc3RzdHIpIHsKKyAgICAgICAgICAgICAgICAgICAgZHN0
c3RyID0gc3RyY2hyKG9wY29kZV9yZWdpbmZvW2RlZl9vcGNvZGVdLCAneCcpOworICAgICAgICAg
ICAgICAgIH0gZWxzZSB7CisgICAgICAgICAgICAgICAgICAgIGRzdHN0ciA9IHN0cnN0cihvcGNv
ZGVfd3JlZ3NbZGVmX29wY29kZV0sICJSZSIpOworICAgICAgICAgICAgICAgICAgICBpZiAoZHN0
c3RyKSB7CisgICAgICAgICAgICAgICAgICAgICAgICBkc3RzdHIgPSBzdHJjaHIob3Bjb2RlX3Jl
Z2luZm9bZGVmX29wY29kZV0sICdlJyk7CisgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7Cisg
ICAgICAgICAgICAgICAgICAgICAgICBkc3RzdHIgPSBzdHJzdHIob3Bjb2RlX3dyZWdzW2RlZl9v
cGNvZGVdLCAiUnkiKTsKKyAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkc3RzdHIpIHsKKyAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBkc3RzdHIgPSBzdHJjaHIob3Bjb2RlX3JlZ2luZm9b
ZGVmX29wY29kZV0sICd5Jyk7CisgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeworICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIGdfYXNzZXJ0X25vdF9yZWFjaGVkKCk7CisgICAgICAg
ICAgICAgICAgICAgICAgICB9CisgICAgICAgICAgICAgICAgICAgIH0KKyAgICAgICAgICAgICAg
ICB9CisgICAgICAgICAgICB9CisgICAgICAgICAgICBnX2Fzc2VydChkc3RzdHIgIT0gTlVMTCk7
CisKKyAgICAgICAgICAgIC8qIE5vdyBwYXRjaCB1cCB0aGUgY29uc3VtZXIgd2l0aCB0aGUgcmVn
aXN0ZXIgbnVtYmVyICovCisgICAgICAgICAgICBkc3RfaWR4ID0gZHN0c3RyIC0gb3Bjb2RlX3Jl
Z2luZm9bZGVmX29wY29kZV07CisgICAgICAgICAgICBwYWNrZXQtPmluc25baV0ucmVnbm9bdXNl
X3JlZ2lkeF0gPQorICAgICAgICAgICAgICAgIHBhY2tldC0+aW5zbltkZWZfaWR4XS5yZWdub1tk
c3RfaWR4XTsKKyAgICAgICAgICAgIC8qCisgICAgICAgICAgICAgKiBXZSBuZWVkIHRvIHJlbWVt
YmVyIHdobyBwcm9kdWNlcyB0aGlzIHZhbHVlIHRvIGxhdGVyCisgICAgICAgICAgICAgKiBjaGVj
ayBpZiBpdCB3YXMgZHluYW1pY2FsbHkgY2FuY2VsbGVkCisgICAgICAgICAgICAgKi8KKyAgICAg
ICAgICAgIHBhY2tldC0+aW5zbltpXS5uZXdfdmFsdWVfcHJvZHVjZXJfc2xvdCA9CisgICAgICAg
ICAgICAgICAgcGFja2V0LT5pbnNuW2RlZl9pZHhdLnNsb3Q7CisgICAgICAgIH0KKyAgICB9Cit9
CisKKy8qIFNwbGl0IENKIGludG8gYSBjb21wYXJlIGFuZCBhIGp1bXAgKi8KK3N0YXRpYyB2b2lk
IGRlY29kZV9zcGxpdF9jbXBqdW1wKFBhY2tldCAqcGt0KQoreworICAgIGludCBsYXN0LCBpOwor
ICAgIGludCBudW1pbnNucyA9IHBrdC0+bnVtX2luc25zOworCisgICAgLyoKKyAgICAgKiBGaXJz
dCwgc3BsaXQgYWxsIGNvbXBhcmUtanVtcHMuCisgICAgICogVGhlIGNvbXBhcmUgaXMgc2VudCB0
byB0aGUgZW5kIGFzIGEgbmV3IGluc3RydWN0aW9uLgorICAgICAqIERvIGl0IHRoaXMgd2F5IHNv
IHdlIGRvbid0IHJlb3JkZXIgZHVhbCBqdW1wcy4gVGhvc2UgbmVlZCB0byBzdGF5IGluCisgICAg
ICogb3JpZ2luYWwgb3JkZXIuCisgICAgICovCisgICAgZm9yIChpID0gMDsgaSA8IG51bWluc25z
OyBpKyspIHsKKyAgICAgICAgLyogSXQncyBhIGNtcC1qdW1wICovCisgICAgICAgIGlmIChHRVRf
QVRUUklCKHBrdC0+aW5zbltpXS5vcGNvZGUsIEFfTkVXQ01QSlVNUCkpIHsKKyAgICAgICAgICAg
IGxhc3QgPSBwa3QtPm51bV9pbnNuczsKKyAgICAgICAgICAgIHBrdC0+aW5zbltsYXN0XSA9IHBr
dC0+aW5zbltpXTsgICAgLyogY29weSB0aGUgaW5zdHJ1Y3Rpb24gKi8KKyAgICAgICAgICAgIHBr
dC0+aW5zbltsYXN0XS5wYXJ0MSA9IDE7ICAgIC8qIGxhc3QgaW5zdHJ1Y3Rpb24gZG9lcyB0aGUg
Q01QICovCisgICAgICAgICAgICBwa3QtPmluc25baV0ucGFydDEgPSAwOyAgICAvKiBleGlzdGlu
ZyBpbnN0cnVjdGlvbiBkb2VzIHRoZSBKVU1QICovCisgICAgICAgICAgICBwa3QtPm51bV9pbnNu
cysrOworICAgICAgICB9CisgICAgfQorCisgICAgLyogTm93IHJlLXNodWZmbGUgYWxsIHRoZSBj
b21wYXJlcyBiYWNrIHRvIHRoZSBiZWdpbm5pbmcgKi8KKyAgICBmb3IgKGkgPSAwOyBpIDwgcGt0
LT5udW1faW5zbnM7IGkrKykgeworICAgICAgICBpZiAocGt0LT5pbnNuW2ldLnBhcnQxKSB7Cisg
ICAgICAgICAgICBkZWNvZGVfc2VuZF9pbnNuX3RvKHBrdCwgaSwgMCk7CisgICAgICAgIH0KKyAg
ICB9Cit9CisKK3N0YXRpYyBpbmxpbmUgaW50IGRlY29kZV9vcGNvZGVfY2FuX2p1bXAoaW50IG9w
Y29kZSkKK3sKKyAgICBpZiAoKEdFVF9BVFRSSUIob3Bjb2RlLCBBX0pVTVApKSB8fAorICAgICAg
ICAoR0VUX0FUVFJJQihvcGNvZGUsIEFfQ0FMTCkpIHx8CisgICAgICAgIChvcGNvZGUgPT0gSjJf
dHJhcDApKSB7CisgICAgICAgIC8qIEV4Y2VwdGlvbiB0byBBX0pVTVAgYXR0cmlidXRlICovCisg
ICAgICAgIGlmIChvcGNvZGUgPT0gSjRfaGludGp1bXByKSB7CisgICAgICAgICAgICByZXR1cm4g
MDsKKyAgICAgICAgfQorICAgICAgICByZXR1cm4gMTsKKyAgICB9CisKKyAgICByZXR1cm4gMDsK
K30KKworc3RhdGljIGlubGluZSBpbnQgZGVjb2RlX29wY29kZV9lbmRzX2xvb3AoaW50IG9wY29k
ZSkKK3sKKyAgICByZXR1cm4gR0VUX0FUVFJJQihvcGNvZGUsIEFfSFdMT09QMF9FTkQpIHx8Cisg
ICAgICAgICAgIEdFVF9BVFRSSUIob3Bjb2RlLCBBX0hXTE9PUDFfRU5EKTsKK30KKworLyogU2V0
IHRoZSBpc18qIGZpZWxkcyBpbiBlYWNoIGluc3RydWN0aW9uICovCitzdGF0aWMgdm9pZCBkZWNv
ZGVfc2V0X2luc25fYXR0cl9maWVsZHMoUGFja2V0ICpwa3QpCit7CisgICAgaW50IGk7CisgICAg
aW50IG51bWluc25zID0gcGt0LT5udW1faW5zbnM7CisgICAgdWludDE2X3Qgb3Bjb2RlOworCisg
ICAgcGt0LT5wa3RfaGFzX2NvZiA9IDA7CisgICAgcGt0LT5wa3RfaGFzX2VuZGxvb3AgPSAwOwor
ICAgIHBrdC0+cGt0X2hhc19kY3plcm9hID0gMDsKKworICAgIGZvciAoaSA9IDA7IGkgPCBudW1p
bnNuczsgaSsrKSB7CisgICAgICAgIG9wY29kZSA9IHBrdC0+aW5zbltpXS5vcGNvZGU7CisgICAg
ICAgIGlmIChwa3QtPmluc25baV0ucGFydDEpIHsKKyAgICAgICAgICAgIGNvbnRpbnVlOyAgICAv
KiBTa2lwIGNvbXBhcmUgb2YgY21wLWp1bXBzICovCisgICAgICAgIH0KKworICAgICAgICBpZiAo
R0VUX0FUVFJJQihvcGNvZGUsIEFfRENaRVJPQSkpIHsKKyAgICAgICAgICAgIHBrdC0+cGt0X2hh
c19kY3plcm9hID0gMTsKKyAgICAgICAgfQorCisgICAgICAgIGlmIChHRVRfQVRUUklCKG9wY29k
ZSwgQV9TVE9SRSkpIHsKKyAgICAgICAgICAgIGlmIChwa3QtPmluc25baV0uc2xvdCA9PSAwKSB7
CisgICAgICAgICAgICAgICAgcGt0LT5wa3RfaGFzX3N0b3JlX3MwID0gMTsKKyAgICAgICAgICAg
IH0gZWxzZSB7CisgICAgICAgICAgICAgICAgcGt0LT5wa3RfaGFzX3N0b3JlX3MxID0gMTsKKyAg
ICAgICAgICAgIH0KKyAgICAgICAgfQorCisgICAgICAgIHBrdC0+cGt0X2hhc19jb2YgfD0gZGVj
b2RlX29wY29kZV9jYW5fanVtcChvcGNvZGUpOworCisgICAgICAgIHBrdC0+aW5zbltpXS5pc19l
bmRsb29wID0gZGVjb2RlX29wY29kZV9lbmRzX2xvb3Aob3Bjb2RlKTsKKworICAgICAgICBwa3Qt
PnBrdF9oYXNfZW5kbG9vcCB8PSBwa3QtPmluc25baV0uaXNfZW5kbG9vcDsKKworICAgICAgICBw
a3QtPnBrdF9oYXNfY29mIHw9IHBrdC0+cGt0X2hhc19lbmRsb29wOworICAgIH0KK30KKworLyoK
KyAqIFNodWZmbGUgZm9yIGV4ZWN1dGlvbgorICogTW92ZSBzdG9yZXMgdG8gZW5kIChpbiBzYW1l
IG9yZGVyIGFzIGVuY29kaW5nKQorICogTW92ZSBjb21wYXJlcyB0byBiZWdpbm5pbmcgKGZvciB1
c2UgYnkgLm5ldyBpbnNucykKKyAqLworc3RhdGljIHZvaWQgZGVjb2RlX3NodWZmbGVfZm9yX2V4
ZWN1dGlvbihQYWNrZXQgKnBhY2tldCkKK3sKKyAgICBpbnQgY2hhbmdlZCA9IDA7CisgICAgaW50
IGk7CisgICAgaW50IGZsYWc7ICAgIC8qIGZsYWcgbWVhbnMgd2UndmUgc2VlbiBhIG5vbi1tZW1v
cnkgaW5zdHJ1Y3Rpb24gKi8KKyAgICBpbnQgbl9tZW1zOworICAgIGludCBsYXN0X2luc24gPSBw
YWNrZXQtPm51bV9pbnNucyAtIDE7CisKKyAgICAvKgorICAgICAqIFNraXAgZW5kIGxvb3BzLCBz
b21laG93IGFuIGVuZCBsb29wIGlzIGdldHRpbmcgaW4gYW5kIG1lc3NpbmcKKyAgICAgKiB1cCB0
aGUgb3JkZXIKKyAgICAgKi8KKyAgICBpZiAoZGVjb2RlX29wY29kZV9lbmRzX2xvb3AocGFja2V0
LT5pbnNuW2xhc3RfaW5zbl0ub3Bjb2RlKSkgeworICAgICAgICBsYXN0X2luc24tLTsKKyAgICB9
CisKKyAgICBkbyB7CisgICAgICAgIGNoYW5nZWQgPSAwOworICAgICAgICAvKgorICAgICAgICAg
KiBTdG9yZXMgZ28gbGFzdCwgbXVzdCBub3QgcmVvcmRlci4KKyAgICAgICAgICogQ2Fubm90IHNo
dWZmbGUgc3RvcmVzIHBhc3QgbG9hZHMsIGVpdGhlci4KKyAgICAgICAgICogSXRlcmF0ZSBiYWNr
d2FyZHMuICBJZiB3ZSBzZWUgYSBub24tbWVtb3J5IGluc3RydWN0aW9uLAorICAgICAgICAgKiB0
aGVuIGEgc3RvcmUsIHNodWZmbGUgdGhlIHN0b3JlIHRvIHRoZSBmcm9udC4gIERvbid0IHNodWZm
bGUKKyAgICAgICAgICogc3RvcmVzIHdydCBlYWNoIG90aGVyIG9yIGEgbG9hZC4KKyAgICAgICAg
ICovCisgICAgICAgIGZvciAoZmxhZyA9IG5fbWVtcyA9IDAsIGkgPSBsYXN0X2luc247IGkgPj0g
MDsgaS0tKSB7CisgICAgICAgICAgICBpbnQgb3Bjb2RlID0gcGFja2V0LT5pbnNuW2ldLm9wY29k
ZTsKKworICAgICAgICAgICAgaWYgKGZsYWcgJiYgR0VUX0FUVFJJQihvcGNvZGUsIEFfU1RPUkUp
KSB7CisgICAgICAgICAgICAgICAgZGVjb2RlX3NlbmRfaW5zbl90byhwYWNrZXQsIGksIGxhc3Rf
aW5zbiAtIG5fbWVtcyk7CisgICAgICAgICAgICAgICAgbl9tZW1zKys7CisgICAgICAgICAgICAg
ICAgY2hhbmdlZCA9IDE7CisgICAgICAgICAgICB9IGVsc2UgaWYgKEdFVF9BVFRSSUIob3Bjb2Rl
LCBBX1NUT1JFKSkgeworICAgICAgICAgICAgICAgIG5fbWVtcysrOworICAgICAgICAgICAgfSBl
bHNlIGlmIChHRVRfQVRUUklCKG9wY29kZSwgQV9MT0FEKSkgeworICAgICAgICAgICAgICAgIC8q
CisgICAgICAgICAgICAgICAgICogRG9uJ3Qgc2V0IGZsYWcsIHNpbmNlIHdlIGRvbid0IHdhbnQg
dG8gc2h1ZmZsZSBhCisgICAgICAgICAgICAgICAgICogc3RvcmUgcGFzdCBhIGxvYWQKKyAgICAg
ICAgICAgICAgICAgKi8KKyAgICAgICAgICAgICAgICBuX21lbXMrKzsKKyAgICAgICAgICAgIH0g
ZWxzZSBpZiAoR0VUX0FUVFJJQihvcGNvZGUsIEFfRE9UTkVXVkFMVUUpKSB7CisgICAgICAgICAg
ICAgICAgLyoKKyAgICAgICAgICAgICAgICAgKiBEb24ndCBzZXQgZmxhZywgc2luY2Ugd2UgZG9u
J3Qgd2FudCB0byBzaHVmZmxlIHBhc3QKKyAgICAgICAgICAgICAgICAgKiBhIC5uZXcgdmFsdWUK
KyAgICAgICAgICAgICAgICAgKi8KKyAgICAgICAgICAgIH0gZWxzZSB7CisgICAgICAgICAgICAg
ICAgZmxhZyA9IDE7CisgICAgICAgICAgICB9CisgICAgICAgIH0KKworICAgICAgICBpZiAoY2hh
bmdlZCkgeworICAgICAgICAgICAgY29udGludWU7CisgICAgICAgIH0KKyAgICAgICAgLyogQ29t
cGFyZXMgZ28gZmlyc3QsIG1heSBiZSByZW9yZGVyZWQgd3J0IGVhY2ggb3RoZXIgKi8KKyAgICAg
ICAgZm9yIChmbGFnID0gMCwgaSA9IDA7IGkgPCBsYXN0X2luc24gKyAxOyBpKyspIHsKKyAgICAg
ICAgICAgIGludCBvcGNvZGUgPSBwYWNrZXQtPmluc25baV0ub3Bjb2RlOworCisgICAgICAgICAg
ICBpZiAoKHN0cnN0cihvcGNvZGVfd3JlZ3Nbb3Bjb2RlXSwgIlBkNCIpIHx8CisgICAgICAgICAg
ICAgICAgIHN0cnN0cihvcGNvZGVfd3JlZ3Nbb3Bjb2RlXSwgIlBlNCIpKSAmJgorICAgICAgICAg
ICAgICAgIEdFVF9BVFRSSUIob3Bjb2RlLCBBX1NUT1JFKSA9PSAwKSB7CisgICAgICAgICAgICAg
ICAgLyogVGhpcyBzaG91bGQgYmUgYSBjb21wYXJlIChub3QgYSBzdG9yZSBjb25kaXRpb25hbCkg
Ki8KKyAgICAgICAgICAgICAgICBpZiAoZmxhZykgeworICAgICAgICAgICAgICAgICAgICBkZWNv
ZGVfc2VuZF9pbnNuX3RvKHBhY2tldCwgaSwgMCk7CisgICAgICAgICAgICAgICAgICAgIGNoYW5n
ZWQgPSAxOworICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKKyAgICAgICAgICAgICAgICB9
CisgICAgICAgICAgICB9IGVsc2UgaWYgKEdFVF9BVFRSSUIob3Bjb2RlLCBBX0lNUExJQ0lUX1dS
SVRFU19QMykgJiYKKyAgICAgICAgICAgICAgICAgICAgICAgIWRlY29kZV9vcGNvZGVfZW5kc19s
b29wKHBhY2tldC0+aW5zbltpXS5vcGNvZGUpKSB7CisgICAgICAgICAgICAgICAgLyoKKyAgICAg
ICAgICAgICAgICAgKiBzcE5sb29wIGluc3RydWN0aW9uCisgICAgICAgICAgICAgICAgICogRG9u
J3QgcmVvcmRlciBlbmRsb29wczsgdGhleSBhcmUgbm90IHZhbGlkIGZvciAubmV3IHVzZXMsCisg
ICAgICAgICAgICAgICAgICogYW5kIHdlIHdhbnQgdG8gbWF0Y2ggSFcKKyAgICAgICAgICAgICAg
ICAgKi8KKyAgICAgICAgICAgICAgICBpZiAoZmxhZykgeworICAgICAgICAgICAgICAgICAgICBk
ZWNvZGVfc2VuZF9pbnNuX3RvKHBhY2tldCwgaSwgMCk7CisgICAgICAgICAgICAgICAgICAgIGNo
YW5nZWQgPSAxOworICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKKyAgICAgICAgICAgICAg
ICB9CisgICAgICAgICAgICB9IGVsc2UgaWYgKEdFVF9BVFRSSUIob3Bjb2RlLCBBX0lNUExJQ0lU
X1dSSVRFU19QMCkgJiYKKyAgICAgICAgICAgICAgICAgICAgICAgIUdFVF9BVFRSSUIob3Bjb2Rl
LCBBX05FV0NNUEpVTVApKSB7CisgICAgICAgICAgICAgICAgaWYgKGZsYWcpIHsKKyAgICAgICAg
ICAgICAgICAgICAgZGVjb2RlX3NlbmRfaW5zbl90byhwYWNrZXQsIGksIDApOworICAgICAgICAg
ICAgICAgICAgICBjaGFuZ2VkID0gMTsKKyAgICAgICAgICAgICAgICAgICAgY29udGludWU7Cisg
ICAgICAgICAgICAgICAgfQorICAgICAgICAgICAgfSBlbHNlIHsKKyAgICAgICAgICAgICAgICBm
bGFnID0gMTsKKyAgICAgICAgICAgIH0KKyAgICAgICAgfQorICAgICAgICBpZiAoY2hhbmdlZCkg
eworICAgICAgICAgICAgY29udGludWU7CisgICAgICAgIH0KKyAgICB9IHdoaWxlIChjaGFuZ2Vk
KTsKKworICAgIC8qCisgICAgICogSWYgd2UgaGF2ZSBhIC5uZXcgcmVnaXN0ZXIgY29tcGFyZS9i
cmFuY2gsIG1vdmUgdGhhdCB0byB0aGUgdmVyeQorICAgICAqIHZlcnkgZW5kLCBwYXN0IHN0b3Jl
cworICAgICAqLworICAgIGZvciAoaSA9IDA7IGkgPCBsYXN0X2luc247IGkrKykgeworICAgICAg
ICBpZiAoR0VUX0FUVFJJQihwYWNrZXQtPmluc25baV0ub3Bjb2RlLCBBX0RPVE5FV1ZBTFVFKSkg
eworICAgICAgICAgICAgZGVjb2RlX3NlbmRfaW5zbl90byhwYWNrZXQsIGksIGxhc3RfaW5zbik7
CisgICAgICAgICAgICBicmVhazsKKyAgICAgICAgfQorICAgIH0KK30KKworc3RhdGljIHZvaWQK
K2FwcGx5X2V4dGVuZGVyKFBhY2tldCAqcGt0LCBpbnQgaSwgdWludDMyX3QgZXh0ZW5kZXIpCit7
CisgICAgaW50IGltbWVkX251bTsKKyAgICB1aW50MzJfdCBiYXNlX2ltbWVkOworCisgICAgaW1t
ZWRfbnVtID0gb3Bjb2RlX3doaWNoX2ltbWVkaWF0ZV9pc19leHRlbmRlZChwa3QtPmluc25baV0u
b3Bjb2RlKTsKKyAgICBiYXNlX2ltbWVkID0gcGt0LT5pbnNuW2ldLmltbWVkW2ltbWVkX251bV07
CisKKyAgICBwa3QtPmluc25baV0uaW1tZWRbaW1tZWRfbnVtXSA9IGV4dGVuZGVyIHwgZlpYVE4o
NiwgMzIsIGJhc2VfaW1tZWQpOworfQorCitzdGF0aWMgdm9pZCBkZWNvZGVfYXBwbHlfZXh0ZW5k
ZXJzKFBhY2tldCAqcGFja2V0KQoreworICAgIGludCBpOworICAgIGZvciAoaSA9IDA7IGkgPCBw
YWNrZXQtPm51bV9pbnNuczsgaSsrKSB7CisgICAgICAgIGlmIChHRVRfQVRUUklCKHBhY2tldC0+
aW5zbltpXS5vcGNvZGUsIEFfSVRfRVhURU5ERVIpKSB7CisgICAgICAgICAgICBwYWNrZXQtPmlu
c25baSArIDFdLmV4dGVuc2lvbl92YWxpZCA9IDE7CisgICAgICAgICAgICBhcHBseV9leHRlbmRl
cihwYWNrZXQsIGkgKyAxLCBwYWNrZXQtPmluc25baV0uaW1tZWRbMF0pOworICAgICAgICB9Cisg
ICAgfQorfQorCitzdGF0aWMgdm9pZCBkZWNvZGVfcmVtb3ZlX2V4dGVuZGVycyhQYWNrZXQgKnBh
Y2tldCkKK3sKKyAgICBpbnQgaSwgajsKKyAgICBmb3IgKGkgPSAwOyBpIDwgcGFja2V0LT5udW1f
aW5zbnM7IGkrKykgeworICAgICAgICBpZiAoR0VUX0FUVFJJQihwYWNrZXQtPmluc25baV0ub3Bj
b2RlLCBBX0lUX0VYVEVOREVSKSkgeworICAgICAgICAgICAgLyogUmVtb3ZlIHRoaXMgb25lIGJ5
IG1vdmluZyB0aGUgcmVtYWluaW5nIGluc3RydWN0aW9ucyBkb3duICovCisgICAgICAgICAgICBm
b3IgKGogPSBpOworICAgICAgICAgICAgICAgIChqIDwgcGFja2V0LT5udW1faW5zbnMgLSAxKSAm
JiAoaiA8IElOU1RSVUNUSU9OU19NQVggLSAxKTsKKyAgICAgICAgICAgICAgICBqKyspIHsKKyAg
ICAgICAgICAgICAgICBwYWNrZXQtPmluc25bal0gPSBwYWNrZXQtPmluc25baiArIDFdOworICAg
ICAgICAgICAgfQorICAgICAgICAgICAgcGFja2V0LT5udW1faW5zbnMtLTsKKyAgICAgICAgfQor
ICAgIH0KK30KKworc3RhdGljIFNsb3RNYXNrIGdldF92YWxpZF9zbG90cyhjb25zdCBQYWNrZXQg
KnBrdCwgdW5zaWduZWQgaW50IHNsb3QpCit7CisgICAgcmV0dXJuIGZpbmRfaWNsYXNzX3Nsb3Rz
KHBrdC0+aW5zbltzbG90XS5vcGNvZGUsCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBr
dC0+aW5zbltzbG90XS5pY2xhc3MpOworfQorCisjaW5jbHVkZSAicTZ2X2RlY29kZS5jIgorCisv
KiBVc2VkIGZvciAiLWQgaW5fYXNtIiBsb2dnaW5nICovCitpbnQgZGlzYXNzZW1ibGVfaGV4YWdv
bih1aW50MzJfdCAqd29yZHMsIGludCBud29yZHMsIGJmZF92bWEgcGMsCisgICAgICAgICAgICAg
ICAgICAgICAgICBHU3RyaW5nICpidWYpCit7CisgICAgUGFja2V0IHBrdDsKKworICAgIGlmIChk
ZWNvZGVfcGFja2V0KG53b3Jkcywgd29yZHMsICZwa3QsIHRydWUpID4gMCkgeworICAgICAgICBz
bnByaW50X2FfcGt0X2Rpc2FzKGJ1ZiwgJnBrdCwgd29yZHMsIHBjKTsKKyAgICAgICAgcmV0dXJu
IHBrdC5lbmNvZF9wa3Rfc2l6ZV9pbl9ieXRlczsKKyAgICB9IGVsc2UgeworICAgICAgICBnX3N0
cmluZ19hc3NpZ24oYnVmLCAiPGludmFsaWQ+Iik7CisgICAgICAgIHJldHVybiAwOworICAgIH0K
K30KZGlmZiAtLWdpdCBhL3RhcmdldC9oZXhhZ29uL3E2dl9kZWNvZGUuYyBiL3RhcmdldC9oZXhh
Z29uL3E2dl9kZWNvZGUuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwLi5lNjdh
OGFiCi0tLSAvZGV2L251bGwKKysrIGIvdGFyZ2V0L2hleGFnb24vcTZ2X2RlY29kZS5jCkBAIC0w
LDAgKzEsMzg1IEBACisvKgorICogIENvcHlyaWdodChjKSAyMDE5LTIwMjEgUXVhbGNvbW0gSW5u
b3ZhdGlvbiBDZW50ZXIsIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC4KKyAqCisgKiAgVGhpcyBw
cm9ncmFtIGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBt
b2RpZnkKKyAqICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBM
aWNlbnNlIGFzIHB1Ymxpc2hlZCBieQorICogIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247
IGVpdGhlciB2ZXJzaW9uIDIgb2YgdGhlIExpY2Vuc2UsIG9yCisgKiAgKGF0IHlvdXIgb3B0aW9u
KSBhbnkgbGF0ZXIgdmVyc2lvbi4KKyAqCisgKiAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVk
IGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCisgKiAgYnV0IFdJVEhPVVQgQU5Z
IFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKKyAqICBNRVJD
SEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhl
CisgKiAgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KKyAqCisg
KiAgWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVi
bGljIExpY2Vuc2UKKyAqICBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbTsgaWYgbm90LCBzZWUgPGh0
dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LgorICovCisKKyNkZWZpbmUgREVDT0RFX05FV19U
QUJMRShUQUcsIFNJWkUsIFdIQVROT1QpICAgICAvKiBOT1RISU5HICovCisjZGVmaW5lIFRBQkxF
X0xJTksoVEFCTEUpICAgICAgICAgICAgICAgICAgICAgICAgLyogTk9USElORyAqLworI2RlZmlu
ZSBURVJNSU5BTChUQUcsIEVOQykgICAgICAgICAgICAgICAgICAgICAgIC8qIE5PVEhJTkcgKi8K
KyNkZWZpbmUgU1VCSU5TTlMoVEFHLCBDTEFTU0EsIENMQVNTQiwgRU5DKSAgICAgICAvKiBOT1RI
SU5HICovCisjZGVmaW5lIEVYVFNQQUNFKFRBRywgRU5DKSAgICAgICAgICAgICAgICAgICAgICAg
LyogTk9USElORyAqLworI2RlZmluZSBJTlZBTElEKCkgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIC8qIE5PVEhJTkcgKi8KKyNkZWZpbmUgREVDT0RFX0VORF9UQUJMRSguLi4pICAgICAg
ICAgICAgICAgICAgICAvKiBOT1RISU5HICovCisjZGVmaW5lIERFQ09ERV9NQVRDSF9JTkZPKC4u
LikgICAgICAgICAgICAgICAgICAgLyogTk9USElORyAqLworI2RlZmluZSBERUNPREVfTEVHQUNZ
X01BVENIX0lORk8oLi4uKSAgICAgICAgICAgIC8qIE5PVEhJTkcgKi8KKworI2RlZmluZSBERUNP
REVfUkVHKFJFR05PLCBXSURUSCwgU1RBUlRCSVQpIFwKKyAgICBpbnNuLT5yZWdub1tSRUdOT10g
PSAoKGVuY29kaW5nID4+IFNUQVJUQklUKSAmICgoMSA8PCBXSURUSCkgLSAxKSk7CisKKyNkZWZp
bmUgREVDT0RFX0lNUExfUkVHKFJFR05PLCBWQUwpIFwKKyAgICBpbnNuLT5yZWdub1tSRUdOT10g
PSBWQUw7CisKKyNkZWZpbmUgREVDT0RFX0lNTShJTU1OTywgV0lEVEgsIFNUQVJUQklULCBWQUxT
VEFSVCkgXAorICAgIGluc24tPmltbWVkW0lNTU5PXSB8PSAoKChlbmNvZGluZyA+PiBTVEFSVEJJ
VCkgJiAoKDEgPDwgV0lEVEgpIC0gMSkpKSA8PCBcCisgICAgICAgICAgICAgICAgICAgICAgICAg
IChWQUxTVEFSVCk7CisKKyNkZWZpbmUgREVDT0RFX0lNTV9TWFQoSU1NTk8sIFdJRFRIKSBcCisg
ICAgaW5zbi0+aW1tZWRbSU1NTk9dID0gKCgoKGludDMyX3QpaW5zbi0+aW1tZWRbSU1NTk9dKSA8
PCAoMzIgLSBXSURUSCkpID4+IFwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgKDMyIC0gV0lE
VEgpKTsKKworI2RlZmluZSBERUNPREVfSU1NX05FRyhJTU1OTywgV0lEVEgpIFwKKyAgICBpbnNu
LT5pbW1lZFtJTU1OT10gPSAtaW5zbi0+aW1tZWRbSU1NTk9dOworCisjZGVmaW5lIERFQ09ERV9J
TU1fU0hJRlQoSU1NTk8sIFNIQU1UKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwK
KyAgICBpZiAoKCFpbnNuLT5leHRlbnNpb25fdmFsaWQpIHx8IFwKKyAgICAgICAgKGluc24tPndo
aWNoX2V4dGVuZGVkICE9IElNTU5PKSkgeyBcCisgICAgICAgIGluc24tPmltbWVkW0lNTU5PXSA8
PD0gU0hBTVQ7IFwKKyAgICB9CisKKyNkZWZpbmUgREVDT0RFX09QSU5GTyhUQUcsIEJFSCkgXAor
ICAgIGNhc2UgVEFHOiBcCisgICAgICAgIHsgQkVIICB9IFwKKyAgICAgICAgYnJlYWs7IFwKKwor
LyoKKyAqIEZpbGwgaW4gdGhlIG9wZXJhbmRzIG9mIHRoZSBpbnN0cnVjdGlvbgorICogZGVjdHJl
ZV9nZW5lcmF0ZWQuaCBoYWQgYSBERUNPREVfT1BJTkZPIGVudHJ5IGZvciBlYWNoIG9wY29kZQor
ICogRm9yIGV4YW1wbGUsCisgKiAgICAgREVDT0RFX09QSU5GTyhBMl9hZGRpLAorICogICAgICAg
ICAgREVDT0RFX1JFRygwLDUsMCkKKyAqICAgICAgICAgIERFQ09ERV9SRUcoMSw1LDE2KQorICog
ICAgICAgICAgREVDT0RFX0lNTSgwLDcsMjEsOSkKKyAqICAgICAgICAgIERFQ09ERV9JTU0oMCw5
LDUsMCkKKyAqICAgICAgICAgIERFQ09ERV9JTU1fU1hUKDAsMTYpCisgKiB3aXRoIHRoZSBtYWNy
b3MgZGVmaW5lZCBhYm92ZSwgd2UnbGwgZmlsbCBpbiBhIHN3aXRjaCBzdGF0ZW1lbnQKKyAqIHdo
ZXJlIGVhY2ggY2FzZSBpcyBhbiBvcGNvZGUgdGFnLgorICovCitzdGF0aWMgdm9pZAorZGVjb2Rl
X29wKEluc24gKmluc24sIE9wY29kZSB0YWcsIHVpbnQzMl90IGVuY29kaW5nKQoreworICAgIGlu
c24tPmltbWVkWzBdID0gMDsKKyAgICBpbnNuLT5pbW1lZFsxXSA9IDA7CisgICAgaW5zbi0+b3Bj
b2RlID0gdGFnOworICAgIGlmIChpbnNuLT5leHRlbnNpb25fdmFsaWQpIHsKKyAgICAgICAgaW5z
bi0+d2hpY2hfZXh0ZW5kZWQgPSBvcGNvZGVfd2hpY2hfaW1tZWRpYXRlX2lzX2V4dGVuZGVkKHRh
Zyk7CisgICAgfQorCisgICAgc3dpdGNoICh0YWcpIHsKKyNpbmNsdWRlICJkZWN0cmVlX2dlbmVy
YXRlZC5oIgorICAgIGRlZmF1bHQ6CisgICAgICAgIGJyZWFrOworICAgIH0KKworICAgIGluc24t
PmdlbmVyYXRlID0gb3Bjb2RlX2dlbnB0clt0YWddOworCisgICAgaW5zbi0+aWNsYXNzID0gaWNs
YXNzX2JpdHMoZW5jb2RpbmcpOworfQorCisjdW5kZWYgREVDT0RFX1JFRworI3VuZGVmIERFQ09E
RV9JTVBMX1JFRworI3VuZGVmIERFQ09ERV9JTU0KKyN1bmRlZiBERUNPREVfSU1NX1NISUZUCisj
dW5kZWYgREVDT0RFX09QSU5GTworI3VuZGVmIERFQ09ERV9NQVRDSF9JTkZPCisjdW5kZWYgREVD
T0RFX0xFR0FDWV9NQVRDSF9JTkZPCisjdW5kZWYgREVDT0RFX0VORF9UQUJMRQorI3VuZGVmIElO
VkFMSUQKKyN1bmRlZiBURVJNSU5BTAorI3VuZGVmIFNVQklOU05TCisjdW5kZWYgRVhUU1BBQ0UK
KyN1bmRlZiBUQUJMRV9MSU5LCisjdW5kZWYgREVDT0RFX05FV19UQUJMRQorI3VuZGVmIERFQ09E
RV9TRVBBUkFUT1JfQklUUworCitzdGF0aWMgdW5zaWduZWQgaW50CitkZWNvZGVfc3ViaW5zbl90
YWJsZXdhbGsoSW5zbiAqaW5zbiwgY29uc3QgRGVjdHJlZVRhYmxlICp0YWJsZSwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICB1aW50MzJfdCBlbmNvZGluZykKK3sKKyAgICB1bnNpZ25lZCBpbnQg
aTsKKyAgICBPcGNvZGUgb3BjOworICAgIGlmICh0YWJsZS0+bG9va3VwX2Z1bmN0aW9uKSB7Cisg
ICAgICAgIGkgPSB0YWJsZS0+bG9va3VwX2Z1bmN0aW9uKHRhYmxlLT5zdGFydGJpdCwgdGFibGUt
PndpZHRoLCBlbmNvZGluZyk7CisgICAgfSBlbHNlIHsKKyAgICAgICAgaSA9IGV4dHJhY3QzMihl
bmNvZGluZywgdGFibGUtPnN0YXJ0Yml0LCB0YWJsZS0+d2lkdGgpOworICAgIH0KKyAgICBpZiAo
dGFibGUtPnRhYmxlW2ldLnR5cGUgPT0gREVDVFJFRV9UQUJMRV9MSU5LKSB7CisgICAgICAgIHJl
dHVybiBkZWNvZGVfc3ViaW5zbl90YWJsZXdhbGsoaW5zbiwgdGFibGUtPnRhYmxlW2ldLnRhYmxl
X2xpbmssCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5jb2Rpbmcp
OworICAgIH0gZWxzZSBpZiAodGFibGUtPnRhYmxlW2ldLnR5cGUgPT0gREVDVFJFRV9URVJNSU5B
TCkgeworICAgICAgICBvcGMgPSB0YWJsZS0+dGFibGVbaV0ub3Bjb2RlOworICAgICAgICBpZiAo
KGVuY29kaW5nICYgZGVjb2RlX2l0YWJsZVtvcGNdLm1hc2spICE9IGRlY29kZV9pdGFibGVbb3Bj
XS5tYXRjaCkgeworICAgICAgICAgICAgcmV0dXJuIDA7CisgICAgICAgIH0KKyAgICAgICAgZGVj
b2RlX29wKGluc24sIG9wYywgZW5jb2RpbmcpOworICAgICAgICByZXR1cm4gMTsKKyAgICB9IGVs
c2UgeworICAgICAgICByZXR1cm4gMDsKKyAgICB9Cit9CisKK3N0YXRpYyB1bnNpZ25lZCBpbnQg
Z2V0X2luc25fYSh1aW50MzJfdCBlbmNvZGluZykKK3sKKyAgICByZXR1cm4gZXh0cmFjdDMyKGVu
Y29kaW5nLCAwLCAxMyk7Cit9CisKK3N0YXRpYyB1bnNpZ25lZCBpbnQgZ2V0X2luc25fYih1aW50
MzJfdCBlbmNvZGluZykKK3sKKyAgICByZXR1cm4gZXh0cmFjdDMyKGVuY29kaW5nLCAxNiwgMTMp
OworfQorCitzdGF0aWMgdW5zaWduZWQgaW50CitkZWNvZGVfaW5zbnNfdGFibGV3YWxrKEluc24g
Kmluc24sIGNvbnN0IERlY3RyZWVUYWJsZSAqdGFibGUsCisgICAgICAgICAgICAgICAgICAgICAg
IHVpbnQzMl90IGVuY29kaW5nKQoreworICAgIHVuc2lnbmVkIGludCBpOworICAgIHVuc2lnbmVk
IGludCBhLCBiOworICAgIE9wY29kZSBvcGM7CisgICAgaWYgKHRhYmxlLT5sb29rdXBfZnVuY3Rp
b24pIHsKKyAgICAgICAgaSA9IHRhYmxlLT5sb29rdXBfZnVuY3Rpb24odGFibGUtPnN0YXJ0Yml0
LCB0YWJsZS0+d2lkdGgsIGVuY29kaW5nKTsKKyAgICB9IGVsc2UgeworICAgICAgICBpID0gZXh0
cmFjdDMyKGVuY29kaW5nLCB0YWJsZS0+c3RhcnRiaXQsIHRhYmxlLT53aWR0aCk7CisgICAgfQor
ICAgIGlmICh0YWJsZS0+dGFibGVbaV0udHlwZSA9PSBERUNUUkVFX1RBQkxFX0xJTkspIHsKKyAg
ICAgICAgcmV0dXJuIGRlY29kZV9pbnNuc190YWJsZXdhbGsoaW5zbiwgdGFibGUtPnRhYmxlW2ld
LnRhYmxlX2xpbmssCisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuY29k
aW5nKTsKKyAgICB9IGVsc2UgaWYgKHRhYmxlLT50YWJsZVtpXS50eXBlID09IERFQ1RSRUVfU1VC
SU5TTlMpIHsKKyAgICAgICAgYSA9IGdldF9pbnNuX2EoZW5jb2RpbmcpOworICAgICAgICBiID0g
Z2V0X2luc25fYihlbmNvZGluZyk7CisgICAgICAgIGIgPSBkZWNvZGVfc3ViaW5zbl90YWJsZXdh
bGsoaW5zbiwgdGFibGUtPnRhYmxlW2ldLnRhYmxlX2xpbmtfYiwgYik7CisgICAgICAgIGEgPSBk
ZWNvZGVfc3ViaW5zbl90YWJsZXdhbGsoaW5zbiArIDEsIHRhYmxlLT50YWJsZVtpXS50YWJsZV9s
aW5rLCBhKTsKKyAgICAgICAgaWYgKChhID09IDApIHx8IChiID09IDApKSB7CisgICAgICAgICAg
ICByZXR1cm4gMDsKKyAgICAgICAgfQorICAgICAgICByZXR1cm4gMjsKKyAgICB9IGVsc2UgaWYg
KHRhYmxlLT50YWJsZVtpXS50eXBlID09IERFQ1RSRUVfVEVSTUlOQUwpIHsKKyAgICAgICAgb3Bj
ID0gdGFibGUtPnRhYmxlW2ldLm9wY29kZTsKKyAgICAgICAgaWYgKChlbmNvZGluZyAmIGRlY29k
ZV9pdGFibGVbb3BjXS5tYXNrKSAhPSBkZWNvZGVfaXRhYmxlW29wY10ubWF0Y2gpIHsKKyAgICAg
ICAgICAgIGlmICgoZW5jb2RpbmcgJiBkZWNvZGVfbGVnYWN5X2l0YWJsZVtvcGNdLm1hc2spICE9
CisgICAgICAgICAgICAgICAgZGVjb2RlX2xlZ2FjeV9pdGFibGVbb3BjXS5tYXRjaCkgeworICAg
ICAgICAgICAgICAgIHJldHVybiAwOworICAgICAgICAgICAgfQorICAgICAgICB9CisgICAgICAg
IGRlY29kZV9vcChpbnNuLCBvcGMsIGVuY29kaW5nKTsKKyAgICAgICAgcmV0dXJuIDE7CisgICAg
fSBlbHNlIHsKKyAgICAgICAgcmV0dXJuIDA7CisgICAgfQorfQorCitzdGF0aWMgdW5zaWduZWQg
aW50CitkZWNvZGVfaW5zbnMoSW5zbiAqaW5zbiwgdWludDMyX3QgZW5jb2RpbmcpCit7CisgICAg
Y29uc3QgRGVjdHJlZVRhYmxlICp0YWJsZTsKKyAgICBpZiAocGFyc2VfYml0cyhlbmNvZGluZykg
IT0gMCkgeworICAgICAgICAvKiBTdGFydCB3aXRoIFBQIHRhYmxlIC0gMzIgYml0IGluc3RydWN0
aW9ucyAqLworICAgICAgICB0YWJsZSA9ICZkZWN0cmVlX3RhYmxlX0RFQ09ERV9ST09UXzMyOwor
ICAgIH0gZWxzZSB7CisgICAgICAgIC8qIHN0YXJ0IHdpdGggRUUgdGFibGUgLSBkdXBsZXggaW5z
dHJ1Y3Rpb25zICovCisgICAgICAgIHRhYmxlID0gJmRlY3RyZWVfdGFibGVfREVDT0RFX1JPT1Rf
RUU7CisgICAgfQorICAgIHJldHVybiBkZWNvZGVfaW5zbnNfdGFibGV3YWxrKGluc24sIHRhYmxl
LCBlbmNvZGluZyk7Cit9CisKK3N0YXRpYyB2b2lkIGRlY29kZV9hZGRfZW5kbG9vcF9pbnNuKElu
c24gKmluc24sIGludCBsb29wbnVtKQoreworICAgIGlmIChsb29wbnVtID09IDEwKSB7CisgICAg
ICAgIGluc24tPm9wY29kZSA9IEoyX2VuZGxvb3AwMTsKKyAgICAgICAgaW5zbi0+Z2VuZXJhdGUg
PSBvcGNvZGVfZ2VucHRyW0oyX2VuZGxvb3AwMV07CisgICAgfSBlbHNlIGlmIChsb29wbnVtID09
IDEpIHsKKyAgICAgICAgaW5zbi0+b3Bjb2RlID0gSjJfZW5kbG9vcDE7CisgICAgICAgIGluc24t
PmdlbmVyYXRlID0gb3Bjb2RlX2dlbnB0cltKMl9lbmRsb29wMV07CisgICAgfSBlbHNlIGlmIChs
b29wbnVtID09IDApIHsKKyAgICAgICAgaW5zbi0+b3Bjb2RlID0gSjJfZW5kbG9vcDA7CisgICAg
ICAgIGluc24tPmdlbmVyYXRlID0gb3Bjb2RlX2dlbnB0cltKMl9lbmRsb29wMF07CisgICAgfSBl
bHNlIHsKKyAgICAgICAgZ19hc3NlcnRfbm90X3JlYWNoZWQoKTsKKyAgICB9Cit9CisKK3N0YXRp
YyBpbmxpbmUgaW50IGRlY29kZV9wYXJzZWJpdHNfaXNfbG9vcGVuZCh1aW50MzJfdCBlbmNvZGlu
ZzMyKQoreworICAgIHVpbnQzMl90IGJpdHMgPSBwYXJzZV9iaXRzKGVuY29kaW5nMzIpOworICAg
IHJldHVybiBiaXRzID09IDB4MjsKK30KKworc3RhdGljIHZvaWQKK2RlY29kZV9zZXRfc2xvdF9u
dW1iZXIoUGFja2V0ICpwa3QpCit7CisgICAgaW50IHNsb3Q7CisgICAgaW50IGk7CisgICAgaW50
IGhpdF9tZW1faW5zbiA9IDA7CisgICAgaW50IGhpdF9kdXBsZXggPSAwOworCisgICAgLyoKKyAg
ICAgKiBUaGUgc2xvdHMgYXJlIGVuY29kZWQgaW4gcmV2ZXJzZSBvcmRlcgorICAgICAqIEZvciBl
YWNoIGluc3RydWN0aW9uLCBjb3VudCBkb3duIHVudGlsIHlvdSBmaW5kIGEgc3VpdGFibGUgc2xv
dAorICAgICAqLworICAgIGZvciAoaSA9IDAsIHNsb3QgPSAzOyBpIDwgcGt0LT5udW1faW5zbnM7
IGkrKykgeworICAgICAgICBTbG90TWFzayB2YWxpZF9zbG90cyA9IGdldF92YWxpZF9zbG90cyhw
a3QsIGkpOworCisgICAgICAgIHdoaWxlICghKHZhbGlkX3Nsb3RzICYgKDEgPDwgc2xvdCkpKSB7
CisgICAgICAgICAgICBzbG90LS07CisgICAgICAgIH0KKyAgICAgICAgcGt0LT5pbnNuW2ldLnNs
b3QgPSBzbG90OworICAgICAgICBpZiAoc2xvdCkgeworICAgICAgICAgICAgLyogSSd2ZSBhc3Np
Z25lZCB0aGUgc2xvdCwgbm93IGRlY3JlbWVudCBpdCBmb3IgdGhlIG5leHQgaW5zbiAqLworICAg
ICAgICAgICAgc2xvdC0tOworICAgICAgICB9CisgICAgfQorCisgICAgLyogRml4IHRoZSBleGNl
cHRpb25zIC0gbWVtIGluc25zIHRvIHNsb3QgMCwxICovCisgICAgZm9yIChpID0gcGt0LT5udW1f
aW5zbnMgLSAxOyBpID49IDA7IGktLSkgeworICAgICAgICAvKiBGaXJzdCBtZW1vcnkgaW5zdHJ1
Y3Rpb24gYWx3YXlzIGdvZXMgdG8gc2xvdCAwICovCisgICAgICAgIGlmICgoR0VUX0FUVFJJQihw
a3QtPmluc25baV0ub3Bjb2RlLCBBX01FTUxJS0UpIHx8CisgICAgICAgICAgICAgR0VUX0FUVFJJ
Qihwa3QtPmluc25baV0ub3Bjb2RlLCBBX01FTUxJS0VfUEFDS0VUX1JVTEVTKSkgJiYKKyAgICAg
ICAgICAgICFoaXRfbWVtX2luc24pIHsKKyAgICAgICAgICAgIGhpdF9tZW1faW5zbiA9IDE7Cisg
ICAgICAgICAgICBwa3QtPmluc25baV0uc2xvdCA9IDA7CisgICAgICAgICAgICBjb250aW51ZTsK
KyAgICAgICAgfQorCisgICAgICAgIC8qIE5leHQgbWVtb3J5IGluc3RydWN0aW9uIGFsd2F5cyBn
b2VzIHRvIHNsb3QgMSAqLworICAgICAgICBpZiAoKEdFVF9BVFRSSUIocGt0LT5pbnNuW2ldLm9w
Y29kZSwgQV9NRU1MSUtFKSB8fAorICAgICAgICAgICAgIEdFVF9BVFRSSUIocGt0LT5pbnNuW2ld
Lm9wY29kZSwgQV9NRU1MSUtFX1BBQ0tFVF9SVUxFUykpICYmCisgICAgICAgICAgICBoaXRfbWVt
X2luc24pIHsKKyAgICAgICAgICAgIHBrdC0+aW5zbltpXS5zbG90ID0gMTsKKyAgICAgICAgfQor
ICAgIH0KKworICAgIC8qIEZpeCB0aGUgZXhjZXB0aW9ucyAtIGR1cGxleCBhbHdheXMgc2xvdCAw
LDEgKi8KKyAgICBmb3IgKGkgPSBwa3QtPm51bV9pbnNucyAtIDE7IGkgPj0gMDsgaS0tKSB7Cisg
ICAgICAgIC8qIEZpcnN0IHN1Ymluc24gYWx3YXlzIGdvZXMgdG8gc2xvdCAwICovCisgICAgICAg
IGlmIChHRVRfQVRUUklCKHBrdC0+aW5zbltpXS5vcGNvZGUsIEFfU1VCSU5TTikgJiYgIWhpdF9k
dXBsZXgpIHsKKyAgICAgICAgICAgIGhpdF9kdXBsZXggPSAxOworICAgICAgICAgICAgcGt0LT5p
bnNuW2ldLnNsb3QgPSAwOworICAgICAgICAgICAgY29udGludWU7CisgICAgICAgIH0KKworICAg
ICAgICAvKiBOZXh0IHN1Ymluc24gYWx3YXlzIGdvZXMgdG8gc2xvdCAxICovCisgICAgICAgIGlm
IChHRVRfQVRUUklCKHBrdC0+aW5zbltpXS5vcGNvZGUsIEFfU1VCSU5TTikgJiYgaGl0X2R1cGxl
eCkgeworICAgICAgICAgICAgcGt0LT5pbnNuW2ldLnNsb3QgPSAxOworICAgICAgICB9CisgICAg
fQorCisgICAgLyogRml4IHRoZSBleGNlcHRpb25zIC0gc2xvdCAxIGlzIG5ldmVyIGVtcHR5LCBh
bHdheXMgYWxpZ25zIHRvIHNsb3QgMCAqLworICAgIGludCBzbG90MF9mb3VuZCA9IDA7CisgICAg
aW50IHNsb3QxX2ZvdW5kID0gMDsKKyAgICBpbnQgc2xvdDFfaWlkeCA9IDA7CisgICAgZm9yIChp
ID0gcGt0LT5udW1faW5zbnMgLSAxOyBpID49IDA7IGktLSkgeworICAgICAgICAvKiBJcyBzbG90
MCB1c2VkPyAqLworICAgICAgICBpZiAocGt0LT5pbnNuW2ldLnNsb3QgPT0gMCkgeworICAgICAg
ICAgICAgaW50IGlzX2VuZGxvb3AgPSAocGt0LT5pbnNuW2ldLm9wY29kZSA9PSBKMl9lbmRsb29w
MDEpOworICAgICAgICAgICAgaXNfZW5kbG9vcCB8PSAocGt0LT5pbnNuW2ldLm9wY29kZSA9PSBK
Ml9lbmRsb29wMCk7CisgICAgICAgICAgICBpc19lbmRsb29wIHw9IChwa3QtPmluc25baV0ub3Bj
b2RlID09IEoyX2VuZGxvb3AxKTsKKworICAgICAgICAgICAgLyoKKyAgICAgICAgICAgICAqIE1h
a2Ugc3VyZSBpdCdzIG5vdCBlbmRsb29wIHNpbmNlLCB3ZSdyZSBvdmVybG9hZGluZworICAgICAg
ICAgICAgICogc2xvdDAgZm9yIGVuZGxvb3AKKyAgICAgICAgICAgICAqLworICAgICAgICAgICAg
aWYgKCFpc19lbmRsb29wKSB7CisgICAgICAgICAgICAgICAgc2xvdDBfZm91bmQgPSAxOworICAg
ICAgICAgICAgfQorICAgICAgICB9CisgICAgICAgIC8qIElzIHNsb3QxIHVzZWQ/ICovCisgICAg
ICAgIGlmIChwa3QtPmluc25baV0uc2xvdCA9PSAxKSB7CisgICAgICAgICAgICBzbG90MV9mb3Vu
ZCA9IDE7CisgICAgICAgICAgICBzbG90MV9paWR4ID0gaTsKKyAgICAgICAgfQorICAgIH0KKyAg
ICAvKiBJcyBzbG90MCBlbXB0eSBhbmQgc2xvdDEgdXNlZD8gKi8KKyAgICBpZiAoKHNsb3QwX2Zv
dW5kID09IDApICYmIChzbG90MV9mb3VuZCA9PSAxKSkgeworICAgICAgICAvKiBUaGVuIHB1c2gg
aXQgdG8gc2xvdDAgKi8KKyAgICAgICAgcGt0LT5pbnNuW3Nsb3QxX2lpZHhdLnNsb3QgPSAwOwor
ICAgIH0KK30KKworLyoKKyAqIGRlY29kZV9wYWNrZXQKKyAqIERlY29kZXMgcGFja2V0IHdpdGgg
Z2l2ZW4gd29yZHMKKyAqIFJldHVybnMgMCBvbiBpbnN1ZmZpY2llbnQgd29yZHMsCisgKiBvciBu
dW1iZXIgb2Ygd29yZHMgdXNlZCBvbiBzdWNjZXNzCisgKi8KKworaW50IGRlY29kZV9wYWNrZXQo
aW50IG1heF93b3JkcywgY29uc3QgdWludDMyX3QgKndvcmRzLCBQYWNrZXQgKnBrdCwKKyAgICAg
ICAgICAgICAgICAgIGJvb2wgZGlzYXNfb25seSkKK3sKKyAgICBpbnQgbnVtX2luc25zID0gMDsK
KyAgICBpbnQgd29yZHNfcmVhZCA9IDA7CisgICAgaW50IGVuZF9vZl9wYWNrZXQgPSAwOworICAg
IGludCBuZXdfaW5zbnMgPSAwOworICAgIHVpbnQzMl90IGVuY29kaW5nMzI7CisKKyAgICAvKiBJ
bml0aWFsaXplICovCisgICAgbWVtc2V0KHBrdCwgMCwgc2l6ZW9mKCpwa3QpKTsKKyAgICAvKiBU
cnkgdG8gYnVpbGQgcGFja2V0ICovCisgICAgd2hpbGUgKCFlbmRfb2ZfcGFja2V0ICYmICh3b3Jk
c19yZWFkIDwgbWF4X3dvcmRzKSkgeworICAgICAgICBlbmNvZGluZzMyID0gd29yZHNbd29yZHNf
cmVhZF07CisgICAgICAgIGVuZF9vZl9wYWNrZXQgPSBpc19wYWNrZXRfZW5kKGVuY29kaW5nMzIp
OworICAgICAgICBuZXdfaW5zbnMgPSBkZWNvZGVfaW5zbnMoJnBrdC0+aW5zbltudW1faW5zbnNd
LCBlbmNvZGluZzMyKTsKKyAgICAgICAgLyoKKyAgICAgICAgICogSWYgd2Ugc2F3IGFuIGV4dGVu
ZGVyLCBtYXJrIG5leHQgd29yZCBleHRlbmRlZCBzbyBpbW1lZGlhdGUKKyAgICAgICAgICogZGVj
b2RlIHdvcmtzCisgICAgICAgICAqLworICAgICAgICBpZiAocGt0LT5pbnNuW251bV9pbnNuc10u
b3Bjb2RlID09IEE0X2V4dCkgeworICAgICAgICAgICAgcGt0LT5pbnNuW251bV9pbnNucyArIDFd
LmV4dGVuc2lvbl92YWxpZCA9IDE7CisgICAgICAgIH0KKyAgICAgICAgbnVtX2luc25zICs9IG5l
d19pbnNuczsKKyAgICAgICAgd29yZHNfcmVhZCsrOworICAgIH0KKworICAgIHBrdC0+bnVtX2lu
c25zID0gbnVtX2luc25zOworICAgIGlmICghZW5kX29mX3BhY2tldCkgeworICAgICAgICAvKiBS
YW4gb3V0IG9mIHdvcmRzISAqLworICAgICAgICByZXR1cm4gMDsKKyAgICB9CisgICAgcGt0LT5l
bmNvZF9wa3Rfc2l6ZV9pbl9ieXRlcyA9IHdvcmRzX3JlYWQgKiA0OworCisgICAgLyoKKyAgICAg
KiBDaGVjayBmb3IgOmVuZGxvb3AgaW4gdGhlIHBhcnNlIGJpdHMKKyAgICAgKiBTZWN0aW9uIDEw
LjYgb2YgdGhlIFByb2dyYW1tZXIncyBSZWZlcmVuY2UgZGVzY3JpYmVzIHRoZSBlbmNvZGluZwor
ICAgICAqICAgICBUaGUgZW5kIG9mIGhhcmR3YXJlIGxvb3AgMCBjYW4gYmUgZW5jb2RlZCB3aXRo
IDIgd29yZHMKKyAgICAgKiAgICAgVGhlIGVuZCBvZiBoYXJkd2FyZSBsb29wIDEgbmVlZHMgMyB3
b3JkcworICAgICAqLworICAgIGlmICgod29yZHNfcmVhZCA9PSAyKSAmJiAoZGVjb2RlX3BhcnNl
Yml0c19pc19sb29wZW5kKHdvcmRzWzBdKSkpIHsKKyAgICAgICAgZGVjb2RlX2FkZF9lbmRsb29w
X2luc24oJnBrdC0+aW5zbltwa3QtPm51bV9pbnNucysrXSwgMCk7CisgICAgfQorICAgIGlmICh3
b3Jkc19yZWFkID49IDMpIHsKKyAgICAgICAgdWludDMyX3QgaGFzX2xvb3AwLCBoYXNfbG9vcDE7
CisgICAgICAgIGhhc19sb29wMCA9IGRlY29kZV9wYXJzZWJpdHNfaXNfbG9vcGVuZCh3b3Jkc1sw
XSk7CisgICAgICAgIGhhc19sb29wMSA9IGRlY29kZV9wYXJzZWJpdHNfaXNfbG9vcGVuZCh3b3Jk
c1sxXSk7CisgICAgICAgIGlmIChoYXNfbG9vcDAgJiYgaGFzX2xvb3AxKSB7CisgICAgICAgICAg
ICBkZWNvZGVfYWRkX2VuZGxvb3BfaW5zbigmcGt0LT5pbnNuW3BrdC0+bnVtX2luc25zKytdLCAx
MCk7CisgICAgICAgIH0gZWxzZSBpZiAoaGFzX2xvb3AxKSB7CisgICAgICAgICAgICBkZWNvZGVf
YWRkX2VuZGxvb3BfaW5zbigmcGt0LT5pbnNuW3BrdC0+bnVtX2luc25zKytdLCAxKTsKKyAgICAg
ICAgfSBlbHNlIGlmIChoYXNfbG9vcDApIHsKKyAgICAgICAgICAgIGRlY29kZV9hZGRfZW5kbG9v
cF9pbnNuKCZwa3QtPmluc25bcGt0LT5udW1faW5zbnMrK10sIDApOworICAgICAgICB9CisgICAg
fQorCisgICAgZGVjb2RlX2FwcGx5X2V4dGVuZGVycyhwa3QpOworICAgIGlmICghZGlzYXNfb25s
eSkgeworICAgICAgICBkZWNvZGVfcmVtb3ZlX2V4dGVuZGVycyhwa3QpOworICAgIH0KKyAgICBk
ZWNvZGVfc2V0X3Nsb3RfbnVtYmVyKHBrdCk7CisgICAgZGVjb2RlX2ZpbGxfbmV3dmFsdWVfcmVn
bm8ocGt0KTsKKworICAgIGlmICghZGlzYXNfb25seSkgeworICAgICAgICBkZWNvZGVfc2h1ZmZs
ZV9mb3JfZXhlY3V0aW9uKHBrdCk7CisgICAgICAgIGRlY29kZV9zcGxpdF9jbXBqdW1wKHBrdCk7
CisgICAgICAgIGRlY29kZV9zZXRfaW5zbl9hdHRyX2ZpZWxkcyhwa3QpOworICAgIH0KKworICAg
IHJldHVybiB3b3Jkc19yZWFkOworfQotLSAKMi43LjQKCg==

